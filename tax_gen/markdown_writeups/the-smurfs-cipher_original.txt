<h1>The Smurfs Cipher</h1>

<h3>Category: Web Exploitation</h3>

<h3>Author: James Lowther (Articuler)</h3>

<h2>Description</h2>

<p>Gargamel stole the key to decrypt The Smurfs ciphertext. Now they can't get into their kingdom to view their flag. Can you help them get the right key?</p>

<h2>Solution</h2>

<p>This challenge gives you a file named <code>cipher</code> and the source code used to return the flag. Your goal is to reverse engineer the source code to create, and upload, the key that will allow the flag to be returned. This challenge requires you to exploit PHP loose comparison. In PHP versions less than 8 using <code>==</code> will loosly compare variables of different types, allowing expressions to implicitly evaluate to true. Any string (i.e. <code>password.txt</code>) compared with the integer <code>0</code> will evaluate to <code>true</code>. By making <code>to_check</code> equal to <code>0</code> we can echo the flag.</p>

<p>A table showing all of the PHP loose comparison values can be found <a href="https://www.php.net/manual/en/types.comparisons.php">here</a>.</p>

<ol>
<li>In order to get the flag we need to ensure that <code>$to_check</code> is <code>0</code> to exploit PHP using loose comparison.</li>
<li>Create a 8 byte file that is equivalent to the the data in <code>cipher + 0xd34db33f</code> and upload it.
<ul>
<li>Your key will be XORed with <code>cipher + 0xd34db33f</code>. If they are equivalent then the XOR result will be zero.</li>
</ul></li>
<li>The if statement will be <code>0 == "whatever the password is"</code> which evaluates to true, and the flag will be echoed back.</li>
</ol>

<h2>Flag</h2>

<p>magpie{l0053<em>c0mp4r150n</em>l34d5<em>t0</em>tr0ub13}</p>
