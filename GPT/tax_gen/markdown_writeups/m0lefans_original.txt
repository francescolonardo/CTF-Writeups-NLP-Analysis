<h2>M0leFans</h2>

<blockquote>
  <p>Solved By : thewhiteh4t</p>
</blockquote>

<p>This challenge begins at a login/register page, after login we can see the following :</p>

<ul>
<li>public feed</li>
<li>profile settings</li>
<li>report link</li>
<li>create post button</li>
<li>search</li>
<li>copy profile link</li>
<li>followers</li>
</ul>

<p><img src="https://i.imgur.com/Dta95kx.png" alt="" /></p>

<p>Inside settings we can set our custom subdomain and we can upload an avatar as well. I tried lot of XSS payloads in name fields as well as create post but JS was not executing, instead it was being printed on the page like normal text so I tried file upload instead</p>

<p>Only images are supported in the file upload but it can be easily bypassed with a GIF header or any other image header</p>

<p><code>
GIF header -&gt; GIF89a;
</code></p>

<p>After trying different file formats for upload I noticed that files were not executing at all, instead they were being downloaded as text files with a randomized filename, so eventually I tried an HTML file with a simple JS alert pop up and it worked!</p>

<p>File upload : </p>

<p><img src="https://i.imgur.com/w1mVfzK.png" alt="" /></p>

<p>In inspect element we can see that a HTML file has appeared in <code>src</code> of <code>img</code> tag :</p>

<p><img src="https://i.imgur.com/NdzDLgV.png" alt="" /></p>

<p>and the JS code is working!</p>

<p><img src="https://i.imgur.com/obQ9nEi.png" alt="" /></p>

<p>Now I saw the report link at the bottom of the page and it mentions that we can report posts to admin, at this point I thought we need to steal the cookie of admin and get access to the admin account but when I checked the cookie it had <code>HttpOnly</code>  flag enabled so this was not the correct direction.</p>

<p>I read the challenge description again and it mentions about <code>following</code> people, now I thought if somehow I can make the admin follow my account then I will be able to get the flag so I started looking into the <code>follow</code> request</p>

<p><img src="https://i.imgur.com/K2BgOiQ.png" alt="" /></p>

<p>It is a simple GET request on <code>/profile/follow</code> . Since JS is working I made a small JS script to call this request.</p>

<p>In theory it works like this :</p>

<ol>
<li>Upload new HTML file with updated JS script</li>
<li>Get the HTML file link from page source</li>
<li>Report the link</li>
<li>Admin opens the link and since JS will automatically execute the admin will silently follow us</li>
</ol>

<p>HTML code :</p>

<p><code>html
GIF89a;
&lt;html&gt;
&lt;head&gt;&lt;/head&gt;
&lt;body&gt;
    &lt;script&gt;
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", "https://twc.m0lecon.fans/profile/follow", true);
        xhttp.withCredentials = true;
        xhttp.send();
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></p>

<p>I got a success message after submitting the link</p>

<p><img src="https://i.imgur.com/O3y4LjU.png" alt="" /></p>

<p>And on the followers page I got a new request!</p>

<p><img src="https://i.imgur.com/OFsnhsW.png" alt="" /></p>

<p>This is the admin, I accepted the request but nothing happens, I cant see the profile of admin there is no link provided. To access the admin profile I needed a subdomain because every profile gets its own unique subdomain. I tried to guess it but that did not work, then I poked around the site for some time but could not find anything which revealed the subdomain so I used a classic technique, <code>subdomain enumeration</code> :</p>

<p><code>
finalrecon --sub https://m0lecon.fans
</code></p>

<p><img src="https://i.imgur.com/sjgHZUy.png" alt="" /></p>

<p>and thatâ€™s how I found the required subdomain!</p>

<p><code>
y0urmuchb3l0v3d4dm1n.m0lecon.fans
</code></p>

<p>But when I visited the profile, there is again nothing, the profile is private and bio does not have the flag, but there is a follow button!</p>

<p><img src="https://i.imgur.com/OxbCBUZ.png" alt="" /></p>

<p>When I clicked the follow button it showed request pending!</p>

<p><img src="https://i.imgur.com/nxBijew.png" alt="" /></p>

<p>I waited for some time thinking admin will automatically accept the request but that did not happen so that reminded me that maybe I can make the admin accept my follow request just like before!</p>

<p>The flow was similar to last time but this time a POST request was being sent to <code>/profile/requests</code> with a body which contained the <code>id</code> of the user who has sent the friend request.</p>

<p>Now I started looking for my id when i noticed that the session cookie is JWT. I decoded the JWT and got the id!</p>

<p><img src="https://i.imgur.com/0hP8whT.png" alt="" /></p>

<p>After compiling the information above here is the new HTML code :</p>

<p><code>html
GIF89a;
&lt;html&gt;
&lt;head&gt;&lt;/head&gt;
&lt;body&gt;
    &lt;script&gt;
        var xhttp = new XMLHttpRequest();
        xhttp.open("POST", "https://y0urmuchb3l0v3d4dm1n.m0lecon.fans/profile/request", true);
        xhttp.withCredentials = true;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send("id=30");
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></p>

<p>The upload and report were successful just like before and now the admin accepted our follow request!</p>

<p><img src="https://i.imgur.com/fVwgb9v.png" alt="" /></p>

<p>and the fan post contains our beloved flag!</p>

<p><img src="https://i.imgur.com/GTPqIKb.png" alt="" /></p>
