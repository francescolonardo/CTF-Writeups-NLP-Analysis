Title: Server Side Template Injection in Flask App
Primary topic: Web Exploitation
Secondary topic: Server Side Template Injection
Tools used: None
Keywords: flask, mako, font, SSTI

#context
Navigating to website, we are presented with the following page.

#discovery
On giving an input, it is sent through get parameter and it reponds with same input with different font styles.

#context
Looking into the source code reveals that its a flask app and using mako template engine for rendering. On line 11, the user input is passed into the spoofiky function and its output is passed into the template.

#code
Tracing the spookify function, it passes the text onto change_font function which just maps the text characters againts different font dictionaries. One font dictionary does not have any unique character for mapping.

#exploitation
Since, the user input is directly passed into the template with any sanitization, this introduces the Server Side Template Injection (SSTI). We confirm it by using the following payload and it sucessfully evaluates it.

#code
{{7*7}}

#exploitation
Then using the following payload, we can run commands on the system and read our flag. 

#code
{{''.__class__.__mro__[1].__subclasses__()[414]('/bin/sh',shell=True,stdout=-1).communicate()[0].strip()}}
